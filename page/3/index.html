<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Xiaolong, lucky" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="程序猿">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiaolong的个人博客">
<meta property="og:url" content="http://rngift.com/page/3/index.html">
<meta property="og:site_name" content="Xiaolong的个人博客">
<meta property="og:description" content="程序猿">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xiaolong的个人博客">
<meta name="twitter:description" content="程序猿">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rngift.com/page/3/"/>





  <title> Xiaolong的个人博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xiaolong的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">每一天都值得被认真对待</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/pastLove" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            爱过的人
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/02/23/MeetMomeryLeak/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/23/MeetMomeryLeak/" itemprop="url">
                  初识内存泄露
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-23T16:02:22+08:00">
                2017-02-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android内存优化/" itemprop="url" rel="index">
                    <span itemprop="name">Android内存优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>什么是内存泄露</strong></p>
<blockquote>
<p>从java的垃圾回收机制说起吧。java比C++好的一点就是有自己的垃圾回收机制。在java虚拟机运行的过程中会把一些没有指向的对象(已知存活的对象节点无法遍历到的对象)回收。</p>
<p>如果一个对象不再被使用，理论上是要被回收的，但是因为它可能被某些存活的对象持有了。导致不能回收。这样的对象会一直占用着内存，直到持有它的对象销毁。而因为强占着内存，很容易导致内存溢出，即OOM。</p>
</blockquote>
<p><strong>为什么会发生内存泄露</strong><br>在Android程序开发中，当一个对象已经不需要再使用了，本该被回收时，而另外一个正在使用的对象持有它的引用从而导致它不能被回收，这就导致本该被回收的对象不能被回收而停留在堆内存中，内存泄漏就产生了。</p>
<p><strong>内存泄漏有什么影响</strong><br>它是造成应用程序OOM的主要原因之一。由于Android系统为每个应用程序分配的内存有限，当一个应用中产生的内存泄漏比较多时，就难免会导致应用所需要的内存超过这个系统分配的内存限额，这就造成了内存溢出而导致应用Crash。</p>
<p><strong>如何避免内存泄露</strong><br>简单地说应该在对象赋值时先看一下持有这个对象的类/变量的声明周期。<br>1.静态变量/对象<br>一些类似于广播啊，EventBus注册，监听事件的注册，因为这些的生命周期都是比Activity长的。所以在activity销毁的时候要取消注册。</p>
<p>今天遇到的一个内存泄露的问题就是因为注册了OrientationEventListener ，在onDestory的时候没有取消监听。当前的context一直都没办法释放掉。打开一次页面5M。一二十次就OOM了。<br>解决方案：在页面销毁的时候记得取消监听。</p>
<p>另外一个内存泄露的问题是webView，webView在activity销毁的时候同样要解除引用，并做销毁。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">   protected void onDestroy() &#123;</div><div class="line">       if (baseWebView != null) &#123;</div><div class="line">           ((ViewGroup) baseWebView.getParent()).removeView(baseWebView);</div><div class="line">           baseWebView.destroy();</div><div class="line">       &#125;</div><div class="line">       super.onDestroy();</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>2.非静态内部类（非静态内部类持有当前类的引用）</p>
<p>经常在类里面定义非静态内部类，因为非静态内部类会持有当前类的引用。所以在非静态内部类的工作未结束的时候当前类也不会被回收。<br>例如我们很经常在类里面自定义个Handler 或者Thread。<br>解决方案：用静态内部类来替换。<br>3.图片处理<br>图片处理的过程中不用的图片及时销毁。不然即使没有泄露，因为图片对象一样会OOM的。<br><strong>一、单例造成的内存泄漏</strong><br>如下这个典例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class AppManager &#123;</div><div class="line">    private static AppManager instance;</div><div class="line">    private Context context;</div><div class="line">    private AppManager(Context context) &#123;</div><div class="line">        this.context = context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static AppManager getInstance(Context context) &#123;</div><div class="line">        if (instance != null) &#123;</div><div class="line">            instance = new AppManager(context);</div><div class="line">        &#125;</div><div class="line">        return instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是一个普通的单例模式，当创建这个单例的时候，由于需要传入一个Context，所以这个Context的生命周期的长短至关重要：</p>
<p>1、传入的是Application的Context：这将没有任何问题，因为单例的生命周期和Application的一样长 ;</p>
<p>2、传入的是Activity的Context：当这个Context所对应的Activity退出时，由于该Context和Activity的生命周期一样长(Activity间接继承于Context)，所以当前Activity退出时它的内存并不会被回收，因为单例对象持有该Activity的对象，单例应该修改为下面这种方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class AppManager &#123;</div><div class="line">    private static AppManager instance;</div><div class="line">    private Context context;</div><div class="line">    private AppManager(Context context) &#123;</div><div class="line">        this.context = context.getApplicationContext();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static AppManager getInstance(Context context) &#123;</div><div class="line">        if (instance != null) &#123;</div><div class="line">            instance = new AppManager(context);</div><div class="line">        &#125;</div><div class="line">        return instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样子持有的是应用的context，就不用担心生命周期比APP还长了。<br>Android的单例模式非常受开发者的喜爱，不过使用的不恰当的话也会造成内存泄漏。因为单例的静态特性使得单例的生命周期和应用的生命周期一样长，这就说明了如果一个对象已经不需要使用了，而单例对象还持有该对象的引用，那么这个对象将不能被正常回收，这就导致了内存泄漏。</p>
<p><strong>二、非静态内部类创建静态实例造成的内存泄漏</strong></p>
<p>有的时候我们可能会在启动频繁的Activity中，为了避免重复创建相同的数据资源，会出现这种写法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    private static TestResource mResource = null;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        if(mManager == null)&#123;</div><div class="line">            mManager = new TestResource();</div><div class="line">        &#125;</div><div class="line">        //...</div><div class="line">    &#125;</div><div class="line">    class TestResource &#123;</div><div class="line">        //...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样就在Activity内部创建了一个非静态内部类的单例，每次启动Activity时都会使用该单例的数据，这样虽然避免了资源的重复创建，不过这种写法却会造成内存泄漏，因为非静态内部类默认会持有外部类的引用，而又使用了该非静态内部类创建了一个静态的实例，该实例的生命周期和应用的一样长，这就导致了该静态实例一直会持有该Activity的引用，导致Activity的内存资源不能正常回收。正确的做法为：</p>
<p>将该内部类设为静态内部类或将该内部类抽取出来封装成一个单例，如果需要使用Context，请使用ApplicationContext 。</p>
<p><strong>三、Handler造成的内存泄漏</strong></p>
<p>Handler的使用造成的内存泄漏问题应该说最为常见了，平时在处理网络任务或者封装一些请求回调等api都应该会借助Handler来处理，对于Handler的使用代码编写一不规范即有可能造成内存泄漏，如下示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private Handler mHandler = new Handler() &#123;</div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            //...</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        loadData();</div><div class="line">    &#125;</div><div class="line">    private void loadData()&#123;</div><div class="line">        //...request</div><div class="line">        Message message = Message.obtain();</div><div class="line">        mHandler.sendMessage(message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这种创建Handler的方式会造成内存泄漏，由于mHandler是Handler的非静态匿名内部类的实例，所以它持有外部类Activity的引用，我们知道消息队列是在一个Looper线程中不断轮询处理消息，那么当这个Activity退出时消息队列中还有未处理的消息或者正在处理消息，而消息队列中的Message持有mHandler实例的引用，mHandler又持有Activity的引用，所以导致该Activity的内存资源无法及时回收，引发内存泄漏，所以另外一种做法为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    private MyHandler mHandler = new MyHandler(this);</div><div class="line">    private TextView mTextView ;</div><div class="line">    private static class MyHandler extends Handler &#123;</div><div class="line">        private WeakReference&lt;Context&gt; reference;</div><div class="line">        public MyHandler(Context context) &#123;</div><div class="line">            reference = new WeakReference&lt;&gt;(context);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            MainActivity activity = (MainActivity) reference.get();</div><div class="line">            if(activity != null)&#123;</div><div class="line">                activity.mTextView.setText(&quot;&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">  </div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mTextView = (TextView)findViewById(R.id.textview);</div><div class="line">        loadData();</div><div class="line">    &#125;</div><div class="line">  </div><div class="line">    private void loadData() &#123;</div><div class="line">        //...request</div><div class="line">        Message message = Message.obtain();</div><div class="line">        mHandler.sendMessage(message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>创建一个静态Handler内部类，然后对Handler持有的对象使用弱引用，这样在回收时也可以回收Handler持有的对象，这样虽然避免了Activity泄漏，不过Looper线程的消息队列中还是可能会有待处理的消息，所以我们在Activity的Destroy时或者Stop时应该移除消息队列中的消息，更准确的做法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"> public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    private MyHandler mHandler = new MyHandler(this);</div><div class="line">    private TextView mTextView ;</div><div class="line">    private static class MyHandler extends Handler &#123;</div><div class="line">        private WeakReference&lt;Context&gt; reference;</div><div class="line">        public MyHandler(Context context) &#123;</div><div class="line">            reference = new WeakReference&lt;&gt;(context);</div><div class="line">        &#125;</div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            MainActivity activity = (MainActivity) reference.get();</div><div class="line">            if(activity != null)&#123;</div><div class="line">                activity.mTextView.setText(&quot;&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mTextView = (TextView)findViewById(R.id.textview);</div><div class="line">        loadData();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void loadData() &#123;</div><div class="line">        //...request</div><div class="line">        Message message = Message.obtain();</div><div class="line">        mHandler.sendMessage(message);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDestroy() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        mHandler.removeCallbacksAndMessages(null);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用mHandler.removeCallbacksAndMessages(null);是移除消息队列中所有消息和所有的Runnable。当然也可以使用 mHandler.removeCallbacks();或mHandler.removeMessages()；来移除指定的Runnable和Message。<br> <strong>四、线程造成的内存泄漏</strong><br>对于线程造成的内存泄漏，也是平时比较常见的，如下这两个示例可能每个人都这样写过：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//——————test1 </div><div class="line">       new AsyncTask&lt;Void, Void, Void&gt;() &#123;</div><div class="line">        @Override</div><div class="line">        protected Void doInBackground(Void... params) &#123;</div><div class="line">            SystemClock.sleep(10000);</div><div class="line">            return null;</div><div class="line">        &#125;</div><div class="line">    &#125;.execute();</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//——————test2 </div><div class="line">new Thread(new Runnable() &#123;             </div><div class="line">    @Override             </div><div class="line">    public void run() &#123;</div><div class="line">    SystemClock.sleep(10000);             </div><div class="line">    &#125;         </div><div class="line">&#125;).start();</div></pre></td></tr></table></figure>
<p>上面的异步任务和Runnable都是一个匿名内部类，因此它们对当前Activity都有一个隐式引用。如果Activity在销毁之前，任务还未完成， 那么将导致Activity的内存资源无法回收，造成内存泄漏。正确的做法还是使用静态内部类的方式，如下： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">static class MyAsyncTask extends AsyncTask&lt;Void, Void, Void&gt; &#123;</div><div class="line">        private WeakReference&lt;Context&gt; weakReference;</div><div class="line">        public MyAsyncTask(Context context) &#123;</div><div class="line">            weakReference = new WeakReference&lt;&gt;(context);</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        protected Void doInBackground(Void... params) &#123;</div><div class="line">            SystemClock.sleep(10000);</div><div class="line">            return null;</div><div class="line">        &#125;</div><div class="line">        @Override</div><div class="line">        protected void onPostExecute(Void aVoid) &#123;</div><div class="line">            super.onPostExecute(aVoid);</div><div class="line">            MainActivity activity = (MainActivity) weakReference.get();</div><div class="line">            if (activity != null) &#123;</div><div class="line">                //...</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    static class MyRunnable implements Runnable&#123;</div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            SystemClock.sleep(10000);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">//——————</div><div class="line">    new Thread(new MyRunnable()).start();</div><div class="line">    new MyAsyncTask(this).execute();</div></pre></td></tr></table></figure>
<p>这样就避免了Activity的内存资源泄漏，当然在Activity销毁时候也应该取消相应的任务AsyncTask::cancel()，避免任务在后台执行浪费资源。 </p>
<p><strong>五、资源未关闭造成的内存泄漏</strong> </p>
<p>对于使用了BraodcastReceiver，ContentObserver，File，Cursor，Stream，Bitmap等资源的使用，应该在Activity销毁时及时关闭或者注销，否则这些资源将不会被回收，造成内存泄漏。 </p>
<p><strong>如何判断是否内存泄露</strong></p>
<p>在Android Studio的Monitor里面可以看到当前应用CPU,内存和网络还有GPU的使用情况<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/MeetMomeryLeak/20170223160821232.png?raw=true" alt="内存管理"><br>这里只说activity层面上的。<br>观察当前activity内存占用，在启动一个activity之后可以看到内存明显上升。因为activity创建时同时会生成很多对象实例。关闭掉当前activity点击<img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/MeetMomeryLeak/20170223161249733.png?raw=true" alt="GC"><br>可以看到内存又回复到之前差不多的状态。说明activity没有内存泄露的情况。有的话可能也不是什么严重的事情。<br>如果可以看到内存没减少或者内存基本没减少。</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/MeetMomeryLeak/20170223161746001.png?raw=true" alt="GC2"><br>可以点击内存回收按钮右边的两个小按钮进行分析，现在使用左边的<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/MeetMomeryLeak/20170223162018550.png?raw=true" alt="分析"><br>扩展出Analyzer Task 然后点击运行按钮可以看到重复的String值和泄露的Activity。<br>点击泄露的Activity<img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/MeetMomeryLeak/20170223162229172.png?raw=true" alt="ss"><br>可以看到Reference Tree 里面有当前activity的信息。一般第一条就是内存泄露的原因。<br>然后根据以上经验可以分析哪里出问题了。一看OreentationEventListener就知道是监听这边出问题了。。好吧，没有取消监听。在onDestory中加上。完美解决。</p>
<p>希望大家能有所收获，并能重视内存优化的问题，希望所有的app都没有OOM，没有ANR流畅不卡顿。^_^~~</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/02/19/AnnualSummary 2016/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/19/AnnualSummary 2016/" itemprop="url">
                  2016年总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-19T15:19:37+08:00">
                2017-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/阶段性总结/" itemprop="url" rel="index">
                    <span itemprop="name">阶段性总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="闲谈"><a href="#闲谈" class="headerlink" title="闲谈"></a>闲谈</h3><hr>
<p>已经毕业快一年了，少了很多刚出来那种激情了，感觉在公司呆久了也开始老油条了。嘻嘻！！<br>开始觉得目前的工作很无趣！<br>经常都是开始一个项目然后框架搭一搭赋值粘贴，一周个把月就是一个项目。<br><img src="http://img.blog.csdn.net/20170219135954610?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="一把梭！！"><br>在这里记录一下在公司这一年的收获吧。<br>首先，刚进公司的时候。虽然之前也有在另一家公司实习过。但是来了这一家公司明显感觉到了两家公司的不一样。可能目前待的公司算是厦门比较大的公司。也可能是因为目前公司搭建整个开发框架的那个小兄弟技术确实牛逼。刚进来就被这家公司的技术框架吸引了。从六月份开始，到现在用这个框架陆陆续续开发了五六个项目。一般都是半个月到一个月 最长的项目应该有两个多月。</p>
<h3 id="框架对比"><a href="#框架对比" class="headerlink" title="框架对比"></a>框架对比</h3><p>在这边上一下两家公司框架对比<br>|    框架名称        |    新公司        |    原公司    |<br>|—————|—————|————-|<br>|    网络请求        |Retrofit+RxJava+OkHttp    |Volley+OkHttp|<br>|    本地数据存储|    SQLlite+SharePreference(封装的较好)|SQLlite+SharePreference|<br>|数据解析|Gson+Retrofit(这边是Retrofit自带的一个Gson类，可以用注解的形式来绑定对象值)|    请求完毕后用Gson做解析，自己封装的库，好像添加了泛型实现，但总的来讲比较复杂        |<br>|    布局工具        |        AutoLayout（zhy的自动布局工具不得不说真的好用）        |    没有使用自动布局工具        |<br>|    Log工具        |        Logger（这个开源的log库感觉还蛮好用的一目了然）        |    DebugUtil    |<br>|    框架模式        |        MVP        |    无（数据绑定跟请求放一起了。这样在页面中存在了很多回调代码，感觉看起来很混乱。而且耦合度高。）    |<br>|    代码支持         |        Lambda        |    无（Lambda纯粹是用来简化代码的，但是不适合阅读）    |<br>|    事件总线        |        EventBus(也是基于handle机制开发的蛮好用的，值得一试。)        |Broadcast|<br>|    列表布局        |        RecycleView（封装）        |    ListView,GridView（封装）        |<br>|其他|支持高版本沉浸式，代码简洁。|不得不说实习的那一家公司各种工具类写的满满的，但是很多工具类其实都没有重用到。因为大家都不知道有那个类。所以在维护的时候就出现很多冗余的代码。|</p>
<p>贴一下使用到的框架。鸿洋的autolayout可以直接compile下来使用具体可以去找找他的github项目 ptr没怎么研究。就一个带ptrheadr的容器。其他的没什么。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">//控件</span></div><div class="line">   <span class="keyword">compile</span> <span class="keyword">project</span>(<span class="string">':autolayout'</span>)</div><div class="line">   <span class="comment">// Rx</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'io.reactivex:rxjava:1.1.1'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'io.reactivex:rxandroid:1.1.0'</span></div><div class="line">   <span class="comment">// Retrofit网络请求</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:retrofit:2.1.0'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:converter-gson:2.1.0'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:adapter-rxjava:2.1.0'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.google.code.gson:gson:2.6.1'</span></div><div class="line">   <span class="comment">//ptr</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'in.srain.cube:ultra-ptr:1.0.11'</span></div><div class="line">   <span class="comment">//glide</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.github.bumptech.glide:glide:3.7.0'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'jp.wasabeef:glide-transformations:2.0.1'</span></div><div class="line">   <span class="comment">//eventpost</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'org.greenrobot:eventbus:3.0.0'</span></div><div class="line">   <span class="comment">//okhttp</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.squareup.okhttp3:logging-interceptor:3.4.1'</span></div><div class="line">   <span class="comment">//log</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.orhanobut:logger:1.15'</span></div><div class="line"><span class="comment">//二维码</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.google.zxing:core:3.3.0'</span></div></pre></td></tr></table></figure></p>
<p>去上一家公司打了三个月的酱油，就写过一个模块的代码。还有一些bug的修改。当然后面问题也都是解决掉了。自己用上一家公司的框架也写过几个小项目。<br>新公司进来，从学习代码规范（上一家公司也有自己的代码规范，不过没有真正学好，因为写的代码不多），然后熟悉框架，差不多一周。之后就开始各种项目。做项目当然开心啦。旁边有同事不懂可以问。平常就各种把框架里面的一个个控件熟悉过来。那段时间刚进来。觉得每天都收获满满。一直加班~（那时候一直在想以我那时候的成长速度，一年后应该就屌炸天了。）不过现在已经是半年多了。事实并没有吊炸天。当然自身的成长还是不少的。这里也讲一下没有吊炸天的原因，因为在一家公司能学到的东西是有限的。</p>
<h3 id="自我反思"><a href="#自我反思" class="headerlink" title="自我反思"></a>自我反思</h3><p>在这家公司我做的项目没有一个项目上线有后续维护的。所有的都是一次做完，下一个项目接踵而至。从一开始做每一个功能都很新奇，到最后写个功能都能闭上眼睛复制粘贴。。我就觉得框架已经差不多了。如果要得到新知识只能自己去学。那个时候开始思考在普通公司工作跟在大公司工作的区别。很多小公司的项目用户其实并不多。只要能做到满足这几个用户的需求就可以了。所以对于性能，甚至效率。还有大部分用户体验的细节上都没有很用心。这个可以去看看腾讯微信的研磨就知道了。人家可是从心理学，行为学的角度来做用户体验的。所以呢？在非大公司的环境下所做的工作永远都是复制粘贴。我不禁想到十几年后我已经不够资格当一个程序员了。但是还是在做这些复制粘贴的工作领着死不能涨的工资。默默流下了悔恨的泪水。</p>
<p>嗯哼，上面的话语其实也讲明了选择一家大公司的重要性。大公司所做的项目都是为用户而来。他们要做的不只是不只是开发一个项目，更有从代码扩展，性能优化，还有单元测试，内存优化。这几个角度来使一个app趋于完美。感觉在那样的环境下生活的程序员才能叫真正的程序员吧。而我们永远走在程序和伪程序，有机会一定要去大公司！！！！！</p>
<p>好了。下一段。</p>
<h3 id="面试与总结"><a href="#面试与总结" class="headerlink" title="面试与总结"></a>面试与总结</h3><p>讲一下上周五去某个上市公司的面试经历</p>
<p>大概是酱的，之前想去一些大一点的公司继续深入学习更多的知识。然后就抽出手来投了几家公司。。当然这些公司招的职位都是高级职位。可能觉得初级职位太low了。作为一个一年开发经验的我。对于这种高级职位，感觉压力山大…投完之后感觉很后悔，为何不先选几个小公司去面几场先增加一下经验。好吧，过了一周，果不其然都被筛掉了。 又过了几天突然其中一家公司打电话过来约我去面试。可以看出我当时的表情= =~卧槽！！卧槽！！！走上人生巅峰的机会。当然那几天工作一直很忙，因为有一个项目进度很赶。所以我就多加了一会班。赶了一下进度，然后请了一天假去面试。。</p>
<p>面试过程大概如下：<br>一面：技术主管面试 二面：总监面试 一面和二面之间因为有一段时间是在等总监。所以顺便跟HR聊了一会。<br>跟主管聊的时候其实聊的还可以（当时感觉），可能他人也蛮不错的。他应该是做图像处理那一块的。所以跟我日常的工作经验还是有差距的。主要就聊了一下Handle，内存优化，OOM，自定义控件，三级缓存等。自己也回答了一些大概，当然一些深入的东西他也没去细究。包括面完我发现我居然忽略掉他的一些问题了。。好吧聊的还算开心。顺便问了他几个笔试题目。。感觉他脑子动的还是蛮快的。在这期间跟HR聊了一会。这里就聊的稍微有点瑕疵了。当然还是聊的蛮开心的。<br>加下来就是总监面了。那时候精神状态特别差。有好几个明明懂的问题。直接就说不懂了。然后各种答不对题。但他也算蛮有耐心的。我很多地方都没有说好，但总监就比较有气场一些。他也没说我讲的对不对，也不指正我的错误。有没答上的点就要求我补充，没说什么点，直接问有什么要补充的吗….真是日了狗。。然后越到后面脑子越乱。。后面问我有什么问题的时候我也没答好，问了一个问题后，直接跟他讲没问题了。。</p>
<p>在这边做一下面试总结。其实面试官的所有题目都是为开发岗位所必须具备的技能提的。包括一些逻辑题目还有java基础题目。当然很多题目他在我做完之后又问了我一次，这个可能就是答的并不符合他的要求。认真讲的话那天有几个点没把握住。<br>1.在面试的场合一定不要紧张。不然会忘掉很多东西。<br>2.如果他们又提问了卷子上的问题。说明有一部分问题还没有回答到点上。这个时候可以对自己所知道的在做进一步扩展。如果实在回答不对，就问一下到底是什么点。<br>3.职业生涯这一块最好对自己这几年的规划，比如说走技术路，以后可能会做架构这一方面的。比如说，先走技术路，之后可能会转管理这一块。<br>3.一般在结尾的时候他们会问你有没有什么问题想知道的。这个是三个面试官都有问我的。这个时候应该做出的回答可以是之前他们问你而你没有答上来的问题。也可以问一下如果进入公司负责的项目。或者公司对这方面技术的人有什么需求，自己有哪一些点没有做好。<br>4.在面试前请做好心理准备，有充足的精力来面对面试。</p>
<p><strong><em>By xiaolong：You have a dream,you got to protect it!</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/01/18/HotFix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/18/HotFix/" itemprop="url">
                  阿里百川HotFix的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-18T16:52:57+08:00">
                2017-01-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android第三方/" itemprop="url" rel="index">
                    <span itemprop="name">Android第三方</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="热修复技术前景分析"><a href="#热修复技术前景分析" class="headerlink" title="热修复技术前景分析"></a>热修复技术前景分析</h3><p>近两年来，热修复技术在安卓开发圈儿成为焦点。随之而来的是，相关的解决方案也不断涌现。为此，本文将热修复的几大流派分别做较深入的阐述，以使关注这一技术的开发同学有更深的了解。</p>
<p>在正式切入话题之前，我们先来看看传统的开发流程究竟有哪些痛点。概括之，可以用三个“太”来描述：1.重新发布版本的代价太大；2.用户下载安装的成本太高；3.BUG修复不及时造成用户体验太差。</p>
<p>正因为如此，热修复技术才得以施展，并被广大开发者追捧。那么，热修复开发流程具有怎样的优势？总结起来，也有三点。</p>
<p>第一， 无需重新发版，而且实时高效。</p>
<p>第二， 用户对修复过程无感知，也无需下载新的应用，总之，代价非常小。</p>
<p>第三， 修复的成功率高，可以吧损失降至最低。</p>
<p>哎呀，热修复技术真是棒棒哒。但是热修复技术虽好，可不能“贪杯”，毕竟流派较多，哪款才适合呢？</p>
<h3 id="市面上流行的热修复技术对比"><a href="#市面上流行的热修复技术对比" class="headerlink" title="市面上流行的热修复技术对比"></a>市面上流行的热修复技术对比</h3><p>目前，市面上主流的几个热修复流派有这些，阿里andfix、美团Robust、QQ空间和微信Tinker。那，咱们就一起来看看这些技术方案都有哪些优缺点？</p>
<p>阿里andfix  </p>
<p>hook本地方法. 并没有整体替换class。1. 打开链接库得到操作句柄, 获取native层内部函数, 得到classobject对象. 2. 修复访问权限属性为public 3. 得到新旧方法的指针, 新方法指向目标方法, 实现方法的替换</p>
<p>优点： 1. 不侵入打包, 性能无损耗；2. 即时生效。</p>
<p>缺点： 1. 需要针对dalvik虚拟机和art虚拟机做适配，需要考虑指令集的兼容问题，需要native代码支持，兼容性上会有一定的影响； 2. 不支持新增类方法/字段，以及修改<init>方法，也不支持对资源的替换。</init></p>
<p>美团Robust  </p>
<p>类似Instant Run原理, 每个产品代码的每个函数都在编译打包阶段自动的插入了一段代码。</p>
<p>客户端拿到patch.dex后，用DexClassLoader加载patch.dex. 其中的changeQuickRedirect字段赋值为用patch.dex中的StatePatch.java这个class new出来的对象。这就是打patch的主要过程。</p>
<p>优点： 正常的使用DexClassLoader，兼容性高，未反射注入，实时生效。</p>
<p>缺点： 1. 原来能被ProGuard内联的函数不能被内联了，所以可能导致方法数的增加，原来没超过65536但是后面可能就操作了65536限制，同时apk的体积也会一定程度的增大；2. so和资源的替换暂时不支持；3. 侵入式打包。</p>
<p>QQ空间</p>
<p>类似Multidex, 注入, 插桩. 大致的过程就是：把BUG方法修复以后，放到一个单独的DEX里，插入到dexElements数组的最前面，让虚拟机去加载修复完后的方法。</p>
<p>davilk: 但是有一个问题是，当两个调用关系的类不在同一个DEX时，就会产生异常报错。我们知道，在APK安装时，davilk虚拟机通过dexopt将classes.dex优化成odex文件，然后才会执行。在这个过程中，会进行类的verify操作，如果调用关系的类都在同一个DEX中的话就会被打上CLASS_ISPREVERIFIED的标志，然后才会写入odex文件。所以，为了可以正常的进行打补丁修复，必须避免类被打上CLASS_ISPREVERIFIED标志，具体的做法就是单独放一个类在另外DEX中，让其他类调用。但是虽然阻止了被打上CLASS_ISPREVERIFIED标志, 但是运行时加载类做verify与optimize所以效率低下. 特别是应用刚启动的情况下需要加载大量类的情况下就会花不少时间。</p>
<p>art: Art采用了新的方式，插桩对代码的执行效率并没有什么影响。但是若补丁中的类出现修改类变量或者方法，可能会导致出现内存地址错乱的问题。为了解决这个问题我们需要将修改了变量、方法以及接口的类的父类以及调用这个类的所有类都加入到补丁包中。</p>
<p>优点： 兼容性高</p>
<p>缺点： 1. 不支持实时生效；2. avilk下类加载性能问题；3. art下补丁包包很大；4. 侵入式打包。</p>
<p>微信Tinker</p>
<p>dex merge，微信针对QQ空间超级补丁技术的不足提出了一个提供DEX差量包，整体替换DEX的方案。主要的原理是与QQ空间超级补丁技术基本相同，区别在于不再将patch.dex增加到elements数组中，而是差量的方式给出patch.dex，然后将patch.dex与应用的classes.dex合并，然后整体替换掉旧的DEX，达到修复的目的。</p>
<p>优点： 1. 自研DexDiff算法, 深度利用Dex的格式来减少差异的大小。它的粒度是Dex格式的每一项，可以充分利用原本Dex的信息，而BsDiff的粒度是文件 补丁包足够小。2. 有效防止了qq空间导致的加载效率下降问题。3. 侵入式打包。</p>
<p>缺点： 1. 不支持即时生效；2. 需要给应用开启新的进程才能进行合并，并且很容易因为内存消耗等原因合并失败；3. 合并时占用额外磁盘空间，对于多DEX的应用来说，如果修改了多个DEX文件，就需要下发多个patch.dex与对应的classes.dex进行合并操作时，这种情况会更严重。</p>
<p>阿里百川HotFix</p>
<p>百川HotFix是在阿里AndFix的基础上，增加了补丁管理后台。我们可以在下面的图中看到我们的服务后台功能，可以上传补丁。补丁必须跟版本号绑定，同时提供了补丁控制功能, 比如停止发布/继续发布/灰度/全量发布等功能。 </p>
<p>同时HotFix基于手淘的实践针对andfix做了大量优化，性能上提高了兼容和稳定性，功能上比如支持新增类和基于类方法作为粒度所以有更小的补丁包，开源的andfix补丁包是以类作为粒度。</p>
<p>事实上，阿里百川HotFix也在不断演进之中，最新的2.0版已经突破了很多限制，比如，不支持资源修复，so修复；不支持新增类方法/类字段等。现在这些都不是问题啦，而且它还在依然在不断进化！</p>
<p>相较于最初的1.X版本，阿里百川HotFix  2.0可谓发生了“翻天覆地”的变化。有哪些？请看。</p>
<ul>
<li><p>将1.x版本的所有限制全部取消；</p>
</li>
<li><p>不仅仅只基于AndFix而是自由切换方案；</p>
</li>
<li><p>不管资源/SO文件/类修复都能做到实时生效；</p>
</li>
<li><p>傻瓜式接入, 完全不侵入你的打包过程, 可视化UI界面打补丁。</p>
</li>
</ul>
<p>这么一个好东东究竟啥时候有啊？别急，2017年1月中旬就会上线，到时候就可以“你有我有全都有了！”</p>
<p>另外，阿里百川HotFix还有一些“计划”。</p>
<p>1、更小的补丁包，比如尝试so和资源文件做bsdiff。</p>
<p>2、支持四大组件的代理。</p>
<p>3、更好的性能和稳定兼容性。</p>
<p>你以为这样就完了？No，下面再给大家分享一下阿里百川HotFix的一些具体修复方案。</p>
<p>百川Hotfix2.X 类修复方案</p>
<p>补丁工具检测补丁冷部署or热部署</p>
<ul>
<li>由于热部署andfix修复正在运行的方法有crash的风险, 所以补丁工具提供参数由业务方来决定是否尝试走热部署, 如果用户patch的方法没有被高频调用同时又有实时生效的需求, 那么可以优先选择走热部署方案</li>
</ul>
<p>热部署 -&gt;andfix支持的代码变更</p>
<ul>
<li>此时走优化后的andfix方案</li>
</ul>
<blockquote>
<p>也就是目前hotfix1.0的方案</p>
</blockquote>
<p>冷部署 -&gt;andfix不支持代码变更</p>
<ul>
<li>davilk下hack本地方法native层绕过dvmresolveclass</li>
</ul>
<blockquote>
<p>patch dex追加到PathClassLoad的dexElements中, 同时我们知道插桩的解决方案会影响到运行时性能的原因在于：app内的所有类都预埋引用一个独立dex的空类，导致安装dexopt阶段的preverify失败，运行时将再次verify+optimize. 所以我们选择了hack本地方法native层绕过dvmresolveclass方法的方式。 </p>
</blockquote>
<ul>
<li>art下直接合成dex，采用手淘目前成熟的art动态部署方案 </li>
</ul>
<blockquote>
<p>不同于微信tinker的dex merge方案, dex merge其实很占用应用内存, 所以最终会导致dex merge失败, 实际上art上默认已经支持多dex的合并, 我们只需要把patch dex跟原来apk中的dex合并成完整的新dex, 然后去替换PathClassLoad的dexElements即可.</p>
</blockquote>
<p>阿里百川Hotfix2.X SO文件修复方案</p>
<ul>
<li><p>art下预load原来so, 再load补丁so</p>
</li>
<li><p>davilk下预load补丁so, 再load原来的so </p>
</li>
<li><p>关键:  综合机型支持的abis和补丁包中的abis共同决定补丁so的新libPath</p>
</li>
</ul>
<p>davilk和art下so文件加载的方式不一样, 导致了需要区分art和davilk做不同的处理. 实际上我们还有另外一个so补丁的方案, 这里暂时不对外透露 </p>
<p>更好的性能</p>
<ul>
<li><p>SOPatchManager.load(String libPath) -&gt;代替  System.load(String pathName)</p>
</li>
<li><p>SOPatchManager.loadLibrary(String libName) -&gt;代替  System.loadLibrary(String libName)</p>
</li>
</ul>
<p>我们知道一个so文件如果load两次那么本地内存的使用会变大. 所以我们提供了替代System加载so文件的方法, 我们建议所有的so文件加载都通过这个方法, 那么加载so文件的时候只会尝试去加载指定目录下去的补丁so, 而不会去加载安装apk中的so文件</p>
<p>阿里百川Hotfix2.X 资源文件修复方案</p>
<p>Android资源文件的特点</p>
<ul>
<li><p>资源id编码于resources.arsc文件中，排布紧密。按照排布顺序进行自动编号</p>
</li>
<li><p>res目录保存所有带id的资源文件。布局文件为二进制形式的xml文件，xml以资源id的方式引用其他资源</p>
</li>
<li><p>assets目录存放所有原始文件，不带id</p>
</li>
<li><p>aapt进行资源的构造，包括自动分配资源id与R文件的生成，默认情况下，每次编译不保证和之前包中的id一致</p>
</li>
</ul>
<p>目前市面上普遍采用的三种方式。</p>
<ul>
<li><p>差量合成完整的资源包，运行时完整加载资源。 缺点：合成资源占用时间和内存，容易引起卡顿。</p>
</li>
<li><p>修改aapt，对以后可能新增的资源提前留空，运行时patch包中新增资源id对应留出的位置。 缺点：需改变打包流程，修改代码并编译替换sdk中的aapt。打包侵入太强，且留空占用一定磁盘空间。留空多少是预先定好的，无法改变。</p>
</li>
<li><p>插件化，组件化资源。 缺点：资源需要划分模块，提前规划。杀鸡焉用牛刀？</p>
</li>
</ul>
<p>一个优秀的资源热修复方案应该做到：</p>
<ul>
<li><p>补丁包尽可能地小。加载补丁迅速，性能好，内存和时间消耗极小。</p>
</li>
<li><p>不改变打包流程，保持sdk工具链的完整性。</p>
</li>
<li><p>开发透明，开发者无感知。不需要事先固定资源id。</p>
</li>
<li><p>方便易用，傻瓜式操作。一键完成patch工作。</p>
</li>
</ul>
<p>阿里百川资源热修复</p>
<ul>
<li><p>直接基于新旧两个apk来构造补丁包，不需要改造aapt，对编译过程无要求。</p>
</li>
<li><p>精确比较各个资源id的使用情况，最大程度利用原先基线包资源，补丁包中只包含新增和修改的资源。</p>
</li>
<li><p>运行时无需合成操作，快速应用生效。不影响性能。</p>
</li>
<li><p>不仅仅是简单修复，对于任意程度、乃至天翻地覆的修改都能适用。只是补丁文件会比较大。</p>
</li>
<li><p>使用方便，只需要选取新旧两个apk，一键生成补丁。</p>
</li>
<li><p>兼容Android所有机型，稳定性好。</p>
</li>
<li><p>配合类修复方案, 我们能够做到资源修复的实时生效</p>
</li>
</ul>
<p>需要注意的地方</p>
<ul>
<li><p>如果事先自己做了资源混淆，需要保证新旧包混淆的关系保持一致，否则打补丁时会找不到原来基线包中资源，而将非新增资源视为新增资源，导致补丁包变大。</p>
</li>
<li><p>建议每次打包时设置去除无用的资源。这样即可以减小包大小，同时也保证补丁包中新增资源都是有用的。</p>
</li>
<li><p>AndroidManifest中引用的资源无法改变。有些资源如icon是安装时固定的，目前所有补丁方案都无法进行改变。而另一些资源，如Theme，我们可以提取AndroidManifest中的资源信息，通过代码的方式进行设置。</p>
</li>
</ul>
<p>阿里百川HotFix管理后台服务</p>
<ul>
<li>补丁灰度发布/正式发布  </li>
</ul>
<blockquote>
<p>发布前可以通过本地/扫码两种方式验证之后再发布上线, 本地补丁模式是指补丁可以放到任何一个指定的目录下即可. 扫码模式是扫描二维码生成一个下载url, 然后直接下载这个时候不需要和服务器验证身份.  灰度发布指定具体的用户数然后随机推送</p>
</blockquote>
<ul>
<li>补丁回滚  </li>
</ul>
<blockquote>
<p>回滚到目标补丁版本, 所有该应用版本下的设备都会回滚到目标补丁的版本。</p>
</blockquote>
<ul>
<li>补丁安全</li>
</ul>
<blockquote>
<ol>
<li>平台托管RSA秘钥  2. 补丁加载安全签名校验</li>
</ol>
</blockquote>
<p>我们后续提供的服务</p>
<ul>
<li>补丁自定义平台无关AES秘钥</li>
</ul>
<blockquote>
<p>更安全, 此时打补丁的时候用户可以填入自定义AES秘钥, 然后SDK初始化的时候填入这个秘钥即可. 我们阿里百川平台完全不知道你的秘钥, 所以你们的补丁在我们的后台是绝对安全的. </p>
</blockquote>
<ul>
<li>补丁条件下发 </li>
</ul>
<blockquote>
<ol>
<li><p>分系统版本 比如一个bug只在android5.0上复现, 那么可能只想对android5.0下发补丁</p>
</li>
<li><p>分渠道  比如只想对某个具体的渠道, 豌豆荚/小米不同的渠道进行分发 </p>
</li>
<li><p>自定义TAG 上述几个是默认提供的条件, 当然我们提供了更加自由的方式, 你可以对任何一个补丁打tag, 然后客户端只能请求下载到后台指定tag的补丁.   </p>
</li>
</ol>
</blockquote>
<ul>
<li>实时显示补丁加载成功率等数据</li>
</ul>
<blockquote>
<p>后续可能会上报补丁加载失败详情, 方便排查问题. </p>
</blockquote>
<ul>
<li>一键清除补丁  </li>
</ul>
<blockquote>
<p>使用回滚功能必需要具备一下几个条件：1. 当前的版本已停止发布 2. 该版本之前存在至少一个历史版本 所以如果第一个补丁就下发错误的话, 补丁回滚就无能为力了, 所以我们提供一键清除补丁的功能。</p>
</blockquote>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/HotFix/20170118163628380.png?raw=true" alt="热修复技术对比"></p>
<p>对比完这些热修复技术是不是觉得Hotfix是不错的选择。接下来就一起来了解一下hotfix的接入和使用吧。</p>
<p>接入流程大概如下：<br><a href="http://console.baichuan.taobao.com/" target="_blank" rel="external">1. 注册阿里百川开发者帐号（这个用来对阿里百川一些sdk的接入进行管理）</a></p>
<ol>
<li>新建一个项目，并开通阿里百川hotfix的使用权限。<br><a href="http://baichuan.taobao.com/docs/doc.htm?spm=a3c0d.7629140.0.0.Lxy877&amp;treeId=234&amp;articleId=105517&amp;docType=1" target="_blank" rel="external">3. 下载，集成sdk。</a></li>
</ol>
<h3 id="Hotfix-SDK接入"><a href="#Hotfix-SDK接入" class="headerlink" title="Hotfix SDK接入"></a>Hotfix SDK接入</h3><p><a href="http://baichuan.taobao.com/docs/doc.htm?spm=a3c0d.7629140.0.0.ZZm6TK&amp;treeId=234&amp;articleId=105456&amp;docType=1" target="_blank" rel="external">HotFix项目文档地址</a></p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/01/04/DeadLock/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/04/DeadLock/" itemprop="url">
                  产生死锁的原因和必要条件+解决死锁的基本方法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-04T14:31:45+08:00">
                2017-01-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/计算机基础/" itemprop="url" rel="index">
                    <span itemprop="name">计算机基础</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>死锁：指多个进程因竞争共享资源而造成的一种僵局，若无外力作用，这些进程都将永远不能再 向前推进。
安全状态与不安全状态：安全状态指系统能按某种进程顺序来为每个进程分配其所需资源，直至最大需求，使每个进程都可顺利完成。
若系统不存在这样一个序列，则称系统处于不安全状态。
</code></pre><h3 id="产生死锁的原因"><a href="#产生死锁的原因" class="headerlink" title="产生死锁的原因"></a>产生死锁的原因</h3><ol>
<li>竞争系统资源 </li>
<li>进程的推进顺序不当</li>
</ol>
<h3 id="产生死锁的必要条件"><a href="#产生死锁的必要条件" class="headerlink" title="产生死锁的必要条件"></a>产生死锁的必要条件</h3><ol>
<li>互斥条件：进程要求对所分配的资源进行排它性控制，即在一段时间内某资源仅为一进程所占用。</li>
<li>请求和保持条件：当进程因请求资源而阻塞时，对已获得的资源保持不放。</li>
<li>不剥夺条件：进程已获得的资源在未使用完之前，不能剥夺，只能在使用完时由自己释放。</li>
<li>环路等待条件：在发生死锁时，必然存在一个进程–资源的环形链。</li>
</ol>
<h3 id="解决死锁的基本方法"><a href="#解决死锁的基本方法" class="headerlink" title="解决死锁的基本方法"></a>解决死锁的基本方法</h3><ol>
<li>预防死锁：</li>
</ol>
<ul>
<li>资源一次性分配：（破坏请求和保持条件）</li>
<li>可剥夺资源：即当某进程新的资源未满足时，释放已占有的资源（破坏不可剥夺条件）</li>
<li>资源有序分配法：系统给每类资源赋予一个编号，每一个进程按编号递增的顺序请求资源，释放则相反（破坏环路等待条件）</li>
</ul>
<ol>
<li><p>避免死锁:<br>预防死锁的几种策略，会严重地损害系统性能。因此在避免死锁时，要施加较弱的限制，从而获得 较满意的系统性能。由于在避免死锁的策略中，允许进程动态地申请资源。因而，系统在进行资源分配之前预先计算资源分配的安全性。若此次分配不会导致系统进入不安全状态，则将资源分配给进程；否则，进程等待。其中最具有代表性的避免死锁算法是银行家算法。</p>
</li>
<li><p>检测死锁<br>首先为每个进程和每个资源指定一个唯一的号码；<br>然后建立资源分配表和进程等待表</p>
</li>
</ol>
<blockquote>
<p>银行家算法<br>系统中有3种类型的资源（A，B，C）和5个进程P1、P2、 P3、P4、P5，A资源的数量为17，B资源的数量为5，C资源的数量为20。在T0时刻系统状态见下表（T0时刻系统状态表）所示。系统采用银行家算法实施死锁避免策略。</p>
<table>
<thead>
<tr>
<th>时刻</th>
<th>最大资源需求量</th>
<th>已分配资源数量</th>
<th>剩余所需资源数量</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td>A        B        C</td>
<td>A        B        C</td>
<td>A        B        C</td>
</tr>
<tr>
<td>P1</td>
<td>5        5        9</td>
<td>2        1        2</td>
<td>3        4        7</td>
</tr>
<tr>
<td>P2</td>
<td>5        3        6</td>
<td>4        0        2</td>
<td>1        3        4</td>
</tr>
<tr>
<td>P3</td>
<td>4        0        11</td>
<td>4        0        5</td>
<td>0        0        6</td>
</tr>
<tr>
<td>P4</td>
<td>4        2        5</td>
<td>2        0        4</td>
<td>2        2        1</td>
</tr>
<tr>
<td>P5</td>
<td>4        2        4</td>
<td>3        1        4</td>
<td>1        1        0</td>
</tr>
</tbody>
</table>
<p>( 1 ) T0时刻是否为安全状态？若是，请给出安全序列。 </p>
</blockquote>
<p>剩余资源数量为<br>A：17 - 2 - 4 - 4 - 2 - 3 = 2<br>B：5 - 1 - 0 - 0 - 0 - 1 = 3<br>C：20 - 7 - 4 - 6 - 1 - 0 = 3<br>可分配给P4执行，执行完后资源剩余4 3 7，执行 P3后剩余  8 3 12<br>执行P5 后剩余 11 4 16 执行P2后剩余 15 4 18，执行P1后剩余 17 5 20<br>所以T0时刻安全，安全序列为P4—&gt;P3—&gt;P5—&gt;P2—&gt;P1<br>当然 P5—&gt;P4—&gt;P3—&gt;P2—&gt;P1也是安全序列。同一个时刻可以有多种安全序列选择。</p>
<ol>
<li>解除死锁:<br>当发现有进程死锁后，便应立即把它从死锁状态中解脱出来，常采用的方法有：</li>
</ol>
<ul>
<li>剥夺资源：从其它进程剥夺足够数量的资源给死锁进程，以解除死锁状态；</li>
<li>撤消进程：可以直接撤消死锁进程或撤消代价最小的进程，直至有足够的资源可用，死锁状态.消除为止；所谓代价是指优先级、运行代价、进程的重要性和价值等。</li>
</ul>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2016/12/10/CodeRepository/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/10/CodeRepository/" itemprop="url">
                  Github仓库创建及git常用命令使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-10T19:33:45+08:00">
                2016-12-10
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/代码托管/" itemprop="url" rel="index">
                    <span itemprop="name">代码托管</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Github现在已经成为很多开源项目代码开源仓库，和个人开发者代码托管的好地方了。很多刚接触git的小伙伴们可能不知道如何在github上创建一个仓库，并将自己的代码提交上去。接下来我就做一些简单的讲解。<br>如果对git不大清楚的话可以参考一下大多数git初学者看过的文章，廖雪峰大神的<a href="http://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000" target="_blank" rel="external">git教程</a>里面内容非常详细。或者这篇<a href="http://blog.csdn.net/hudashi/article/details/7661198" target="_blank" rel="external">git简介</a>大概讲述了一下从git项目初始化到提交commit代码到git仓库的过程。</p>
<p>####<strong>前置工作</strong><br>下载一个git来作为仓库管理工具<a href="https://git-for-windows.github.io/" target="_blank" rel="external">gitWindows下载</a> 下载完之后直接安装就OK了。</p>
<p>####<strong>git安装好了，讲一下常用操作</strong><br>新建一个文件夹，点击鼠标右键-&gt;git bash here 打开git 控制台，可以在里面做git操作了。</p>
<p>#####1.git config<br>使用Git的第一件事就是设置你的名字和email,这些就是你在提交commit时的签名。</p>
<p>$ git config –global user.name “XiaoLong”</p>
<p>$ git config –global user.email “719243738@qq.com”</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210180705912.png?raw=true" alt="git First"></p>
<p> 执行了上面的命令后,会在你的主目录(home directory)建立一个叫~/.gitconfig 的文件. 内容一般像下面这样:<br>[user]<br>name = XiaoLong<br>email = 719243738@qq.com</p>
<p>####2.创建仓库<br>git init<br>执行这个命令，将当前目录作为git仓库</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210181821774.png?raw=true" alt="init"></p>
<p>git add<br>添加文件到索引区域。<br>仓库创建完毕在这个文件夹中添加一个文件，我创建一个MarkDown文件，命名为README.md<br>git add README.md 提交README.md文件，将创建一个临时区域来存放这些文件。<br>如果想提交全部文件可以使用 git add –all</p>
<p>git commit<br>提交到本地仓库。<br>一般使用 git commit -m “描述信息”<br>来为本次提交添加描述</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210183924175.png?raw=true" alt="简单操作"></p>
<p>git的更多操作和教程建议大家可以看看这个<a href="http://blog.csdn.net/hudashi/article/details/7661198" target="_blank" rel="external">git简介</a>将所有常用的都覆盖到了。</p>
<p>接下来就进行github远程仓库创建何代码提交<br>登陆github</p>
<p>点击右上角头像-&gt;setting进入设置页面–&gt;SSH and GPS keys–&gt;new SSH key，将本机的SSHkey配置上去 </p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210185210505.png?raw=true" alt="git配置"></p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210185446526.png?raw=true" alt="sshkey配置"></p>
<p><a href="http://blog.csdn.net/tanzhengyu/article/details/51064380" target="_blank" rel="external">ssh key获取点这里</a><br>配置完成之后</p>
<p>回到自己的首页点击Repositories<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210185926531.png?raw=true" alt="Repositories"></p>
<p>查看自己的仓库列表，点击<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210190226701.png?raw=true" alt="新建仓库"></p>
<p>右边的那个New<br>创建一个仓库<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210190401889.png?raw=true" alt="创建"></p>
<p>点Create Respoisitory 创建仓库</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210190848251.png?raw=true" alt="新创建的仓库"></p>
<p>在空项目仓库里，github 也有教如何将项目提交到远程仓库。<br>复制 ssh key</p>
<p>在需要提交的项目文件夹下打开git 控制台，如果该文件夹未构建git 仓库请先<br>git init 创建一个本地仓库<br>然后执行 git remote add 别名 git@github.com:xiaolongonly/MyGitTest.git</p>
<p>将本地仓库与远程仓库关联</p>
<p>然后执行 git push xiaoxiaolong master  等待文件提交完毕</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210191821864.png?raw=true" alt="push"></p>
<p>刷新一下github的当前项目仓库。</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161210191856934.png?raw=true" alt="提交完成"></p>
<p>可以看到文件已经提交完成了。</p>
<p>当然实际中 git的命令不可能只用到这么几个。所有常见的命令在之前推荐的文章里也有介绍。<br>那我就讲解一下如何使用可视化界面的工具SmartGit来管理<br><a href="http://yd.down.chinaz.com/201610/smartgit_jre_v8.0.3.zip" target="_blank" rel="external">SmartGit下载地址</a></p>
<p>###SmartGit</p>
<p>SmartGit是一个非常好用的git可视化界面管理工具</p>
<p>接下来用SmartGit把我们之前push到github上的项目pull下来</p>
<p>点击左上角 Repository–&gt;Clone或者快捷键：Ctrl + Shift + O Clone 克隆项目<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212101950910.png?raw=true" alt="克隆"></p>
<p>这里的地址用的是<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212102140351.png?raw=true" alt="gitAddress"></p>
<p>Next–&gt;Next<br>选择路径<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212102231830.png?raw=true" alt="选择路径"></p>
<p>点击确定等到右下角的output pull完成就可以了<br>在窗口的Repositories 可以看到pull下来的项目<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212102725171.png?raw=true" alt="Project"></p>
<p>下面是分支信息</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212102849677.png?raw=true" alt="分支信息"></p>
<p>在分支信息里你可以<br>从origin 的master check out 一个本地分支出来。名字可以自定义<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212103030850.png?raw=true" alt="分支切换"></p>
<p>我切了一个xiaolong的本地分支出来</p>
<p>在一般的项目开发过程中，由于成员不止一个，我们不会直接在master做操作。因为每个人都在master分值上改来改去的话 。项目就容易出问题，出现冲突等…<br>现在xiaolong分支是跟主分支一样的内容了。我们可以在这个分支的本地分支进行修改。<br>之后合并到主开发分支再push到远程仓库就可以了</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212105150735.png?raw=true" alt="项目信息"></p>
<p>右键MyGitTest –&gt; Open in Explorer<br>找到README.md修改一下里面的内容<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212105717507.png?raw=true" alt="修改"></p>
<p>回到smartGit 可以看到 当前文件的修改信息，还有差异文件列表<br>点击 stage   commit<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212105906026.png?raw=true" alt="commit"></p>
<p>添加完文件后commit上去<br>注意：我们commit是commit到我们当前的分支。<br>所以要在Branches 里面<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212110027403.png?raw=true" alt="Branches"><br>右键master –&gt;check out<br>然后右键 xiaolong–&gt;merge<br>然后点击上面的push. push上去。<br>等output 输出。。<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/CodeRepository/20161212110322235.png?raw=true" alt="output "><br>完成之后刷新一下github上面的该项目。push完成了。</p>
<p>在SmartGit使用中，由于我们是试用版所以每30天就会过期，过期就不能用了。这边提供过期解决方案：删除配置文件。具体参照<a href="http://www.cnblogs.com/nn839155963/p/5912788.html" target="_blank" rel="external">SmartGit过期解决方案</a></p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2016/12/08/RTAuthority/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/08/RTAuthority/" itemprop="url">
                  Android6.0运行时权限解决方案
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-08T16:23:31+08:00">
                2016-12-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android/" itemprop="url" rel="index">
                    <span itemprop="name">Android</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <pre><code>今天在测试APP的时候发现部分手机APP定位权限使用不了。看了一下机型都是Android6.0以上版本的Android手机。
之前就听说Android6.0以上版本权限管理更严格了，没想到今天踩坑了。

6.0版本之前的权限管理都是一些手机系统自己写的权限管理，比如说小米手机系统，魅族...这些都自己带有自己权限管理。
这样子容易出现的问题是：
1.如果某个权限被禁用了。应用开发中根本没提供方法来判断该权限是否被禁用。我们就需要自己的方法去判断。
比如说录音权限被禁用了：http://blog.csdn.net/omrapollo/article/details/51150280，是从录音功能下手做判断。而不是从权限列表获取权限状态。这是真的坑。
2.我们知道权限被禁用了，还需要判断一下是哪个系统好提醒用户按照操作去开启这个权限。
也就是说开发过程中需要把主流的机型测试一遍。然后如果有权限管理的话把权限流程过一遍。加个判别系统的方法，然后在把流程做成一个一个加上去。简直可怕。

Google最终解决方案，给系统弄一个权限管理。
太棒了，权限管理由Android系统本身来做才是对开发者最友好的解决方案。
</code></pre><p>废话不多说，接下来就讲讲6.0版本权限问题的终极解决方案吧。</p>
<p>Android在 6.0以上版本需要进行动态的权限配置。</p>
<h2 id="一、SDK新增方法"><a href="#一、SDK新增方法" class="headerlink" title="一、SDK新增方法"></a>一、SDK新增方法</h2><h3 id="1-在ActivityCompat增加的方法"><a href="#1-在ActivityCompat增加的方法" class="headerlink" title="1.在ActivityCompat增加的方法"></a>1.在ActivityCompat增加的方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ActivityCompat.requestPermissions(context, needPermissions, REQUEST_CODE_REQUEST_PERMISSION);</div></pre></td></tr></table></figure>
<p>这个方法用来动态配置权限。如果没有所需的权限。将会弹窗提醒用户配置权限。<br>三个参数分别为:当前上下文，需要申请的权限列表列表，请求码。请求码用于后面回调返回请求结果用。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ActivityCompat.checkSelfPermission(context, needPermission);</div></pre></td></tr></table></figure>
<p>这个方法用来监测某个权限是否被配置。<br>两个参数分别为：当前上下文，需要监测的权限信息。<br>这个方法的返回值有两个0或-1 分别是已授权，和未授权</p>
<p>在PackManager这个类中有与之相匹配的常量<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">    * Permission check result: this is returned by &#123;<span class="doctag">@link</span> #checkPermission&#125;</div><div class="line">    * if the permission has been granted to the given package.</div><div class="line">    */</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PERMISSION_GRANTED = <span class="number">0</span>;</div><div class="line"></div><div class="line">   <span class="comment">/**</span></div><div class="line">    * Permission check result: this is returned by &#123;<span class="doctag">@link</span> #checkPermission&#125;</div><div class="line">    * if the permission has not been granted to the given package.</div><div class="line">    */</div><div class="line">   <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PERMISSION_DENIED = -<span class="number">1</span>;</div></pre></td></tr></table></figure></p>
<h3 id="2-Activity中增加回调方法"><a href="#2-Activity中增加回调方法" class="headerlink" title="2.Activity中增加回调方法"></a>2.Activity中增加回调方法</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="meta">@Override</span></div><div class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, @NonNull String[] permissions, @NonNull <span class="keyword">int</span>[]grantResults)</span> </span>&#123;</div><div class="line">      <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>这个方法会在用户配置完权限后回调<br>三个回调参数分别是：请求码，请求的权限，权限当前状态</p>
<h2 id="二、写个demo试验一下"><a href="#二、写个demo试验一下" class="headerlink" title="二、写个demo试验一下"></a>二、写个demo试验一下</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> cn.xiaolongonly.myapplication;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.Manifest;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.annotation.NonNull;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.ActivityCompat;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String[] requestPermissions = &#123;</div><div class="line">            Manifest.permission.WRITE_EXTERNAL_STORAGE,</div><div class="line">            Manifest.permission.READ_EXTERNAL_STORAGE,</div><div class="line">            Manifest.permission.ACCESS_COARSE_LOCATION,</div><div class="line">            Manifest.permission.ACCESS_FINE_LOCATION&#125;;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        <span class="keyword">int</span> write = ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE);</div><div class="line">        <span class="keyword">int</span> read = ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.READ_EXTERNAL_STORAGE);</div><div class="line">        <span class="keyword">int</span> coarse = ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_COARSE_LOCATION);</div><div class="line">        <span class="keyword">int</span> fine = ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION);</div><div class="line">        Log.d(<span class="string">"permissionState："</span>, <span class="string">"write:"</span>+write + <span class="string">"_"</span> + <span class="string">"read:"</span>+read + <span class="string">"_"</span> + <span class="string">"coarse:"</span>+coarse + <span class="string">"_"</span> + <span class="string">"fine:"</span>+fine);</div><div class="line">        ActivityCompat.requestPermissions(<span class="keyword">this</span>, requestPermissions, <span class="number">10086</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, @NonNull String[] permissions, @NonNull <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</div><div class="line">        Log.d(<span class="string">"RequestCode"</span>, requestCode + <span class="string">""</span>);</div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; permissions.length; i++) &#123;</div><div class="line">            Log.d(<span class="string">"permissionInfo"</span>, <span class="string">"permissionName："</span> + permissions[i] + <span class="string">"permission State："</span> + grantResults[i]);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">int</span> write = ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.WRITE_EXTERNAL_STORAGE);</div><div class="line">        <span class="keyword">int</span> read = ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.READ_EXTERNAL_STORAGE);</div><div class="line">        <span class="keyword">int</span> coarse = ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_COARSE_LOCATION);</div><div class="line">        <span class="keyword">int</span> fine = ActivityCompat.checkSelfPermission(<span class="keyword">this</span>, Manifest.permission.ACCESS_FINE_LOCATION);</div><div class="line">        Log.d(<span class="string">"permissionState："</span>, <span class="string">"write:"</span>+write + <span class="string">"_"</span> + <span class="string">"read:"</span>+read + <span class="string">"_"</span> + <span class="string">"coarse:"</span>+coarse + <span class="string">"_"</span> + <span class="string">"fine:"</span>+fine);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="打印出的Log如下"><a href="#打印出的Log如下" class="headerlink" title="打印出的Log如下"></a>打印出的Log如下</h3><p>允许的情况</p>
<p><strong>D/CreatePermissionState：: write:-1_read:-1_coarse:-1_fine:-1</strong><br><strong>D/RequestCode: 10086</strong><br><strong>D/permissionInfo: permissionName：android.permission.WRITE_EXTERNAL_STORAGEpermission State：0</strong><br><strong>D/permissionInfo: permissionName：android.permission.READ_EXTERNAL_STORAGEpermission State：0</strong><br><strong>D/permissionInfo: permissionName：android.permission.ACCESS_COARSE_LOCATIONpermission State：-1</strong><br><strong>D/permissionInfo: permissionName：android.permission.ACCESS_FINE_LOCATIONpermission State：-1</strong><br><strong>D/FinishPermissionState：: write:0_read:0_coarse:-1_fine:-1</strong></p>
<p>拒绝后</p>
<p><strong>D/CreatePermissionState：: write:-1_read:-1_coarse:-1_fine:-1</strong><br><strong>D/RequestCode: 10086</strong><br><strong>D/permissionInfo: permissionName：android.permission.WRITE_EXTERNAL_STORAGEpermission State：-1</strong><br><strong>D/permissionInfo: permissionName：android.permission.READ_EXTERNAL_STORAGEpermission State：-1</strong><br><strong>D/permissionInfo: permissionName：android.permission.ACCESS_COARSE_LOCATIONpermission State：-1</strong><br><strong>D/permissionInfo: permissionName：android.permission.ACCESS_FINE_LOCATIONpermission State：-1</strong><br><strong>D/FinishPermissionState：: write:-1_read:-1_coarse:-1_fine:-1</strong></p>
<p>界面：</p>
<p><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/RTAuthority/20161208162153523.png?raw=true" alt="授权提醒"></p>
<h3 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h3><p>发现只出现一个授权文件读写的提醒框。<br>最后发现我在清单文件Manifest中只注册了读写权限。没有注册网络定位和精准定位权限。加上这两个。<br>这次启动的时候就出现了两个提示框了。（授权文件读写和定位）<br>可以看出，文件读写是归一个权限控制来管理的，两个定位权限也是归于一个权限控制来管理的。<br>清单权限注册<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.WRITE_EXTERNAL_STORAGE"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.READ_EXTERNAL_STORAGE"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_COARSE_LOCATION"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">uses-permission</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span>/&gt;</span></div></pre></td></tr></table></figure></p>
<h3 id="注意事项："><a href="#注意事项：" class="headerlink" title="注意事项："></a>注意事项：</h3><ol>
<li><p>需要动态配置的权限一定要在清单文件中做注册，不然默认都是不做配置的。之前踩过的一个坑是只注册了COARSE_LOCATION没有注册FINE_LOCATION，发现FINE_LOCATION一直是未授权，但是COARSE_LOCATION授权成功了。</p>
</li>
<li><p>当用户拒绝权限授权之后，在次权限申请的时候是会出现不在询问的提示框的。勾选之后只能选择拒绝权限。拒绝之后以后就不会再做提醒了，<br>权限会自动被拒绝，requestPermissions方法是有走的，系统自动拒绝了这个权限。所以在onRequestPermissionResult()中一样能看到不提醒但requestPermissions做了申请的权限。</p>
</li>
</ol>
<p>##三、最后再对代码进行简单的封装<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.xiaolongonly.myapplication;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.Manifest;</div><div class="line"><span class="keyword">import</span> android.app.Activity;</div><div class="line"><span class="keyword">import</span> android.content.Intent;</div><div class="line"><span class="keyword">import</span> android.content.pm.PackageManager;</div><div class="line"><span class="keyword">import</span> android.net.Uri;</div><div class="line"><span class="keyword">import</span> android.provider.Settings;</div><div class="line"><span class="keyword">import</span> android.support.v4.app.ActivityCompat;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.widget.Toast;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionUtil</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_CODE_REQUEST_PERMISSION = <span class="number">1027</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String PACKAGE_URL_SCHEME = <span class="string">"package:"</span>;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> REQUEST_CODE_REQUEST_SETTING = <span class="number">1028</span>;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">PermissionListener</span> </span>&#123;</div><div class="line">        <span class="function"><span class="keyword">void</span> <span class="title">allGranted</span><span class="params">()</span></span>;                                          <span class="comment">//申请的权限已全部被允许;</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PermissionTool</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">public</span> String[] lackPermission;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 需要进行检测的权限数组</div><div class="line">         */</div><div class="line">        <span class="keyword">public</span> String[] mainNeedPermissions = &#123;       <span class="comment">//SD卡权限，定位权限</span></div><div class="line">                Manifest.permission.WRITE_EXTERNAL_STORAGE,</div><div class="line">                Manifest.permission.READ_EXTERNAL_STORAGE,</div><div class="line">                Manifest.permission.ACCESS_COARSE_LOCATION,</div><div class="line">                Manifest.permission.ACCESS_FINE_LOCATION,</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 需要进行检测的权限数组</div><div class="line">         */</div><div class="line">        <span class="keyword">public</span> String[] qrCodeNeedPermissions = &#123;       <span class="comment">//获取相机权限</span></div><div class="line">                Manifest.permission.CAMERA</div><div class="line">        &#125;;</div><div class="line">        <span class="comment">/**</span></div><div class="line">         * 需要进行检测的权限数组</div><div class="line">         */</div><div class="line">        <span class="keyword">public</span> String[] requestNeedPermissions = &#123;       <span class="comment">//获取手机设备号用</span></div><div class="line">                Manifest.permission.READ_PHONE_STATE</div><div class="line">        &#125;;</div><div class="line"></div><div class="line">        <span class="keyword">private</span> PermissionListener mListener;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">PermissionTool</span><span class="params">(PermissionListener listener)</span> </span>&#123;</div><div class="line">            mListener = listener;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">checkAndRequestPermission</span><span class="params">(Activity activity, String... needPermissions)</span> </span>&#123;</div><div class="line">            <span class="keyword">boolean</span> isAllGranted = <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">for</span> (String needPermission : needPermissions) &#123;</div><div class="line">                <span class="keyword">if</span> (ActivityCompat.checkSelfPermission(activity, needPermission)</div><div class="line">                        != PackageManager.PERMISSION_GRANTED) &#123;</div><div class="line">                    isAllGranted = <span class="keyword">false</span>;</div><div class="line">                &#125;</div><div class="line">                Log.d(<span class="string">"state"</span>, ActivityCompat.checkSelfPermission(activity, needPermission) + <span class="string">""</span>);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">if</span> (isAllGranted) &#123;</div><div class="line">                mListener.allGranted();</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                ActivityCompat.requestPermissions(activity, needPermissions, REQUEST_CODE_REQUEST_PERMISSION);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionResult</span><span class="params">(<span class="keyword">final</span> Activity activity,</span></span></div><div class="line">                                              <span class="keyword">int</span> requestCode, String[] permissions, <span class="keyword">int</span>[] grantResults) &#123;</div><div class="line">            <span class="keyword">if</span> (requestCode == REQUEST_CODE_REQUEST_PERMISSION) &#123;</div><div class="line">                <span class="keyword">boolean</span> allGrant = <span class="keyword">true</span>;</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; grantResults.length; i++) &#123;</div><div class="line">                    <span class="keyword">if</span> (grantResults[i] != PackageManager.PERMISSION_GRANTED) &#123;</div><div class="line">                        allGrant = <span class="keyword">false</span>;</div><div class="line">                    &#125;</div><div class="line">                    Log.d(<span class="string">"PermissionTool"</span>, <span class="string">"onRequestPermissionResult(): "</span> + grantResults[i] + <span class="string">"permission"</span> + permissions[i]);</div><div class="line">                &#125;</div><div class="line">                <span class="keyword">if</span> (allGrant) &#123;</div><div class="line">                    mListener.allGranted();</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    Toast.makeText(activity, <span class="string">"部分所需权限未开启，将影响功能正常使用，请开启权限！"</span>, Toast.LENGTH_LONG).show();</div><div class="line">                    startAppSettings(activity);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">startAppSettings</span><span class="params">(Activity activity)</span> </span>&#123;</div><div class="line">            Intent intent = <span class="keyword">new</span> Intent(Settings.ACTION_APPLICATION_DETAILS_SETTINGS);</div><div class="line">            intent.setData(Uri.parse(PACKAGE_URL_SCHEME + activity.getPackageName()));</div><div class="line">            activity.startActivityForResult(intent, REQUEST_CODE_REQUEST_SETTING);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这里将权限管理的方法和回调都抽取到一个类中了。直接调用方法和回调就可以了。</p>
<p>值得注意的是：在自己写的APP有一些页面没有这些授权是无法使用的。但是用户又禁止了权限。而用户可能不知道要去哪里开启这个权限，就可以通过打开当前应用的设置页面来引导用户开启。startAppSettings(Activity activity)</p>
<p>###使用：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> cn.xiaolongonly.myapplication;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.Manifest;</div><div class="line"><span class="keyword">import</span> android.os.Build;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.annotation.NonNull;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String[] requestPermissions = &#123;</div><div class="line">            Manifest.permission.WRITE_EXTERNAL_STORAGE,</div><div class="line">            Manifest.permission.READ_EXTERNAL_STORAGE,</div><div class="line">            Manifest.permission.ACCESS_COARSE_LOCATION,</div><div class="line">            Manifest.permission.ACCESS_FINE_LOCATION&#125;;</div><div class="line">    <span class="keyword">private</span> PermissionUtil.PermissionTool permissionTool;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        <span class="keyword">if</span> (Build.VERSION.SDK_INT &gt;= <span class="number">23</span>) &#123; <span class="comment">//针对6.0以后的版本加权限判断</span></div><div class="line">            permissionTool = <span class="keyword">new</span> PermissionUtil.PermissionTool(<span class="keyword">new</span> PermissionUtil.PermissionListener() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">allGranted</span><span class="params">()</span> </span>&#123;</div><div class="line">                    initView();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line">            permissionTool.checkAndRequestPermission(MainActivity.<span class="keyword">this</span>, requestPermissions);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            initView();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">//在这里做界面初始化</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onRequestPermissionsResult</span><span class="params">(<span class="keyword">int</span> requestCode, @NonNull String[] permissions, @NonNull <span class="keyword">int</span>[] grantResults)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onRequestPermissionsResult(requestCode, permissions, grantResults);</div><div class="line">        permissionTool.onRequestPermissionResult(<span class="keyword">this</span>, requestCode, permissions, grantResults);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>总结对于Android6.0运行时权限暂时就知道怎么配置了，如果有不足的地方欢迎指出。<br><a href="http://download.csdn.net/detail/guoxiaolongonly/9705842" target="_blank" rel="external">demo下载</a></p>
<p>##新功能<br>这边顺便讲一下在manifest清单文件中多了</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">uses-permission-sdk-23</span> <span class="attr">android:name</span>=<span class="string">"android.permission.ACCESS_FINE_LOCATION"</span>/&gt;</span></div></pre></td></tr></table></figure>
<p>这样的权限设置，这个跟应用动态授权没有什么关系。<br>在<a href="https://developer.android.google.cn/guide/topics/manifest/uses-permission-sdk-23-element.html" target="_blank" rel="external">谷歌官方文档</a><br>是这么解释的</p>
<pre><code>指明应用需要特定权限，但仅当应用在 API 级别 23 或更高版本的设备上运行时才需要。如果设备运行的是 API 级别 22 或更低版本，则应用没有指定的权限。
当您更新应用以包含需要其他权限的新功能时，此元素很有用。如果用户在运行 API 级别 22 或更低版本的设备更新应用，系统在安装时会提示用户授予在该更新中声明的所有新权限。如果某个新功能无关紧要，您可能想同时在这些设备上停用该功能，以便用户不需要授予额外权限即可更新应用。如果使用 &lt;uses-permission-sdk-23&gt; 元素而不使用 &lt;uses-permission&gt;，则仅当应用在支持运行时权限模式（用户在应用运行时向其授予权限）的平台上运行时才可请求权限。
如需了解有关权限的详细信息，请参阅简介的权限部分和单独的系统权限 API 指南。在 android.Manifest.permission 上可以找到基础平台定义的权限列表。
</code></pre><p>也就是说如果使用的是<uses-permission-sdk-23>来注册的话这个权限就只能运行时动态赋予。 而版本低于SDK23的Android设备不支持动态设置权限。所以低于SDK23的应用是不能有这个权限的。</uses-permission-sdk-23></p>
<h1 id="好消息好消息"><a href="#好消息好消息" class="headerlink" title="好消息好消息"></a>好消息好消息</h1><p><a href="https://developer.android.google.cn/index.html" target="_blank" rel="external">谷歌Developers</a>中国网站今天发布了。</p>
<p>英文四级的我感到非常happy。</p>
<p>毕竟看英文文档都要借助翻译一个单词一个单词查还是很辛苦的，现在文档都有官方的中文版本了。</p>
<p>手动撒花！！！！手动撒花！！！！手动撒花！！！！</p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2016/12/06/MPAndroidChart3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/06/MPAndroidChart3/" itemprop="url">
                  MPAndroidChart的简单封装
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-06T20:44:21+08:00">
                2016-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android第三方框架/" itemprop="url" rel="index">
                    <span itemprop="name">Android第三方框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>因为需求中大部分图表的样式都差不多，只有里面的数据做了变化，而使用图表的时候又需要对图表进行各种各样的配置，所以对图表框架进一步封装是有必要的。<br>我这里将图表的配置写在一个类中，将常用的方法（数据，图表颜色，描述，等等）令写方法出来设置。。因为使用的是建造者模式，可以根据需求定义。这里封装了线性图、饼状图、柱状图、雷达图。</p>
<p>写了一个数据类ChartValue用来存放所需数据的XY值，然后将数据设置也封装到了，配置类中，图表构建完成后获得图表的View对象，填充到想要的布局中去。</p>
<h6 id="具体实现"><a href="#具体实现" class="headerlink" title="具体实现"></a>具体实现</h6><p>ChartView数据类：用来存放X，Y轴值。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.xiaolongonly.mpchartsample.bean;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> xiaolong</div><div class="line"> * <span class="doctag">@version</span> v1.0</div><div class="line"> * <span class="doctag">@function</span> &lt;描述功能&gt;</div><div class="line"> * <span class="doctag">@date</span> 2016/9/22-17:32</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ChartValue</span>&lt;<span class="title">T</span>&gt; </span>&#123;</div><div class="line">    <span class="keyword">public</span> String xVal;</div><div class="line">    <span class="keyword">public</span> T yVal;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChartValue</span><span class="params">()</span> </span>&#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ChartValue</span><span class="params">(String xVal, T yVal)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.xVal = xVal;</div><div class="line">        <span class="keyword">this</span>.yVal = yVal;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Item项：每个需要的图表构建一个item对象,存放固定配置和数据设置<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> cn.xiaolongonly.mpchartsample.chart.item;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Context;</div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"><span class="keyword">import</span> android.view.LayoutInflater;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.charts.LineChart;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.AxisBase;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.Legend;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.XAxis;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.YAxis;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.ChartData;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.Entry;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.LineData;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.LineDataSet;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.formatter.IAxisValueFormatter;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.interfaces.datasets.ILineDataSet;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.R;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.bean.ChartValue;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.chart.markview.DataMarkView;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.chart.util.ColorTemplate;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LineChartItem</span> <span class="keyword">extends</span> <span class="title">BaseChartItem</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String xDesc;</div><div class="line">    <span class="keyword">private</span> String yDesc;</div><div class="line">    <span class="keyword">private</span> DataMarkView dataMarkView;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LineChartItem</span><span class="params">(ChartData cd, Context c, IAxisValueFormatter iAxisValueFormatter)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(cd, c, iAxisValueFormatter);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">LineChartItem</span><span class="params">(ChartData cd, Context c, DataMarkView dataMarkView, IAxisValueFormatter iAxisValueFormatter)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(cd, c, iAxisValueFormatter);</div><div class="line">        <span class="keyword">this</span>.dataMarkView = dataMarkView;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getItemType</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> TYPE_LINECHART;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getView(<span class="keyword">null</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getxDesc</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> xDesc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setxDesc</span><span class="params">(String xDesc)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.xDesc = xDesc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getyDesc</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> yDesc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setyDesc</span><span class="params">(String yDesc)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.yDesc = yDesc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> View <span class="title">getView</span><span class="params">(View convertView)</span> </span>&#123;</div><div class="line"></div><div class="line">        ViewHolder holder = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (convertView == <span class="keyword">null</span>) &#123;</div><div class="line"></div><div class="line">            holder = <span class="keyword">new</span> ViewHolder();</div><div class="line"></div><div class="line">            convertView = LayoutInflater.from(mContext).inflate(</div><div class="line">                    R.layout.list_item_linechart, <span class="keyword">null</span>);</div><div class="line">            holder.chart = (LineChart) convertView.findViewById(R.id.chart);</div><div class="line"></div><div class="line">            convertView.setTag(holder);</div><div class="line"></div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            holder = (ViewHolder) convertView.getTag();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// apply styling</span></div><div class="line"></div><div class="line">        LineChart lineChart = (LineChart) holder.chart;</div><div class="line">        lineChart.setBackgroundColor(mContext.getResources().getColor(R.color.chart_bg));</div><div class="line">        lineChart.getLegend().setPosition(Legend.LegendPosition.ABOVE_CHART_LEFT);</div><div class="line">        lineChart.getLegend().setForm(Legend.LegendForm.CIRCLE);</div><div class="line">        <span class="comment">// 设置无数据文本提示</span></div><div class="line">        lineChart.setDescription(<span class="keyword">null</span>);</div><div class="line"><span class="comment">//        lineChart.setNoDataText(mContext.getResources().getString(R.string.chart_no_data));</span></div><div class="line"><span class="comment">//        lineChart.setXYDesc(xDesc, yDesc);</span></div><div class="line">        <span class="keyword">if</span> (!xDesc.equals(<span class="string">""</span>) || !yDesc.equals(<span class="string">""</span>)) &#123;</div><div class="line">            lineChart.setXYDesc(xDesc, yDesc, <span class="number">10f</span>, mContext.getResources().getColor(R.color.normal_black_color));</div><div class="line">        &#125;</div><div class="line">        <span class="comment">//设置单方向和双方向缩放 true x,y方向可以同时控制，false只能控制x方向的缩小放大或者Y方向的缩小放大</span></div><div class="line">        lineChart.setPinchZoom(<span class="keyword">true</span>);</div><div class="line">        DataMarkView dataMarkView = <span class="keyword">new</span> DataMarkView(mContext, <span class="number">0</span>, <span class="string">""</span>);</div><div class="line">        lineChart.setMarkerView(dataMarkView);</div><div class="line">        lineChart.setDrawGridBackground(<span class="keyword">false</span>);</div><div class="line">        XAxis xAxis = lineChart.getXAxis();</div><div class="line">        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM); <span class="comment">//定制X轴是在图表上方还是下方。</span></div><div class="line">        xAxis.setDrawGridLines(<span class="keyword">false</span>);</div><div class="line">        xAxis.setGranularity(<span class="number">1</span>);<span class="comment">//放大的时候X值不增多</span></div><div class="line">        xAxis.setValueFormatter(mIAxisValueFormatter);</div><div class="line">        <span class="keyword">if</span> (dataMarkView != <span class="keyword">null</span>) &#123;</div><div class="line">            lineChart.setMarkerView(dataMarkView);</div><div class="line">        &#125;</div><div class="line">        YAxis yAxisRight = lineChart.getAxisRight();</div><div class="line">        yAxisRight.setEnabled(<span class="keyword">false</span>);</div><div class="line">        YAxis yAxisLeft = lineChart.getAxisLeft();</div><div class="line">        yAxisLeft.setAxisMinimum(<span class="number">0</span>);</div><div class="line">        <span class="comment">// set data</span></div><div class="line">        lineChart.setData((LineData) mChartData);</div><div class="line"></div><div class="line">        <span class="comment">// do not forget to refresh the chart</span></div><div class="line">        <span class="comment">// holder.chart.invalidate();</span></div><div class="line">        lineChart.animateX(<span class="number">750</span>);</div><div class="line">        lineChart.animateY(<span class="number">750</span>);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> convertView;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Builder</span> </span>&#123;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">int</span>[] colors = ColorTemplate.PIE_COLORS;</div><div class="line">        <span class="keyword">private</span> String[] describles = <span class="keyword">new</span> String[]&#123;<span class="string">""</span>&#125;;</div><div class="line">        <span class="keyword">private</span> String xDesc = <span class="string">""</span>;</div><div class="line">        <span class="keyword">private</span> String yDesc = <span class="string">""</span>;</div><div class="line">        <span class="keyword">private</span> List&lt;List&lt;ChartValue&gt;&gt; charValueLists = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        <span class="keyword">private</span> Context context;</div><div class="line">        <span class="keyword">private</span> <span class="keyword">boolean</span> isFillColor;</div><div class="line">        <span class="keyword">private</span> ArrayList&lt;String&gt; labels = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Builder</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.context = context;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">addChartValueList</span><span class="params">(List&lt;ChartValue&gt; charValueLists)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.charValueLists.add(charValueLists);</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">setChartValueList</span><span class="params">(List&lt;List&lt;ChartValue&gt;&gt; charValueLists)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.charValueLists = charValueLists;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">setyDesc</span><span class="params">(String yDesc)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.yDesc = yDesc;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">setxDesc</span><span class="params">(String xDesc)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.xDesc = xDesc;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">setDescribles</span><span class="params">(String[] describles)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.describles = describles;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">setColorReses</span><span class="params">(<span class="keyword">int</span>[] colorReses)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.colors = <span class="keyword">new</span> <span class="keyword">int</span>[colorReses.length];</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; colors.length; i++) &#123;</div><div class="line">                colors[i] = context.getResources().getColor(colorReses[i]);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> Builder <span class="title">fillColorEnable</span><span class="params">(<span class="keyword">boolean</span> isFillColor)</span> </span>&#123;</div><div class="line">            <span class="keyword">this</span>.isFillColor = isFillColor;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> LineChartItem <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">            <span class="keyword">return</span> build(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">public</span> LineChartItem <span class="title">build</span><span class="params">(DataMarkView dataMarkView)</span> </span>&#123;</div><div class="line">            List&lt;ILineDataSet&gt; lineDataSets = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> listIndexOutside = <span class="number">0</span>; listIndexOutside &lt; charValueLists.size(); listIndexOutside++) &#123;</div><div class="line">                ArrayList&lt;Entry&gt; entries = <span class="keyword">new</span> ArrayList&lt;Entry&gt;();</div><div class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> listIndexInside = <span class="number">0</span>; listIndexInside &lt; charValueLists.get(listIndexOutside).size(); listIndexInside++) &#123;</div><div class="line">                    entries.add(<span class="keyword">new</span> Entry((<span class="keyword">float</span>) listIndexInside, (<span class="keyword">float</span>) charValueLists.get(listIndexOutside).get(listIndexInside).yVal));</div><div class="line">                    <span class="keyword">if</span> (listIndexOutside == <span class="number">0</span>) &#123;</div><div class="line">                        labels.add(charValueLists.get(listIndexOutside).get(listIndexInside).xVal);</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">                lineDataSets.add(generateLineDataSet(entries, describles[listIndexOutside], colors[listIndexOutside % colors.length]));</div><div class="line">            &#125;</div><div class="line">            IAxisValueFormatter iAxisValueFormatter = <span class="keyword">new</span> IAxisValueFormatter() &#123;</div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> String <span class="title">getFormattedValue</span><span class="params">(<span class="keyword">float</span> value, AxisBase axis)</span> </span>&#123;</div><div class="line">                    <span class="keyword">return</span> labels.get((<span class="keyword">int</span>) value % labels.size());</div><div class="line">                &#125;</div><div class="line">            &#125;;</div><div class="line">            LineData cd = <span class="keyword">new</span> LineData(lineDataSets);</div><div class="line">            LineChartItem lineChartItem = <span class="keyword">null</span>;</div><div class="line">            <span class="keyword">if</span> (dataMarkView != <span class="keyword">null</span>) &#123;</div><div class="line">                lineChartItem = <span class="keyword">new</span> LineChartItem(cd, context, dataMarkView, iAxisValueFormatter);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                lineChartItem = <span class="keyword">new</span> LineChartItem(cd, context, iAxisValueFormatter);</div><div class="line">            &#125;</div><div class="line">            lineChartItem.setxDesc(xDesc);</div><div class="line">            lineChartItem.setyDesc(yDesc);</div><div class="line">            <span class="keyword">return</span> lineChartItem;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="function"><span class="keyword">private</span> ILineDataSet <span class="title">generateLineDataSet</span><span class="params">(ArrayList&lt;Entry&gt; entries, String describle, <span class="keyword">int</span> color)</span> </span>&#123;</div><div class="line">            LineDataSet dataSet = <span class="keyword">new</span> LineDataSet(entries, describle);</div><div class="line">            dataSet.setLineWidth(<span class="number">2.0f</span>);</div><div class="line">            dataSet.setCircleRadius(<span class="number">3.5f</span>);</div><div class="line">            dataSet.setDrawCircleHole(<span class="keyword">true</span>);<span class="comment">//填充圆</span></div><div class="line">            dataSet.setValueTextSize(<span class="number">9f</span>);</div><div class="line">            dataSet.setHighlightLineWidth(<span class="number">2.0f</span>);</div><div class="line">            dataSet.setDrawFilled(isFillColor);</div><div class="line">            dataSet.setFillAlpha(<span class="number">51</span>);</div><div class="line">            dataSet.setFillColor(color); <span class="comment">//填充色</span></div><div class="line">            dataSet.setHighLightColor(color); <span class="comment">//选中十字线色</span></div><div class="line">            dataSet.setColor(color); <span class="comment">//线条颜色</span></div><div class="line">            dataSet.setCircleColor(color); <span class="comment">//圆点颜色</span></div><div class="line">            dataSet.setCircleColorHole(Color.WHITE);</div><div class="line">            dataSet.setCircleHoleRadius(<span class="number">2.0f</span>);</div><div class="line">            dataSet.setDrawValues(<span class="keyword">false</span>);</div><div class="line">            <span class="keyword">return</span> dataSet;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>当然如果需求图表有其他样式的的话，我觉得也可以把配置信息抽取出来，通过不同的配置来设置不同的样式。</p>
<p>在Activity中的使用<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">package</span> cn.xiaolongonly.mpchartsample.ui;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.widget.RelativeLayout;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.R;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.base.BaseTitleActivity;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.bean.ChartValue;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.chart.item.LineChartItem;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> xiaolong</div><div class="line"> * <span class="doctag">@version</span> v1.0</div><div class="line"> * <span class="doctag">@function</span> &lt;描述功能&gt;</div><div class="line"> * <span class="doctag">@date</span> 2016/12/5-17:32</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LineChartActivity2</span> <span class="keyword">extends</span> <span class="title">BaseTitleActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> RelativeLayout rlContent;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getLayoutId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> R.layout.activity_chart;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">        rlContent = findView(R.id.rlContent);</div><div class="line">        List&lt;ChartValue&gt; chartValues = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        chartValues.add(<span class="keyword">new</span> ChartValue(<span class="string">"11月"</span>, <span class="number">110f</span>));</div><div class="line">        chartValues.add(<span class="keyword">new</span> ChartValue(<span class="string">"10月"</span>, <span class="number">120f</span>));</div><div class="line">        chartValues.add(<span class="keyword">new</span> ChartValue(<span class="string">"9月"</span>, <span class="number">100f</span>));</div><div class="line">        List&lt;ChartValue&gt; chartValues2 = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        chartValues2.add(<span class="keyword">new</span> ChartValue(<span class="string">"11月"</span>, <span class="number">155f</span>));</div><div class="line">        chartValues2.add(<span class="keyword">new</span> ChartValue(<span class="string">"10月"</span>, <span class="number">133f</span>));</div><div class="line">        chartValues2.add(<span class="keyword">new</span> ChartValue(<span class="string">"9月"</span>, <span class="number">122f</span>));</div><div class="line">        LineChartItem lineChartItem = <span class="keyword">new</span> LineChartItem.Builder(<span class="keyword">this</span>).setxDesc(<span class="string">"单位(月)"</span>)</div><div class="line">                .setyDesc(<span class="string">"单位(万)"</span>).setDescribles(<span class="keyword">new</span> String[]&#123;<span class="string">"项目支出金额"</span>&#125;)</div><div class="line">                .addChartValueList(chartValues).addChartValueList(chartValues2)</div><div class="line">                .build();</div><div class="line">        rlContent.addView(lineChartItem.getView());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>是不是就简单多了只要构建一个Item对象，然后将item对象的图表布局，add到View中去就可以了。</p>
<p>实现效果<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/MPAndroidChart3/20161206202946914.png?raw=true" alt="实现效果"></p>
<p><a href="https://github.com/xiaolongonly/MPAndroid-Chart" target="_blank" rel="external">项目github下载</a></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>一直都没想到有一天我也能这么写代码，感觉代码写多了很多东西就懂了。</p>
<p>在最开始的时候老大让我对图表框架进行二次封装，我听的一脸懵逼，经过一段时间的思考，反复对照之前的项目，因为之前的项目的配置都写在继承的图表中，在xml布局中要将图表改成继承的图表，数据导入也写在了Activity类中，感觉代码特别多且杂，后来想到了一句话，多用组合少用继承，现在看来确实，组合的方式会比继承好很多。虽然参考了好多代码，封装的也不怎么样，但是我确实是做到了。</p>
<p>那时候跟同时说我把图表框架封装完的时候，同事说，不会啊封装的不错。对于我这种渣渣来讲就是莫大的安慰了。离自己的目标又近了一步。加油~~</p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2016/12/06/MPAndroidChart2/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/06/MPAndroidChart2/" itemprop="url">
                  MPAndroidChart添加自定义样式
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-06T20:27:50+08:00">
                2016-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android第三方框架/" itemprop="url" rel="index">
                    <span itemprop="name">Android第三方框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>之前为添加XY轴描述大伤脑筋，因为如果用原生的TextView在图表控件的上方和下方分别作为XY轴加了Legend之后效果会差很多，如果绘制在图表上方又不好控制位置。<br>之前用textView来左XY轴实现效果：<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/MPAndroidChart2/20161206202535454.png?raw=true" alt="实现效果"><br>实现效果总的来讲还是可以的，但是因为控件是分离的，不好做到适配。<br>如果能在图表里面绘制一个就好了，然后发现了图表有Legend的绘制，有得参考了，自己根据Legend写了一个。<br>话不多说，开搞</p>
<h4 id="分析Legend实现"><a href="#分析Legend实现" class="headerlink" title="分析Legend实现"></a>分析Legend实现</h4><p>Android Studio双击Shift找Legend，在框架的components文件夹下找到了Legend这个类。<br>Legend里面配置了一堆Legend参数：位置，颜色，方向，显示的数据等等…嗯，知道了这个就是用来配置Legend属性的类。</p>
<p>components里面的属性类都继承了ComponentBase这个类，看一下ComponentBase这个类做什么的。<br>里面是一些抽取出来的共用的配置，文字大小，颜色，是否可用间距等…</p>
<p>Legend在框架中的引用：LegendEntry，LegendRender,BarLineChartBase,Chart,BaseDataSet,IDataSet都有做引用</p>
<ol>
<li>LegendEntry:跟BarEntry等是一样的，是Legend每个item的属性。因为Legend 有多个数据，所以需要一个Entry的列表的来做存储。</li>
<li>LegendRender:这个是重点，它用来根据属性配置绘制Legend。</li>
<li>BarLineChartBase：这个在这个类的onDraw方法找到了Legend和LegendRender的引用。绘制就在这里了。</li>
<li>Chart:声明Legend和LegendRender，这个是公用的属性。</li>
<li>BaseDataSet和IDataSet:因为Legend跟图表的颜色和label有挂钩，所以需要。</li>
</ol>
<p>分析上面文件我们需要写两个类，XYDESC(属性配置类)，XYDESCRender(绘制类),并且在BarLineChartBase中声明和绘制（只有这两个图有XY轴）</p>
<h4 id="实现我们的XYDESC"><a href="#实现我们的XYDESC" class="headerlink" title="实现我们的XYDESC"></a>实现我们的XYDESC</h4><p>在components文件夹下增加XYDESC类<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.utils.Utils;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> xiaolong</div><div class="line"> * <span class="doctag">@version</span> v1.0</div><div class="line"> * <span class="doctag">@function</span> &lt;描述功能&gt;</div><div class="line"> * <span class="doctag">@date</span> 2016/10/12-14:09</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XYDesc</span> <span class="keyword">extends</span> <span class="title">ComponentBase</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> String xDesc;</div><div class="line">    <span class="keyword">private</span> String yDesc;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> yPadding;</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getxDesc</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> xDesc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setxDesc</span><span class="params">(String xDesc)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.xDesc = xDesc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getyDesc</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> yDesc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setyDesc</span><span class="params">(String yDesc)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.yDesc = yDesc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XYDesc</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.setEnabled(<span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * returns the maximum length in pixels across all legend labels + formsize</div><div class="line">     * + formtotextspace</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> p the paint object used for rendering the text</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getMaximumEntryWidth</span><span class="params">(Paint p, String desc)</span> </span>&#123;</div><div class="line">        <span class="keyword">float</span> length = (<span class="keyword">float</span>) Utils.calcTextWidth(p, desc);</div><div class="line">        <span class="keyword">return</span> length;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * returns the maximum height in pixels across all legend labels</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> p the paint object used for rendering the text</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getMaximumEntryHeight</span><span class="params">(Paint p, String desc)</span> </span>&#123;</div><div class="line">        <span class="keyword">float</span> length = (<span class="keyword">float</span>) Utils.calcTextHeight(p, desc);</div><div class="line">        <span class="keyword">return</span> length;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getyPadding</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> yPadding;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setyPadding</span><span class="params">(<span class="keyword">float</span> yPadding)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.yPadding = yPadding;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>分别设置了X轴和Y轴描述，<br>padding是因为我们是参照Legend写的如果不做padding的话，会跟Legend绘制重叠，所以如果在左上角或右下角有Legend的时候加上padding。</p>
<p>//这两个方法用来计算文字的宽度和高度(Render中需要)</p>
<p>getMaxinumEntryWidth(Paint p,String desc)    </p>
<p>getMaximumEntryHeight(Paint p, String desc)</p>
<p>在renderer文件夹下增加XYDESCRender</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.graphics.Canvas;</div><div class="line"><span class="keyword">import</span> android.graphics.Paint;</div><div class="line"><span class="keyword">import</span> android.graphics.Typeface;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.XYDesc;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.utils.Utils;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.utils.ViewPortHandler;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> xiaolong</div><div class="line"> * <span class="doctag">@version</span> v1.0</div><div class="line"> * <span class="doctag">@function</span> &lt;描述功能&gt;</div><div class="line"> * <span class="doctag">@date</span> 2016/10/12-14:05</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">XYDESCRenderer</span> <span class="keyword">extends</span> <span class="title">Renderer</span> </span>&#123;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint for the XYDESCRenderer labels</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mXYDESCLabelPaint;</div><div class="line">    <span class="keyword">protected</span> XYDesc mXYDesc;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">XYDESCRenderer</span><span class="params">(ViewPortHandler viewPortHandler, XYDesc xydesc)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(viewPortHandler);</div><div class="line">        mXYDesc = xydesc;</div><div class="line">        <span class="comment">//初始化画笔</span></div><div class="line">        mXYDESCLabelPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        mXYDESCLabelPaint.setTextSize(Utils.convertDpToPixel(xydesc.getTextSize()));</div><div class="line">        mXYDESCLabelPaint.setTextAlign(Paint.Align.LEFT);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the Paint object used for drawing the Legend labels.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Paint <span class="title">getLabelPaint</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mXYDESCLabelPaint;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 在画布上绘制</div><div class="line">     * <span class="doctag">@param</span> c</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">renderLegend</span><span class="params">(Canvas c)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (!mXYDesc.isEnabled())</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        Typeface tf = mXYDESCLabelPaint.getTypeface();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (tf != <span class="keyword">null</span>)</div><div class="line">            mXYDESCLabelPaint.setTypeface(tf);</div><div class="line"></div><div class="line">        mXYDESCLabelPaint.setTextSize(mXYDesc.getTextSize());</div><div class="line">        mXYDESCLabelPaint.setColor(mXYDesc.getTextColor());</div><div class="line">		<span class="comment">//获取行高</span></div><div class="line">        <span class="keyword">float</span> labelLineHeight = Utils.getLineHeight(mXYDESCLabelPaint);</div><div class="line">        <span class="keyword">float</span> yoffset = mXYDesc.getYOffset();</div><div class="line">        <span class="keyword">float</span> xoffset = mXYDesc.getXOffset();</div><div class="line"><span class="comment">//        drawLabel(c, mViewPortHandler.contentLeft() + mXYDesc.getMaximumEntryWidth(mXYDESCLabelPaint, mXYDesc.getyDesc()), yoffset + labelLineHeight + mXYDesc.getyPadding(), mXYDesc.getyDesc());</span></div><div class="line">        drawLabel(c, mViewPortHandler.contentLeft()</div><div class="line">                , yoffset + labelLineHeight + mXYDesc.getyPadding(), mXYDesc.getyDesc());</div><div class="line">        drawLabel(c, mViewPortHandler.contentRight() - mXYDesc.getMaximumEntryWidth(mXYDESCLabelPaint, mXYDesc.getxDesc())</div><div class="line">                , mViewPortHandler.getChartHeight() - yoffset - mXYDesc.getMaximumEntryHeight(mXYDESCLabelPaint, mXYDesc.getxDesc()) + <span class="number">10</span>, mXYDesc.getxDesc());</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Draws the provided label at the given position.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> c     canvas to draw with</div><div class="line">     * <span class="doctag">@param</span> x</div><div class="line">     * <span class="doctag">@param</span> y</div><div class="line">     * <span class="doctag">@param</span> label the label to draw</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawLabel</span><span class="params">(Canvas c, <span class="keyword">float</span> x, <span class="keyword">float</span> y, String label)</span> </span>&#123;</div><div class="line">        c.drawText(label, x, y, mXYDESCLabelPaint);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>固定两个drawLabel分别在左上角和右下角。</p>
<p>然后在BarLineChartBase声明XYDESC和XYDESCRender</p>
<pre><code>protected XYDesc mXYDesc;
protected XYDESCRenderer mXYDESCRenderer;
//在init方法中初始化
  mXYDesc = new XYDesc();
mXYDESCRenderer = new XYDESCRenderer(mViewPortHandler, mXYDesc);
//在onDraw方法中绘制
找到 mLegendRenderer.renderLegend(canvas);下面加一句
mXYDESCRenderer.renderLegend(canvas);
增加属性设置方法
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> XYDesc <span class="title">getXYDesc</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> mXYDesc;</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> XYDESCRenderer <span class="title">getXYDESCRenderer</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">return</span> mXYDESCRenderer;</div><div class="line">  &#125;</div><div class="line"></div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setXYDesc</span><span class="params">(String xDesc, String yDesc)</span> </span>&#123;</div><div class="line">      setXYDesc(xDesc, yDesc, <span class="number">10f</span>);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setXYDesc</span><span class="params">(String xDesc, String yDesc, <span class="keyword">float</span> textSize)</span> </span>&#123;</div><div class="line">      setXYDesc(xDesc, yDesc, textSize, Color.BLACK);</div><div class="line">  &#125;</div><div class="line"></div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setXYDesc</span><span class="params">(String xDesc, String yDesc, <span class="keyword">float</span> textSize, <span class="keyword">int</span> textColor)</span> </span>&#123;</div><div class="line">      mXYDesc.setxDesc(xDesc);</div><div class="line">      mXYDesc.setyDesc(yDesc);</div><div class="line">      mXYDesc.setTextSize(textSize);</div><div class="line">      mXYDesc.setTextColor(textColor);</div><div class="line">      mXYDesc.setEnabled(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">      <span class="keyword">if</span> (mLegend.isEnabled() &amp;&amp; (mLegend.getPosition() == Legend.LegendPosition.ABOVE_CHART_CENTER</div><div class="line">              || mLegend.getPosition() == Legend.LegendPosition.ABOVE_CHART_LEFT</div><div class="line">              || mLegend.getPosition() == Legend.LegendPosition.ABOVE_CHART_RIGHT)) &#123;</div><div class="line">          mXYDesc.setyPadding(<span class="number">6</span> * mLegend.getFormSize());</div><div class="line">      &#125;</div><div class="line">      <span class="keyword">this</span>.setExtraBottomOffset(<span class="number">12f</span> + textSize);</div><div class="line">      <span class="keyword">this</span>.setExtraTopOffset(<span class="number">12f</span> + textSize);</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>就可以参考第一篇的来使用了。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.xiaolongonly.mpchartsample.ui;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.charts.LineChart;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.AxisBase;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.Legend;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.XAxis;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.YAxis;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.Entry;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.LineData;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.LineDataSet;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.formatter.IAxisValueFormatter;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.interfaces.datasets.ILineDataSet;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.R;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.base.BaseActivity;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.chart.markview.DataMarkView;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.chart.util.ColorTemplate;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> xiaolong</div><div class="line"> * <span class="doctag">@version</span> v1.0</div><div class="line"> * <span class="doctag">@function</span> &lt;描述功能&gt;</div><div class="line"> * <span class="doctag">@date</span> 2016/12/6-9:10</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LineChartActivity1</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> LineChart chart;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getLayoutId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> R.layout.list_item_linechart;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">        chart = findView(R.id.chart);</div><div class="line"></div><div class="line">        ChartConfig();</div><div class="line">		<span class="comment">//XY轴配置</span></div><div class="line">        XAxis xAxis = chart.getXAxis();</div><div class="line">        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM); <span class="comment">//定制X轴是在图表上方还是下方。</span></div><div class="line">        xAxis.setDrawGridLines(<span class="keyword">false</span>);</div><div class="line">        xAxis.setGranularity(<span class="number">1</span>);</div><div class="line">        xAxis.setValueFormatter(<span class="keyword">new</span> IAxisValueFormatter() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getFormattedValue</span><span class="params">(<span class="keyword">float</span> value, AxisBase axis)</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> (<span class="keyword">int</span>) value + <span class="string">"年"</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        YAxis yAxisRight = chart.getAxisRight();</div><div class="line">        yAxisRight.setEnabled(<span class="keyword">false</span>);</div><div class="line">        YAxis yAxisLeft = chart.getAxisLeft();</div><div class="line">        yAxisLeft.setAxisMinValue(<span class="number">0</span>);</div><div class="line">		<span class="comment">//动画效果</span></div><div class="line">        chart.animateX(<span class="number">750</span>);</div><div class="line">        chart.animateY(<span class="number">750</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 图表的配置 一些提示和Legend</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ChartConfig</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">//设置覆盖物</span></div><div class="line">        DataMarkView dataMarkView = <span class="keyword">new</span> DataMarkView(<span class="keyword">this</span>, <span class="number">0</span>, <span class="string">""</span>);<span class="comment">//自定义覆盖物</span></div><div class="line">        chart.setMarkerView(dataMarkView);</div><div class="line"></div><div class="line">        <span class="comment">//背景设置</span></div><div class="line">        chart.setDrawGridBackground(<span class="keyword">false</span>);<span class="comment">//表格背景绘制</span></div><div class="line">        chart.setBackgroundColor(getResources().getColor(R.color.chart_bg));</div><div class="line"></div><div class="line">        <span class="comment">//Legend定制</span></div><div class="line">        chart.getLegend().setPosition(Legend.LegendPosition.ABOVE_CHART_LEFT);</div><div class="line">        chart.getLegend().setForm(Legend.LegendForm.CIRCLE);<span class="comment">//Legend样式</span></div><div class="line"></div><div class="line">        <span class="comment">//图表描述</span></div><div class="line">        chart.setDescription(<span class="keyword">null</span>);</div><div class="line">        <span class="comment">// 设置无数据文本提示</span></div><div class="line">        chart.setNoDataText(getResources().getString(R.string.chart_no_data));</div><div class="line">        <span class="comment">//XY轴描述</span></div><div class="line">        chart.setXYDesc(<span class="string">"年份"</span>, <span class="string">"总金额（元)"</span>);</div><div class="line">        <span class="comment">//设置单方向和双方向缩放 true x,y方向可以同时控制，false只能控制x方向的缩小放大或者Y方向的缩小放大</span></div><div class="line">        chart.setPinchZoom(<span class="keyword">true</span>);</div><div class="line">        <span class="comment">//填充数据</span></div><div class="line">        chart.setData(<span class="keyword">new</span> LineData(generateLineDataSet()));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> ILineDataSet <span class="title">generateLineDataSet</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> color = ColorTemplate.PIE_COLORS[<span class="number">0</span>];</div><div class="line">        LineDataSet dataSet = <span class="keyword">new</span> LineDataSet(generateData(), <span class="string">"年度营业额曲线"</span>);</div><div class="line">        dataSet.setLineWidth(<span class="number">2.0f</span>);</div><div class="line">        dataSet.setCircleRadius(<span class="number">3.5f</span>);</div><div class="line">        dataSet.setDrawCircleHole(<span class="keyword">true</span>);<span class="comment">//填充圆</span></div><div class="line">        dataSet.setValueTextSize(<span class="number">9f</span>);</div><div class="line">        dataSet.setHighlightLineWidth(<span class="number">2.0f</span>);</div><div class="line">        dataSet.setDrawFilled(<span class="keyword">true</span>);<span class="comment">//区域颜色</span></div><div class="line">        dataSet.setFillAlpha(<span class="number">51</span>);</div><div class="line">        dataSet.setFillColor(color); <span class="comment">//填充色</span></div><div class="line">        dataSet.setHighLightColor(color); <span class="comment">//选中十字线色</span></div><div class="line">        dataSet.setColor(color); <span class="comment">//线条颜色</span></div><div class="line">        dataSet.setCircleColor(color); <span class="comment">//圆点颜色</span></div><div class="line">        dataSet.setCircleColorHole(Color.WHITE);</div><div class="line">        dataSet.setCircleHoleRadius(<span class="number">2.0f</span>);</div><div class="line">        dataSet.setDrawValues(<span class="keyword">false</span>);</div><div class="line">        <span class="keyword">return</span> dataSet;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> List&lt;Entry&gt; <span class="title">generateData</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;Entry&gt; entryList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        entryList.add(<span class="keyword">new</span> Entry(<span class="number">2013</span>, <span class="number">1000</span>));</div><div class="line">        entryList.add(<span class="keyword">new</span> Entry(<span class="number">2014</span>, <span class="number">2000</span>));</div><div class="line">        entryList.add(<span class="keyword">new</span> Entry(<span class="number">2015</span>, <span class="number">3000</span>));</div><div class="line">        entryList.add(<span class="keyword">new</span> Entry(<span class="number">2016</span>, <span class="number">4000</span>));</div><div class="line">        <span class="keyword">return</span> entryList;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/MPAndroidChart2/20161206202649342.png?raw=true" alt="效果图"></p>
<p>将描述写到了图表框架中了。感觉明显就好用多了。</p>
<pre><code>在很多需求中，大部分图表都是大同小异。我们并不想要将同种类型的图表都按需求配置一遍，那样代码会显得多且杂，所以有必要将这些配置写成通用的配置。

下一篇会介绍图表框架的简单封装。
</code></pre><p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2016/12/06/MPAndroidChart1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/06/MPAndroidChart1/" itemprop="url">
                  非常实用的图表工具MPAndroidChart
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-12-06T20:23:12+08:00">
                2016-12-06
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android第三方框架/" itemprop="url" rel="index">
                    <span itemprop="name">Android第三方框架</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>最近做了两个数据展示的APP，都使用到了MPAndroidChart这个图表框架。</p>
<p>框架地址：<a href="https://github.com/PhilJay/MPAndroidChart" target="_blank" rel="external">https://github.com/PhilJay/MPAndroidChart</a></p>
<p>下面就来讲解一下MPChart的使用</p>
<h1 id="MPAndoridChart"><a href="#MPAndoridChart" class="headerlink" title="MPAndoridChart"></a>MPAndoridChart</h1><h2 id="Chart-types（目前支持的图表类别）"><a href="#Chart-types（目前支持的图表类别）" class="headerlink" title="Chart types（目前支持的图表类别）"></a>Chart types（目前支持的图表类别）</h2><ul>
<li><p>LineChart (with legend, simple design) (线性图1)<br><img src="https://camo.githubusercontent.com/a9eaa5fc7fb6c1e70b22acd09385055e0f5c4fe7/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d5043686172742f6d61737465722f73637265656e73686f74732f73696d706c6564657369676e5f6c696e656368617274342e706e67" alt="线性图1"></p>
</li>
<li><p>LineChart (with legend, simple design) (线性图2)<br><img src="https://camo.githubusercontent.com/8c1c9cf68af994a1e17690834603c450638cc62c/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d5043686172742f6d61737465722f73637265656e73686f74732f73696d706c6564657369676e5f6c696e656368617274332e706e67" alt="线性图2"></p>
</li>
<li><p>LineChart (cubic lines) (线性图3)<br><img src="https://camo.githubusercontent.com/4e85ee91169c2ad5dc500b3b415a0c974766615d/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d5043686172742f6d61737465722f73637265656e73686f74732f63756269636c696e6563686172742e706e67" alt="线性图3"></p>
</li>
<li><p>LineChart (gradient fill)    (线性图4)<br><img src="https://camo.githubusercontent.com/e29d8d3316203700965cc6cc56e67b779f2845bb/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d5043686172742f6d61737465722f73637265656e73686f74732f636f6d62696e65645f63686172742e706e67" alt="线性图4"></p>
</li>
<li><p>Combined-Chart (bar- and linechart in this case) (组合图 柱状图加线形图组合)<br><img src="https://camo.githubusercontent.com/e29d8d3316203700965cc6cc56e67b779f2845bb/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d5043686172742f6d61737465722f73637265656e73686f74732f636f6d62696e65645f63686172742e706e67" alt="组合图"></p>
</li>
<li><p>BarChart (with legend, simple design)(柱状图1)<br><img src="https://camo.githubusercontent.com/78b4bc4e50e151970961daf56e81c4c0db72d27c/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d5043686172742f6d61737465722f73637265656e73686f74732f73696d706c6564657369676e5f6261726368617274332e706e67" alt="柱状图1"></p>
</li>
<li><p>BarChart (grouped DataSets) (柱状图2)</p>
</li>
</ul>
<p><img src="https://camo.githubusercontent.com/4bf136c2fd25bcbeac0bcf363bc8f48dae0651fc/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d5043686172742f6d61737465722f73637265656e73686f74732f67726f7570656462617263686172742e706e67" alt="柱状图2"></p>
<ul>
<li><p>Horizontal-BarChart(横向柱状图)<br><img src="https://camo.githubusercontent.com/2ec281e0ac3013076bff1c3ac00d8d6de372d7a4/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d5043686172742f6d61737465722f73637265656e73686f74732f686f72697a6f6e74616c5f62617263686172742e706e67" alt="横向柱状图"></p>
</li>
<li><p>PieChart (with selection, …) (饼状图)<br><img src="https://camo.githubusercontent.com/7e8a4a3c938c21d032d44d999edd781b6e146f2a/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d50416e64726f696443686172742f6d61737465722f73637265656e73686f74732f73696d706c6564657369676e5f7069656368617274312e706e67" alt="饼状图"></p>
</li>
<li><p>ScatterChart (with squares, triangles, circles, … and more)(散点图)<br><img src="https://camo.githubusercontent.com/6b254aa699df7f9464967009129c3017de721b77/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d50416e64726f696443686172742f6d61737465722f73637265656e73686f74732f7363617474657263686172742e706e67" alt="散点图"></p>
</li>
</ul>
<ul>
<li>CandleStickChart (for financial data)    （烛形图）<br><img src="https://camo.githubusercontent.com/6dbee4e35fde8691e5ac29417583dc8e16608895/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d50416e64726f696443686172742f6d61737465722f73637265656e73686f74732f63616e646c65737469636b63686172742e706e67" alt="烛形图"></li>
</ul>
<ul>
<li>BubbleChart (area covered by bubbles indicates the yValue)（气泡图）<br><img src="https://camo.githubusercontent.com/6704c21e680e831c3c07d0bebf2676f5e99a3d41/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d50416e64726f696443686172742f6d61737465722f73637265656e73686f74732f627562626c6563686172742e706e67" alt="气泡图"></li>
</ul>
<ul>
<li>RadarChart (spider web chart)(雷达图)<br><img src="https://camo.githubusercontent.com/782ded242133f98db56004fc94401570b8749620/68747470733a2f2f7261772e6769746875622e636f6d2f5068696c4a61792f4d50416e64726f696443686172742f6d61737465722f73637265656e73686f74732f726164617263686172742e706e67" alt="雷达图"></li>
</ul>
<h2 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h2><ul>
<li>支持x，y轴缩放</li>
<li>支持拖拽</li>
<li>支持手指滑动</li>
<li>支持高亮显示</li>
<li>支持保存图表到文件中</li>
<li>支持从文件（txt）中读取数据</li>
<li>预先定义颜色模板</li>
<li>自动生成标注</li>
<li>支持自定义x，y轴的显示标签</li>
<li>支持x，y轴动画</li>
<li>支持x，y轴设置最大值和附加信息</li>
<li>支持自定义字体，颜色，背景，手势，虚线等</li>
</ul>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><pre><code>写sample的时候才发现，从1.0版本到3.0版本这个框架改动还是蛮多的。
主要是把雷达图和饼状图抽取共用了。为了实现复合图将X轴值的设置放到了Axais中。之前是直接放到ChartData中的。

图表常用的实现：
每个图表都必须实现填充ChartData，也就是XY轴的数据。
系统有默认的图表样式，可根据喜好设置图表的样式，各种颜色、形状、数据之间的间距等。
可以根据图表的绘制流程和图表的点击事件(点击某个数据的监听)设置监听。
可以添加图表的一些辅助显示工具：MarkView(以MarkView的形式显示数据，这种在数据量大的情况能避免数据显示重叠)，Legend(图表轴描述)
</code></pre><p>这边以LineChart为例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> cn.xiaolongonly.mpchartsample.ui;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.graphics.Color;</div><div class="line"></div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.charts.LineChart;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.AxisBase;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.Legend;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.XAxis;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.components.YAxis;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.Entry;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.LineData;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.data.LineDataSet;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.formatter.IAxisValueFormatter;</div><div class="line"><span class="keyword">import</span> com.github.mikephil.charting.interfaces.datasets.ILineDataSet;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"></div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.R;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.base.BaseActivity;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.chart.markview.DataMarkView;</div><div class="line"><span class="keyword">import</span> cn.xiaolongonly.mpchartsample.chart.util.ColorTemplate;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * <span class="doctag">@author</span> xiaolong</div><div class="line"> * <span class="doctag">@version</span> v1.0</div><div class="line"> * <span class="doctag">@function</span> &lt;描述功能&gt;</div><div class="line"> * <span class="doctag">@date</span> 2016/12/6-9:10</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LineChartActivity1</span> <span class="keyword">extends</span> <span class="title">BaseActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> LineChart chart;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">int</span> <span class="title">getLayoutId</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> R.layout.list_item_linechart;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">initView</span><span class="params">()</span> </span>&#123;</div><div class="line">        chart = findView(R.id.chart);</div><div class="line"></div><div class="line">        ChartConfig();</div><div class="line">		<span class="comment">//XY轴配置</span></div><div class="line">        XAxis xAxis = chart.getXAxis();</div><div class="line">        xAxis.setPosition(XAxis.XAxisPosition.BOTTOM); <span class="comment">//定制X轴是在图表上方还是下方。</span></div><div class="line">        xAxis.setDrawGridLines(<span class="keyword">false</span>);</div><div class="line">        xAxis.setGranularity(<span class="number">1</span>);</div><div class="line">        xAxis.setValueFormatter(<span class="keyword">new</span> IAxisValueFormatter() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">getFormattedValue</span><span class="params">(<span class="keyword">float</span> value, AxisBase axis)</span> </span>&#123;</div><div class="line">                <span class="keyword">return</span> (<span class="keyword">int</span>) value + <span class="string">"年"</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">        YAxis yAxisRight = chart.getAxisRight();</div><div class="line">        yAxisRight.setEnabled(<span class="keyword">false</span>);</div><div class="line">        YAxis yAxisLeft = chart.getAxisLeft();</div><div class="line">        yAxisLeft.setAxisMinValue(<span class="number">0</span>);</div><div class="line">		<span class="comment">//动画效果</span></div><div class="line">        chart.animateX(<span class="number">750</span>);</div><div class="line">        chart.animateY(<span class="number">750</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 图表的配置 一些提示和Legend</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">ChartConfig</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">//设置覆盖物</span></div><div class="line">        DataMarkView dataMarkView = <span class="keyword">new</span> DataMarkView(<span class="keyword">this</span>, <span class="number">0</span>, <span class="string">""</span>);<span class="comment">//自定义覆盖物</span></div><div class="line">        chart.setMarkerView(dataMarkView);</div><div class="line"></div><div class="line">        <span class="comment">//背景设置</span></div><div class="line">        chart.setDrawGridBackground(<span class="keyword">false</span>);<span class="comment">//表格背景绘制</span></div><div class="line">        chart.setBackgroundColor(getResources().getColor(R.color.chart_bg));</div><div class="line"></div><div class="line">        <span class="comment">//Legend定制</span></div><div class="line">        chart.getLegend().setPosition(Legend.LegendPosition.ABOVE_CHART_LEFT);</div><div class="line">        chart.getLegend().setForm(Legend.LegendForm.CIRCLE);<span class="comment">//Legend样式</span></div><div class="line"></div><div class="line">        <span class="comment">//图表描述</span></div><div class="line">        chart.setDescription(<span class="keyword">null</span>);</div><div class="line">        <span class="comment">// 设置无数据文本提示</span></div><div class="line">        chart.setNoDataText(getResources().getString(R.string.chart_no_data));</div><div class="line">        <span class="comment">//XY轴描述</span></div><div class="line">        chart.setXYDesc(<span class="string">"年份"</span>, <span class="string">"总金额（元)"</span>);</div><div class="line">        <span class="comment">//设置单方向和双方向缩放 true x,y方向可以同时控制，false只能控制x方向的缩小放大或者Y方向的缩小放大</span></div><div class="line">        chart.setPinchZoom(<span class="keyword">true</span>);</div><div class="line">        <span class="comment">//填充数据</span></div><div class="line">        chart.setData(<span class="keyword">new</span> LineData(generateLineDataSet()));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">setListener</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> ILineDataSet <span class="title">generateLineDataSet</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">int</span> color = ColorTemplate.PIE_COLORS[<span class="number">0</span>];</div><div class="line">        LineDataSet dataSet = <span class="keyword">new</span> LineDataSet(generateData(), <span class="string">"年度营业额曲线"</span>);</div><div class="line">        dataSet.setLineWidth(<span class="number">2.0f</span>);</div><div class="line">        dataSet.setCircleRadius(<span class="number">3.5f</span>);</div><div class="line">        dataSet.setDrawCircleHole(<span class="keyword">true</span>);<span class="comment">//填充圆</span></div><div class="line">        dataSet.setValueTextSize(<span class="number">9f</span>);</div><div class="line">        dataSet.setHighlightLineWidth(<span class="number">2.0f</span>);</div><div class="line">        dataSet.setDrawFilled(<span class="keyword">true</span>);<span class="comment">//区域颜色</span></div><div class="line">        dataSet.setFillAlpha(<span class="number">51</span>);</div><div class="line">        dataSet.setFillColor(color); <span class="comment">//填充色</span></div><div class="line">        dataSet.setHighLightColor(color); <span class="comment">//选中十字线色</span></div><div class="line">        dataSet.setColor(color); <span class="comment">//线条颜色</span></div><div class="line">        dataSet.setCircleColor(color); <span class="comment">//圆点颜色</span></div><div class="line">        dataSet.setCircleColorHole(Color.WHITE);</div><div class="line">        dataSet.setCircleHoleRadius(<span class="number">2.0f</span>);</div><div class="line">        dataSet.setDrawValues(<span class="keyword">false</span>);</div><div class="line">        <span class="keyword">return</span> dataSet;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> List&lt;Entry&gt; <span class="title">generateData</span><span class="params">()</span> </span>&#123;</div><div class="line">        List&lt;Entry&gt; entryList = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        entryList.add(<span class="keyword">new</span> Entry(<span class="number">2013</span>, <span class="number">1000</span>));</div><div class="line">        entryList.add(<span class="keyword">new</span> Entry(<span class="number">2014</span>, <span class="number">2000</span>));</div><div class="line">        entryList.add(<span class="keyword">new</span> Entry(<span class="number">2015</span>, <span class="number">3000</span>));</div><div class="line">        entryList.add(<span class="keyword">new</span> Entry(<span class="number">2016</span>, <span class="number">4000</span>));</div><div class="line">        <span class="keyword">return</span> entryList;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>效果如下<br><img src="https://github.com/guoxiaolongonly/BlogCache/blob/master/img/MPAndroidChart1/20161206202040496.png?raw=true" alt="效果图"></p>
<pre><code>简单的介绍了一下MPChart的实现，一般就两个流程：
一是设置图表配置（Legend,X，Y轴样式，图表样式，markView添加，动画效果等，注：不设置的话会使用默认的配置）
二是填充数据（将需要展示的数据绑定到图表框架中）。
图表框架有写地方并不能满足我们的需求，比如说没有XY轴描述。
国内的人大部分看图表的习惯就只需要显示单条X，Y轴，并在轴末端设置单位等。
下一篇文章介绍 自定义需求，XY轴描述添加。
</code></pre><p>参考自：<a href="http://blog.csdn.net/u013338165/article/details/44810025" target="_blank" rel="external">http://blog.csdn.net/u013338165/article/details/44810025</a></p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2016/08/08/Summary 2016-08-08/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/08/08/Summary 2016-08-08/" itemprop="url">
                  工作总结（一）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2016-08-08T14:23:44+08:00">
                2016-08-08
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/阶段性总结/" itemprop="url" rel="index">
                    <span itemprop="name">阶段性总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h5 id="闲谈："><a href="#闲谈：" class="headerlink" title="闲谈："></a>闲谈：</h5><h6 id="工作总结"><a href="#工作总结" class="headerlink" title="工作总结"></a>工作总结</h6><p>总结一下最近工作，换了新环境，感觉有好多东西要学的，在这里接触的大部分是Android的新技术。现在对Android开发使用的技术与上一家公司使用的技术进行对比。</p>
<pre><code>         新公司                            原公司
网络请求：Retrofit+RxJava                  Volley+OkHttp
数据解析：Gson+Retrofit                      Gson
本地数据存储：SQLlite+Sharepreference        SQLlite+Sharepreference
布局工具：AutoLayout                          Android原生
Log工具：orhanobut:logger                    自己封装的DebugUtil
框架模式：MVP                              无
代码支持：Lambda                              无
事件总线：eventBus，Broadcast                 Broadcast
PullTorefresh：RecycleView                  ListView,GridView...
其他：支持高版本沉浸式                        无
</code></pre><p>总的来讲新公司用的东西都是比较新的东西，之前一直想要研究来着，都不知道从哪里学起，终于有机会好好学。<br>其实旧公司的框架算是很稳定的框架，开发时间较长，里面封装了好多工具类，基本上可以支持大部分开发需求，节省了好多人力资源。不过因为框架是比较老的而且进行了好多封装，如果要重构的话可以说牵一发动全身。<br>老框架虽然稳定，但是他不好做修改。但新框架又有很多需要研究的东西。算是各有千秋吧。<br>可能对于有些人他们就喜欢用稳定的框架开发，但作为一名刚下水的移动端开发者来讲我还是觉得新的东西蛮不错的，至少有好多东西可以深入学习，而且这些新技术至少在这几年内还会是主流，这也是学新技术的优势所在啊。<br>对于工作上面的感受就是这样，很喜欢现在有的工作环境。</p>
<h6 id="担忧"><a href="#担忧" class="headerlink" title="担忧"></a>担忧</h6><p>顺便讲一讲作为一名原生移动端开发者的担忧，最近这几年，尤其是今年Html5发展迅速，再加上4G网络的普及，网速不再成为制约，移动端的Html5开发渐渐成了主流。在年初的时候还没觉得Html5市场占有率这么高，大部分应用也就几个页面做成Web版的，原生的还是占大头。但最近接触的项目渐渐的有大部分页面为纯H5页面开发了。目前接手的几个项目中H5的占比都超过50%了，今天刚要开始的一个项目也是有百分之六七十的页面做成了H5。心中的担忧还是没错的，Html5日渐成熟，现在H5前端开发工程师渐渐成为了主流，特别是移动端这边的，由于各种条件的驱使，H5页面开发也趋于主流。感觉Android和IOS原生渐渐沦为管道了。现在部分应用还是会保留部分原生来确保用户体验，但是随着H5及5G的慢慢普及，原生的部分只会越来越少，到时候一个项目中Android和IOS可能需要的人力就很低了。Html5的需求很明显了。</p>
<pre><code>现在对比一下自己感觉中的H5所具备的优势。
1.开发成本低，H5页面是可以跨平台使用的，开发的时候只需要一套H5页面就可以实现两个平台的功能
2.维护成本也低啊，H5相比原生来讲不需要两个平台同时进行修改，只需要修改一下web页就可以  
3.迭代用户看不见的，用户根本不需要更新安装包，新版本直接就可以体验到了。
4.有bug可以及时修复，不需要再次的版本发布
</code></pre><p>可以看出 在开发和过程中使用h5开发可以节省大量人力成本，原本需要十个人干的活现在只需要6-8个公司肯定乐意啊，而且更多时候可以立即修复的bug，可以免安装进行的更新，用户肯定买单。对于用户体验来讲这绝对是非常酸爽的体验。</p>
<h5 id="写一点开发过程中遇到的坑"><a href="#写一点开发过程中遇到的坑" class="headerlink" title="写一点开发过程中遇到的坑"></a>写一点开发过程中遇到的坑</h5><p>1.印象比较深刻的<br>之前在自定义虚线的时候，发现预览虚线显示正常，但是装机运行后虚线显示就变成了实线。代码如下<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</div><div class="line"><span class="tag">&lt;<span class="name">shape</span> <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></div><div class="line">       <span class="attr">android:shape</span>=<span class="string">"line"</span> &gt;</div><div class="line">    <span class="tag">&lt;<span class="name">stroke</span></span></div><div class="line">        <span class="attr">android:dashGap</span>=<span class="string">"6px"</span></div><div class="line">        <span class="attr">android:dashWidth</span>=<span class="string">"12px"</span></div><div class="line">        <span class="attr">android:width</span>=<span class="string">"1px"</span></div><div class="line">        <span class="attr">android:color</span>=<span class="string">"@color/colorLine"</span> /&gt;</div><div class="line"></div><div class="line"><span class="tag">&lt;/<span class="name">shape</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>实在找不到原因，然后后面找了一些网上的解决办法在<a href="http://wv1124.iteye.com/blog/218720" target="_blank" rel="external">地址</a> 终于找到了问题的解决方案了，好吧，直接在Manifest中，把使用到这个layout的Activity的设置了 android:hardwareAccelerated=”false”成功解决问题！！</p>
<p><strong><em>By Xiaolong：You have a dream,you got to protect it!</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/2/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><a class="page-number" href="/page/2/">2</a><span class="page-number current">3</span><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/4/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/lucky.jpg"
               alt="小龙" />
          <p class="site-author-name" itemprop="name">小龙</p>
           
              <p class="site-description motion-element" itemprop="description">程序猿</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">23</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xiaolongonly" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/guoxiaolongonly" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-android"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小龙</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
