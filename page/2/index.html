<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Xiaolong, lucky" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="程序猿">
<meta property="og:type" content="website">
<meta property="og:title" content="Xiaolong的个人博客">
<meta property="og:url" content="http://rngift.com/page/2/index.html">
<meta property="og:site_name" content="Xiaolong的个人博客">
<meta property="og:description" content="程序猿">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Xiaolong的个人博客">
<meta name="twitter:description" content="程序猿">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rngift.com/page/2/"/>





  <title> Xiaolong的个人博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xiaolong的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">每一天都值得被认真对待</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/pastLove" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            爱过的人
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/07/07/Gradle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/07/Gradle/" itemprop="url">
                  gradle学习笔记，常用命令，多渠道打包等
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-07T15:07:23+08:00">
                2017-07-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android项目构建/" itemprop="url" rel="index">
                    <span itemprop="name">Android项目构建</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>本文整理自：<br><a href="http://stormzhang.com/devtools/2014/12/18/android-studio-tutorial4/" target="_blank" rel="external">http://stormzhang.com/devtools/2014/12/18/android-studio-tutorial4/</a><br><a href="http://stormzhang.com/devtools/2015/01/05/android-studio-tutorial5/" target="_blank" rel="external">http://stormzhang.com/devtools/2015/01/05/android-studio-tutorial5/</a><br><a href="http://stormzhang.com/devtools/2015/01/15/android-studio-tutorial6/" target="_blank" rel="external">http://stormzhang.com/devtools/2015/01/15/android-studio-tutorial6/</a> </p>
<h2 id="什么是Gradle？"><a href="#什么是Gradle？" class="headerlink" title="###什么是Gradle？"></a>###什么是Gradle？</h2><p>Gradle是一种依赖管理工具，基于Groovy语言，面向Java应用为主，它抛弃了基于XML的各种繁琐配置，取而代之的是一种基于Groovy的内部领域特定（DSL）语言。</p>
<h2 id="Gradle基本概念"><a href="#Gradle基本概念" class="headerlink" title="###Gradle基本概念"></a>###Gradle基本概念</h2><p>项目目录：<br><img src="http://img.blog.csdn.net/20170706174859891?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="index"><br>从上到下依次分析</p>
<p><strong>1. GradleDemo/app/build.gradle</strong></p>
<p>这个文件是app文件夹下这个Module的gradle配置文件，也可以算是整个项目最主要的gradle配置文件，我们来看下这个文件的内容：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">	<span class="comment">//声明是android程序</span></div><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line">android &#123;</div><div class="line">    <span class="comment">//SDK版本</span></div><div class="line">    compileSdkVersion <span class="number">25</span></div><div class="line">    <span class="comment">//build tools版本</span></div><div class="line">    buildToolsVersion <span class="string">"25.0.2"</span></div><div class="line">    defaultConfig &#123;</div><div class="line">        <span class="comment">// 应用包名</span></div><div class="line">        applicationId <span class="string">"com.standards.gradledemo"</span></div><div class="line">        minSdkVersion <span class="number">15</span></div><div class="line">        targetSdkVersion <span class="number">25</span></div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">        testInstrumentationRunner <span class="string">"android.support.test.runner.AndroidJUnitRunner"</span></div><div class="line">    &#125;</div><div class="line">    buildTypes &#123;</div><div class="line">        debug&#123;</div><div class="line">            <span class="comment">//debug版本</span></div><div class="line">        &#125;</div><div class="line">        release &#123;</div><div class="line">            <span class="comment">//是否进行混淆</span></div><div class="line">            minifyEnabled <span class="keyword">false</span></div><div class="line">            <span class="comment">//混淆文件配置</span></div><div class="line">            <span class="function">proguardFiles <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android.txt'</span>)</span>, 'proguard-rules.pro'</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    <span class="comment">// 编译libs目录下的所有jar包</span></div><div class="line">    <span class="function">compile <span class="title">fileTree</span><span class="params">(include: [<span class="string">'*.jar'</span>], dir: <span class="string">'libs'</span>)</span></span></div><div class="line">    <span class="title">androidTestCompile</span><span class="params">(<span class="string">'com.android.support.test.espresso:espresso-core:2.2.2'</span>, &#123;</span></div><div class="line">        exclude group: <span class="string">'com.android.support'</span>, <span class="keyword">module</span>: <span class="string">'support-annotations'</span></div><div class="line">    &#125;)</div><div class="line">    compile 'com.android.support:appcompat-v7:25.3.1'</div><div class="line">    testCompile 'junit:junit:4.12'</div><div class="line">    <span class="comment">// 编译devlib模块</span></div><div class="line">    compile <span class="title">project</span><span class="params">(<span class="string">':devlib'</span>)</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>说明：</p>
<ul>
<li><p>buildToolsVersion这个需要你本地安装该版本才行，很多人导入新的第三方库，失败的原因之一是build version的版本不对，这个可以手动更改成你本地已有的版本或者打开 SDK Manager 去下载对应版本。</p>
</li>
<li><p>proguardFiles这部分有两段，前一部分代表系统默认的Android程序的混淆文件，该文件已经包含了基本的混淆声明，免去了我们很多事，这个文件的目录在 /tools/proguard/proguard-Android.txt , 后一部分是我们项目里的自定义的混淆文件，目录就在 app/proguard-rules.txt , 如果你用Studio 1.0创建的新项目默认生成的文件名是 proguard-rules.pro , 这个名字没关系，在这个文件里你可以声明一些第三方依赖的一些混淆规则，由于是开源项目，这里未进行混淆。最终混淆的结果是这两部分文件共同作用的。</p>
</li>
<li><p>以上文件里的内容只是基本配置，其实还有很多自定义部分，如自动打包debug，release，beta等环境，签名，多渠道打包等，后续会单独拿出来讲解。</p>
</li>
</ul>
<p><strong>2. GradleDemo/devlib/build.gradle</strong></p>
<p>每一个Module都需要有一个gradle配置文件，语法都是一样，唯一不同的是开头声明的是 apply plugin: ‘com.android.library’</p>
<p><strong>3. GradleDemo/gradle</strong></p>
<p>这个目录下有个 wrapper 文件夹，里面可以看到有两个文件，我们主要看下 gradle-wrapper.properties 这个文件的内容：<br><figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">#Thu Jul 06 16:20:36 CST 2017</div><div class="line">distributionBase=GRADLE_USER_HOME</div><div class="line">distributionPath=wrapper/dists</div><div class="line">zipStoreBase=GRADLE_USER_HOME</div><div class="line">zipStorePath=wrapper/dists</div><div class="line">distributionUrl=https\://services.gradle.org/distributions/gradle-2.14.1-all.zip</div></pre></td></tr></table></figure></p>
<p>可以看到里面声明了gradle的目录与下载路径以及当前项目使用的gradle版本，这些默认的路径我们一般不会更改的，这个文件里指明的gradle版本不对也是很多导包不成功的原因之一。</p>
<p><strong>4. GradleDemo/build.gradle</strong></p>
<p>这个文件是整个项目的gradle基础配置文件,我们来看看这里面的内容<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></div><div class="line"></div><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath <span class="string">'com.android.tools.build:gradle:2.2.3'</span></div><div class="line"></div><div class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></div><div class="line">        <span class="comment">// in the individual module build.gradle files</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">task <span class="title">clean</span><span class="params">(type: Delete)</span> </span>&#123;</div><div class="line">    delete rootProject.buildDir</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>内容主要包含了两个方面：一个是声明仓库的源，这里可以看到是指明的jcenter(), 之前版本则是mavenCentral(), jcenter可以理解成是一个新的中央远程仓库，兼容maven中心仓库，而且性能更优。另一个是声明了android gradle plugin的版本，android studio 1.0正式版必须要求支持gradle plugin 1.0的版本。</p>
<p><strong>5. GradleDemo/settings.gradle</strong></p>
<p>这个文件是全局的项目配置文件，里面主要声明一些需要加入gradle的module，我们来看看9GAG该文件的内容：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">include <span class="string">':app'</span>, <span class="string">':devlib'</span></div></pre></td></tr></table></figure></p>
<p>文件中的 app, devlib 都是module，如果还有其他module都需要按照如上格式加进去。也可以Ctrl+Shift+Alt+S  进入项目配置里面可视化配置。</p>
<h2 id="Gradle命令详解"><a href="#Gradle命令详解" class="headerlink" title="###Gradle命令详解"></a>###Gradle命令详解</h2><p><strong>命令行Gradle编译的过程</strong></p>
<p>1、切换到GradleDemo项目的根目录，执行 <strong>./gradlew -v</strong> 来查看下项目所用的Gradle版本<br>如果你是第一次执行会去下载Gradle，下载成功后会看到如下信息</p>
<pre><code>------------------------------------------------------------
Gradle 2.14.1
------------------------------------------------------------

Build time:   2016-07-18 06:38:37 UTC
Revision:     d9e2113d9fb05a5caabba61798bdb8dfdca83719

Groovy:       2.4.4
Ant:          Apache Ant(TM) version 1.9.6 compiled on June 29 2015
JVM:          1.8.0_25 (Oracle Corporation 25.25-b02)
OS:           Windows 7 6.1 amd64
</code></pre><p>2、接着执行 <strong>./gradlew clean</strong>执行这个命令去下载Gradle的一些依赖,下载成功并编译通过时会看到如下信息：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">:clean UP-TO-DATE</div><div class="line">:app:clean</div><div class="line">:devlib:clean                 </div><div class="line">	               </div><div class="line">BUILD SUCCESSFUL</div></pre></td></tr></table></figure></p>
<p>紧接着在 GradleDemo/app/build/outputs/apk 目录下会看到类似于app-debug-unaligned.apk, app-release-unsigned.apk等，看名字应该能理解意思，unaligned代表没有进行zip优化的，unsigned代表没有签名的。然后就可以直接安装apk查看运行效果了。</p>
<p><strong>Gradle常用命令</strong></p>
<p>上面大家接触了一些命令如 <strong>./gradlew -v</strong> <strong>./gradlew clean ./gradlew build</strong>, 这里注意是<strong>./gradlew</strong>, <strong>./</strong>代表当前目录，<strong>gradlew</strong>代表 gradle wrapper，意思是gradle的一层包装，大家可以理解为在这个项目本地就封装了gradle，即gradle wrapper， 在<strong>GraldeDemo/gradle/wrapper/gralde-wrapper.properties</strong>文件中声明了它指向的目录和版本。只要下载成功即可用grdlew wrapper的命令代替全局的gradle命令。</p>
<p>理解了gradle wrapper的概念，下面一些常用命令也就容易理解了。</p>
<p>./gradlew -v 版本号<br>./gradlew clean 清除9GAG/app目录下的build文件夹<br>./gradlew build 检查依赖并编译打包<br>这里注意的是 <strong>./gradlew build</strong> 命令把debug、release环境的包都打出来，如果正式发布只需要打Release的包，该怎么办呢，下面介绍一个很有用的命令 <strong>assemble</strong>, 如</p>
<p>./gradlew assembleDebug 编译并打Debug包<br>./gradlew assembleRelease 编译并打Release的包<br>除此之外，assemble还可以和productFlavors结合使用，具体在下一篇多渠道打包进一步解释。</p>
<p>./gradlew installRelease Release模式打包并安装<br>./gradlew uninstallRelease 卸载Release模式包</p>
<h2 id="Gradle多渠道打包"><a href="#Gradle多渠道打包" class="headerlink" title="###Gradle多渠道打包"></a>###Gradle多渠道打包</h2><p><strong>友盟多渠道打包</strong></p>
<p>1.以友盟统计为例，在AndroidManifest.xml里面会有这么一段：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta-data</span></span></div><div class="line">	 <span class="attr">android:name</span>=<span class="string">"UMENG_CHANNEL"</span></div><div class="line">	 <span class="attr">android:value</span>=<span class="string">"Channel_ID"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p>里面的Channel_ID就是渠道标示。我们的目标就是在编译的时候这个值能够自动变化。</p>
<p>第一步，在AndroidManifest.xml里配置PlaceHolder<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">meta-data</span></span></div><div class="line">    <span class="attr">android:name</span>=<span class="string">"UMENG_CHANNEL"</span></div><div class="line">    <span class="attr">android:value</span>=<span class="string">"$&#123;UMENG_CHANNEL_VALUE&#125;"</span> /&gt;</div></pre></td></tr></table></figure></p>
<p>第二步，在build.gradle设置productFlavors<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">	android &#123;  </div><div class="line">	    productFlavors &#123;</div><div class="line">	        xiaomi &#123;</div><div class="line">	            manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="string">"xiaomi"</span>]</div><div class="line">	        &#125;</div><div class="line">	        _360 &#123;</div><div class="line">	            manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="string">"_360"</span>]</div><div class="line">	        &#125;</div><div class="line">	        baidu &#123;</div><div class="line">	            manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="string">"baidu"</span>]</div><div class="line">	        &#125;</div><div class="line">	        wandoujia &#123;</div><div class="line">	            manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="string">"wandoujia"</span>]</div><div class="line">	        &#125;</div><div class="line">	    &#125;  </div><div class="line">	&#125;</div><div class="line">或者批量修改</div><div class="line"></div><div class="line">	android &#123;  </div><div class="line">	    productFlavors &#123;</div><div class="line">	        xiaomi &#123;&#125;</div><div class="line">	        _360 &#123;&#125;</div><div class="line">	        baidu &#123;&#125;</div><div class="line">	        wandoujia &#123;&#125;</div><div class="line">	    &#125;  </div><div class="line">	</div><div class="line">	    productFlavors.all &#123; </div><div class="line">	        flavor -&gt; flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name] </div><div class="line">	    &#125;</div><div class="line">	&#125;</div></pre></td></tr></table></figure></p>
<p>很简单清晰有没有？直接执行 <strong>./gradlew assembleRelease</strong> ， 然后就可以静静的喝杯咖啡等待打包完成吧。</p>
<p><strong>assemble结合Build Variants来创建task</strong></p>
<ul>
<li>./gradlew assembleDebug</li>
<li>./gradlew assembleRelease</li>
</ul>
<p>除此之外 <strong>assemble</strong> 还能和 <strong>Product Flavor </strong>结合创建新的任务，其实 <strong>assemble</strong> 是和 <strong>Build Variants</strong> 一起结合使用的，而 <strong>Build Variants = Build Type + Product Flavor</strong> ， 举个例子大家就明白了：</p>
<p>如果我们想打包wandoujia渠道的release版本，执行如下命令就好了：</p>
<ul>
<li><p>./gradlew assembleWandoujiaRelease<br>如果我们只打wandoujia渠道版本，则：</p>
</li>
<li><p>./gradlew assembleWandoujia<br>此命令会生成wandoujia渠道的Release和Debug版本</p>
</li>
</ul>
<p>同理我想打全部Release版本：</p>
<ul>
<li>./gradlew assembleRelease<br>这条命令会把Product Flavor下的所有渠道的Release版本都打出来。</li>
</ul>
<p>总之，assemble 命令创建task有如下用法：</p>
<ul>
<li><strong>assemble</strong>： 允许直接构建一个Variant版本，例如assembleFlavor1Debug。</li>
<li><strong>assemble</strong>： 允许构建指定Build Type的所有APK，例如assembleDebug将会构建Flavor1Debug和Flavor2Debug两个Variant版本。</li>
<li><strong>assemble</strong>： 允许构建指定flavor的所有APK，例如assembleFlavor1将会构建Flavor1Debug和Flavor1Release两个Variant版本。</li>
</ul>
<p><strong>完整的gradle脚本</strong><br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div></pre></td><td class="code"><pre><div class="line">apply plugin: <span class="string">'com.android.application'</span></div><div class="line"></div><div class="line"><span class="function">def <span class="title">releaseTime</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Date().format(<span class="string">"yyyy-MM-dd"</span>, TimeZone.getTimeZone(<span class="string">"UTC"</span>))</div><div class="line">&#125;</div><div class="line"></div><div class="line">android &#123;</div><div class="line">    compileSdkVersion <span class="number">21</span></div><div class="line">    buildToolsVersion <span class="string">'21.1.2'</span></div><div class="line"></div><div class="line">    defaultConfig &#123;</div><div class="line">        applicationId <span class="string">"com.boohee.*"</span></div><div class="line">        minSdkVersion <span class="number">14</span></div><div class="line">        targetSdkVersion <span class="number">21</span></div><div class="line">        versionCode <span class="number">1</span></div><div class="line">        versionName <span class="string">"1.0"</span></div><div class="line">        </div><div class="line">        <span class="comment">// dex突破65535的限制</span></div><div class="line">        multiDexEnabled <span class="keyword">true</span></div><div class="line">        <span class="comment">// 默认是umeng的渠道</span></div><div class="line">        manifestPlaceholders = [UMENG_CHANNEL_VALUE: <span class="string">"umeng"</span>]</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    lintOptions &#123;</div><div class="line">        abortOnError <span class="keyword">false</span></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    signingConfigs &#123;</div><div class="line">        debug &#123;</div><div class="line">            <span class="comment">// No debug config</span></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        release &#123;</div><div class="line">            <span class="function">storeFile <span class="title">file</span><span class="params">(<span class="string">"../yourapp.keystore"</span>)</span></span></div><div class="line">            storePassword "your password"</div><div class="line">            keyAlias "your alias"</div><div class="line">            keyPassword "your password"</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    buildTypes &#123;</div><div class="line">        debug &#123;</div><div class="line">            <span class="comment">// 显示Log</span></div><div class="line">            buildConfigField <span class="string">"boolean"</span>, <span class="string">"LOG_DEBUG"</span>, <span class="string">"true"</span></div><div class="line"></div><div class="line">            versionNameSuffix <span class="string">"-debug"</span></div><div class="line">            minifyEnabled <span class="keyword">false</span></div><div class="line">            zipAlignEnabled <span class="keyword">false</span></div><div class="line">            shrinkResources <span class="keyword">false</span></div><div class="line">            signingConfig signingConfigs.debug</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        release &#123;</div><div class="line">            <span class="comment">// 不显示Log</span></div><div class="line">            buildConfigField <span class="string">"boolean"</span>, <span class="string">"LOG_DEBUG"</span>, <span class="string">"false"</span></div><div class="line"></div><div class="line">            minifyEnabled <span class="keyword">true</span></div><div class="line">            zipAlignEnabled <span class="keyword">true</span></div><div class="line">            <span class="comment">// 移除无用的resource文件</span></div><div class="line">            <span class="function">shrinkResources <span class="keyword">true</span></span></div><div class="line">            proguardFiles <span class="title">getDefaultProguardFile</span><span class="params">(<span class="string">'proguard-android.txt'</span>)</span>, 'proguard-rules.pro'</div><div class="line">            signingConfig signingConfigs.release</div><div class="line"></div><div class="line">            applicationVariants.all &#123; variant -&gt;</div><div class="line">                variant.outputs.each &#123; output -&gt;</div><div class="line">                    def outputFile = output.<span class="function">outputFile</span></div><div class="line">                    <span class="title">if</span> <span class="params">(outputFile != <span class="keyword">null</span> &amp;&amp; outputFile.name.endsWith(<span class="string">'.apk'</span>)</span>) &#123;</div><div class="line">                    	<span class="comment">// 输出apk名称为boohee_v1.0_2015-01-15_wandoujia.apk</span></div><div class="line">                        def fileName = <span class="string">"boohee_v$&#123;defaultConfig.versionName&#125;_$&#123;releaseTime()&#125;_$&#123;variant.productFlavors[0].name&#125;.apk"</span></div><div class="line">                        output.outputFile = <span class="keyword">new</span> File(outputFile.parent, fileName)</div><div class="line">                    &#125;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">// 友盟多渠道打包</span></div><div class="line">    productFlavors &#123;</div><div class="line">        wandoujia &#123;&#125;</div><div class="line">        _360 &#123;&#125;</div><div class="line">        baidu &#123;&#125;</div><div class="line">        xiaomi &#123;&#125;</div><div class="line">        tencent &#123;&#125;</div><div class="line">        taobao &#123;&#125;</div><div class="line">        ...</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    productFlavors.all &#123; flavor -&gt;</div><div class="line">        flavor.manifestPlaceholders = [UMENG_CHANNEL_VALUE: name]</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">dependencies &#123;</div><div class="line">    <span class="function">compile <span class="title">fileTree</span><span class="params">(dir: <span class="string">'libs'</span>, include: [<span class="string">'*.jar'</span>])</span></span></div><div class="line">    compile 'com.android.support:support-v4:21.0.3'</div><div class="line">    compile 'com.jakewharton:butterknife:6.0.0'</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/07/04/Realm/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/07/04/Realm/" itemprop="url">
                  Realm数据库的那些坑
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-07-04T11:00:05+08:00">
                2017-07-04
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android第三方/" itemprop="url" rel="index">
                    <span itemprop="name">Android第三方</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Realm算是移动端用的比较多的ORM框架了，当初选择的时候入了坑，现在只能在这里慢慢爬了，版本3.1.4。记录一些存在的坑。</p>
<p>##Realm的缺点</p>
<p>###id不能自增<br>解决方案：UUID自动生成，或者每次插入的时候获取最大的id往上+1.</p>
<p>###实体类只能继承RealmObjet 或者实现RealmModel加@RealmClass注解。<br><strong>只能直接继承不能间接继承。</strong><br>我的遇到的问题如下，因为所有的数据库实体类都有一部分同样的字段。我就想把这些字段写到MyBaseObject基类中，再由基类来继承ReamObject。实体类直接继承基类。编译不过。<br>Error:(14, 8) 错误: Valid model classes must either extend RealmObject or implement RealmModel. </p>
<p><strong>不能参照RealmObject自己实现RealmModel</strong><br>翻看了一下ReamObject的源码发现它是对RealmModel的实现。天真的以为我也可以这么写一个基类来继承。依然编译不过。一样的错误。<br>这个RealmModel+注解的方式，简直是来逗我的</p>
<p>暂无解决方案。老老实实一个一个写！</p>
<p>###查询的对象带有RealmProxy对象代理</p>
<p>带有代理的对象是可以直接进行Realm数据库操作的。<br><img src="http://img.blog.csdn.net/20170711105957783?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="RealmProxy"> </p>
<p>实体会多一个ColumnInfo和ProxyState 的对象实例。。ProxyState里面又包含了该RealmProxy对象。<br>结构如下：<br><img src="http://img.blog.csdn.net/20170711111806643?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="层级嵌套结构"><br>可以看出这是一种递归的存储方式。至于java为什么不溢出，因为它的model直接指向了自己的地址。<br>问题：做遍历操作会导致ANR和内存溢出<br>解决方案：</p>
<ol>
<li>类似于这种递归的方式如果需要做遍历操作的话。比如说转Json或者一些其他的操作的时候不要忘了忽略掉递归的对象，否则分分钟就内存溢出ANR了。比如Gson忽略某个字段<a href="http://blog.csdn.net/lionliu6/article/details/50787893" target="_blank" rel="external">参考</a></li>
<li>也可以直接把对象copyfromRealm，拿到真正的对象<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Realm.getDefaultInstance().copyFromRealm(object);</div></pre></td></tr></table></figure>
</li>
</ol>
<h3 id="数据库版本更新的那些坑"><a href="#数据库版本更新的那些坑" class="headerlink" title="数据库版本更新的那些坑"></a>数据库版本更新的那些坑</h3><h4 id="数据库版本更新介绍"><a href="#数据库版本更新介绍" class="headerlink" title="数据库版本更新介绍"></a>数据库版本更新介绍</h4><p>通常来讲数据库更新有三个需要关注的地方。 </p>
<ul>
<li>版本号 .schemaVersion(3)</li>
<li>新版本信息  .migration() </li>
<li>删库更新  .deleteRealmIfMigrationNeeded()<br>代码如下：<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">Realm.init(<span class="keyword">this</span>);</div><div class="line">RealmConfiguration config = <span class="keyword">new</span> RealmConfiguration.Builder()</div><div class="line">            .schemaVersion(<span class="number">3</span>)</div><div class="line">            .migration(<span class="keyword">new</span> Migration()) </div><div class="line">            .deleteRealmIfMigrationNeeded()</div><div class="line">            .build();</div><div class="line">Realm.setDefaultConfiguration(config);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>版本号就需要每次有做更新schemaVersion往上增加<br>3 . 4 . 5 …<br>deleteRealmIfMigrationNeeded() 这句话慎用。</p>
<p>官方说明：</p>
<p>设置这将改变如何处理迁移异常的行为。磁盘上的Realm将被清除并重新创建<br>加了这句话，如果出现版本号不一致，或者更新出了某些问题。<br>就会清除掉所有的数据。<br>migration实现就不做过多介绍了，可以<a href="http://blog.csdn.net/u014608640/article/details/77530917" target="_blank" rel="external">参考这个</a>。</p>
<h4 id="坑——数据库更新后不能回退"><a href="#坑——数据库更新后不能回退" class="headerlink" title="坑——数据库更新后不能回退"></a>坑——数据库更新后不能回退</h4><p>如果版本更新做了错误的表字段更新，你想要回退。<br>有两个解决方案（1） 删除掉应用重新安装。（数据会全部丢失）<br>（2）更新一个版本，把修改还原回去。（工作量大，但是数据不会丢。）</p>
<h4 id="坑——基本类型字段添加"><a href="#坑——基本类型字段添加" class="headerlink" title="坑——基本类型字段添加"></a>坑——基本类型字段添加</h4><p>addField(“xxxfield”,long.class);<br>一定要用基本类型的class,如long.class,int.class,byte.class 不能用Long.class,Byte.class<br>这个坑将导致上面的坑。解决方案就看上面看上面吧。</p>
<p>realm对于这种经常用数据库存储的应用，真的不好用！！！</p>
<h4 id="坑——Rx流操作"><a href="#坑——Rx流操作" class="headerlink" title="坑——Rx流操作"></a>坑——Rx流操作</h4><p>最近想把Realm用Rx流改写一下，然后又发现了他的坑了。</p>
<h4 id="不支持线程切换"><a href="#不支持线程切换" class="headerlink" title="不支持线程切换"></a>不支持线程切换</h4><p>在Rx流中我们经常会做线程变换操作，然后Realm并不支持其他非创建线程中访问Realm对象。</p>
<p><img src="http://img.blog.csdn.net/20171204175727236?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="线程切换"><br>也就是说，你在哪个线程创建的Realm对象只能在哪个线程中使用。mmp，好吧，谢谢你的异常提醒，但我用的不是很爽。</p>
<p>不是很爽解决方案：把Realm对象创建在子线程<br>在IO线程中创建一个Realm对象毕竟数据库操作是个耗时操作。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Realm.getInstance(<span class="keyword">new</span> RealmConfiguration.Builder().build());</div></pre></td></tr></table></figure></p>
<p>之后就只能在IO线程中做操作了。别忘了~~  2333</p>
<h4 id="Rx操作"><a href="#Rx操作" class="headerlink" title="Rx操作"></a>Rx操作</h4><p>嗯，一个Rx流的查询操作，莫名其妙给我一直发数据流，相当于无限的查询。后面才发现是因为我的另外一个操作也是有对数据库的查询操作的。 不知道Realm内部怎么实现。就导致这两个的subscribe一直重复走。</p>
<p>解决方案：没有解决方案，建议不要用Rx流。。。。啊啊啊MMP啊 我回不去了!</p>
<p>迎接坑吧！！<br>realm对于这种经常用数据库存储的应用，真的不好用！！！</p>
<p><strong><em>By Xiaolong：You have a dream,you got to protect it!</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/05/07/CodeStandars/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/07/CodeStandars/" itemprop="url">
                  代码命名规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-07T22:55:46+08:00">
                2017-05-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android规范/" itemprop="url" rel="index">
                    <span itemprop="name">Android规范</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>代码命名规范在开发过程中极其重要，记得进第一家公司的时候，刚进入就丢了一份java的代码规范文档给我。写了个小demo给当时的主管，然后因为命名规范问题被叫去谈话了,由此可见公司的开发人员都非常重视代码命名。因为很多时候一个应用的开发工作并不是你一个人完成的，你可能会有一个小伙伴与你同时开发，也可能你开发完成后会有其他的小伙伴接替你的工作。如果这个时候别人看到你乱七八糟的代码不知道从哪里下手估计心里早就把你骂了千百遍。换位思考，如果你是接班人，或者和你合作的小伙伴代码写的乱七八糟的。想要用他封装的某个功能，结果毛都没看懂。心里肯定要骂娘呀。<br>作为一个伟大的程序员候选人，我们的目标是创造好用且优雅的代码。<br>啊哈哈，那首先走出第一步。代码命名和注释。</p>
<h5 id="包名"><a href="#包名" class="headerlink" title="包名"></a>包名</h5><p>首先说下Android包名的命名规则。</p>
<p>Andorid的包名一般采用域名的反转，单词全小写。域名为www.example.com的包名为com.example,省略www。</p>
<p>包名的开始是一个顶级域名，比如com,cn,org等，包名使用.做为分隔符。第二位一般是二级域名，也可以根据不同机构各自的命名。<br>后面的命名可以用部门，项目等进行区分（也可以没有）,例如:</p>
<p>com.example.project<br>在项目内可以根据功能不同，按照模块划分不同的包名,com.example.project.user就是表示用户模块。</p>
<p>也可以根据层级的不同而划分不同的包名,比如:com.example.prokect.activity,就是Acitivity相关的包。</p>
<p>当然也可以在不同层级里面再按照模块划分包名，比如:com.example.project.activity.user，表示和用户有关的Activity。</p>
<p>总结,包名一般是以反转域名开始，后面跟有项目名称(缩写，也可以没有)。</p>
<p>后面可以采用的区分包名方式:</p>
<p>按照类功能 com.example.project.bean（实体类） com.example.project.network(存放网络层相关)</p>
<p>模块下区分层级 com.example.project.ui.user;(这边放user模块UI) com.example.project.ui.widger(一些自定义控件)</p>
<h5 id="类和接口"><a href="#类和接口" class="headerlink" title="类和接口"></a>类和接口</h5><p>类名是一个或多个单词组成，采用大驼峰命名，尽量要使类名简洁且利于描述,例如:SignInActivity，类名规则如下：</p>
<p>大驼峰命名<br>简洁而富有表达性<br>尽量不使用缩写（广泛使用的单词除外，比如URL,XML…）<br>多单词中采用 名词+动词的方式命名: LocationManage<br>对于缩写单词要全部大写比如:XMLManage<br>一个类如果继承了Android的组件，需在使用该组件的名称作为后缀，这样容易区分该类的作用，比如: SgnInActivity,UserInfoFragment,FileUploadService…</p>
<p>接口一般使用I开头，采用大驼峰命名规则，比如：IPullToRefresh。</p>
<h5 id="变量"><a href="#变量" class="headerlink" title="变量"></a>变量</h5><p>Android变量分为三种：成员变量,静态变量和常量。</p>
<h6 id="成员变量"><a href="#成员变量" class="headerlink" title="成员变量"></a>成员变量</h6><p>成员变量采用小驼峰命名规则，第一单词的首字母小写，其后的首字母大写。变量名一般不使用_和$开头。例如：</p>
<p>private Intent cropIntent;<br>变量名应简短且易于描述，选用规则尽量简单，易于记忆和联想。</p>
<p>非控件的类成员变量可以用m开头，比如 private UserInfo mUserInfo;</p>
<p>尽量避免单个字符的变量名，除非是用于一次性的临时变量,临时的整形变量一般命名为 i,j,k,m,n。字符型的变量一般使用c,d,e。</p>
<p>对于View变量的命名规则，如果View是一个单词的，采用第一个单词小写的方式+对应View的描述进行,例如：</p>
<p>private View viewUserInfo;<br>如果是两个单词组成的View，比如:TextView,一般采用缩写的方式,例如:</p>
<p>private TextView tvUserName;<br>一般情况下Button缩写为:btn。</p>
<h6 id="静态变量"><a href="#静态变量" class="headerlink" title="静态变量"></a>静态变量</h6><p>为了可以很方便的区分静态变量，静态变量的命名一般采用小写的s开头，后面单词的命名规则和成员变量保持一致，例如:</p>
<p>private static Map<string, string=""> sCacheStrings;</string,></p>
<h6 id="常量"><a href="#常量" class="headerlink" title="常量"></a>常量</h6><p>常量命名规则一般是所有的单词都是大写，中间使用_（下划线）分割，例如：</p>
<p>private static final float SCALE_RATE = 1.25f;<br>代码中不允许出现单独的字符串或数字常量，比如xx.equals(“1”),单独的字符串或数字不利于后期的维护。如果需要使用数据或字符，请按照他们的含义封装成静态常量，或者使用枚举，for语句除外。</p>
<h6 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h6><p>方法命名规则采用小驼峰命名法例如:onCreate(),onRun()，方法名一般采用动词或者动名词。<br>一般使用的方法名前缀。</p>
<p>getXX()返回某个值的方法<br>initXX() 初始化相关方法，比如初始化布局:initView()<br>checkXX()和isXX() 方法为boolean值的时候使用is或者check为前缀<br>saveXX() 保存数据<br>clearXX()和removeXX() 清除数据<br>updateXX() 更新数据<br>processXX() 对数据进行处理<br>dispalyXX() 显示某某信息<br>draswXX() 绘制数据或者效果<br>setXXX()配置某些信息</p>
<h6 id="对于方法的其他一些规范："><a href="#对于方法的其他一些规范：" class="headerlink" title="对于方法的其他一些规范："></a>对于方法的其他一些规范：</h6><p>方法的参数尽可能不超过4个，需要更多的参数的时候可以采用class的方法<br>方法参数中尽量少使用boolean,使用boolean传参不利于代码的阅读<br>方法尽量不超过15行，方法过长，说明当前方法业务逻辑过于复杂，需要进行方法拆分<br>一个方法只做一件事，<br>如果一个方法返回的是一个错误码，可以使用异常<br>不使用try catch 处理业务逻辑<br>尽可能不实用null，替代为异常或者使用空的变量，比如Collections.emptyList()</p>
<h5 id="Layout"><a href="#Layout" class="headerlink" title="Layout"></a>Layout</h5><p>Layout的命名规则需要和使用他们的组件对应，方便查找和维护，比如我们在创建一个用户信息的UserInfoActivity，对应的Layout的命名就应该是activity_user_info.xml。</p>
<p>对应Andorid组件的Layout命名规则:</p>
<p>Activity -&gt; activity_user_info.xml<br>Fragment -&gt; fragment_sign_up.xml<br>Dialog -&gt; dialog_change_password.xml<br>AdapterView Item -&gt; item_user.xml<br>Layout只是一部分 -&gt; partial_stats_bar.xml</p>
<h5 id="string和color"><a href="#string和color" class="headerlink" title="string和color"></a>string和color</h5><p>项目中使用的string,和color的值原则上都是必须放在strings.xml和colors.xml中，不要放在Java代码中，这样的好处是可复用，提高维护性，减少非必要的代码。颜色是因为基本上颜色主题差不多如果有需要改颜色，只需要该一下colors的色值就可以了。string的优势是如果以后做国际化的话string的代码就不需要再次做修改了。如果项目很大这些都没做好想要改掉所有的中文是很麻烦的。</p>
<p>xml的资源命名,字母全部小写，多个单词之间使用_(下划线)分割.</p>
<p>建议color的命名中体现其ARGB值，比如:<br>color_blue_0000ff（看一下大致的颜色后面加上色值）<br>这样的写法对于代码提示更加的友好,有利于对照标注图查找颜色值。</p>
<h5 id="id命名"><a href="#id命名" class="headerlink" title="id命名"></a>id命名</h5><p>建议使用驼峰式命名，使用名词或者名词词组，应该通过id的命名可以直接理解当前的View要实现的功能.在这里使用驼峰命名的优势是，打个下划线特别麻烦。而且你在类中要找到这个命名也很麻烦。比如 tvUserName = findViewById(R.id.tv_user_name);如果都使用驼峰命名，二者是一样的 tvUserName =findViewById(R.id.tvUserName);这样就可以使出copy paste  大招了！！！</p>
<p>例如：</p>
<p>@+id/tvUserName<br>id命名的第一个单词使用View的缩写，如果View只是一个单词，缩写就是当前单词。一般Button的缩写为：btn。</p>
<h5 id="Drawable命名"><a href="#Drawable命名" class="headerlink" title="Drawable命名"></a>Drawable命名</h5><p>Drawable的命名规则根据使用的控件来命名，控件的缩写在前面，后面使用表示其功能的一个或者多个单词，中间使用使用_下划线分割。</p>
<p>Action bar使用ab_，比如:ab<em>stacked.png<br>Button 使用btn</em><br>Dialgo 使用dialog<em><br>Divide 使用 divider</em><br>Icon 使用 ic<em><br>Menu 使用menu</em><br>Notification使用 notification<em><br>Tabs 使用tab</em><br>Drawable是有多个状态的，在命名中体现出状态的不同：</p>
<p>Normal 对应_normal结尾，比如btn_order_normal.9.png<br>Pressed 对应_pressed结尾<br>Focused 对应_focused结尾<br>Disabled 对应_disabled结尾<br>Selected 对应_selected结尾<br>其他资源文件的命名需要遵守Android的规范即可，比如arrays.xml数组文件，dimens.xml分辨的配置，style.xml样式的配置，资源文件的ID命名规则都是才是字母小写，使用下划线分割的原则。</p>
<p>暂时就想到这么多了，有漏的后面再做补充！！</p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/05/07/ApiStandars/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/07/ApiStandars/" itemprop="url">
                  接口设计规范
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-07T22:55:46+08:00">
                2017-05-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android规范/" itemprop="url" rel="index">
                    <span itemprop="name">Android规范</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="接口通用信息"><a href="#接口通用信息" class="headerlink" title="接口通用信息"></a>接口通用信息</h1><h2 id="示例地址"><a href="#示例地址" class="headerlink" title="示例地址"></a>示例地址</h2><pre><code>http://....../app/getApp
</code></pre><p>接口控制器：</p>
<pre><code>外网  http://110.110.1.20/app/

内网  http://192.168.1.22/app/
</code></pre><p>公共参数:</p>
<pre><code>getApp接口名称
</code></pre><h2 id="请求有以下两种方式"><a href="#请求有以下两种方式" class="headerlink" title="请求有以下两种方式"></a>请求有以下两种方式</h2><pre><code>GET

POST
</code></pre><h2 id="上传参数说明"><a href="#上传参数说明" class="headerlink" title="上传参数说明"></a>上传参数说明</h2><pre><code>UUID 设备号：

    每个手机的设备号是唯一的
</code></pre><h2 id="上传参数的格式"><a href="#上传参数的格式" class="headerlink" title="上传参数的格式"></a>上传参数的格式</h2><pre><code>{&quot;key&quot;:&quot;value&quot;,&quot;key1&quot;:value1,&quot;key2&quot;:&quot;value2&quot;,..........}
</code></pre><h2 id="返回的数据规范"><a href="#返回的数据规范" class="headerlink" title="返回的数据规范"></a>返回的数据规范</h2><pre><code>a、明文返回值，直接使用

b、部分字段加密的返回值通过DES.decryptDES()解密，需要key和vi进行解密，

    {
        &quot;code&quot;:1,
        &quot;msg&quot;:&quot;xxxxxx&quot;,
        &quot;data&quot;:{}
    }
</code></pre><h2 id="返回数据说明"><a href="#返回数据说明" class="headerlink" title="返回数据说明"></a>返回数据说明</h2><pre><code>a、code 标识返回状态
   1    成功
  -1    失败
-101    token失效
b、msg 服务端返回的说明
c、data为空，返回 {}
</code></pre><h2 id="返回示例"><a href="#返回示例" class="headerlink" title="返回示例"></a>返回示例</h2><pre><code>如：
{
    &quot;code&quot;:1,

    &quot;msg&quot;:&quot;&quot;,

    &quot;data&quot;:{

        &quot;param1&quot;:&quot;xxx&quot;,

        &quot;list&quot;:[

            { 
                &quot;aa&quot;:&quot;xxx&quot;,
                &quot;bb&quot;:1,
                &quot;cc&quot;:&quot;xxxxxx&quot;
            },
            ...........
        ]
    }
}

如2：

{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;&quot;,
    &quot;data&quot;:{}

}
</code></pre><h1 id="基础模块"><a href="#基础模块" class="headerlink" title="基础模块"></a>基础模块</h1><h2 id="获取访问令牌"><a href="#获取访问令牌" class="headerlink" title="获取访问令牌"></a>获取访问令牌</h2><p>请求地址</p>
<pre><code>http://192.168.1.20/app/getAccessToken
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称           类型        是否必须    示例值                   描述
uuid          String        是    321234098546345634534526   设备号
</code></pre><p>响应参数</p>
<pre><code>名称           类型        是否必须    示例值                   描述
acccessToken  String        是     访问令牌
expiresIn     String        是       28800                  过期时间, 单位为秒（可不做过期）
sessionKey    String        是     78......610              session key(32位字符)
sessionSecret String        是     2222......0              session密钥(32位字符)
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;&quot;,
    &quot;data&quot;:{
        &quot;accessToken&quot;:&quot;AVjWf49ZrHPXsqA1hwSr7AcheUIb/oaRTR
        s0GzXxzsHBm79lcNLSNGjnisHaDBAWVM
        R8tR0xMQjhIdwkve8eNTs=&quot;,            //访问令牌
        &quot;expiresIn&quot;:28800,                                 //Int, 过期时间, 单位为秒
        &quot;sessionKey&quot;:&quot;787d9f9beeeca3379cde65ff3354e610&quot;,   //session key
        &quot;sessionSecret&quot;:&quot;222baa398b38a499f267ed869215b130&quot;  //session密钥
    }

}
</code></pre><p>code取值</p>
<pre><code> 1成功

-1失败
</code></pre><h1 id="账号模块"><a href="#账号模块" class="headerlink" title="账号模块"></a>账号模块</h1><h2 id="登录（4-10增加返回字段：classNum-grade）"><a href="#登录（4-10增加返回字段：classNum-grade）" class="headerlink" title="登录（4.10增加返回字段：classNum,grade）"></a>登录（4.10增加返回字段：classNum,grade）</h2><p>请求地址</p>
<pre><code>http://..../getLogin
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称           类型        是否必须    示例值            描述

stuNo          String         是    SWE13001        学号
stuPsw         String         是    2341            密码
</code></pre><p>响应参数</p>
<pre><code>名称             类型     是否必须     示例值           描述
displayName     String    是       张三            显示名称
authenUserId    String    是       11.......fb    登录用户ID
headerUrl       String    是       http://.x.png  头像
major           String    是       软件工程        专业
stuNo           String    是       SWE13001       学号
phone           String    是       13600000001    联系电话 
calssNum        String    是       软件工程一班     班级 
grade           String    是       2013级         年级
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;登录成功&quot;,
    &quot;data&quot;:{
        &quot;displayName&quot;:&quot;张三&quot;,
        &quot;headerUrl&quot;：&quot;http://192.168.1.20/image/header.png&quot;
        &quot;authenUserId&quot;:&quot;1120d8d6ea4a4850b65d0faa40d6dffb
        &quot;major&quot;:&quot;软件工程&quot;,
        &quot;stuNo&quot;：&quot;SWE13001&quot;,
        &quot;phone&quot;:&quot;13600000001&quot;,
        &quot;calssNum&quot;：&quot;软件工程一班&quot;,
        &quot;phone&quot;:&quot;2013级&quot;
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="获取用户头像-已弃用"><a href="#获取用户头像-已弃用" class="headerlink" title="获取用户头像(已弃用)"></a><del>获取用户头像</del>(已弃用)</h2><p>请求地址</p>
<pre><code>http://..../getUserHeader
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称           类型        是否必须    示例值            描述
stuNo          String         是    SWE13001        学号
</code></pre><p>响应参数</p>
<pre><code>名称        类型      是否必须    示例值             描述
header        String         是     http://xxx.jpg      头像地址
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;获取头像成功&quot;,
    &quot;data&quot;:{
        &quot;header&quot;:&quot;http://xxx.jpg&quot;,
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="注册（已弃用）"><a href="#注册（已弃用）" class="headerlink" title="注册（已弃用）"></a><del>注册</del>（已弃用）</h2><p>请求地址</p>
<pre><code>http://..../register
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称           类型     是否必须    示例值            描述
stuNo          String      是     SWE13001        学号（学号要唯一）
stuPsw         String      是     2341            密码
data           String      是     xxxx            二进制数据
name           String      是     picture_0105    图片名称
</code></pre><p>响应参数</p>
<pre><code>名称          类型    是否必须     示例值           描述
stuName      String      是     张三             显示名称
authenUserId String      是     11.......fb     登录用户ID
headerUrl    String      是     http://.x.png   头像
major        String      是     软件工程         专业
stuNo        String      是     SWE13001        学号
phone        String      是     联系电话         13600000001
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;注册成功&quot;,
    &quot;data&quot;:{
        &quot;displayName&quot;:&quot;张三&quot;,
        &quot;headerUrl&quot;：&quot;http://192.168.1.20/image/header.png&quot;
        &quot;authenUserId&quot;:&quot;1120d8d6ea4a4850b65d0faa40d6dffb
        &quot;major&quot;:&quot;软件工程&quot;,
        &quot;stuNo&quot;：&quot;SWE13001&quot;
        &quot;phone&quot;:&quot;13600000001&quot;
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h1 id="主页"><a href="#主页" class="headerlink" title="主页"></a>主页</h1><h2 id="获取今日课程列表"><a href="#获取今日课程列表" class="headerlink" title="获取今日课程列表"></a>获取今日课程列表</h2><p>请求地址</p>
<pre><code>http://..../getTodayCourse(4.10 state 增加未签到状态)
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述
authenUserId String    是    11...ffb   用户ID
</code></pre><p> 响应参数</p>
<pre><code>名称        类型        是否必须    示例值        描述
courseId   String       是     sdfe12        课程Id
name       String       是     软件工程       课程名称
date       String       是     20170122      上课日期
state      int          是      0            签到状态 0未开放签到 1正常
                                                    2旷课      3迟到  4请假 5.未签到
teacher    String       是     顾萍萍        教师名称
classPlace String       是     主一110       上课地点
classTime  int          是     0            节次  0一二节 1三四节 2午一午二
                                                    3五六节 4七八节 5 九十节
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;&quot;,
    &quot;data&quot;:{
        &quot;total&quot;:5,
        &quot;list&quot;:[
            {
                &quot;courseId&quot;:&quot;sdfe12&quot;,
                &quot;name&quot;:&quot;软件工程&quot;,
                &quot;date&quot;:&quot;20170122&quot;,
                &quot;state&quot;:0,
                &quot;teacher&quot;:顾萍萍,
                &quot;classPlace&quot;:&quot;主一110&quot;,
                &quot;classTime&quot; : 0
            },
            ......
        ]
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>请求地址</p>
<pre><code>http://..../signIn
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述

authenUserId String    是    11...ffb   用户ID
courseId     String    是    xxxx      课程Id
date         String    是    20170328  日期
image        String    否    xxxx      二进制数据
classTime    int       是    节次       上课时间  0一二节 1三四节 2午一午二
                                                3五六节 4七八节 5九十节
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;签到成功&quot;,
    &quot;data&quot;:{
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="获取当前用户全部课程（可以查询每门课的考勤结果）"><a href="#获取当前用户全部课程（可以查询每门课的考勤结果）" class="headerlink" title="获取当前用户全部课程（可以查询每门课的考勤结果）"></a>获取当前用户全部课程（可以查询每门课的考勤结果）</h2><p>请求地址</p>
<pre><code>http://..../getAllCourseList
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述
authenUserId String    是    11...ffb   用户ID
</code></pre><p>响应参数</p>
<pre><code>名称        类型        是否必须    示例值        描述
courseId   String       是     sdfe12        课程Id
name       String       是     软件工程       课程名称 
teacher    String       是     顾萍萍          任课教师名称
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;获取课程列表成功&quot;,
    &quot;data&quot;:{
     &quot;total&quot;:5,
        &quot;list&quot;:[
               {
                &quot;courseId&quot;:&quot;sdfe12&quot;,
                &quot;name&quot;:&quot;软件工程&quot;,
                &quot;teacher&quot;:&quot;任课教师名称&quot;,
            },
            ......
        ]
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="考勤结果查询-4-10-state-增加未签到状态"><a href="#考勤结果查询-4-10-state-增加未签到状态" class="headerlink" title="考勤结果查询(4.10 state 增加未签到状态)"></a>考勤结果查询(4.10 state 增加未签到状态)</h2><p>请求地址</p>
<pre><code>http://..../checkResult
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述

authenUserId String    是    11...ffb   用户ID
startTime    String    是    20170222   起始时间
endTime      String    是    20170222   结束时间
courseId     String    否    “sd11002”  课程Id(为空代表查询全部课程)
</code></pre><p>响应参数</p>
<pre><code>名称        类型        是否必须    示例值        描述
courseId   String       是     sdfe12        课程Id
name       String       是     软件工程       课程名称
date       String       是     20170122      上课日期
state      int          是      0            签到状态 0未开放签到 1正常
                                                    2旷课      3迟到  4请假 5未签到
teacher    String       是     顾萍萍        教师名称
classPlace String       是     主一110       上课地点
classTime  int          是     0            节次  0一二节 1三四节 2午一午二
                                                    3五六节 4七八节 5 九十节
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;获取考勤结果成功&quot;,
    &quot;data&quot;:{
        &quot;total&quot;:5,
        &quot;list&quot;:[
           {
                &quot;courseId&quot;:&quot;sdfe12&quot;,
                &quot;name&quot;:&quot;软件工程&quot;,
                &quot;date&quot;:&quot;20170122&quot;,
                &quot;state&quot;:0,
                &quot;teacher&quot;:顾萍萍,
                &quot;classPlace&quot;:&quot;主一110&quot;,
                &quot;classTime&quot; : 0
            },
            ......
        ]

    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="考勤结果列表-4-10-state-增加未签到状态"><a href="#考勤结果列表-4-10-state-增加未签到状态" class="headerlink" title="考勤结果列表(4.10 state 增加未签到状态)"></a>考勤结果列表(4.10 state 增加未签到状态)</h2><p>请求地址</p>
<pre><code>http://..../checkTruant
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述

authenUserId String    是    11...ffb   用户ID
</code></pre><p>响应参数</p>
<pre><code>名称        类型        是否必须    示例值        描述

courseId   String       是     sdfe12        课程Id
name       String       是     软件工程       课程名称
date       String       是     20170122      上课日期
state      int          是      0            签到状态 0未开放签到 1正常
                                                    2旷课      3迟到  4请假 5.未签到
teacher    String       是     顾萍萍        教师名称
classPlace String       是     主一110       上课地点
classTime  int          是     0            节次  0一二节 1三四节 2午一午二
                                                    3五六节 4七八节 5 九十节
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;获取考勤结果成功&quot;,
    &quot;data&quot;:{
        &quot;total&quot;:5,
        &quot;list&quot;:[
           {
                &quot;courseId&quot;:&quot;sdfe12&quot;,
                &quot;name&quot;:&quot;软件工程&quot;,
                &quot;date&quot;:&quot;20170122&quot;,
                &quot;state&quot;:0,
                &quot;teacher&quot;:顾萍萍,
                &quot;classPlace&quot;:&quot;主一110&quot;,
                &quot;classTime&quot; : 0
            },
            ......
        ]

    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="获取本周课程列表"><a href="#获取本周课程列表" class="headerlink" title="获取本周课程列表"></a>获取本周课程列表</h2><p>请求地址</p>
<pre><code>http://..../getWeekCourse(4.10 state 增加未签到状态)
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述

authenUserId String    是    11...ffb   用户ID
</code></pre><p> 响应参数</p>
<pre><code>名称        类型        是否必须    示例值        描述

courseId   String       是     sdfe12        课程Id
name       String       是     软件工程       课程名称
date       String       是     20170122      上课日期
state      int          是      0            签到状态 0未开放签到 1正常
                                                    2旷课      3迟到  4请假 5.未签到
teacher    String       是     顾萍萍        教师名称
classPlace String       是     主一110       上课地点
classTime  int          是     0            节次  0一二节 1三四节 2午一午二
                                                    3五六节 4七八节 5 九十节
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;&quot;,
    &quot;data&quot;:{
        &quot;total&quot;:5,
        &quot;list&quot;:[
            {
                &quot;courseId&quot;:&quot;sdfe12&quot;,
                &quot;name&quot;:&quot;软件工程&quot;,
                &quot;date&quot;:&quot;20170122&quot;,
                &quot;state&quot;:0,
                &quot;teacher&quot;:顾萍萍,
                &quot;classPlace&quot;:&quot;主一110&quot;,
                &quot;classTime&quot; : 0
            },
            ......
        ]
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="请假"><a href="#请假" class="headerlink" title="请假"></a>请假</h2><p>请求地址</p>
<pre><code>http://..../takeOff
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述
authenUserId String    是      11...ffb   用户ID
courseId     String    是      ddasd131   课程ID
date         String    是      20170328   请假日期
classTime    int       是         0       节次  0一二节 1三四节 2午一午二
                                                    3五六节 4七八节 5 九十节
data         String    是      xxxx       二进制数据
name         Sring     是      xxx.png    图片名称
reason       String    是      想睡觉      请假理由
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;请假成功&quot;,
    &quot;data&quot;:{
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="图片上传-4-10弃用"><a href="#图片上传-4-10弃用" class="headerlink" title="图片上传(4.10弃用)"></a><del>图片上传</del>(4.10弃用)</h2><p>请求地址</p>
<pre><code>http://..../uploadPicture
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述
authenUserId String  是    11...ffb      用户ID
data         String  是  xxxx           二进制数据
name         String  是 picture_0105    图片名称
type         int     是       0         0头像
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;头像上传成功！&quot;,
    &quot;data&quot;:{
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="用户密码修改（4-10新增）"><a href="#用户密码修改（4-10新增）" class="headerlink" title="用户密码修改（4.10新增）"></a>用户密码修改（4.10新增）</h2><p>请求地址</p>
<pre><code>http://..../pswModify
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述
authenUserId String  是    11...ffb      用户ID
oldpsw       String  是    10086         旧密码
newpsw       String  是    10087         新密码
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;密码修改成功！&quot;,
    &quot;data&quot;:{
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><h2 id="用户信息修改（4-10新增）"><a href="#用户信息修改（4-10新增）" class="headerlink" title="用户信息修改（4.10新增）"></a>用户信息修改（4.10新增）</h2><p>请求地址</p>
<pre><code>http://..../userInfoModify
</code></pre><p>请求方式</p>
<pre><code>POST
</code></pre><p>接口参数</p>
<pre><code>名称          类型    是否必须    示例值     描述
authenUserId String  是    11...ffb      用户ID
phone        String  是    10086         手机号码
</code></pre><p>返回示例</p>
<pre><code>{
    &quot;code&quot;:1,
    &quot;msg&quot;:&quot;修改成功！&quot;,
    &quot;data&quot;:{
    }
 }
</code></pre><p>code取值</p>
<pre><code> 1成功
-1失败
</code></pre><p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/05/07/WorkSummary 2017-05-07/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/05/07/WorkSummary 2017-05-07/" itemprop="url">
                  工作总结（二）
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-05-07T13:32:20+08:00">
                2017-05-07
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/阶段性总结/" itemprop="url" rel="index">
                    <span itemprop="name">阶段性总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h4 id="闲谈："><a href="#闲谈：" class="headerlink" title="闲谈："></a>闲谈：</h4><h5 id="工作总结"><a href="#工作总结" class="headerlink" title="工作总结"></a>工作总结</h5><h6 id="又换了新工作了，讲一下离职原因吧"><a href="#又换了新工作了，讲一下离职原因吧" class="headerlink" title="又换了新工作了，讲一下离职原因吧"></a>又换了新工作了，讲一下离职原因吧</h6><ol>
<li>工作太闲（因为业务砍了很多，所以手头上的事情都很少，几个Android开发维护一个项目，基本上每天的上班时间都是是在逛论坛，写博客）</li>
<li>新的生活环境不适应（这个也算是一个大原因，以前是住岛内跟朋友合住，但是后面公司搬到岛外去了，跟着公司去岛外找了个房子，那边的房子比较潮湿，基本上每天都病怏怏的，特别难受。）</li>
<li>工资不涨（这是我的第二家公司，那时候已经在第一家基本熟悉了整个开发流程才到这家公司，那时候开的薪资特别低，说到底还是自己的原因啦，感觉每次去一家公司工资都比别人低。并不是技术比别人差，而是不会强势）</li>
</ol>
<p>上一家公司是纯互联网公司，主营业务做的是旅游行业B2B的业务，公司规模还算可以。我是在快毕业那会进这家公司的,在这家公司工作的期间算是我成长最快的一个时期，在这家公司学到了好多东西。</p>
<p>从一些主流第三方框架学习到项目架构设计封装。一些项目功能的抽取封装。项目中有很多的设计模式，单例模式，观察者模式，责任链模式，建造者模式，装饰器模式，适配器模式。基本都能在这家公司原来的框架里看到。在这边看到了很多很有意思的代码。至少在我之前是没想到还有这么写的。这里其实应该感谢之前公司的老大，工作了十几年，他的技术特别强，对于封装还有架构的设计都有自己的思路。刚进去从熟悉代码，到代码规范，基本都对我指点了一番。在我离开之际他开始着手跨平台开发了。</p>
<p>很可惜不跟随他和公司一起往下走，但心里一直存有感激。（其实对于自己有过的每一份工作即使离开了心里多少都会有感激，毕竟这是成长过程中可贵的经历）</p>
<h6 id="关于新公司工作的感受"><a href="#关于新公司工作的感受" class="headerlink" title="关于新公司工作的感受"></a>关于新公司工作的感受</h6><p>关于入职，这段时间在各大招聘平台上找了不少工作，投了很多相对而言比较大的公司的简历。也面试了几家，给我的感觉是现在的Android开发供过于求。<br>企业开始各种筛选各种挑，也确实，现在Andorid开发的门槛特别低，随便会写点java，网上找找现成的源码。就可以开发出自己想要的功能了。一些框架也比以前好很多，网上都很多 retrofit,okhttp,MVP架构的项目demo，随便拿一个来用就可以实现大多数APP了。<br>所以我其实这份工作更考虑找一个framework层开发的工作。看了这家公司的资料，很多东西都是关于硬件方面的，我以为这份工作就是底层的工作了，那时候面试的时候，我现在的经理有跟我说蓝牙相关的，我以为是针对于蓝牙的二次开发。直接说可以了，但其实用到的是蓝牙接口的一些命令来实现与硬件做交互，实际上的核心还是偏向应用层开发。<br>由于软件部门较小，所以很多流程都不完善，没有原型文档，没有接口文档，UI特别少，刚进来的时候一脸懵逼。<br>比如说销售会直接跟我们提开发相关的功能，测试也基本都是销售和产品经理兼职测试。一个项目下来要做的东西特别杂，经常因为没有确定好需求，需要修修补补。但这样也有一个好处是开发流程的时间能节省不少，毕竟少了一个产品与销售沟通和出原型的过程，当然更大的一个好处是部门还小，这些可以自己去完善，制定规则，到时候发展空间也比较大。总之干一行爱一行吧。</p>
<h5 id="谈一些工作中遇到的坑"><a href="#谈一些工作中遇到的坑" class="headerlink" title="谈一些工作中遇到的坑"></a>谈一些工作中遇到的坑</h5><p>公司有几份项目特别老，大概有三四年左右的历史了，里面的代码也不能说乱吧。就是命名规范简直不忍直视，能达得到我工作之前的水平了。我找一个功能的代码找了半天。<br>觉得命名规范这个东西还是需要每个人都去注意一下。<br>接下来打算整理一份命名规范的文档。<br>代码命名很重要！！！代码命名很重要！！！代码命名很重要！！！不要给自己和后人留坑！！</p>
<p><strong><em>By xiaolong：You have a dream,you got to protect it!</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/03/31/MPAndroidChartSource/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/31/MPAndroidChartSource/" itemprop="url">
                  MPAndroidChart源码解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-31T14:08:11+08:00">
                2017-03-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android源码解析/" itemprop="url" rel="index">
                    <span itemprop="name">Android源码解析</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一直在使用MPAndroidChart但对其内部机制却没有做多少了解，自己之前还修改过MPAndroidChart的源码，某次面试被问到，MPAndroidChart是怎样进行绘制的，瞬间一脸懵逼，回答了个大概，但是被看出其实不是很了解。算亡羊补牢吧，今天抽了点时间看了MPAndroidChart 3.0的源码部分。<br>直接进入正题吧。</p>
<h2 id="Chart基类"><a href="#Chart基类" class="headerlink" title="Chart基类"></a>Chart基类</h2><p>这边顺便讲解一下Chart这个类，它是所有图表类的抽象基类，继承自ViewGroup，实现了图表接口ChartInterface（这个接口用来实现图表的大小，边界，和范围的获取。），Chart里面存放了一些公共的配置和一些共有的抽象方法，数据等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div><div class="line">308</div><div class="line">309</div><div class="line">310</div><div class="line">311</div><div class="line">312</div><div class="line">313</div><div class="line">314</div><div class="line">315</div><div class="line">316</div><div class="line">317</div><div class="line">318</div><div class="line">319</div><div class="line">320</div><div class="line">321</div><div class="line">322</div><div class="line">323</div><div class="line">324</div><div class="line">325</div><div class="line">326</div><div class="line">327</div><div class="line">328</div><div class="line">329</div><div class="line">330</div><div class="line">331</div><div class="line">332</div><div class="line">333</div><div class="line">334</div><div class="line">335</div><div class="line">336</div><div class="line">337</div><div class="line">338</div><div class="line">339</div><div class="line">340</div><div class="line">341</div><div class="line">342</div><div class="line">343</div><div class="line">344</div><div class="line">345</div><div class="line">346</div><div class="line">347</div><div class="line">348</div><div class="line">349</div><div class="line">350</div><div class="line">351</div><div class="line">352</div><div class="line">353</div><div class="line">354</div><div class="line">355</div><div class="line">356</div><div class="line">357</div><div class="line">358</div><div class="line">359</div><div class="line">360</div><div class="line">361</div><div class="line">362</div><div class="line">363</div><div class="line">364</div><div class="line">365</div><div class="line">366</div><div class="line">367</div><div class="line">368</div><div class="line">369</div><div class="line">370</div><div class="line">371</div><div class="line">372</div><div class="line">373</div><div class="line">374</div><div class="line">375</div><div class="line">376</div><div class="line">377</div><div class="line">378</div><div class="line">379</div><div class="line">380</div><div class="line">381</div><div class="line">382</div><div class="line">383</div><div class="line">384</div><div class="line">385</div><div class="line">386</div><div class="line">387</div><div class="line">388</div><div class="line">389</div><div class="line">390</div><div class="line">391</div><div class="line">392</div><div class="line">393</div><div class="line">394</div><div class="line">395</div><div class="line">396</div><div class="line">397</div><div class="line">398</div><div class="line">399</div><div class="line">400</div><div class="line">401</div><div class="line">402</div><div class="line">403</div><div class="line">404</div><div class="line">405</div><div class="line">406</div><div class="line">407</div><div class="line">408</div><div class="line">409</div><div class="line">410</div><div class="line">411</div><div class="line">412</div><div class="line">413</div><div class="line">414</div><div class="line">415</div><div class="line">416</div><div class="line">417</div><div class="line">418</div><div class="line">419</div><div class="line">420</div><div class="line">421</div><div class="line">422</div><div class="line">423</div><div class="line">424</div><div class="line">425</div><div class="line">426</div><div class="line">427</div><div class="line">428</div><div class="line">429</div><div class="line">430</div><div class="line">431</div><div class="line">432</div><div class="line">433</div><div class="line">434</div><div class="line">435</div><div class="line">436</div><div class="line">437</div><div class="line">438</div><div class="line">439</div><div class="line">440</div><div class="line">441</div><div class="line">442</div><div class="line">443</div><div class="line">444</div><div class="line">445</div><div class="line">446</div><div class="line">447</div><div class="line">448</div><div class="line">449</div><div class="line">450</div><div class="line">451</div><div class="line">452</div><div class="line">453</div><div class="line">454</div><div class="line">455</div><div class="line">456</div><div class="line">457</div><div class="line">458</div><div class="line">459</div><div class="line">460</div><div class="line">461</div><div class="line">462</div><div class="line">463</div><div class="line">464</div><div class="line">465</div><div class="line">466</div><div class="line">467</div><div class="line">468</div><div class="line">469</div><div class="line">470</div><div class="line">471</div><div class="line">472</div><div class="line">473</div><div class="line">474</div><div class="line">475</div><div class="line">476</div><div class="line">477</div><div class="line">478</div><div class="line">479</div><div class="line">480</div><div class="line">481</div><div class="line">482</div><div class="line">483</div><div class="line">484</div><div class="line">485</div><div class="line">486</div><div class="line">487</div><div class="line">488</div><div class="line">489</div><div class="line">490</div><div class="line">491</div><div class="line">492</div><div class="line">493</div><div class="line">494</div><div class="line">495</div><div class="line">496</div><div class="line">497</div><div class="line">498</div><div class="line">499</div><div class="line">500</div><div class="line">501</div><div class="line">502</div><div class="line">503</div><div class="line">504</div><div class="line">505</div><div class="line">506</div><div class="line">507</div><div class="line">508</div><div class="line">509</div><div class="line">510</div><div class="line">511</div><div class="line">512</div><div class="line">513</div><div class="line">514</div><div class="line">515</div><div class="line">516</div><div class="line">517</div><div class="line">518</div><div class="line">519</div><div class="line">520</div><div class="line">521</div><div class="line">522</div><div class="line">523</div><div class="line">524</div><div class="line">525</div><div class="line">526</div><div class="line">527</div><div class="line">528</div><div class="line">529</div><div class="line">530</div><div class="line">531</div><div class="line">532</div><div class="line">533</div><div class="line">534</div><div class="line">535</div><div class="line">536</div><div class="line">537</div><div class="line">538</div><div class="line">539</div><div class="line">540</div><div class="line">541</div><div class="line">542</div><div class="line">543</div><div class="line">544</div><div class="line">545</div><div class="line">546</div><div class="line">547</div><div class="line">548</div><div class="line">549</div><div class="line">550</div><div class="line">551</div><div class="line">552</div><div class="line">553</div><div class="line">554</div><div class="line">555</div><div class="line">556</div><div class="line">557</div><div class="line">558</div><div class="line">559</div><div class="line">560</div><div class="line">561</div><div class="line">562</div><div class="line">563</div><div class="line">564</div><div class="line">565</div><div class="line">566</div><div class="line">567</div><div class="line">568</div><div class="line">569</div><div class="line">570</div><div class="line">571</div><div class="line">572</div><div class="line">573</div><div class="line">574</div><div class="line">575</div><div class="line">576</div><div class="line">577</div><div class="line">578</div><div class="line">579</div><div class="line">580</div><div class="line">581</div><div class="line">582</div><div class="line">583</div><div class="line">584</div><div class="line">585</div><div class="line">586</div><div class="line">587</div><div class="line">588</div><div class="line">589</div><div class="line">590</div><div class="line">591</div><div class="line">592</div><div class="line">593</div><div class="line">594</div><div class="line">595</div><div class="line">596</div><div class="line">597</div><div class="line">598</div><div class="line">599</div><div class="line">600</div><div class="line">601</div><div class="line">602</div><div class="line">603</div><div class="line">604</div><div class="line">605</div><div class="line">606</div><div class="line">607</div><div class="line">608</div><div class="line">609</div><div class="line">610</div><div class="line">611</div><div class="line">612</div><div class="line">613</div><div class="line">614</div><div class="line">615</div><div class="line">616</div><div class="line">617</div><div class="line">618</div><div class="line">619</div><div class="line">620</div><div class="line">621</div><div class="line">622</div><div class="line">623</div><div class="line">624</div><div class="line">625</div><div class="line">626</div><div class="line">627</div><div class="line">628</div><div class="line">629</div><div class="line">630</div><div class="line">631</div><div class="line">632</div><div class="line">633</div><div class="line">634</div><div class="line">635</div><div class="line">636</div><div class="line">637</div><div class="line">638</div><div class="line">639</div><div class="line">640</div><div class="line">641</div><div class="line">642</div><div class="line">643</div><div class="line">644</div><div class="line">645</div><div class="line">646</div><div class="line">647</div><div class="line">648</div><div class="line">649</div><div class="line">650</div><div class="line">651</div><div class="line">652</div><div class="line">653</div><div class="line">654</div><div class="line">655</div><div class="line">656</div><div class="line">657</div><div class="line">658</div><div class="line">659</div><div class="line">660</div><div class="line">661</div><div class="line">662</div><div class="line">663</div><div class="line">664</div><div class="line">665</div><div class="line">666</div><div class="line">667</div><div class="line">668</div><div class="line">669</div><div class="line">670</div><div class="line">671</div><div class="line">672</div><div class="line">673</div><div class="line">674</div><div class="line">675</div><div class="line">676</div><div class="line">677</div><div class="line">678</div><div class="line">679</div><div class="line">680</div><div class="line">681</div><div class="line">682</div><div class="line">683</div><div class="line">684</div><div class="line">685</div><div class="line">686</div><div class="line">687</div><div class="line">688</div><div class="line">689</div><div class="line">690</div><div class="line">691</div><div class="line">692</div><div class="line">693</div><div class="line">694</div><div class="line">695</div><div class="line">696</div><div class="line">697</div><div class="line">698</div><div class="line">699</div><div class="line">700</div><div class="line">701</div><div class="line">702</div><div class="line">703</div><div class="line">704</div><div class="line">705</div><div class="line">706</div><div class="line">707</div><div class="line">708</div><div class="line">709</div><div class="line">710</div><div class="line">711</div><div class="line">712</div><div class="line">713</div><div class="line">714</div><div class="line">715</div><div class="line">716</div><div class="line">717</div><div class="line">718</div><div class="line">719</div><div class="line">720</div><div class="line">721</div><div class="line">722</div><div class="line">723</div><div class="line">724</div><div class="line">725</div><div class="line">726</div><div class="line">727</div><div class="line">728</div><div class="line">729</div><div class="line">730</div><div class="line">731</div><div class="line">732</div><div class="line">733</div><div class="line">734</div><div class="line">735</div><div class="line">736</div><div class="line">737</div><div class="line">738</div><div class="line">739</div><div class="line">740</div><div class="line">741</div><div class="line">742</div><div class="line">743</div><div class="line">744</div><div class="line">745</div><div class="line">746</div><div class="line">747</div><div class="line">748</div><div class="line">749</div><div class="line">750</div><div class="line">751</div><div class="line">752</div><div class="line">753</div><div class="line">754</div><div class="line">755</div><div class="line">756</div><div class="line">757</div><div class="line">758</div><div class="line">759</div><div class="line">760</div><div class="line">761</div><div class="line">762</div><div class="line">763</div><div class="line">764</div><div class="line">765</div><div class="line">766</div><div class="line">767</div><div class="line">768</div><div class="line">769</div><div class="line">770</div><div class="line">771</div><div class="line">772</div><div class="line">773</div><div class="line">774</div><div class="line">775</div><div class="line">776</div><div class="line">777</div><div class="line">778</div><div class="line">779</div><div class="line">780</div><div class="line">781</div><div class="line">782</div><div class="line">783</div><div class="line">784</div><div class="line">785</div><div class="line">786</div><div class="line">787</div><div class="line">788</div><div class="line">789</div><div class="line">790</div><div class="line">791</div><div class="line">792</div><div class="line">793</div><div class="line">794</div><div class="line">795</div><div class="line">796</div><div class="line">797</div><div class="line">798</div><div class="line">799</div><div class="line">800</div><div class="line">801</div><div class="line">802</div><div class="line">803</div><div class="line">804</div><div class="line">805</div><div class="line">806</div><div class="line">807</div><div class="line">808</div><div class="line">809</div><div class="line">810</div><div class="line">811</div><div class="line">812</div><div class="line">813</div><div class="line">814</div><div class="line">815</div><div class="line">816</div><div class="line">817</div><div class="line">818</div><div class="line">819</div><div class="line">820</div><div class="line">821</div><div class="line">822</div><div class="line">823</div><div class="line">824</div><div class="line">825</div><div class="line">826</div><div class="line">827</div><div class="line">828</div><div class="line">829</div><div class="line">830</div><div class="line">831</div><div class="line">832</div><div class="line">833</div><div class="line">834</div><div class="line">835</div><div class="line">836</div><div class="line">837</div><div class="line">838</div><div class="line">839</div><div class="line">840</div><div class="line">841</div><div class="line">842</div><div class="line">843</div><div class="line">844</div><div class="line">845</div><div class="line">846</div><div class="line">847</div><div class="line">848</div><div class="line">849</div><div class="line">850</div><div class="line">851</div><div class="line">852</div><div class="line">853</div><div class="line">854</div><div class="line">855</div><div class="line">856</div><div class="line">857</div><div class="line">858</div><div class="line">859</div><div class="line">860</div><div class="line">861</div><div class="line">862</div><div class="line">863</div><div class="line">864</div><div class="line">865</div><div class="line">866</div><div class="line">867</div><div class="line">868</div><div class="line">869</div><div class="line">870</div><div class="line">871</div><div class="line">872</div><div class="line">873</div><div class="line">874</div><div class="line">875</div><div class="line">876</div><div class="line">877</div><div class="line">878</div><div class="line">879</div><div class="line">880</div><div class="line">881</div><div class="line">882</div><div class="line">883</div><div class="line">884</div><div class="line">885</div><div class="line">886</div><div class="line">887</div><div class="line">888</div><div class="line">889</div><div class="line">890</div><div class="line">891</div><div class="line">892</div><div class="line">893</div><div class="line">894</div><div class="line">895</div><div class="line">896</div><div class="line">897</div><div class="line">898</div><div class="line">899</div><div class="line">900</div><div class="line">901</div><div class="line">902</div><div class="line">903</div><div class="line">904</div><div class="line">905</div><div class="line">906</div><div class="line">907</div><div class="line">908</div><div class="line">909</div><div class="line">910</div><div class="line">911</div><div class="line">912</div><div class="line">913</div><div class="line">914</div><div class="line">915</div><div class="line">916</div><div class="line">917</div><div class="line">918</div><div class="line">919</div><div class="line">920</div><div class="line">921</div><div class="line">922</div><div class="line">923</div><div class="line">924</div><div class="line">925</div><div class="line">926</div><div class="line">927</div><div class="line">928</div><div class="line">929</div><div class="line">930</div><div class="line">931</div><div class="line">932</div><div class="line">933</div><div class="line">934</div><div class="line">935</div><div class="line">936</div><div class="line">937</div><div class="line">938</div><div class="line">939</div><div class="line">940</div><div class="line">941</div><div class="line">942</div><div class="line">943</div><div class="line">944</div><div class="line">945</div><div class="line">946</div><div class="line">947</div><div class="line">948</div><div class="line">949</div><div class="line">950</div><div class="line">951</div><div class="line">952</div><div class="line">953</div><div class="line">954</div><div class="line">955</div><div class="line">956</div><div class="line">957</div><div class="line">958</div><div class="line">959</div><div class="line">960</div><div class="line">961</div><div class="line">962</div><div class="line">963</div><div class="line">964</div><div class="line">965</div><div class="line">966</div><div class="line">967</div><div class="line">968</div><div class="line">969</div><div class="line">970</div><div class="line">971</div><div class="line">972</div><div class="line">973</div><div class="line">974</div><div class="line">975</div><div class="line">976</div><div class="line">977</div><div class="line">978</div><div class="line">979</div><div class="line">980</div><div class="line">981</div><div class="line">982</div><div class="line">983</div><div class="line">984</div><div class="line">985</div><div class="line">986</div><div class="line">987</div><div class="line">988</div><div class="line">989</div><div class="line">990</div><div class="line">991</div><div class="line">992</div><div class="line">993</div><div class="line">994</div><div class="line">995</div><div class="line">996</div><div class="line">997</div><div class="line">998</div><div class="line">999</div><div class="line">1000</div><div class="line">1001</div><div class="line">1002</div><div class="line">1003</div><div class="line">1004</div><div class="line">1005</div><div class="line">1006</div><div class="line">1007</div><div class="line">1008</div><div class="line">1009</div><div class="line">1010</div><div class="line">1011</div><div class="line">1012</div><div class="line">1013</div><div class="line">1014</div><div class="line">1015</div><div class="line">1016</div><div class="line">1017</div><div class="line">1018</div><div class="line">1019</div><div class="line">1020</div><div class="line">1021</div><div class="line">1022</div><div class="line">1023</div><div class="line">1024</div><div class="line">1025</div><div class="line">1026</div><div class="line">1027</div><div class="line">1028</div><div class="line">1029</div><div class="line">1030</div><div class="line">1031</div><div class="line">1032</div><div class="line">1033</div><div class="line">1034</div><div class="line">1035</div><div class="line">1036</div><div class="line">1037</div><div class="line">1038</div><div class="line">1039</div><div class="line">1040</div><div class="line">1041</div><div class="line">1042</div><div class="line">1043</div><div class="line">1044</div><div class="line">1045</div><div class="line">1046</div><div class="line">1047</div><div class="line">1048</div><div class="line">1049</div><div class="line">1050</div><div class="line">1051</div><div class="line">1052</div><div class="line">1053</div><div class="line">1054</div><div class="line">1055</div><div class="line">1056</div><div class="line">1057</div><div class="line">1058</div><div class="line">1059</div><div class="line">1060</div><div class="line">1061</div><div class="line">1062</div><div class="line">1063</div><div class="line">1064</div><div class="line">1065</div><div class="line">1066</div><div class="line">1067</div><div class="line">1068</div><div class="line">1069</div><div class="line">1070</div><div class="line">1071</div><div class="line">1072</div><div class="line">1073</div><div class="line">1074</div><div class="line">1075</div><div class="line">1076</div><div class="line">1077</div><div class="line">1078</div><div class="line">1079</div><div class="line">1080</div><div class="line">1081</div><div class="line">1082</div><div class="line">1083</div><div class="line">1084</div><div class="line">1085</div><div class="line">1086</div><div class="line">1087</div><div class="line">1088</div><div class="line">1089</div><div class="line">1090</div><div class="line">1091</div><div class="line">1092</div><div class="line">1093</div><div class="line">1094</div><div class="line">1095</div><div class="line">1096</div><div class="line">1097</div><div class="line">1098</div><div class="line">1099</div><div class="line">1100</div><div class="line">1101</div><div class="line">1102</div><div class="line">1103</div><div class="line">1104</div><div class="line">1105</div><div class="line">1106</div><div class="line">1107</div><div class="line">1108</div><div class="line">1109</div><div class="line">1110</div><div class="line">1111</div><div class="line">1112</div><div class="line">1113</div><div class="line">1114</div><div class="line">1115</div><div class="line">1116</div><div class="line">1117</div><div class="line">1118</div><div class="line">1119</div><div class="line">1120</div><div class="line">1121</div><div class="line">1122</div><div class="line">1123</div><div class="line">1124</div><div class="line">1125</div><div class="line">1126</div><div class="line">1127</div><div class="line">1128</div><div class="line">1129</div><div class="line">1130</div><div class="line">1131</div><div class="line">1132</div><div class="line">1133</div><div class="line">1134</div><div class="line">1135</div><div class="line">1136</div><div class="line">1137</div><div class="line">1138</div><div class="line">1139</div><div class="line">1140</div><div class="line">1141</div><div class="line">1142</div><div class="line">1143</div><div class="line">1144</div><div class="line">1145</div><div class="line">1146</div><div class="line">1147</div><div class="line">1148</div><div class="line">1149</div><div class="line">1150</div><div class="line">1151</div><div class="line">1152</div><div class="line">1153</div><div class="line">1154</div><div class="line">1155</div><div class="line">1156</div><div class="line">1157</div><div class="line">1158</div><div class="line">1159</div><div class="line">1160</div><div class="line">1161</div><div class="line">1162</div><div class="line">1163</div><div class="line">1164</div><div class="line">1165</div><div class="line">1166</div><div class="line">1167</div><div class="line">1168</div><div class="line">1169</div><div class="line">1170</div><div class="line">1171</div><div class="line">1172</div><div class="line">1173</div><div class="line">1174</div><div class="line">1175</div><div class="line">1176</div><div class="line">1177</div><div class="line">1178</div><div class="line">1179</div><div class="line">1180</div><div class="line">1181</div><div class="line">1182</div><div class="line">1183</div><div class="line">1184</div><div class="line">1185</div><div class="line">1186</div><div class="line">1187</div><div class="line">1188</div><div class="line">1189</div><div class="line">1190</div><div class="line">1191</div><div class="line">1192</div><div class="line">1193</div><div class="line">1194</div><div class="line">1195</div><div class="line">1196</div><div class="line">1197</div><div class="line">1198</div><div class="line">1199</div><div class="line">1200</div><div class="line">1201</div><div class="line">1202</div><div class="line">1203</div><div class="line">1204</div><div class="line">1205</div><div class="line">1206</div><div class="line">1207</div><div class="line">1208</div><div class="line">1209</div><div class="line">1210</div><div class="line">1211</div><div class="line">1212</div><div class="line">1213</div><div class="line">1214</div><div class="line">1215</div><div class="line">1216</div><div class="line">1217</div><div class="line">1218</div><div class="line">1219</div><div class="line">1220</div><div class="line">1221</div><div class="line">1222</div><div class="line">1223</div><div class="line">1224</div><div class="line">1225</div><div class="line">1226</div><div class="line">1227</div><div class="line">1228</div><div class="line">1229</div><div class="line">1230</div><div class="line">1231</div><div class="line">1232</div><div class="line">1233</div><div class="line">1234</div><div class="line">1235</div><div class="line">1236</div><div class="line">1237</div><div class="line">1238</div><div class="line">1239</div><div class="line">1240</div><div class="line">1241</div><div class="line">1242</div><div class="line">1243</div><div class="line">1244</div><div class="line">1245</div><div class="line">1246</div><div class="line">1247</div><div class="line">1248</div><div class="line">1249</div><div class="line">1250</div><div class="line">1251</div><div class="line">1252</div><div class="line">1253</div><div class="line">1254</div><div class="line">1255</div><div class="line">1256</div><div class="line">1257</div><div class="line">1258</div><div class="line">1259</div><div class="line">1260</div><div class="line">1261</div><div class="line">1262</div><div class="line">1263</div><div class="line">1264</div><div class="line">1265</div><div class="line">1266</div><div class="line">1267</div><div class="line">1268</div><div class="line">1269</div><div class="line">1270</div><div class="line">1271</div><div class="line">1272</div><div class="line">1273</div><div class="line">1274</div><div class="line">1275</div><div class="line">1276</div><div class="line">1277</div><div class="line">1278</div><div class="line">1279</div><div class="line">1280</div><div class="line">1281</div><div class="line">1282</div><div class="line">1283</div><div class="line">1284</div><div class="line">1285</div><div class="line">1286</div><div class="line">1287</div><div class="line">1288</div><div class="line">1289</div><div class="line">1290</div><div class="line">1291</div><div class="line">1292</div><div class="line">1293</div><div class="line">1294</div><div class="line">1295</div><div class="line">1296</div><div class="line">1297</div><div class="line">1298</div><div class="line">1299</div><div class="line">1300</div><div class="line">1301</div><div class="line">1302</div><div class="line">1303</div><div class="line">1304</div><div class="line">1305</div><div class="line">1306</div><div class="line">1307</div><div class="line">1308</div><div class="line">1309</div><div class="line">1310</div><div class="line">1311</div><div class="line">1312</div><div class="line">1313</div><div class="line">1314</div><div class="line">1315</div><div class="line">1316</div><div class="line">1317</div><div class="line">1318</div><div class="line">1319</div><div class="line">1320</div><div class="line">1321</div><div class="line">1322</div><div class="line">1323</div><div class="line">1324</div><div class="line">1325</div><div class="line">1326</div><div class="line">1327</div><div class="line">1328</div><div class="line">1329</div><div class="line">1330</div><div class="line">1331</div><div class="line">1332</div><div class="line">1333</div><div class="line">1334</div><div class="line">1335</div><div class="line">1336</div><div class="line">1337</div><div class="line">1338</div><div class="line">1339</div><div class="line">1340</div><div class="line">1341</div><div class="line">1342</div><div class="line">1343</div><div class="line">1344</div><div class="line">1345</div><div class="line">1346</div><div class="line">1347</div><div class="line">1348</div><div class="line">1349</div><div class="line">1350</div><div class="line">1351</div><div class="line">1352</div><div class="line">1353</div><div class="line">1354</div><div class="line">1355</div><div class="line">1356</div><div class="line">1357</div><div class="line">1358</div><div class="line">1359</div><div class="line">1360</div><div class="line">1361</div><div class="line">1362</div><div class="line">1363</div><div class="line">1364</div><div class="line">1365</div><div class="line">1366</div><div class="line">1367</div><div class="line">1368</div><div class="line">1369</div><div class="line">1370</div><div class="line">1371</div><div class="line">1372</div><div class="line">1373</div><div class="line">1374</div><div class="line">1375</div><div class="line">1376</div><div class="line">1377</div><div class="line">1378</div><div class="line">1379</div><div class="line">1380</div><div class="line">1381</div><div class="line">1382</div><div class="line">1383</div><div class="line">1384</div><div class="line">1385</div><div class="line">1386</div><div class="line">1387</div><div class="line">1388</div><div class="line">1389</div><div class="line">1390</div><div class="line">1391</div><div class="line">1392</div><div class="line">1393</div><div class="line">1394</div><div class="line">1395</div><div class="line">1396</div><div class="line">1397</div><div class="line">1398</div><div class="line">1399</div><div class="line">1400</div><div class="line">1401</div><div class="line">1402</div><div class="line">1403</div><div class="line">1404</div><div class="line">1405</div><div class="line">1406</div><div class="line">1407</div><div class="line">1408</div><div class="line">1409</div><div class="line">1410</div><div class="line">1411</div><div class="line">1412</div><div class="line">1413</div><div class="line">1414</div><div class="line">1415</div><div class="line">1416</div><div class="line">1417</div><div class="line">1418</div><div class="line">1419</div><div class="line">1420</div><div class="line">1421</div><div class="line">1422</div><div class="line">1423</div><div class="line">1424</div><div class="line">1425</div><div class="line">1426</div><div class="line">1427</div><div class="line">1428</div><div class="line">1429</div><div class="line">1430</div><div class="line">1431</div><div class="line">1432</div><div class="line">1433</div><div class="line">1434</div><div class="line">1435</div><div class="line">1436</div><div class="line">1437</div><div class="line">1438</div><div class="line">1439</div><div class="line">1440</div><div class="line">1441</div><div class="line">1442</div><div class="line">1443</div><div class="line">1444</div><div class="line">1445</div><div class="line">1446</div><div class="line">1447</div><div class="line">1448</div><div class="line">1449</div><div class="line">1450</div><div class="line">1451</div><div class="line">1452</div><div class="line">1453</div><div class="line">1454</div><div class="line">1455</div><div class="line">1456</div><div class="line">1457</div><div class="line">1458</div><div class="line">1459</div><div class="line">1460</div><div class="line">1461</div><div class="line">1462</div><div class="line">1463</div><div class="line">1464</div><div class="line">1465</div><div class="line">1466</div><div class="line">1467</div><div class="line">1468</div><div class="line">1469</div><div class="line">1470</div><div class="line">1471</div><div class="line">1472</div><div class="line">1473</div><div class="line">1474</div><div class="line">1475</div><div class="line">1476</div><div class="line">1477</div><div class="line">1478</div><div class="line">1479</div><div class="line">1480</div><div class="line">1481</div><div class="line">1482</div><div class="line">1483</div><div class="line">1484</div><div class="line">1485</div><div class="line">1486</div><div class="line">1487</div><div class="line">1488</div><div class="line">1489</div><div class="line">1490</div><div class="line">1491</div><div class="line">1492</div><div class="line">1493</div><div class="line">1494</div><div class="line">1495</div><div class="line">1496</div><div class="line">1497</div><div class="line">1498</div><div class="line">1499</div><div class="line">1500</div><div class="line">1501</div><div class="line">1502</div><div class="line">1503</div><div class="line">1504</div><div class="line">1505</div><div class="line">1506</div><div class="line">1507</div><div class="line">1508</div><div class="line">1509</div><div class="line">1510</div><div class="line">1511</div><div class="line">1512</div><div class="line">1513</div><div class="line">1514</div><div class="line">1515</div><div class="line">1516</div><div class="line">1517</div><div class="line">1518</div><div class="line">1519</div><div class="line">1520</div><div class="line">1521</div><div class="line">1522</div><div class="line">1523</div><div class="line">1524</div><div class="line">1525</div><div class="line">1526</div><div class="line">1527</div><div class="line">1528</div><div class="line">1529</div><div class="line">1530</div><div class="line">1531</div><div class="line">1532</div><div class="line">1533</div><div class="line">1534</div><div class="line">1535</div><div class="line">1536</div><div class="line">1537</div><div class="line">1538</div><div class="line">1539</div><div class="line">1540</div><div class="line">1541</div><div class="line">1542</div><div class="line">1543</div><div class="line">1544</div><div class="line">1545</div><div class="line">1546</div><div class="line">1547</div><div class="line">1548</div><div class="line">1549</div><div class="line">1550</div><div class="line">1551</div><div class="line">1552</div><div class="line">1553</div><div class="line">1554</div><div class="line">1555</div><div class="line">1556</div><div class="line">1557</div><div class="line">1558</div><div class="line">1559</div><div class="line">1560</div><div class="line">1561</div><div class="line">1562</div><div class="line">1563</div><div class="line">1564</div><div class="line">1565</div><div class="line">1566</div><div class="line">1567</div><div class="line">1568</div><div class="line">1569</div><div class="line">1570</div><div class="line">1571</div><div class="line">1572</div><div class="line">1573</div><div class="line">1574</div><div class="line">1575</div><div class="line">1576</div><div class="line">1577</div><div class="line">1578</div><div class="line">1579</div><div class="line">1580</div><div class="line">1581</div><div class="line">1582</div><div class="line">1583</div><div class="line">1584</div><div class="line">1585</div><div class="line">1586</div><div class="line">1587</div><div class="line">1588</div><div class="line">1589</div><div class="line">1590</div><div class="line">1591</div><div class="line">1592</div><div class="line">1593</div><div class="line">1594</div><div class="line">1595</div><div class="line">1596</div><div class="line">1597</div><div class="line">1598</div><div class="line">1599</div><div class="line">1600</div><div class="line">1601</div><div class="line">1602</div><div class="line">1603</div><div class="line">1604</div><div class="line">1605</div><div class="line">1606</div><div class="line">1607</div><div class="line">1608</div><div class="line">1609</div><div class="line">1610</div><div class="line">1611</div><div class="line">1612</div><div class="line">1613</div><div class="line">1614</div><div class="line">1615</div><div class="line">1616</div><div class="line">1617</div><div class="line">1618</div><div class="line">1619</div><div class="line">1620</div><div class="line">1621</div><div class="line">1622</div><div class="line">1623</div><div class="line">1624</div><div class="line">1625</div><div class="line">1626</div><div class="line">1627</div><div class="line">1628</div><div class="line">1629</div><div class="line">1630</div><div class="line">1631</div><div class="line">1632</div><div class="line">1633</div><div class="line">1634</div><div class="line">1635</div><div class="line">1636</div><div class="line">1637</div><div class="line">1638</div><div class="line">1639</div><div class="line">1640</div><div class="line">1641</div><div class="line">1642</div><div class="line">1643</div><div class="line">1644</div><div class="line">1645</div><div class="line">1646</div><div class="line">1647</div><div class="line">1648</div><div class="line">1649</div><div class="line">1650</div><div class="line">1651</div><div class="line">1652</div><div class="line">1653</div><div class="line">1654</div><div class="line">1655</div><div class="line">1656</div><div class="line">1657</div><div class="line">1658</div><div class="line">1659</div><div class="line">1660</div><div class="line">1661</div><div class="line">1662</div><div class="line">1663</div><div class="line">1664</div><div class="line">1665</div><div class="line">1666</div><div class="line">1667</div><div class="line">1668</div><div class="line">1669</div><div class="line">1670</div><div class="line">1671</div><div class="line">1672</div><div class="line">1673</div><div class="line">1674</div><div class="line">1675</div><div class="line">1676</div><div class="line">1677</div><div class="line">1678</div><div class="line">1679</div><div class="line">1680</div><div class="line">1681</div><div class="line">1682</div><div class="line">1683</div><div class="line">1684</div><div class="line">1685</div><div class="line">1686</div><div class="line">1687</div><div class="line">1688</div><div class="line">1689</div><div class="line">1690</div><div class="line">1691</div><div class="line">1692</div><div class="line">1693</div><div class="line">1694</div><div class="line">1695</div><div class="line">1696</div><div class="line">1697</div><div class="line">1698</div><div class="line">1699</div><div class="line">1700</div><div class="line">1701</div><div class="line">1702</div><div class="line">1703</div><div class="line">1704</div><div class="line">1705</div><div class="line">1706</div><div class="line">1707</div><div class="line">1708</div><div class="line">1709</div><div class="line">1710</div><div class="line">1711</div><div class="line">1712</div><div class="line">1713</div><div class="line">1714</div><div class="line">1715</div><div class="line">1716</div><div class="line">1717</div><div class="line">1718</div><div class="line">1719</div><div class="line">1720</div><div class="line">1721</div><div class="line">1722</div><div class="line">1723</div><div class="line">1724</div><div class="line">1725</div><div class="line">1726</div><div class="line">1727</div><div class="line">1728</div><div class="line">1729</div><div class="line">1730</div><div class="line">1731</div><div class="line">1732</div><div class="line">1733</div><div class="line">1734</div><div class="line">1735</div><div class="line">1736</div><div class="line">1737</div><div class="line">1738</div><div class="line">1739</div><div class="line">1740</div><div class="line">1741</div><div class="line">1742</div><div class="line">1743</div><div class="line">1744</div><div class="line">1745</div><div class="line">1746</div><div class="line">1747</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Baseclass of all Chart-Views.</div><div class="line"> * 这个类是图表类的基类，继承自ViewGroup，它可以让图表像View一样被使用。</div><div class="line"> * <span class="doctag">@author</span> Philipp Jahoda</div><div class="line"> */</div><div class="line"><span class="meta">@SuppressLint</span>(<span class="string">"NewApi"</span>)</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Chart</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">ChartData</span>&lt;? <span class="keyword">extends</span> <span class="title">IDataSet</span>&lt;? <span class="keyword">extends</span> <span class="title">Entry</span>&gt;&gt;&gt; <span class="keyword">extends</span></span></div><div class="line">        <span class="title">ViewGroup</span></div><div class="line">        <span class="keyword">implements</span> <span class="title">ChartInterface</span> &#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOG_TAG = <span class="string">"MPAndroidChart"</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * flag that indicates if logging is enabled or not</div><div class="line">     * 声明log是否开启（调试用）</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> mLogEnabled = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * object that holds all data that was originally set for the chart, before</div><div class="line">     * it was modified or any filtering algorithms had been applied</div><div class="line">     * 图表数据</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> T mData = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Flag that indicates if highlighting per tap (touch) is enabled</div><div class="line">     * 触摸区域高亮</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> mHighLightPerTapEnabled = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * If set to true, chart continues to scroll after touch up</div><div class="line">     * 触摸事件完成后是否继续滚动（可以试试pieChart的旋转功能）</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mDragDecelerationEnabled = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Deceleration friction coefficient in [0 ; 1] interval, higher values</div><div class="line">     * indicate that speed will decrease slowly, for example if it set to 0, it</div><div class="line">     * will stop immediately. 1 is an invalid value, and will be converted to</div><div class="line">     * 0.999f automatically.</div><div class="line">     * 这个就是滚动的减慢速度，算摩擦系数，0就直接停了，1会一直转，所以他回自动变成0.999，</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mDragDecelerationFrictionCoef = <span class="number">0.9f</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * default value-formatter, number of digits depends on provided chart-data</div><div class="line">     * 数据格式化</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ValueFormatter mDefaultFormatter;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint object used for drawing the description text in the bottom right</div><div class="line">     * corner of the chart</div><div class="line">     * 图表描述画笔</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mDescPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint object for drawing the information text when there are no values in</div><div class="line">     * the chart</div><div class="line">     * 这个画笔是用来画无数据的情况</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mInfoPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * description text that appears in the bottom right corner of the chart</div><div class="line">     * 描述描述！！</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> String mDescription = <span class="string">"Description"</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * the object representing the labels on the x-axis</div><div class="line">     * X轴的label可以看折现图的横轴label</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> XAxis mXAxis;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * if true, touch gestures are enabled on the chart</div><div class="line">     * 手势开关</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> mTouchEnabled = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * the legend object containing all data associated with the legend</div><div class="line">     * Legend是一个图例描述，里面是这个图例，位置等其他配置的信息。</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Legend mLegend;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * listener that is called when a value on the chart is selected</div><div class="line">     * 数据选中监听</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> OnChartValueSelectedListener mSelectionListener;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 图表点击监听</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ChartTouchListener mChartTouchListener;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * text that is displayed when the chart is empty</div><div class="line">     * 空数据文本</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> String mNoDataText = <span class="string">"No chart data available."</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Gesture listener for custom callbacks when making gestures on the chart.</div><div class="line">     * 手势监听</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> OnChartGestureListener mGestureListener;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * text that is displayed when the chart is empty that describes why the</div><div class="line">     * chart is empty</div><div class="line">     * 无数据描述</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> String mNoDataTextDescription;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个是图例绘制类</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> LegendRenderer mLegendRenderer;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * object responsible for rendering the data</div><div class="line">     * 数据绘制类基类实现</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> DataRenderer mRenderer;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 区域高亮辅助基类。用来计算高亮区域并返回</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ChartHighlighter mHighlighter;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * object that manages the bounds and drawing constraints of the chart</div><div class="line">     * 边界约束管理</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ViewPortHandler mViewPortHandler;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * object responsible for animations</div><div class="line">     * 动画</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ChartAnimator mAnimator;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Extra offsets to be appended to the viewport</div><div class="line">     * 边距</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mExtraTopOffset = <span class="number">0</span>.f,</div><div class="line">            mExtraRightOffset = <span class="number">0</span>.f,</div><div class="line">            mExtraBottomOffset = <span class="number">0</span>.f,</div><div class="line">            mExtraLeftOffset = <span class="number">0</span>.f;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * default constructor for initialization in code</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Chart</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * constructor for initialization in xml</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Chart</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * even more awesome constructor</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Chart</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * initialize all paints and stuff</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        setWillNotDraw(<span class="keyword">false</span>);</div><div class="line">        <span class="comment">// setLayerType(View.LAYER_TYPE_HARDWARE, null);</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &lt; <span class="number">11</span>)</div><div class="line">            mAnimator = <span class="keyword">new</span> ChartAnimator();</div><div class="line">        <span class="keyword">else</span></div><div class="line">            mAnimator = <span class="keyword">new</span> ChartAnimator(<span class="keyword">new</span> AnimatorUpdateListener() &#123;</div><div class="line"></div><div class="line">                <span class="meta">@Override</span></div><div class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onAnimationUpdate</span><span class="params">(ValueAnimator animation)</span> </span>&#123;</div><div class="line">                    <span class="comment">// ViewCompat.postInvalidateOnAnimation(Chart.this);</span></div><div class="line">                    postInvalidate();</div><div class="line">                &#125;</div><div class="line">            &#125;);</div><div class="line"></div><div class="line">        <span class="comment">// initialize the utils</span></div><div class="line">        Utils.init(getContext());</div><div class="line"></div><div class="line">        mDefaultFormatter = <span class="keyword">new</span> DefaultValueFormatter(<span class="number">1</span>);</div><div class="line"></div><div class="line">        mViewPortHandler = <span class="keyword">new</span> ViewPortHandler();</div><div class="line"></div><div class="line">        mLegend = <span class="keyword">new</span> Legend();</div><div class="line"></div><div class="line">        mLegendRenderer = <span class="keyword">new</span> LegendRenderer(mViewPortHandler, mLegend);</div><div class="line"></div><div class="line">        mXAxis = <span class="keyword">new</span> XAxis();</div><div class="line"></div><div class="line">        mDescPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        mDescPaint.setColor(Color.BLACK);</div><div class="line">        mDescPaint.setTextAlign(Align.RIGHT);</div><div class="line">        mDescPaint.setTextSize(Utils.convertDpToPixel(<span class="number">9f</span>));</div><div class="line"></div><div class="line">        mInfoPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        mInfoPaint.setColor(Color.rgb(<span class="number">247</span>, <span class="number">189</span>, <span class="number">51</span>)); <span class="comment">// orange</span></div><div class="line">        mInfoPaint.setTextAlign(Align.CENTER);</div><div class="line">        mInfoPaint.setTextSize(Utils.convertDpToPixel(<span class="number">12f</span>));</div><div class="line"></div><div class="line">        mDrawPaint = <span class="keyword">new</span> Paint(Paint.DITHER_FLAG);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mLogEnabled)</div><div class="line">            Log.i(<span class="string">""</span>, <span class="string">"Chart.init()"</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets a new data object for the chart. The data object contains all values</div><div class="line">     * and information needed for displaying.</div><div class="line">     * 设置新数据</div><div class="line">     * <span class="doctag">@param</span> data</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (data == <span class="keyword">null</span>) &#123;</div><div class="line">            Log.e(LOG_TAG,</div><div class="line">                    <span class="string">"Cannot set data for chart. Provided data object is null."</span>);</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// LET THE CHART KNOW THERE IS DATA</span></div><div class="line">        mOffsetsCalculated = <span class="keyword">false</span>;</div><div class="line">        mData = data;</div><div class="line"></div><div class="line">        <span class="comment">// calculate how many digits are needed</span></div><div class="line">        calculateFormatter(data.getYMin(), data.getYMax());</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (IDataSet set : mData.getDataSets()) &#123;</div><div class="line">            <span class="keyword">if</span> (Utils.needsDefaultFormatter(set.getValueFormatter()))</div><div class="line">                set.setValueFormatter(mDefaultFormatter);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// let the chart know there is new data</span></div><div class="line">        notifyDataSetChanged();</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mLogEnabled)</div><div class="line">            Log.i(LOG_TAG, <span class="string">"Data is set."</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Clears the chart from all data (sets it to null) and refreshes it (by</div><div class="line">     * calling invalidate()).</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</div><div class="line">        mData = <span class="keyword">null</span>;</div><div class="line">        mIndicesToHighlight = <span class="keyword">null</span>;</div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Removes all DataSets (and thereby Entries) from the chart. Does not</div><div class="line">     * remove the x-values. Also refreshes the chart by calling invalidate().</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearValues</span><span class="params">()</span> </span>&#123;</div><div class="line">        mData.clearValues();</div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns true if the chart is empty (meaning it's data object is either</div><div class="line">     * null or contains no entries).</div><div class="line">     * data是否为空</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mData == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (mData.getYValCount() &lt;= <span class="number">0</span>)</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Lets the chart know its underlying data has changed and performs all</div><div class="line">     * necessary recalculations. It is crucial that this method is called</div><div class="line">     * everytime data is changed dynamically. Not calling this method can lead</div><div class="line">     * to crashes or unexpected behaviour.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">notifyDataSetChanged</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * calculates the offsets of the chart to the border depending on the</div><div class="line">     * position of an eventual legend or depending on the length of the y-axis</div><div class="line">     * and x-axis labels and their position</div><div class="line">     * 边距</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">calculateOffsets</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * calcualtes the y-min and y-max value and the y-delta and x-delta value</div><div class="line">     * 最大最小y值计算抽象方法</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">calcMinMax</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * calculates the required number of digits for the values that might be</div><div class="line">     * drawn in the chart (if enabled), and creates the default-value-formatter</div><div class="line">     * 计算单位</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">calculateFormatter</span><span class="params">(<span class="keyword">float</span> min, <span class="keyword">float</span> max)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">float</span> reference = <span class="number">0f</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mData == <span class="keyword">null</span> || mData.getXValCount() &lt; <span class="number">2</span>) &#123;</div><div class="line"></div><div class="line">            reference = Math.max(Math.abs(min), Math.abs(max));</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            reference = Math.abs(max - min);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">int</span> digits = Utils.getDecimals(reference);</div><div class="line">        mDefaultFormatter = <span class="keyword">new</span> DefaultValueFormatter(digits);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * flag that indicates if offsets calculation has already been done or not</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mOffsetsCalculated = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint object used for drawing the bitmap</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mDrawPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 空数据的绘制在这里</div><div class="line">     * <span class="doctag">@param</span> canvas</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="comment">// super.onDraw(canvas);</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mData == <span class="keyword">null</span>) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">boolean</span> hasText = !TextUtils.isEmpty(mNoDataText);</div><div class="line">            <span class="keyword">boolean</span> hasDescription = !TextUtils.isEmpty(mNoDataTextDescription);</div><div class="line">            <span class="keyword">float</span> line1height = hasText ? Utils.calcTextHeight(mInfoPaint, mNoDataText) : <span class="number">0</span>.f;</div><div class="line">            <span class="keyword">float</span> line2height = hasDescription ? Utils.calcTextHeight(mInfoPaint, mNoDataTextDescription) : <span class="number">0</span>.f;</div><div class="line">            <span class="keyword">float</span> lineSpacing = (hasText &amp;&amp; hasDescription) ?</div><div class="line">                    (mInfoPaint.getFontSpacing() - line1height) : <span class="number">0</span>.f;</div><div class="line"></div><div class="line">            <span class="comment">// if no data, inform the user</span></div><div class="line"></div><div class="line">            <span class="keyword">float</span> y = (getHeight() -</div><div class="line">                    (line1height + lineSpacing + line2height)) / <span class="number">2</span>.f</div><div class="line">                    + line1height;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (hasText) &#123;</div><div class="line">                canvas.drawText(mNoDataText, getWidth() / <span class="number">2</span>, y, mInfoPaint);</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (hasDescription) &#123;</div><div class="line">                    y = y + line1height + lineSpacing;</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (hasDescription) &#123;</div><div class="line">                canvas.drawText(mNoDataTextDescription, getWidth() / <span class="number">2</span>, y, mInfoPaint);</div><div class="line">            &#125;</div><div class="line">            <span class="keyword">return</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!mOffsetsCalculated) &#123;</div><div class="line"></div><div class="line">            calculateOffsets();</div><div class="line">            mOffsetsCalculated = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * the custom position of the description text</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> PointF mDescriptionPosition;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * draws the description text in the bottom right corner of the chart</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawDescription</span><span class="params">(Canvas c)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (!mDescription.equals(<span class="string">""</span>)) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (mDescriptionPosition == <span class="keyword">null</span>) &#123;</div><div class="line"></div><div class="line">                c.drawText(mDescription, getWidth() - mViewPortHandler.offsetRight() - <span class="number">10</span>,</div><div class="line">                        getHeight() - mViewPortHandler.offsetBottom()</div><div class="line">                                - <span class="number">10</span>, mDescPaint);</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                c.drawText(mDescription, mDescriptionPosition.x, mDescriptionPosition.y, mDescPaint);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ################ ################ ################ ################</div><div class="line">     */</div><div class="line">    <span class="comment">/** BELOW THIS CODE FOR HIGHLIGHTING */</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * array of Highlight objects that reference the highlighted slices in the</div><div class="line">     * chart</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Highlight[] mIndicesToHighlight;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the array of currently highlighted values. This might a null or</div><div class="line">     * empty array if nothing is highlighted.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> Highlight[] getHighlighted() &#123;</div><div class="line">        <span class="keyword">return</span> mIndicesToHighlight;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns true if values can be highlighted via tap gesture, false if not.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isHighlightPerTapEnabled</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mHighLightPerTapEnabled;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set this to false to prevent values from being highlighted by tap gesture.</div><div class="line">     * Values can still be highlighted via drag or programmatically. Default: true</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> enabled</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHighlightPerTapEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</div><div class="line">        mHighLightPerTapEnabled = enabled;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns true if there are values to highlight, false if there are no</div><div class="line">     * values to highlight. Checks if the highlight array is null, has a length</div><div class="line">     * of zero or if the first object is null.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">valuesToHighlight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mIndicesToHighlight == <span class="keyword">null</span> || mIndicesToHighlight.length &lt;= <span class="number">0</span></div><div class="line">                || mIndicesToHighlight[<span class="number">0</span>] == <span class="keyword">null</span> ? <span class="keyword">false</span></div><div class="line">                : <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Highlights the values at the given indices in the given DataSets. Provide</div><div class="line">     * null or an empty array to undo all highlighting. This should be used to</div><div class="line">     * programmatically highlight values. This DOES NOT generate a callback to</div><div class="line">     * the OnChartValueSelectedListener.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> highs</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highlightValues</span><span class="params">(Highlight[] highs)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">// set the indices to highlight</span></div><div class="line">        mIndicesToHighlight = highs;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (highs == <span class="keyword">null</span> || highs.length &lt;= <span class="number">0</span> || highs[<span class="number">0</span>] == <span class="keyword">null</span>) &#123;</div><div class="line">            mChartTouchListener.setLastHighlighted(<span class="keyword">null</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mChartTouchListener.setLastHighlighted(highs[<span class="number">0</span>]);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="comment">// redraw the chart</span></div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Highlights the value at the given x-index in the given DataSet. Provide</div><div class="line">     * -1 as the x-index or dataSetIndex to undo all highlighting.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> xIndex</div><div class="line">     * <span class="doctag">@param</span> dataSetIndex</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highlightValue</span><span class="params">(<span class="keyword">int</span> xIndex, <span class="keyword">int</span> dataSetIndex)</span> </span>&#123;</div><div class="line">        highlightValue(xIndex, dataSetIndex, <span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Highlights the value at the given x-index in the given DataSet. Provide</div><div class="line">     * -1 as the x-index or dataSetIndex to undo all highlighting.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> xIndex</div><div class="line">     * <span class="doctag">@param</span> dataSetIndex</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highlightValue</span><span class="params">(<span class="keyword">int</span> xIndex, <span class="keyword">int</span> dataSetIndex, <span class="keyword">boolean</span> callListener)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (xIndex &lt; <span class="number">0</span> || dataSetIndex &lt; <span class="number">0</span> || xIndex &gt;= mData.getXValCount()</div><div class="line">                || dataSetIndex &gt;= mData.getDataSetCount()) &#123;</div><div class="line"></div><div class="line">            highlightValue(<span class="keyword">null</span>, callListener);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            highlightValue(<span class="keyword">new</span> Highlight(xIndex, dataSetIndex), callListener);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Highlights the values represented by the provided Highlight object</div><div class="line">     * This DOES NOT generate a callback to the OnChartValueSelectedListener.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> highlight contains information about which entry should be highlighted</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highlightValue</span><span class="params">(Highlight highlight)</span> </span>&#123;</div><div class="line">        highlightValue(highlight, <span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Highlights the value selected by touch gesture. Unlike</div><div class="line">     * highlightValues(...), this generates a callback to the</div><div class="line">     * OnChartValueSelectedListener.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> high         - the highlight object</div><div class="line">     * <span class="doctag">@param</span> callListener - call the listener</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highlightValue</span><span class="params">(Highlight high, <span class="keyword">boolean</span> callListener)</span> </span>&#123;</div><div class="line"></div><div class="line">        Entry e = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (high == <span class="keyword">null</span>)</div><div class="line">            mIndicesToHighlight = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (mLogEnabled)</div><div class="line">                Log.i(LOG_TAG, <span class="string">"Highlighted: "</span> + high.toString());</div><div class="line"></div><div class="line">            e = mData.getEntryForHighlight(high);</div><div class="line">            <span class="keyword">if</span> (e == <span class="keyword">null</span>) &#123;</div><div class="line">                mIndicesToHighlight = <span class="keyword">null</span>;</div><div class="line">                high = <span class="keyword">null</span>;</div><div class="line">            &#125; <span class="keyword">else</span> &#123;</div><div class="line">                <span class="keyword">if</span> (<span class="keyword">this</span> <span class="keyword">instanceof</span> BarLineChartBase</div><div class="line">                        &amp;&amp; ((BarLineChartBase)<span class="keyword">this</span>).isHighlightFullBarEnabled())</div><div class="line">                    high = <span class="keyword">new</span> Highlight(high.getXIndex(), Float.NaN, -<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>);</div><div class="line"></div><div class="line">                <span class="comment">// set the indices to highlight</span></div><div class="line">                mIndicesToHighlight = <span class="keyword">new</span> Highlight[]&#123;</div><div class="line">                        high</div><div class="line">                &#125;;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (callListener &amp;&amp; mSelectionListener != <span class="keyword">null</span>) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (!valuesToHighlight())</div><div class="line">                mSelectionListener.onNothingSelected();</div><div class="line">            <span class="keyword">else</span> &#123;</div><div class="line">                <span class="comment">// notify the listener</span></div><div class="line">                mSelectionListener.onValueSelected(e, high.getDataSetIndex(), high);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// redraw the chart</span></div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Deprecated. Calls highlightValue(high, true)</div><div class="line">     */</div><div class="line">    <span class="meta">@Deprecated</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">highlightTouch</span><span class="params">(Highlight high)</span> </span>&#123;</div><div class="line">        highlightValue(high, <span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set a new (e.g. custom) ChartTouchListener <span class="doctag">NOTE:</span> make sure to</div><div class="line">     * setTouchEnabled(true); if you need touch gestures on the chart</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> l</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnTouchListener</span><span class="params">(ChartTouchListener l)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mChartTouchListener = l;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ################ ################ ################ ################</div><div class="line">     */</div><div class="line">    <span class="comment">/** BELOW CODE IS FOR THE MARKER VIEW */</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * if set to true, the marker view is drawn when a value is clicked</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> mDrawMarkerViews = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * the view that represents the marker</div><div class="line">     * 覆盖物</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> MarkerView mMarkerView;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * draws all MarkerViews on the highlighted positions</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawMarkers</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">// if there is no marker view or drawing marker is disabled</span></div><div class="line">        <span class="keyword">if</span> (mMarkerView == <span class="keyword">null</span> || !mDrawMarkerViews || !valuesToHighlight())</div><div class="line">            <span class="keyword">return</span>;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mIndicesToHighlight.length; i++) &#123;</div><div class="line"></div><div class="line">            Highlight highlight = mIndicesToHighlight[i];</div><div class="line">            <span class="keyword">int</span> xIndex = highlight.getXIndex();</div><div class="line">            <span class="keyword">int</span> dataSetIndex = highlight.getDataSetIndex();</div><div class="line"></div><div class="line">            <span class="keyword">float</span> deltaX = mXAxis != <span class="keyword">null</span> </div><div class="line">                ? mXAxis.mAxisRange</div><div class="line">                : ((mData == <span class="keyword">null</span> ? <span class="number">0</span>.f : mData.getXValCount()) - <span class="number">1</span>.f);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (xIndex &lt;= deltaX &amp;&amp; xIndex &lt;= deltaX * mAnimator.getPhaseX()) &#123;</div><div class="line"></div><div class="line">                Entry e = mData.getEntryForHighlight(mIndicesToHighlight[i]);</div><div class="line"></div><div class="line">                <span class="comment">// make sure entry not null</span></div><div class="line">                <span class="keyword">if</span> (e == <span class="keyword">null</span> || e.getXIndex() != mIndicesToHighlight[i].getXIndex())</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line"></div><div class="line">                <span class="keyword">float</span>[] pos = getMarkerPosition(e, highlight);</div><div class="line"></div><div class="line">                <span class="comment">// check bounds</span></div><div class="line">                <span class="keyword">if</span> (!mViewPortHandler.isInBounds(pos[<span class="number">0</span>], pos[<span class="number">1</span>]))</div><div class="line">                    <span class="keyword">continue</span>;</div><div class="line"></div><div class="line">                <span class="comment">// callbacks to update the content</span></div><div class="line">                mMarkerView.refreshContent(e, highlight);</div><div class="line"></div><div class="line">                <span class="comment">// mMarkerView.measure(MeasureSpec.makeMeasureSpec(0,</span></div><div class="line">                <span class="comment">// MeasureSpec.UNSPECIFIED),</span></div><div class="line">                <span class="comment">// MeasureSpec.makeMeasureSpec(0, MeasureSpec.UNSPECIFIED));</span></div><div class="line">                <span class="comment">// mMarkerView.layout(0, 0, mMarkerView.getMeasuredWidth(),</span></div><div class="line">                <span class="comment">// mMarkerView.getMeasuredHeight());</span></div><div class="line">                <span class="comment">// mMarkerView.draw(mDrawCanvas, pos[0], pos[1]);</span></div><div class="line"></div><div class="line">                mMarkerView.measure(MeasureSpec.makeMeasureSpec(<span class="number">0</span>, MeasureSpec.UNSPECIFIED),</div><div class="line">                        MeasureSpec.makeMeasureSpec(<span class="number">0</span>, MeasureSpec.UNSPECIFIED));</div><div class="line">                mMarkerView.layout(<span class="number">0</span>, <span class="number">0</span>, mMarkerView.getMeasuredWidth(),</div><div class="line">                        mMarkerView.getMeasuredHeight());</div><div class="line"></div><div class="line">                <span class="keyword">if</span> (pos[<span class="number">1</span>] - mMarkerView.getHeight() &lt;= <span class="number">0</span>) &#123;</div><div class="line">                    <span class="keyword">float</span> y = mMarkerView.getHeight() - pos[<span class="number">1</span>];</div><div class="line">                    mMarkerView.draw(canvas, pos[<span class="number">0</span>], pos[<span class="number">1</span>] + y);</div><div class="line">                &#125; <span class="keyword">else</span> &#123;</div><div class="line">                    mMarkerView.draw(canvas, pos[<span class="number">0</span>], pos[<span class="number">1</span>]);</div><div class="line">                &#125;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the actual position in pixels of the MarkerView for the given</div><div class="line">     * Entry in the given DataSet.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> e</div><div class="line">     * <span class="doctag">@param</span> highlight</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">float</span>[] getMarkerPosition(Entry e, Highlight highlight);</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ################ ################ ################ ################</div><div class="line">     * ANIMATIONS ONLY WORK FOR API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     */</div><div class="line">    <span class="comment">/** CODE BELOW THIS RELATED TO ANIMATION */</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the animator responsible for animating chart values.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> ChartAnimator <span class="title">getAnimator</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mAnimator;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * If set to true, chart continues to scroll after touch up default: true</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDragDecelerationEnabled</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mDragDecelerationEnabled;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * If set to true, chart continues to scroll after touch up. Default: true.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> enabled</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDragDecelerationEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</div><div class="line">        mDragDecelerationEnabled = enabled;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns drag deceleration friction coefficient</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getDragDecelerationFrictionCoef</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mDragDecelerationFrictionCoef;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Deceleration friction coefficient in [0 ; 1] interval, higher values</div><div class="line">     * indicate that speed will decrease slowly, for example if it set to 0, it</div><div class="line">     * will stop immediately. 1 is an invalid value, and will be converted to</div><div class="line">     * 0.999f automatically.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> newValue</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDragDecelerationFrictionCoef</span><span class="params">(<span class="keyword">float</span> newValue)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (newValue &lt; <span class="number">0</span>.f)</div><div class="line">            newValue = <span class="number">0</span>.f;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (newValue &gt;= <span class="number">1f</span>)</div><div class="line">            newValue = <span class="number">0.999f</span>;</div><div class="line"></div><div class="line">        mDragDecelerationFrictionCoef = newValue;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ################ ################ ################ ################</div><div class="line">     * ANIMATIONS ONLY WORK FOR API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     */</div><div class="line">    <span class="comment">/** CODE BELOW FOR PROVIDING EASING FUNCTIONS */</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Animates the drawing / rendering of the chart on both x- and y-axis with</div><div class="line">     * the specified animation time. If animate(...) is called, no further</div><div class="line">     * calling of invalidate() is necessary to refresh the chart. ANIMATIONS</div><div class="line">     * ONLY WORK FOR API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> durationMillisX</div><div class="line">     * <span class="doctag">@param</span> durationMillisY</div><div class="line">     * <span class="doctag">@param</span> easingX         a custom easing function to be used on the animation phase</div><div class="line">     * <span class="doctag">@param</span> easingY         a custom easing function to be used on the animation phase</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateXY</span><span class="params">(<span class="keyword">int</span> durationMillisX, <span class="keyword">int</span> durationMillisY, EasingFunction easingX,</span></span></div><div class="line">                          EasingFunction easingY) &#123;</div><div class="line">        mAnimator.animateXY(durationMillisX, durationMillisY, easingX, easingY);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Animates the rendering of the chart on the x-axis with the specified</div><div class="line">     * animation time. If animate(...) is called, no further calling of</div><div class="line">     * invalidate() is necessary to refresh the chart. ANIMATIONS ONLY WORK FOR</div><div class="line">     * API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> durationMillis</div><div class="line">     * <span class="doctag">@param</span> easing         a custom easing function to be used on the animation phase</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateX</span><span class="params">(<span class="keyword">int</span> durationMillis, EasingFunction easing)</span> </span>&#123;</div><div class="line">        mAnimator.animateX(durationMillis, easing);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Animates the rendering of the chart on the y-axis with the specified</div><div class="line">     * animation time. If animate(...) is called, no further calling of</div><div class="line">     * invalidate() is necessary to refresh the chart. ANIMATIONS ONLY WORK FOR</div><div class="line">     * API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> durationMillis</div><div class="line">     * <span class="doctag">@param</span> easing         a custom easing function to be used on the animation phase</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateY</span><span class="params">(<span class="keyword">int</span> durationMillis, EasingFunction easing)</span> </span>&#123;</div><div class="line">        mAnimator.animateY(durationMillis, easing);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ################ ################ ################ ################</div><div class="line">     * ANIMATIONS ONLY WORK FOR API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     */</div><div class="line">    <span class="comment">/** CODE BELOW FOR PREDEFINED EASING OPTIONS */</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Animates the drawing / rendering of the chart on both x- and y-axis with</div><div class="line">     * the specified animation time. If animate(...) is called, no further</div><div class="line">     * calling of invalidate() is necessary to refresh the chart. ANIMATIONS</div><div class="line">     * ONLY WORK FOR API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> durationMillisX</div><div class="line">     * <span class="doctag">@param</span> durationMillisY</div><div class="line">     * <span class="doctag">@param</span> easingX         a predefined easing option</div><div class="line">     * <span class="doctag">@param</span> easingY         a predefined easing option</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateXY</span><span class="params">(<span class="keyword">int</span> durationMillisX, <span class="keyword">int</span> durationMillisY, Easing.EasingOption easingX,</span></span></div><div class="line">                          Easing.EasingOption easingY) &#123;</div><div class="line">        mAnimator.animateXY(durationMillisX, durationMillisY, easingX, easingY);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Animates the rendering of the chart on the x-axis with the specified</div><div class="line">     * animation time. If animate(...) is called, no further calling of</div><div class="line">     * invalidate() is necessary to refresh the chart. ANIMATIONS ONLY WORK FOR</div><div class="line">     * API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> durationMillis</div><div class="line">     * <span class="doctag">@param</span> easing         a predefined easing option</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateX</span><span class="params">(<span class="keyword">int</span> durationMillis, Easing.EasingOption easing)</span> </span>&#123;</div><div class="line">        mAnimator.animateX(durationMillis, easing);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Animates the rendering of the chart on the y-axis with the specified</div><div class="line">     * animation time. If animate(...) is called, no further calling of</div><div class="line">     * invalidate() is necessary to refresh the chart. ANIMATIONS ONLY WORK FOR</div><div class="line">     * API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> durationMillis</div><div class="line">     * <span class="doctag">@param</span> easing         a predefined easing option</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateY</span><span class="params">(<span class="keyword">int</span> durationMillis, Easing.EasingOption easing)</span> </span>&#123;</div><div class="line">        mAnimator.animateY(durationMillis, easing);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ################ ################ ################ ################</div><div class="line">     * ANIMATIONS ONLY WORK FOR API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     */</div><div class="line">    <span class="comment">/** CODE BELOW FOR ANIMATIONS WITHOUT EASING */</span></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Animates the rendering of the chart on the x-axis with the specified</div><div class="line">     * animation time. If animate(...) is called, no further calling of</div><div class="line">     * invalidate() is necessary to refresh the chart. ANIMATIONS ONLY WORK FOR</div><div class="line">     * API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> durationMillis</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateX</span><span class="params">(<span class="keyword">int</span> durationMillis)</span> </span>&#123;</div><div class="line">        mAnimator.animateX(durationMillis);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Animates the rendering of the chart on the y-axis with the specified</div><div class="line">     * animation time. If animate(...) is called, no further calling of</div><div class="line">     * invalidate() is necessary to refresh the chart. ANIMATIONS ONLY WORK FOR</div><div class="line">     * API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> durationMillis</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateY</span><span class="params">(<span class="keyword">int</span> durationMillis)</span> </span>&#123;</div><div class="line">        mAnimator.animateY(durationMillis);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Animates the drawing / rendering of the chart on both x- and y-axis with</div><div class="line">     * the specified animation time. If animate(...) is called, no further</div><div class="line">     * calling of invalidate() is necessary to refresh the chart. ANIMATIONS</div><div class="line">     * ONLY WORK FOR API LEVEL 11 (Android 3.0.x) AND HIGHER.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> durationMillisX</div><div class="line">     * <span class="doctag">@param</span> durationMillisY</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateXY</span><span class="params">(<span class="keyword">int</span> durationMillisX, <span class="keyword">int</span> durationMillisY)</span> </span>&#123;</div><div class="line">        mAnimator.animateXY(durationMillisX, durationMillisY);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * ################ ################ ################ ################</div><div class="line">     */</div><div class="line">    <span class="comment">/** BELOW THIS ONLY GETTERS AND SETTERS */</span></div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the object representing all x-labels, this method can be used to</div><div class="line">     * acquire the XAxis object and modify it (e.g. change the position of the</div><div class="line">     * labels, styling, etc.)</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> XAxis <span class="title">getXAxis</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mXAxis;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the default ValueFormatter that has been determined by the chart</div><div class="line">     * considering the provided minimum and maximum values.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> ValueFormatter <span class="title">getDefaultValueFormatter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mDefaultFormatter;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * set a selection listener for the chart</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> l</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnChartValueSelectedListener</span><span class="params">(OnChartValueSelectedListener l)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mSelectionListener = l;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets a gesture-listener for the chart for custom callbacks when executing</div><div class="line">     * gestures on the chart surface.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> l</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setOnChartGestureListener</span><span class="params">(OnChartGestureListener l)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mGestureListener = l;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the custom gesture listener.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> OnChartGestureListener <span class="title">getOnChartGestureListener</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mGestureListener;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * returns the current y-max value across all DataSets</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getYMax</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mData.getYMax();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * returns the current y-min value across all DataSets</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getYMin</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mData.getYMin();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getXChartMax</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mXAxis.mAxisMaximum;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getXChartMin</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mXAxis.mAxisMinimum;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getXValCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mData.getXValCount();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the total number of (y) values the chart holds (across all DataSets).</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getValueCount</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mData.getYValCount();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the center point of the chart (the whole View) in pixels.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> PointF <span class="title">getCenter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> PointF(getWidth() / <span class="number">2f</span>, getHeight() / <span class="number">2f</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the center of the chart taking offsets under consideration.</div><div class="line">     * (returns the center of the content rectangle)</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> PointF <span class="title">getCenterOffsets</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mViewPortHandler.getContentCenter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * set a description text that appears in the bottom right corner of the</div><div class="line">     * chart, size = Y-legend text size</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> desc</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescription</span><span class="params">(String desc)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (desc == <span class="keyword">null</span>)</div><div class="line">            desc = <span class="string">""</span>;</div><div class="line">        <span class="keyword">this</span>.mDescription = desc;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets a custom position for the description text in pixels on the screen.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> x - xcoordinate</div><div class="line">     * <span class="doctag">@param</span> y - ycoordinate</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescriptionPosition</span><span class="params">(<span class="keyword">float</span> x, <span class="keyword">float</span> y)</span> </span>&#123;</div><div class="line">        mDescriptionPosition = <span class="keyword">new</span> PointF(x, y);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * sets the typeface for the description paint</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> t</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescriptionTypeface</span><span class="params">(Typeface t)</span> </span>&#123;</div><div class="line">        mDescPaint.setTypeface(t);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * sets the size of the description text in pixels, min 6f, max 16f</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> size</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescriptionTextSize</span><span class="params">(<span class="keyword">float</span> size)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (size &gt; <span class="number">16f</span>)</div><div class="line">            size = <span class="number">16f</span>;</div><div class="line">        <span class="keyword">if</span> (size &lt; <span class="number">6f</span>)</div><div class="line">            size = <span class="number">6f</span>;</div><div class="line"></div><div class="line">        mDescPaint.setTextSize(Utils.convertDpToPixel(size));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets the color of the description text.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> color</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDescriptionColor</span><span class="params">(<span class="keyword">int</span> color)</span> </span>&#123;</div><div class="line">        mDescPaint.setColor(color);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets extra offsets (around the chart view) to be appended to the</div><div class="line">     * auto-calculated offsets.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> left</div><div class="line">     * <span class="doctag">@param</span> top</div><div class="line">     * <span class="doctag">@param</span> right</div><div class="line">     * <span class="doctag">@param</span> bottom</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExtraOffsets</span><span class="params">(<span class="keyword">float</span> left, <span class="keyword">float</span> top, <span class="keyword">float</span> right, <span class="keyword">float</span> bottom)</span> </span>&#123;</div><div class="line">        setExtraLeftOffset(left);</div><div class="line">        setExtraTopOffset(top);</div><div class="line">        setExtraRightOffset(right);</div><div class="line">        setExtraBottomOffset(bottom);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set an extra offset to be appended to the viewport's top</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExtraTopOffset</span><span class="params">(<span class="keyword">float</span> offset)</span> </span>&#123;</div><div class="line">        mExtraTopOffset = Utils.convertDpToPixel(offset);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@return</span> the extra offset to be appended to the viewport's top</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getExtraTopOffset</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mExtraTopOffset;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set an extra offset to be appended to the viewport's right</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExtraRightOffset</span><span class="params">(<span class="keyword">float</span> offset)</span> </span>&#123;</div><div class="line">        mExtraRightOffset = Utils.convertDpToPixel(offset);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@return</span> the extra offset to be appended to the viewport's right</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getExtraRightOffset</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mExtraRightOffset;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set an extra offset to be appended to the viewport's bottom</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExtraBottomOffset</span><span class="params">(<span class="keyword">float</span> offset)</span> </span>&#123;</div><div class="line">        mExtraBottomOffset = Utils.convertDpToPixel(offset);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@return</span> the extra offset to be appended to the viewport's bottom</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getExtraBottomOffset</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mExtraBottomOffset;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set an extra offset to be appended to the viewport's left</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setExtraLeftOffset</span><span class="params">(<span class="keyword">float</span> offset)</span> </span>&#123;</div><div class="line">        mExtraLeftOffset = Utils.convertDpToPixel(offset);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * <span class="doctag">@return</span> the extra offset to be appended to the viewport's left</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">float</span> <span class="title">getExtraLeftOffset</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mExtraLeftOffset;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set this to true to enable logcat outputs for the chart. Beware that</div><div class="line">     * logcat output decreases rendering performance. Default: disabled.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> enabled</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setLogEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</div><div class="line">        mLogEnabled = enabled;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns true if log-output is enabled for the chart, fals if not.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLogEnabled</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mLogEnabled;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets the text that informs the user that there is no data available with</div><div class="line">     * which to draw the chart.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> text</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNoDataText</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">        mNoDataText = text;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets descriptive text to explain to the user why there is no chart</div><div class="line">     * available Defaults to empty if not set</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> text</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNoDataTextDescription</span><span class="params">(String text)</span> </span>&#123;</div><div class="line">        mNoDataTextDescription = text;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set this to false to disable all gestures and touches on the chart,</div><div class="line">     * default: true</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> enabled</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTouchEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mTouchEnabled = enabled;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * sets the view that is displayed when a value is clicked on the chart</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> v</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMarkerView</span><span class="params">(MarkerView v)</span> </span>&#123;</div><div class="line">        mMarkerView = v;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * returns the view that is set as a marker view for the chart</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> MarkerView <span class="title">getMarkerView</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mMarkerView;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the Legend object of the chart. This method can be used to get an</div><div class="line">     * instance of the legend in order to customize the automatically generated</div><div class="line">     * Legend.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Legend <span class="title">getLegend</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mLegend;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the renderer object responsible for rendering / drawing the</div><div class="line">     * Legend.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> LegendRenderer <span class="title">getLegendRenderer</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mLegendRenderer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the rectangle that defines the borders of the chart-value surface</div><div class="line">     * (into which the actual values are drawn).</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> RectF <span class="title">getContentRect</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mViewPortHandler.getContentRect();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * disables intercept touchevents</div><div class="line">     * 防止事件被拦截，这个在ScrollView嵌套中有手势操作的haunted，需要用到</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">disableScroll</span><span class="params">()</span> </span>&#123;</div><div class="line">        ViewParent parent = getParent();</div><div class="line">        <span class="keyword">if</span> (parent != <span class="keyword">null</span>)</div><div class="line">            parent.requestDisallowInterceptTouchEvent(<span class="keyword">true</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * enables intercept touchevents</div><div class="line">     * 关闭后事件会被ScrollView拦截，一些手势操作会受到影响</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">enableScroll</span><span class="params">()</span> </span>&#123;</div><div class="line">        ViewParent parent = getParent();</div><div class="line">        <span class="keyword">if</span> (parent != <span class="keyword">null</span>)</div><div class="line">            parent.requestDisallowInterceptTouchEvent(<span class="keyword">false</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint for the grid background (only line and barchart)</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAINT_GRID_BACKGROUND = <span class="number">4</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint for the info text that is displayed when there are no values in the</div><div class="line">     * chart</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAINT_INFO = <span class="number">7</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint for the description text in the bottom right corner</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAINT_DESCRIPTION = <span class="number">11</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint for the hole in the middle of the pie chart</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAINT_HOLE = <span class="number">13</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint for the text in the middle of the pie chart</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAINT_CENTER_TEXT = <span class="number">14</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint used for the legend</div><div class="line">     */</div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> PAINT_LEGEND_LABEL = <span class="number">18</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * set a new paint object for the specified parameter in the chart e.g.</div><div class="line">     * Chart.PAINT_VALUES</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> p     the new paint object</div><div class="line">     * <span class="doctag">@param</span> which Chart.PAINT_VALUES, Chart.PAINT_GRID, Chart.PAINT_VALUES,</div><div class="line">     *              ...</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPaint</span><span class="params">(Paint p, <span class="keyword">int</span> which)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">switch</span> (which) &#123;</div><div class="line">            <span class="keyword">case</span> PAINT_INFO:</div><div class="line">                mInfoPaint = p;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> PAINT_DESCRIPTION:</div><div class="line">                mDescPaint = p;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the paint object associated with the provided constant.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> which e.g. Chart.PAINT_LEGEND_LABEL</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Paint <span class="title">getPaint</span><span class="params">(<span class="keyword">int</span> which)</span> </span>&#123;</div><div class="line">        <span class="keyword">switch</span> (which) &#123;</div><div class="line">            <span class="keyword">case</span> PAINT_INFO:</div><div class="line">                <span class="keyword">return</span> mInfoPaint;</div><div class="line">            <span class="keyword">case</span> PAINT_DESCRIPTION:</div><div class="line">                <span class="keyword">return</span> mDescPaint;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * returns true if drawing the marker-view is enabled when tapping on values</div><div class="line">     * (use the setMarkerView(View v) method to specify a marker view)</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isDrawMarkerViewEnabled</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mDrawMarkerViews;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set this to true to draw a user specified marker-view when tapping on</div><div class="line">     * chart values (use the setMarkerView(MarkerView mv) method to specify a</div><div class="line">     * marker view). Default: true</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> enabled</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setDrawMarkerViews</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</div><div class="line">        mDrawMarkerViews = enabled;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * returns the x-value at the given index</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> index</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getXValue</span><span class="params">(<span class="keyword">int</span> index)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mData == <span class="keyword">null</span> || mData.getXValCount() &lt;= index)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span> mData.getXVals().get(index);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Get all Entry objects at the given index across all DataSets.</div><div class="line">     * INFORMATION: This method does calculations at runtime. Do not over-use in</div><div class="line">     * performance critical situations.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> xIndex</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> List&lt;Entry&gt; <span class="title">getEntriesAtIndex</span><span class="params">(<span class="keyword">int</span> xIndex)</span> </span>&#123;</div><div class="line"></div><div class="line">        List&lt;Entry&gt; vals = <span class="keyword">new</span> ArrayList&lt;Entry&gt;();</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mData.getDataSetCount(); i++) &#123;</div><div class="line"></div><div class="line">            IDataSet set = mData.getDataSetByIndex(i);</div><div class="line"></div><div class="line">            Entry e = set.getEntryForXIndex(xIndex);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123;</div><div class="line">                vals.add(e);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> vals;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the ChartData object that has been set for the chart.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">getData</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mData;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the ViewPortHandler of the chart that is responsible for the</div><div class="line">     * content area of the chart and its offsets and dimensions.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> ViewPortHandler <span class="title">getViewPortHandler</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mViewPortHandler;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the Renderer object the chart uses for drawing data.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> DataRenderer <span class="title">getRenderer</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mRenderer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets a new DataRenderer object for the chart.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> renderer</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setRenderer</span><span class="params">(DataRenderer renderer)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (renderer != <span class="keyword">null</span>)</div><div class="line">            mRenderer = renderer;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> ChartHighlighter <span class="title">getHighlighter</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mHighlighter;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Sets a custom highligher object for the chart that handles / processes</div><div class="line">     * all highlight touch events performed on the chart-view.</div><div class="line">     * 设置一个高亮工具（不同图表的高亮实现不一样，这里放了基类）</div><div class="line">     * <span class="doctag">@param</span> highlighter</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHighlighter</span><span class="params">(ChartHighlighter highlighter)</span> </span>&#123;</div><div class="line"></div><div class="line">        mHighlighter = highlighter;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> PointF <span class="title">getCenterOfView</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> getCenter();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the bitmap that represents the chart.</div><div class="line">     * 保存图片，获取图表图片（这个方法是将当前整个Canvas创建一张图片）</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Bitmap <span class="title">getChartBitmap</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="comment">// Define a bitmap with the same size as the view</span></div><div class="line">        Bitmap returnedBitmap = Bitmap.createBitmap(getWidth(), getHeight(), Bitmap.Config.RGB_565);</div><div class="line">        <span class="comment">// Bind a canvas to it</span></div><div class="line">        Canvas canvas = <span class="keyword">new</span> Canvas(returnedBitmap);</div><div class="line">        <span class="comment">// Get the view's background</span></div><div class="line">        Drawable bgDrawable = getBackground();</div><div class="line">        <span class="keyword">if</span> (bgDrawable != <span class="keyword">null</span>)</div><div class="line">            <span class="comment">// has background drawable, then draw it on the canvas</span></div><div class="line">            bgDrawable.draw(canvas);</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="comment">// does not have background drawable, then draw white background on</span></div><div class="line">            <span class="comment">// the canvas</span></div><div class="line">            canvas.drawColor(Color.WHITE);</div><div class="line">        <span class="comment">// draw the view on the canvas</span></div><div class="line">        draw(canvas);</div><div class="line">        <span class="comment">// return the bitmap</span></div><div class="line">        <span class="keyword">return</span> returnedBitmap;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Saves the current chart state with the given name to the given path on</div><div class="line">     * the sdcard leaving the path empty "" will put the saved file directly on</div><div class="line">     * the SD card chart is saved as a PNG image, example:</div><div class="line">     * saveToPath("myfilename", "foldername1/foldername2");</div><div class="line">     * 保存图片</div><div class="line">     * <span class="doctag">@param</span> title</div><div class="line">     * <span class="doctag">@param</span> pathOnSD e.g. "folder1/folder2/folder3"</div><div class="line">     * <span class="doctag">@return</span> returns true on success, false on error</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveToPath</span><span class="params">(String title, String pathOnSD)</span> </span>&#123;</div><div class="line"></div><div class="line">        Bitmap b = getChartBitmap();</div><div class="line"></div><div class="line">        OutputStream stream = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            stream = <span class="keyword">new</span> FileOutputStream(Environment.getExternalStorageDirectory().getPath()</div><div class="line">                    + pathOnSD + <span class="string">"/"</span> + title</div><div class="line">                    + <span class="string">".png"</span>);</div><div class="line"></div><div class="line">            <span class="comment">/*</span></div><div class="line">             * Write bitmap to file using JPEG or PNG and 40% quality hint for</div><div class="line">             * JPEG.</div><div class="line">             */</div><div class="line">            b.compress(CompressFormat.PNG, <span class="number">40</span>, stream);</div><div class="line"></div><div class="line">            stream.close();</div><div class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Saves the current state of the chart to the gallery as an image type. The</div><div class="line">     * compression must be set for JPEG only. 0 == maximum compression, 100 = low</div><div class="line">     * compression (high quality). <span class="doctag">NOTE:</span> Needs permission WRITE_EXTERNAL_STORAGE</div><div class="line">     * 保存图片</div><div class="line">     * <span class="doctag">@param</span> fileName        e.g. "my_image"</div><div class="line">     * <span class="doctag">@param</span> subFolderPath   e.g. "ChartPics"</div><div class="line">     * <span class="doctag">@param</span> fileDescription e.g. "Chart details"</div><div class="line">     * <span class="doctag">@param</span> format          e.g. Bitmap.CompressFormat.PNG</div><div class="line">     * <span class="doctag">@param</span> quality         e.g. 50, min = 0, max = 100</div><div class="line">     * <span class="doctag">@return</span> returns true if saving was successful, false if not</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveToGallery</span><span class="params">(String fileName, String subFolderPath, String fileDescription, Bitmap.CompressFormat format, <span class="keyword">int</span> quality)</span> </span>&#123;</div><div class="line">        <span class="comment">// restrain quality</span></div><div class="line">        <span class="keyword">if</span> (quality &lt; <span class="number">0</span> || quality &gt; <span class="number">100</span>)</div><div class="line">            quality = <span class="number">50</span>;</div><div class="line"></div><div class="line">        <span class="keyword">long</span> currentTime = System.currentTimeMillis();</div><div class="line"></div><div class="line">        File extBaseDir = Environment.getExternalStorageDirectory();</div><div class="line">        File file = <span class="keyword">new</span> File(extBaseDir.getAbsolutePath() + <span class="string">"/DCIM/"</span> + subFolderPath);</div><div class="line">        <span class="keyword">if</span> (!file.exists()) &#123;</div><div class="line">            <span class="keyword">if</span> (!file.mkdirs()) &#123;</div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        String mimeType = <span class="string">""</span>;</div><div class="line">        <span class="keyword">switch</span> (format) &#123;</div><div class="line">            <span class="keyword">case</span> PNG:</div><div class="line">                mimeType = <span class="string">"image/png"</span>;</div><div class="line">                <span class="keyword">if</span> (!fileName.endsWith(<span class="string">".png"</span>))</div><div class="line">                    fileName += <span class="string">".png"</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> WEBP:</div><div class="line">                mimeType = <span class="string">"image/webp"</span>;</div><div class="line">                <span class="keyword">if</span> (!fileName.endsWith(<span class="string">".webp"</span>))</div><div class="line">                    fileName += <span class="string">".webp"</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">            <span class="keyword">case</span> JPEG:</div><div class="line">            <span class="keyword">default</span>:</div><div class="line">                mimeType = <span class="string">"image/jpeg"</span>;</div><div class="line">                <span class="keyword">if</span> (!(fileName.endsWith(<span class="string">".jpg"</span>) || fileName.endsWith(<span class="string">".jpeg"</span>)))</div><div class="line">                    fileName += <span class="string">".jpg"</span>;</div><div class="line">                <span class="keyword">break</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        String filePath = file.getAbsolutePath() + <span class="string">"/"</span> + fileName;</div><div class="line">        FileOutputStream out = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            out = <span class="keyword">new</span> FileOutputStream(filePath);</div><div class="line"></div><div class="line">            Bitmap b = getChartBitmap();</div><div class="line">            b.compress(format, quality, out);</div><div class="line"></div><div class="line">            out.flush();</div><div class="line">            out.close();</div><div class="line"></div><div class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</div><div class="line">            e.printStackTrace();</div><div class="line"></div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        <span class="keyword">long</span> size = <span class="keyword">new</span> File(filePath).length();</div><div class="line"></div><div class="line">        ContentValues values = <span class="keyword">new</span> ContentValues(<span class="number">8</span>);</div><div class="line"></div><div class="line">        <span class="comment">// store the details</span></div><div class="line">        values.put(Images.Media.TITLE, fileName);</div><div class="line">        values.put(Images.Media.DISPLAY_NAME, fileName);</div><div class="line">        values.put(Images.Media.DATE_ADDED, currentTime);</div><div class="line">        values.put(Images.Media.MIME_TYPE, mimeType);</div><div class="line">        values.put(Images.Media.DESCRIPTION, fileDescription);</div><div class="line">        values.put(Images.Media.ORIENTATION, <span class="number">0</span>);</div><div class="line">        values.put(Images.Media.DATA, filePath);</div><div class="line">        values.put(Images.Media.SIZE, size);</div><div class="line"></div><div class="line">        <span class="keyword">return</span> getContext().getContentResolver().insert(Images.Media.EXTERNAL_CONTENT_URI, values) != <span class="keyword">null</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Saves the current state of the chart to the gallery as a JPEG image. The</div><div class="line">     * filename and compression can be set. 0 == maximum compression, 100 = low</div><div class="line">     * compression (high quality). <span class="doctag">NOTE:</span> Needs permission WRITE_EXTERNAL_STORAGE</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> fileName e.g. "my_image"</div><div class="line">     * <span class="doctag">@param</span> quality  e.g. 50, min = 0, max = 100</div><div class="line">     * <span class="doctag">@return</span> returns true if saving was successful, false if not</div><div class="line">     * 保存图片</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">saveToGallery</span><span class="params">(String fileName, <span class="keyword">int</span> quality)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> saveToGallery(fileName, <span class="string">""</span>, <span class="string">"MPAndroidChart-Library Save"</span>, Bitmap.CompressFormat.JPEG, quality);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * tasks to be done after the view is setup</div><div class="line">     * 这个Runnable列表用来存放View创建后所需的绘制</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ArrayList&lt;Runnable&gt; mJobs = <span class="keyword">new</span> ArrayList&lt;Runnable&gt;();</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeViewportJob</span><span class="params">(Runnable job)</span> </span>&#123;</div><div class="line">        mJobs.remove(job);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearAllViewportJobs</span><span class="params">()</span> </span>&#123;</div><div class="line">        mJobs.clear();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Either posts a job immediately if the chart has already setup it's</div><div class="line">     * dimensions or adds the job to the execution queue.</div><div class="line">     * 添加一个工作</div><div class="line">     * <span class="doctag">@param</span> job</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewportJob</span><span class="params">(Runnable job)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mViewPortHandler.hasChartDimens()) &#123;</div><div class="line">            <span class="comment">//如果View已经知道大小了，说明View已经绘制过了，直接post通知更新</span></div><div class="line">            post(job);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            mJobs.add(job);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns all jobs that are scheduled to be executed after</div><div class="line">     * onSizeChanged(...).</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> ArrayList&lt;Runnable&gt; <span class="title">getJobs</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mJobs;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onLayout</span><span class="params">(<span class="keyword">boolean</span> changed, <span class="keyword">int</span> left, <span class="keyword">int</span> top, <span class="keyword">int</span> right, <span class="keyword">int</span> bottom)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; getChildCount(); i++) &#123;</div><div class="line">            getChildAt(i).layout(left, top, right, bottom);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onMeasure</span><span class="params">(<span class="keyword">int</span> widthMeasureSpec, <span class="keyword">int</span> heightMeasureSpec)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onMeasure(widthMeasureSpec, heightMeasureSpec);</div><div class="line">        <span class="keyword">int</span> size = (<span class="keyword">int</span>) Utils.convertDpToPixel(<span class="number">50f</span>);</div><div class="line">        setMeasuredDimension(</div><div class="line">                Math.max(getSuggestedMinimumWidth(),</div><div class="line">                        resolveSize(size,</div><div class="line">                                widthMeasureSpec)),</div><div class="line">                Math.max(getSuggestedMinimumHeight(),</div><div class="line">                        resolveSize(size,</div><div class="line">                                heightMeasureSpec)));</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 实现了这个类用来做视图更新</div><div class="line">     * <span class="doctag">@param</span> w</div><div class="line">     * <span class="doctag">@param</span> h</div><div class="line">     * <span class="doctag">@param</span> oldw</div><div class="line">     * <span class="doctag">@param</span> oldh</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onSizeChanged</span><span class="params">(<span class="keyword">int</span> w, <span class="keyword">int</span> h, <span class="keyword">int</span> oldw, <span class="keyword">int</span> oldh)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (mLogEnabled)</div><div class="line">            Log.i(LOG_TAG, <span class="string">"OnSizeChanged()"</span>);</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (w &gt; <span class="number">0</span> &amp;&amp; h &gt; <span class="number">0</span> &amp;&amp; w &lt; <span class="number">10000</span> &amp;&amp; h &lt; <span class="number">10000</span>) &#123;</div><div class="line"></div><div class="line">            mViewPortHandler.setChartDimens(w, h);</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (mLogEnabled)</div><div class="line">                Log.i(LOG_TAG, <span class="string">"Setting chart dimens, width: "</span> + w + <span class="string">", height: "</span> + h);</div><div class="line"></div><div class="line">            <span class="keyword">for</span> (Runnable r : mJobs) &#123;</div><div class="line">                post(r);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            mJobs.clear();</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        notifyDataSetChanged();</div><div class="line"></div><div class="line">        <span class="keyword">super</span>.onSizeChanged(w, h, oldw, oldh);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Setting this to true will set the layer-type HARDWARE for the view, false</div><div class="line">     * will set layer-type SOFTWARE.</div><div class="line">     * 是否开启硬件加速</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> enabled</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setHardwareAccelerationEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (android.os.Build.VERSION.SDK_INT &gt;= <span class="number">11</span>) &#123;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (enabled)</div><div class="line">                setLayerType(View.LAYER_TYPE_HARDWARE, <span class="keyword">null</span>);</div><div class="line">            <span class="keyword">else</span></div><div class="line">                setLayerType(View.LAYER_TYPE_SOFTWARE, <span class="keyword">null</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            Log.e(LOG_TAG,</div><div class="line">                    <span class="string">"Cannot enable/disable hardware acceleration for devices below API level 11."</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDetachedFromWindow</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDetachedFromWindow();</div><div class="line"></div><div class="line">        <span class="comment">//Log.i(LOG_TAG, "Detaching...");</span></div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mUnbind)</div><div class="line">            unbindDrawables(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * unbind flag</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mUnbind = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Unbind all drawables to avoid memory leaks.</div><div class="line">     * Link: http://stackoverflow.com/a/6779164/1590502</div><div class="line">     * 防止内存泄漏</div><div class="line">     * <span class="doctag">@param</span> view</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unbindDrawables</span><span class="params">(View view)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (view.getBackground() != <span class="keyword">null</span>) &#123;</div><div class="line">            view.getBackground().setCallback(<span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">if</span> (view <span class="keyword">instanceof</span> ViewGroup) &#123;</div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ((ViewGroup) view).getChildCount(); i++) &#123;</div><div class="line">                unbindDrawables(((ViewGroup) view).getChildAt(i));</div><div class="line">            &#125;</div><div class="line">            ((ViewGroup) view).removeAllViews();</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Set this to true to enable "unbinding" of drawables. When a View is detached</div><div class="line">     * from a window. This helps avoid memory leaks.</div><div class="line">     * Default: false</div><div class="line">     * Link: http://stackoverflow.com/a/6779164/1590502</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> enabled</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUnbindEnabled</span><span class="params">(<span class="keyword">boolean</span> enabled)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mUnbind = enabled;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>它是所有图表的基类，里面是一些基础的方法，包括数据，描述，空数据等公用方法的绘制。保存当前图表信息等…<br>继承结构如下</p>
<ol>
<li>Chart(图表类基类)<ol>
<li>BarLineChartBase（柱状图折线图抽象类）<ol>
<li>BubbleChart（气泡图)</li>
<li>CandleStickChart（烛状图）</li>
<li>CombinedChart（复合图表)</li>
<li>BarChart（柱状图）</li>
<li>LineChart（折线图）</li>
<li>ScatterChart（散点图）</li>
</ol>
</li>
<li>PieRadarChartBase(饼状图雷达图抽象类）<ol>
<li>PieChart（饼状图）</li>
<li>RadarChart（雷达图）</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>根据不同的图表做了不同的实现，比如说BarLineChartBase都有一个共同的属性是XY轴，在onDraw方法中对XY轴做了绘制，BarLineChartBase还支持缩放操作。PieRadarBase是没有XY轴且不支持缩放操作，但支持旋转。所以将这两个图单独抽象了一层。<br>onDraw算是共有的主要方法。因为数据绘制都是在onDraw方法中的canvas上面。</p>
<p>下面来讲解一下MPAndroidChart的绘制过程</p>
<h2 id="MPAndroidChart绘制过程"><a href="#MPAndroidChart绘制过程" class="headerlink" title="MPAndroidChart绘制过程"></a>MPAndroidChart绘制过程</h2><p>所有的绘制都做了抽象在这边基本能重用的方法就做一层抽象。<br>我们来看一下最底层的抽象Renderer类<br>Chart的绘制是经由Renderer类之手，看一下Renderer类的实现。</p>
<h3 id="Render"><a href="#Render" class="headerlink" title="Render"></a>Render</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * Abstract baseclass of all Renderers.</div><div class="line"> * </div><div class="line"> * <span class="doctag">@author</span> Philipp Jahoda</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Renderer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * the component that handles the drawing area of the chart and it's offsets</div><div class="line">     * 这个方法用来控制绘制区域还有偏移量等设置</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ViewPortHandler mViewPortHandler;</div><div class="line"></div><div class="line">    <span class="comment">/** the minimum value on the x-axis that should be plotted</span></div><div class="line">     * X轴需要绘制的最小值</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> mMinX = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/** the maximum value on the x-axis that should be plotted </span></div><div class="line">    * X轴需要绘制的最大值</div><div class="line">    */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> mMaxX = <span class="number">0</span>;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 这边通过构造传入ViewPortHandler</div><div class="line">	 */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Renderer</span><span class="params">(ViewPortHandler viewPortHandler)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mViewPortHandler = viewPortHandler;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns true if the specified value fits in between the provided min</div><div class="line">     * and max bounds, false if not.</div><div class="line">     * 这个方法用来计算当前的值是否在X的最小和最大之间</div><div class="line">     * <span class="doctag">@param</span> val</div><div class="line">     * <span class="doctag">@param</span> min</div><div class="line">     * <span class="doctag">@param</span> max</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">fitsBounds</span><span class="params">(<span class="keyword">float</span> val, <span class="keyword">float</span> min, <span class="keyword">float</span> max)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (val &lt; min || val &gt; max)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Calculates the minimum and maximum x-value the chart can currently</div><div class="line">     * display (with the given zoom level). -&gt; mMinX, mMaxX</div><div class="line">     * 这个方法用来计算当前可以显示的X的大小，</div><div class="line">     * <span class="doctag">@param</span> dataProvider</div><div class="line">     * <span class="doctag">@param</span> xAxisModulus</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calcXBounds</span><span class="params">(BarLineScatterCandleBubbleDataProvider dataProvider, <span class="keyword">int</span> xAxisModulus)</span> </span>&#123;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> low = dataProvider.getLowestVisibleXIndex();</div><div class="line">        <span class="keyword">int</span> high = dataProvider.getHighestVisibleXIndex();</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> subLow = (low % xAxisModulus == <span class="number">0</span>) ? xAxisModulus : <span class="number">0</span>;</div><div class="line">        </div><div class="line">        mMinX = Math.max((low / xAxisModulus) * (xAxisModulus) - subLow, <span class="number">0</span>);</div><div class="line">        mMaxX = Math.min((high / xAxisModulus) * (xAxisModulus) + xAxisModulus, (<span class="keyword">int</span>) dataProvider.getXChartMax());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>注释写得很详细，这个类里面的方法用来确定当前视图可显示的大小，所有的Render类都继承自它。包括AxisRenderer（轴和轴值绘制），LegendRender（图例绘制）,DataRender（图表图形绘制）。<br>AxisRenderer，和LegendRender的实现都大同小异，DataRender属于图表绘制的抽象，因为图表的样式比较多，它扩展了一些可以供图表使用的方法，接下来主要拿DataRender来讲。</p>
<h3 id="DataRender"><a href="#DataRender" class="headerlink" title="DataRender"></a>DataRender</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Superclass of all render classes for the different data types (line, bar, ...).</div><div class="line"> * 这个类是Renderer的子类，用来提供一些抽象的绘制方法。</div><div class="line"> * <span class="doctag">@author</span> Philipp Jahoda</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DataRenderer</span> <span class="keyword">extends</span> <span class="title">Renderer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * the animator object used to perform animations on the chart data</div><div class="line">     * 这个对象是用来设置图表动画的</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ChartAnimator mAnimator;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * main paint object used for rendering</div><div class="line">     * 初始化图表item绘制的画笔</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mRenderPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint used for highlighting values</div><div class="line">     * 绘制高亮区域</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mHighlightPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个没见用到</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mDrawPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * paint object for drawing values (text representing values of chart</div><div class="line">     * entries)</div><div class="line">     * 这个用来绘制图表的文本信息</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mValuePaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 构造函数传入了动画对象ChartAnimator，控制绘制区域和偏移量的对象ViewPortHandler</div><div class="line">     * <span class="doctag">@param</span> animator</div><div class="line">     * <span class="doctag">@param</span> viewPortHandler</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataRenderer</span><span class="params">(ChartAnimator animator, ViewPortHandler viewPortHandler)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(viewPortHandler);</div><div class="line">        <span class="keyword">this</span>.mAnimator = animator;</div><div class="line"></div><div class="line">        mRenderPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        mRenderPaint.setStyle(Style.FILL);</div><div class="line"></div><div class="line">        mDrawPaint = <span class="keyword">new</span> Paint(Paint.DITHER_FLAG);</div><div class="line"></div><div class="line">        mValuePaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        mValuePaint.setColor(Color.rgb(<span class="number">63</span>, <span class="number">63</span>, <span class="number">63</span>));</div><div class="line">        mValuePaint.setTextAlign(Align.CENTER);</div><div class="line">        mValuePaint.setTextSize(Utils.convertDpToPixel(<span class="number">9f</span>));</div><div class="line"></div><div class="line">        mHighlightPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);</div><div class="line">        mHighlightPaint.setStyle(Paint.Style.STROKE);</div><div class="line">        mHighlightPaint.setStrokeWidth(<span class="number">2f</span>);</div><div class="line">        mHighlightPaint.setColor(Color.rgb(<span class="number">255</span>, <span class="number">187</span>, <span class="number">115</span>));</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the Paint object this renderer uses for drawing the values</div><div class="line">     * (value-text).</div><div class="line">     * 这个方法返回了文本绘制的画笔对象</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Paint <span class="title">getPaintValues</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mValuePaint;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the Paint object this renderer uses for drawing highlight</div><div class="line">     * indicators.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Paint <span class="title">getPaintHighlight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mHighlightPaint;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Returns the Paint object used for rendering.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@return</span></div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Paint <span class="title">getPaintRender</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mRenderPaint;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Applies the required styling (provided by the DataSet) to the value-paint</div><div class="line">     * object.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> set</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyValueTextStyle</span><span class="params">(IDataSet set)</span> </span>&#123;</div><div class="line"></div><div class="line">        mValuePaint.setTypeface(set.getValueTypeface());</div><div class="line">        mValuePaint.setTextSize(set.getValueTextSize());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Initializes the buffers used for rendering with a new size. Since this</div><div class="line">     * method performs memory allocations, it should only be called if</div><div class="line">     * necessary.</div><div class="line">     * 初始化Buffers，buffer是用来进行尺寸变换的一个类，他和transformer类配合生成实际的尺寸</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initBuffers</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Draws the actual data in form of lines, bars, ... depending on Renderer subclass.</div><div class="line">     * 数据绘制抽象类</div><div class="line">     * <span class="doctag">@param</span> c</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drawData</span><span class="params">(Canvas c)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Loops over all Entrys and draws their values.</div><div class="line">     *数值绘制抽象类</div><div class="line">     * <span class="doctag">@param</span> c</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drawValues</span><span class="params">(Canvas c)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Draws the value of the given entry by using the provided ValueFormatter.</div><div class="line">     * 数值绘制</div><div class="line">     * <span class="doctag">@param</span> c            canvas</div><div class="line">     * <span class="doctag">@param</span> formatter    formatter for custom value-formatting</div><div class="line">     * <span class="doctag">@param</span> value        the value to be drawn</div><div class="line">     * <span class="doctag">@param</span> entry        the entry the value belongs to</div><div class="line">     * <span class="doctag">@param</span> dataSetIndex the index of the DataSet the drawn Entry belongs to</div><div class="line">     * <span class="doctag">@param</span> x            position</div><div class="line">     * <span class="doctag">@param</span> y            position</div><div class="line">     * <span class="doctag">@param</span> color</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawValue</span><span class="params">(Canvas c, ValueFormatter formatter, <span class="keyword">float</span> value, Entry entry, <span class="keyword">int</span> dataSetIndex, <span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">int</span> color)</span> </span>&#123;</div><div class="line">        mValuePaint.setColor(color);</div><div class="line">        c.drawText(formatter.getFormattedValue(value, entry, dataSetIndex, mViewPortHandler), x, y, mValuePaint);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Draws any kind of additional information (e.g. line-circles).</div><div class="line">     * 这个是为LineChart 或者PieChart等设计的附加绘制。因为lineChart需要为每个点进行绘制，PieChart可能需要绘制中间圆形等。</div><div class="line">     * <span class="doctag">@param</span> c</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drawExtras</span><span class="params">(Canvas c)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Draws all highlight indicators for the values that are currently highlighted.</div><div class="line">     * 绘制高亮数据</div><div class="line">     * <span class="doctag">@param</span> c</div><div class="line">     * <span class="doctag">@param</span> indices the highlighted values</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drawHighlighted</span><span class="params">(Canvas c, Highlight[] indices)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>DataRender里面的方法大致如下</p>
<ol>
<li>图表的绘制抽象方法 (drawData)</li>
<li>数值绘制的抽象方法 (drawValues)</li>
<li>数值绘制方法（drawValue）</li>
<li>图表高亮抽象方法（drawHighlighted）</li>
<li>动画对象和画笔对象的初始化(构造函数)</li>
</ol>
<p>看一下BarChartRender的实现</p>
<h3 id="BarChartRender"><a href="#BarChartRender" class="headerlink" title="BarChartRender"></a>BarChartRender</h3><pre><code class="java">
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarChartRenderer</span> <span class="keyword">extends</span> <span class="title">DataRenderer</span> </span>{
    <span class="comment">/**
     * BarDataProvider这个类中存放了所有的barData，还有一些类似于阴影，数值位置，高亮箭头等。
     */</span>
    <span class="keyword">protected</span> BarDataProvider mChart;

    <span class="comment">/** the rect object that is used for drawing the bars
     *  这个是用来设置每条bar的大小。主要是用做高亮绘制
     */</span>
    <span class="keyword">protected</span> RectF mBarRect = <span class="keyword">new</span> RectF();
    <span class="comment">/**
     * 声明buffer的数组
     */</span>
    <span class="keyword">protected</span> BarBuffer[] mBarBuffers;
    <span class="comment">/**
     * 阴影画笔
     */</span>
    <span class="keyword">protected</span> Paint mShadowPaint;
    <span class="comment">/**
     * 边框画笔
     */</span>
    <span class="keyword">protected</span> Paint mBarBorderPaint;

    <span class="comment">/**
     * 构造函数传入了BarDataProvider,动画类，显示位置控制类，初始化了绘制所需的画笔
     * <span class="doctag">@param</span> chart
     * <span class="doctag">@param</span> animator
     * <span class="doctag">@param</span> viewPortHandler
     */</span>
    <span class="function"><span class="keyword">public</span> <span class="title">BarChartRenderer</span><span class="params">(BarDataProvider chart, ChartAnimator animator,
            ViewPortHandler viewPortHandler)</span> </span>{
        <span class="keyword">super</span>(animator, viewPortHandler);
        <span class="keyword">this</span>.mChart = chart;

        mHighlightPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);
        mHighlightPaint.setStyle(Paint.Style.FILL);
        mHighlightPaint.setColor(Color.rgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));
        <span class="comment">// set alpha after color</span>
        mHighlightPaint.setAlpha(<span class="number">120</span>);

        mShadowPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);
        mShadowPaint.setStyle(Paint.Style.FILL);

        mBarBorderPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);
        mBarBorderPaint.setStyle(Paint.Style.STROKE);
    }

    <span class="comment">/**
     * 初始化Buffer
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initBuffers</span><span class="params">()</span> </span>{

        BarData barData = mChart.getBarData();
        mBarBuffers = <span class="keyword">new</span> BarBuffer[barData.getDataSetCount()];

        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mBarBuffers.length; i++) {
            IBarDataSet set = barData.getDataSetByIndex(i);
            mBarBuffers[i] = <span class="keyword">new</span> BarBuffer(set.getEntryCount() * <span class="number">4</span> * (set.isStacked() ? set.getStackSize() : <span class="number">1</span>),
                    barData.getGroupSpace(),
                    barData.getDataSetCount(), set.isStacked());
        }
    }

    <span class="comment">/**
     * 绘制图表
     * <span class="doctag">@param</span> c
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawData</span><span class="params">(Canvas c)</span> </span>{

        BarData barData = mChart.getBarData();

        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; barData.getDataSetCount(); i++) {

            IBarDataSet set = barData.getDataSetByIndex(i);

            <span class="keyword">if</span> (set.isVisible() &amp;&amp; set.getEntryCount() &gt; <span class="number">0</span>) {
                drawDataSet(c, set, i);
            }
        }
    }

    <span class="comment">/**
     * 根据每个dataset绘制图表
     * <span class="doctag">@param</span> c
     * <span class="doctag">@param</span> dataSet
     * <span class="doctag">@param</span> index
     */</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawDataSet</span><span class="params">(Canvas c, IBarDataSet dataSet, <span class="keyword">int</span> index)</span> </span>{

        Transformer trans = mChart.getTransformer(dataSet.getAxisDependency());

        mShadowPaint.setColor(dataSet.getBarShadowColor());
        mBarBorderPaint.setColor(dataSet.getBarBorderColor());
        mBarBorderPaint.setStrokeWidth(Utils.convertDpToPixel(dataSet.getBarBorderWidth()));

        <span class="keyword">final</span> <span class="keyword">boolean</span> drawBorder = dataSet.getBarBorderWidth() &gt; <span class="number">0</span>.f;

        <span class="keyword">float</span> phaseX = mAnimator.getPhaseX();
        <span class="keyword">float</span> phaseY = mAnimator.getPhaseY();

        <span class="comment">// initialize the buffer</span>
        BarBuffer buffer = mBarBuffers[index];
        buffer.setPhases(phaseX, phaseY);
        buffer.setBarSpace(dataSet.getBarSpace());
        buffer.setDataSet(index);
        buffer.setInverted(mChart.isInverted(dataSet.getAxisDependency()));

        buffer.feed(dataSet);

        trans.pointValuesToPixel(buffer.buffer);

        <span class="comment">// draw the bar shadow before the values</span>
        <span class="keyword">if</span> (mChart.isDrawBarShadowEnabled()) {

            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; buffer.size(); j += <span class="number">4</span>) {

                <span class="keyword">if</span> (!mViewPortHandler.isInBoundsLeft(buffer.buffer[j + <span class="number">2</span>]))
                    <span class="keyword">continue</span>;

                <span class="keyword">if</span> (!mViewPortHandler.isInBoundsRight(buffer.buffer[j]))
                    <span class="keyword">break</span>;

                c.drawRect(buffer.buffer[j], mViewPortHandler.contentTop(),
                        buffer.buffer[j + <span class="number">2</span>],
                        mViewPortHandler.contentBottom(), mShadowPaint);
            }
        }

        <span class="comment">// if multiple colors</span>
        <span class="keyword">if</span> (dataSet.getColors().size() &gt; <span class="number">1</span>) {

            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; buffer.size(); j += <span class="number">4</span>) {

                <span class="keyword">if</span> (!mViewPortHandler.isInBoundsLeft(buffer.buffer[j + <span class="number">2</span>]))
                    <span class="keyword">continue</span>;

                <span class="keyword">if</span> (!mViewPortHandler.isInBoundsRight(buffer.buffer[j]))
                    <span class="keyword">break</span>;

                <span class="comment">// Set the color for the currently drawn value. If the index</span>
                <span class="comment">// is out of bounds, reuse colors.</span>
                mRenderPaint.setColor(dataSet.getColor(j / <span class="number">4</span>));
                c.drawRect(buffer.buffer[j], buffer.buffer[j + <span class="number">1</span>], buffer.buffer[j + <span class="number">2</span>],
                        buffer.buffer[j + <span class="number">3</span>], mRenderPaint);

                <span class="keyword">if</span> (drawBorder) {
                    c.drawRect(buffer.buffer[j], buffer.buffer[j + <span class="number">1</span>], buffer.buffer[j + <span class="number">2</span>],
                            buffer.buffer[j + <span class="number">3</span>], mBarBorderPaint);
                }
            }
        } <span class="keyword">else</span> {

            mRenderPaint.setColor(dataSet.getColor());

            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; buffer.size(); j += <span class="number">4</span>) {

                <span class="keyword">if</span> (!mViewPortHandler.isInBoundsLeft(buffer.buffer[j + <span class="number">2</span>]))
                    <span class="keyword">continue</span>;

                <span class="keyword">if</span> (!mViewPortHandler.isInBoundsRight(buffer.buffer[j]))
                    <span class="keyword">break</span>;

                c.drawRect(buffer.buffer[j], buffer.buffer[j + <span class="number">1</span>], buffer.buffer[j + <span class="number">2</span>],
                        buffer.buffer[j + <span class="number">3</span>], mRenderPaint);

                <span class="keyword">if</span> (drawBorder) {
                    c.drawRect(buffer.buffer[j], buffer.buffer[j + <span class="number">1</span>], buffer.buffer[j + <span class="number">2</span>],
                            buffer.buffer[j + <span class="number">3</span>], mBarBorderPaint);
                }
            }
        }
    }

    <span class="comment">/**
     * Prepares a bar for being highlighted.
     * 准备高亮的区域
     * <span class="doctag">@param</span> x the x-position
     * <span class="doctag">@param</span> y1 the y1-position
     * <span class="doctag">@param</span> y2 the y2-position
     * <span class="doctag">@param</span> barspaceHalf the space between bars
     * <span class="doctag">@param</span> trans
     */</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">prepareBarHighlight</span><span class="params">(<span class="keyword">float</span> x, <span class="keyword">float</span> y1, <span class="keyword">float</span> y2, <span class="keyword">float</span> barspaceHalf,
            Transformer trans)</span> </span>{

        <span class="keyword">float</span> barWidth = <span class="number">0.5f</span>;

        <span class="keyword">float</span> left = x - barWidth + barspaceHalf;
        <span class="keyword">float</span> right = x + barWidth - barspaceHalf;
        <span class="keyword">float</span> top = y1;
        <span class="keyword">float</span> bottom = y2;

        mBarRect.set(left, top, right, bottom);

        trans.rectValueToPixel(mBarRect, mAnimator.getPhaseY());
    }

    <span class="comment">/**
     * 绘制数值
     * <span class="doctag">@param</span> c
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawValues</span><span class="params">(Canvas c)</span> </span>{
        <span class="comment">// if values are drawn</span>
        <span class="keyword">if</span> (passesCheck()) {

            List&lt;IBarDataSet&gt; dataSets = mChart.getBarData().getDataSets();

            <span class="keyword">final</span> <span class="keyword">float</span> valueOffsetPlus = Utils.convertDpToPixel(<span class="number">4.5f</span>);
            <span class="keyword">float</span> posOffset = <span class="number">0f</span>;
            <span class="keyword">float</span> negOffset = <span class="number">0f</span>;
            <span class="keyword">boolean</span> drawValueAboveBar = mChart.isDrawValueAboveBarEnabled();

            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mChart.getBarData().getDataSetCount(); i++) {

                IBarDataSet dataSet = dataSets.get(i);

                <span class="keyword">if</span> (!dataSet.isDrawValuesEnabled() || dataSet.getEntryCount() == <span class="number">0</span>)
                    <span class="keyword">continue</span>;

                <span class="comment">// apply the text-styling defined by the DataSet</span>
                applyValueTextStyle(dataSet);

                <span class="keyword">boolean</span> isInverted = mChart.isInverted(dataSet.getAxisDependency());

                <span class="comment">// calculate the correct offset depending on the draw position of</span>
                <span class="comment">// the value</span>
                <span class="keyword">float</span> valueTextHeight = Utils.calcTextHeight(mValuePaint, <span class="string">"8"</span>);
                posOffset = (drawValueAboveBar ? -valueOffsetPlus : valueTextHeight + valueOffsetPlus);
                negOffset = (drawValueAboveBar ? valueTextHeight + valueOffsetPlus : -valueOffsetPlus);

                <span class="keyword">if</span> (isInverted) {
                    posOffset = -posOffset - valueTextHeight;
                    negOffset = -negOffset - valueTextHeight;
                }

                Transformer trans = mChart.getTransformer(dataSet.getAxisDependency());

                <span class="keyword">float</span>[] valuePoints = getTransformedValues(trans, dataSet, i);

                <span class="comment">// if only single values are drawn (sum)</span>
                <span class="keyword">if</span> (!dataSet.isStacked()) {

                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; valuePoints.length * mAnimator.getPhaseX(); j += <span class="number">2</span>) {

                        <span class="keyword">if</span> (!mViewPortHandler.isInBoundsRight(valuePoints[j]))
                            <span class="keyword">break</span>;

                        <span class="keyword">if</span> (!mViewPortHandler.isInBoundsY(valuePoints[j + <span class="number">1</span>])
                                || !mViewPortHandler.isInBoundsLeft(valuePoints[j]))
                            <span class="keyword">continue</span>;

                        BarEntry entry = dataSet.getEntryForIndex(j / <span class="number">2</span>);
                        <span class="keyword">float</span> val = entry.getVal();

                        drawValue(c, dataSet.getValueFormatter(), val, entry, i, valuePoints[j],
                                valuePoints[j + <span class="number">1</span>] + (val &gt;= <span class="number">0</span> ? posOffset : negOffset), dataSet.getValueTextColor(j / <span class="number">2</span>));
                    }

                    <span class="comment">// if we have stacks</span>
                } <span class="keyword">else</span> {

                    <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; (valuePoints.length - <span class="number">1</span>) * mAnimator.getPhaseX(); j += <span class="number">2</span>) {

                        BarEntry entry = dataSet.getEntryForIndex(j / <span class="number">2</span>);

                        <span class="keyword">float</span>[] vals = entry.getVals();

                        <span class="comment">// we still draw stacked bars, but there is one</span>
                        <span class="comment">// non-stacked</span>
                        <span class="comment">// in between</span>
                        <span class="keyword">if</span> (vals == <span class="keyword">null</span>) {

                            <span class="keyword">if</span> (!mViewPortHandler.isInBoundsRight(valuePoints[j]))
                                <span class="keyword">break</span>;

                            <span class="keyword">if</span> (!mViewPortHandler.isInBoundsY(valuePoints[j + <span class="number">1</span>])
                                    || !mViewPortHandler.isInBoundsLeft(valuePoints[j]))
                                <span class="keyword">continue</span>;

                            drawValue(c, dataSet.getValueFormatter(), entry.getVal(), entry, i, valuePoints[j],
                                    valuePoints[j + <span class="number">1</span>] + (entry.getVal() &gt;= <span class="number">0</span> ? posOffset : negOffset), dataSet.getValueTextColor(j / <span class="number">2</span>));

                            <span class="comment">// draw stack values</span>
                        } <span class="keyword">else</span> {

                            <span class="keyword">int</span> color = dataSet.getValueTextColor(j / <span class="number">2</span>);

                            <span class="keyword">float</span>[] transformed = <span class="keyword">new</span> <span class="keyword">float</span>[vals.length * <span class="number">2</span>];

                            <span class="keyword">float</span> posY = <span class="number">0f</span>;
                            <span class="keyword">float</span> negY = -entry.getNegativeSum();

                            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>, idx = <span class="number">0</span>; k &lt; transformed.length; k += <span class="number">2</span>, idx++) {

                                <span class="keyword">float</span> value = vals[idx];
                                <span class="keyword">float</span> y;

                                <span class="keyword">if</span> (value &gt;= <span class="number">0f</span>) {
                                    posY += value;
                                    y = posY;
                                } <span class="keyword">else</span> {
                                    y = negY;
                                    negY -= value;
                                }

                                transformed[k + <span class="number">1</span>] = y * mAnimator.getPhaseY();
                            }

                            trans.pointValuesToPixel(transformed);

                            <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; transformed.length; k += <span class="number">2</span>) {

                                <span class="keyword">float</span> x = valuePoints[j];
                                <span class="keyword">float</span> y = transformed[k + <span class="number">1</span>]
                                        + (vals[k / <span class="number">2</span>] &gt;= <span class="number">0</span> ? posOffset : negOffset);

                                <span class="keyword">if</span> (!mViewPortHandler.isInBoundsRight(x))
                                    <span class="keyword">break</span>;

                                <span class="keyword">if</span> (!mViewPortHandler.isInBoundsY(y)
                                        || !mViewPortHandler.isInBoundsLeft(x))
                                    <span class="keyword">continue</span>;

                                drawValue(c, dataSet.getValueFormatter(), vals[k / <span class="number">2</span>], entry, i, x, y, color);
                            }
                        }
                    }
                }
            }
        }
    }

    <span class="comment">/**
     * 绘制高亮
     * <span class="doctag">@param</span> c
     * <span class="doctag">@param</span> indices the highlighted values
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawHighlighted</span><span class="params">(Canvas c, Highlight[] indices)</span> </span>{

        BarData barData = mChart.getBarData();
        <span class="keyword">int</span> setCount = barData.getDataSetCount();

        <span class="keyword">for</span> (Highlight high : indices) {

            <span class="keyword">final</span> <span class="keyword">int</span> minDataSetIndex = high.getDataSetIndex() == -<span class="number">1</span>
                    ? <span class="number">0</span>
                    : high.getDataSetIndex();
            <span class="keyword">final</span> <span class="keyword">int</span> maxDataSetIndex = high.getDataSetIndex() == -<span class="number">1</span>
                    ? barData.getDataSetCount()
                    : (high.getDataSetIndex() + <span class="number">1</span>);
            <span class="keyword">if</span> (maxDataSetIndex - minDataSetIndex &lt; <span class="number">1</span>) <span class="keyword">continue</span>;

            <span class="keyword">for</span> (<span class="keyword">int</span> dataSetIndex = minDataSetIndex;
                    dataSetIndex &lt; maxDataSetIndex;
                    dataSetIndex++) {

                IBarDataSet set = barData.getDataSetByIndex(dataSetIndex);

                <span class="keyword">if</span> (set == <span class="keyword">null</span> || !set.isHighlightEnabled())
                    <span class="keyword">continue</span>;

                <span class="keyword">float</span> barspaceHalf = set.getBarSpace() / <span class="number">2f</span>;

                Transformer trans = mChart.getTransformer(set.getAxisDependency());

                mHighlightPaint.setColor(set.getHighLightColor());
                mHighlightPaint.setAlpha(set.getHighLightAlpha());

                <span class="keyword">int</span> index = high.getXIndex();

                <span class="comment">// check outofbounds</span>
                <span class="keyword">if</span> (index &gt;= <span class="number">0</span>
                        &amp;&amp; index &lt; (mChart.getXChartMax() * mAnimator.getPhaseX()) / setCount) {

                    BarEntry e = set.getEntryForXIndex(index);

                    <span class="keyword">if</span> (e == <span class="keyword">null</span> || e.getXIndex() != index)
                        <span class="keyword">continue</span>;

                    <span class="keyword">float</span> groupspace = barData.getGroupSpace();
                    <span class="keyword">boolean</span> isStack = high.getStackIndex() &lt; <span class="number">0</span> ? <span class="keyword">false</span> : <span class="keyword">true</span>;

                    <span class="comment">// calculate the correct x-position</span>
                    <span class="keyword">float</span> x = index * setCount + dataSetIndex + groupspace / <span class="number">2f</span>
                            + groupspace * index;

                    <span class="keyword">final</span> <span class="keyword">float</span> y1;
                    <span class="keyword">final</span> <span class="keyword">float</span> y2;

                    <span class="keyword">if</span> (isStack) {
                        y1 = high.getRange().from;
                        y2 = high.getRange().to;
                    } <span class="keyword">else</span> {
                        y1 = e.getVal();
                        y2 = <span class="number">0</span>.f;
                    }

                    prepareBarHighlight(x, y1, y2, barspaceHalf, trans);

                    c.drawRect(mBarRect, mHighlightPaint);

                    <span class="keyword">if</span> (mChart.isDrawHighlightArrowEnabled()) {

                        mHighlightPaint.setAlpha(<span class="number">255</span>);

                        <span class="comment">// distance between highlight arrow and bar</span>
                        <span class="keyword">float</span> offsetY = mAnimator.getPhaseY() * <span class="number">0.07f</span>;

                        <span class="keyword">float</span>[] values = <span class="keyword">new</span> <span class="keyword">float</span>[<span class="number">9</span>];
                        trans.getPixelToValueMatrix().getValues(values);
                        <span class="keyword">final</span> <span class="keyword">float</span> xToYRel = Math.abs(
                                values[Matrix.MSCALE_Y] / values[Matrix.MSCALE_X]);

                        <span class="keyword">final</span> <span class="keyword">float</span> arrowWidth = set.getBarSpace() / <span class="number">2</span>.f;
                        <span class="keyword">final</span> <span class="keyword">float</span> arrowHeight = arrowWidth * xToYRel;

                        <span class="keyword">final</span> <span class="keyword">float</span> yArrow = (y1 &gt; -y2 ? y1 : y1) * mAnimator.getPhaseY();

                        Path arrow = <span class="keyword">new</span> Path();
                        arrow.moveTo(x + <span class="number">0.4f</span>, yArrow + offsetY);
                        arrow.lineTo(x + <span class="number">0.4f</span> + arrowWidth, yArrow + offsetY - arrowHeight);
                        arrow.lineTo(x + <span class="number">0.4f</span> + arrowWidth, yArrow + offsetY + arrowHeight);

                        trans.pathValueToPixel(arrow);
                        c.drawPath(arrow, mHighlightPaint);
                    }
                }
            }
        }
    }

    <span class="keyword">public</span> <span class="keyword">float</span>[] getTransformedValues(Transformer trans, IBarDataSet data,
            <span class="keyword">int</span> dataSetIndex) {
        <span class="keyword">return</span> trans.generateTransformedValuesBarChart(data, dataSetIndex,
                mChart.getBarData(),
                mAnimator.getPhaseY());
    }

    <span class="comment">/**
     * 检查是否为可显示的值
     * <span class="doctag">@return</span>
     */</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">passesCheck</span><span class="params">()</span> </span>{
        <span class="keyword">return</span> mChart.getBarData().getYValCount() &lt; mChart.getMaxVisibleCount()
                * mViewPortHandler.getScaleX();
    }

    <span class="comment">/**
     * 绘制其他
     * <span class="doctag">@param</span> c
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawExtras</span><span class="params">(Canvas c)</span> </span>{ }
}
</code></pre>
<p>可以看到里面就是图表项和文本绘制的具体实现了，主要方法是drawvalues方法，大致就是一些通过一些方法计算每条bar的值，然后进行绘制。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在这边简单讲解一下设计的方法。因为所有的Chart都继承了ViewGroup，实现了View的onMeasure,onDraw,onLayout，onSizeChanged方法，所以它是可以像自定义控件一样来使用。<br>View的绘制都再Render中实现，不同图表实现了不同的Render，继承结构大概如下：</p>
<ol>
<li>Render基类<ol>
<li>AxisRender（轴绘制）</li>
<li>DataRender（图表绘制抽象类）<ol>
<li>CombinedChartRender（复合图表绘制，这个类是3.0版本添加的，可以展示折线图，柱状图，散点图等混合）</li>
<li>BubbleChartRenderer(气泡图绘制)</li>
<li>BarChartRender(柱状图绘制)</li>
<li>LineScatterCandleRadarRenderer（折线图，散点图，烛状图，雷达图抽象类）<ol>
<li>LineRadarRenderer（折线图，雷达图抽象）<ol>
<li>LineChartRender(折线图绘制类)</li>
<li>RadarChartRender(雷达图绘制类)</li>
</ol>
</li>
<li>ScatterChartRender(散点图绘制) </li>
<li>CandleStickChartRenderer（烛状图绘制）</li>
</ol>
</li>
</ol>
</li>
<li>LegendRender（图例绘制）</li>
</ol>
</li>
</ol>
<p>在不同的图表构造中初始化不同的将mRender对象初始化成不同的图表的Render对象，这里传入的参数有</p>
<ol>
<li>不同图表的DataProvider（DataProvider是一个接口，实现了获取Y轴方向（左或右），和获取数据的方法）。</li>
<li>ChartAnimator这是一个动画类，执行动画效果</li>
<li>ViewPortHandler 图表信息类，包括边距，大小，转换等级（缩放）<br>之后这些Render类就根据自己的实现在canvas上面绘制东西了。</li>
</ol>
<h2 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h2><p>由于很好奇它的点击事件是怎么实现的，这边也看了一下它的点击事件。<br>每个图表写了自己的TouchListener<br>在构造中需要传入的参数有</p>
<ol>
<li>图表大小的矩阵（用来计算缩放等级，还有当前点击事件位置）</li>
<li>图表对象</li>
</ol>
<p>之后根据Touch事件判断相应的手势或者点击，触摸事件作出反应（点击，手势缩放，移动等）。调用View的postInvalidate 方法通知刷新。</p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/03/31/EventBusSource/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/31/EventBusSource/" itemprop="url">
                  EventBus源码解析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-31T14:08:11+08:00">
                2017-03-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android源码解析/" itemprop="url" rel="index">
                    <span itemprop="name">Android源码解析</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="为什么要使用EventBus"><a href="#为什么要使用EventBus" class="headerlink" title="为什么要使用EventBus"></a>为什么要使用EventBus</h2><p>在Android开发过程中经常有这样的场景–&gt;栈顶Activity需要关闭非栈顶的Activity，或调用其中的某些方法。</p>
<p>案例：我有三个Activity，主界面Activity,个人中心Activity，登录界面Activity，主界面打开了个人中心页面，个人中心页面有个退出登录的功能，点击后退出登录关闭主界面Activity和当前Activity,打开登录页面.</p>
<p>这只是个简单的案例，当然关闭当前Activity和打开登录页面的Activity都是没什么难度的东西。</p>
<p>我们来讨论主界面关闭的一些实现方案。</p>
<ol>
<li><p>得到主界面Activity的对象。这边可能需要某个静态方法来持有这个对象，以前见过一种写法是写一个ActivityManager来持有这些Activity对象，然后手动管理这些Activity。</p>
</li>
<li><p>发送一个广播通知主界面Activity.</p>
</li>
<li><p>在当前Activity销毁时传一个resultCode，主界面看到这个resultCode来判断是否是否要做关闭操作。</p>
</li>
</ol>
<p>暂时能想到的就这三种实现方案，分析一下三种实现：</p>
<blockquote>
<p>第三种实现方案并不适用于比如我现在是主界面–&gt;个人主页–&gt;个人中心，做第三种方案的话代码写到哭晕在厕所，并且第三种方案代码写起来会很复杂，页面可能还没关掉就把自己绕晕了（个人想法，不推荐！）</p>
<p>第二种实现方案：发送一个广播做通知，其实是一个蛮不错的选择，发送广播然后实现广播类做回调通知。但是如果现在需求是对一个Fragment做通知。这个时候广播就派不上用场了。毕竟广播只能再Activity中注册发送广播。</p>
<p>第一种实现方案：这种方案在以前还是蛮常见的，以前学Android的时候会看到一些大牛们，自己写一个ActivityManager用来存放Activity对象做生命周期管理。但是这样做其实是会有问题的。因为持有的是Activity的对象，这就导致了Activity只能手动销毁。每次写关闭页面的时候都要调用这个方法来销毁Activity，不然分分钟就OOM了。还有另外一个缺点就是需要遍历整个栈来确定存活的Activity对象。找到你要找的Activity，然后调用其中的方法。如果是要销毁则还要将它移除栈中。（心很累）</p>
</blockquote>
<p>想想这些方法真的都好难用呀。<br>这个时候就需要来个上帝来管理这些东西了。EventBus一脸害羞的跳出来了。一种全局的观察者模式，你可以把你的愿望（Event）请求post给这位上帝，它提供多线程的处理方案，来让你的(愿望)在你指定的地方实现。</p>
<h2 id="EventBus使用"><a href="#EventBus使用" class="headerlink" title="EventBus使用"></a>EventBus使用</h2><p> 在<a href="https://github.com/greenrobot/EventBus" target="_blank" rel="external">Github</a>上可以看到gradle所需配置<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">compile &apos;org.greenrobot:eventbus:3.0.0&apos;</div></pre></td></tr></table></figure></p>
<p> 在gradle文件做上如上配置就可以了</p>
<p>分三个步骤</p>
<ol>
<li>定义一个作为通知的实体类Event;</li>
<li>在需要订阅的地方做注册和取消注册，写一个订阅方法(方法需要写注解 @Subscribe(threadMode = ThreadMode.XXX))</li>
<li>在任意地方调用EventBus.getDefault().post(Event());</li>
</ol>
<p>简单代码如下：<br>在MainActivity注册和解除注册，并写出订阅方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.cncn.myapplication;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Intent;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.EventBus;</div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.Subscribe;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MainActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        <span class="comment">//注册一个EventBus</span></div><div class="line">        EventBus.getDefault().register(<span class="keyword">this</span>);</div><div class="line">        findViewById(R.id.tvClickView).setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                startActivity(<span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, UserInfoActivity.class));</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="meta">@Subscribe</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onMainEvent</span><span class="params">(Event event)</span> </span>&#123;</div><div class="line">        <span class="comment">//打印对象的地址信息</span></div><div class="line">        Log.d(<span class="string">"MainActivity"</span>, <span class="string">"EventInfo"</span> + event.toString() + <span class="string">"_"</span> + event.eventInfo);</div><div class="line">        finish();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDestroy</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onDestroy();</div><div class="line">        Log.d(<span class="string">"MainActivity"</span>,<span class="string">"我被关掉了"</span>);</div><div class="line">        <span class="comment">//如果已经注册，千万别忘了取消注册</span></div><div class="line">        <span class="keyword">if</span> (EventBus.getDefault().isRegistered(<span class="keyword">this</span>))</div><div class="line">            EventBus.getDefault().unregister(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>在UserInfoActivity发送通知</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.cncn.myapplication;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Intent;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.os.PersistableBundle;</div><div class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.util.Log;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.EventBus;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by xiaolong on 2017/3/24.</div><div class="line"> * Email:719243738@qq.com</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserInfoActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> TextView tvClickView;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        tvClickView = (TextView) findViewById(R.id.tvClickView);</div><div class="line">        tvClickView.setText(<span class="string">"点我退出登录！"</span>);</div><div class="line">        tvClickView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                startActivity(<span class="keyword">new</span> Intent(UserInfoActivity.<span class="keyword">this</span>, LoginActivity.class));</div><div class="line">                Event event = <span class="keyword">new</span> Event(<span class="number">110</span>, <span class="string">"关闭页面吧！！"</span>);</div><div class="line">                Log.d(<span class="string">"UserInfoActivity"</span>, event.toString());</div><div class="line">                EventBus.getDefault().post(event);</div><div class="line">                finish();</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>LoginActivity</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.cncn.myapplication;</div><div class="line"></div><div class="line"><span class="keyword">import</span> android.content.Intent;</div><div class="line"><span class="keyword">import</span> android.os.Bundle;</div><div class="line"><span class="keyword">import</span> android.support.annotation.Nullable;</div><div class="line"><span class="keyword">import</span> android.support.v7.app.AppCompatActivity;</div><div class="line"><span class="keyword">import</span> android.view.View;</div><div class="line"><span class="keyword">import</span> android.widget.TextView;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by xiaolong on 2017/3/24.</div><div class="line"> * Email:719243738@qq.com</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LoginActivity</span> <span class="keyword">extends</span> <span class="title">AppCompatActivity</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> TextView tvClickView;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@Nullable Bundle savedInstanceState)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        tvClickView = (TextView) findViewById(R.id.tvClickView);</div><div class="line">        tvClickView.setText(<span class="string">"点我登录！"</span>);</div><div class="line">        tvClickView.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</div><div class="line">            <span class="meta">@Override</span></div><div class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View v)</span> </span>&#123;</div><div class="line">                startActivity(<span class="keyword">new</span> Intent(LoginActivity.<span class="keyword">this</span>,MainActivity.class));</div><div class="line">            &#125;</div><div class="line">        &#125;);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>实体类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.example.cncn.myapplication;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Created by xiaolong on 2017/3/24.</div><div class="line"> * Email:719243738@qq.com</div><div class="line"> */</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</div><div class="line">    <span class="keyword">public</span> <span class="keyword">int</span> eventCode;</div><div class="line">    <span class="keyword">public</span> String eventInfo;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Event</span><span class="params">(<span class="keyword">int</span> eventCode, String eventInfo)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.eventCode = eventCode;</div><div class="line">        <span class="keyword">this</span>.eventInfo = eventInfo;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>运行结果</p>
<p><img src="http://img.blog.csdn.net/20170325221620023?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="打印接锅"></p>
<p>如此简单便捷的使用方式，确实是做消息通知的不二选择。不过在注册过EventBus的类中，千万别忘了在结束的时候取消注册，不然会报错。不过报错总比那些没报错强引用了这个对象的好~~这么好用的东西还是需要去了解一下其内部实现的。而且EventBus内部实现其实并不复杂。</p>
<h2 id="EventBus源码解析"><a href="#EventBus源码解析" class="headerlink" title="EventBus源码解析"></a>EventBus源码解析</h2><p>注册EventBus的时候需要执行，EventBus.getDefault().register(this);<br>我们先从getDefault方法入手，看下里面做了些什么</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/** Convenience singleton for apps using a process-wide EventBus instance. */</span></div><div class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> EventBus <span class="title">getDefault</span><span class="params">()</span> </span>&#123;</div><div class="line">       <span class="keyword">if</span> (defaultInstance == <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">synchronized</span> (EventBus.class) &#123;</div><div class="line">               <span class="keyword">if</span> (defaultInstance == <span class="keyword">null</span>) &#123;</div><div class="line">                   defaultInstance = <span class="keyword">new</span> EventBus();</div><div class="line">               &#125;</div><div class="line">           &#125;</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> defaultInstance;</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<p>大致代码如下，单例模式获取一个EventBus对象，保证所有的EventBus对象是同一个。</p>
<p>进入 EventBus构造看一下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates a new EventBus instance; each instance is a separate scope in which events are delivered. To use a</div><div class="line"> * central bus, consider &#123;<span class="doctag">@link</span> #getDefault()&#125;.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="title">EventBus</span><span class="params">()</span> </span>&#123;</div><div class="line">    <span class="keyword">this</span>(DEFAULT_BUILDER);</div><div class="line">&#125;</div><div class="line"></div><div class="line">EventBus(EventBusBuilder builder) &#123;</div><div class="line">    subscriptionsByEventType = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">    typesBySubscriber = <span class="keyword">new</span> HashMap&lt;&gt;();</div><div class="line">    stickyEvents = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</div><div class="line">    mainThreadPoster = <span class="keyword">new</span> HandlerPoster(<span class="keyword">this</span>, Looper.getMainLooper(), <span class="number">10</span>);</div><div class="line">    backgroundPoster = <span class="keyword">new</span> BackgroundPoster(<span class="keyword">this</span>);</div><div class="line">    asyncPoster = <span class="keyword">new</span> AsyncPoster(<span class="keyword">this</span>);</div><div class="line">    indexCount = builder.subscriberInfoIndexes != <span class="keyword">null</span> ? builder.subscriberInfoIndexes.size() : <span class="number">0</span>;</div><div class="line">    subscriberMethodFinder = <span class="keyword">new</span> SubscriberMethodFinder(builder.subscriberInfoIndexes,</div><div class="line">            builder.strictMethodVerification, builder.ignoreGeneratedIndex);</div><div class="line">    logSubscriberExceptions = builder.logSubscriberExceptions;</div><div class="line">    logNoSubscriberMessages = builder.logNoSubscriberMessages;</div><div class="line">    sendSubscriberExceptionEvent = builder.sendSubscriberExceptionEvent;</div><div class="line">    sendNoSubscriberEvent = builder.sendNoSubscriberEvent;</div><div class="line">    throwSubscriberException = builder.throwSubscriberException;</div><div class="line">    eventInheritance = builder.eventInheritance;</div><div class="line">    executorService = builder.executorService;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>两个构造方法，一个是无参的public的方法，另外一个是内部方法，带参数的。<br>第一个方法默认调用有参数的构造方法，来生成一个EventBus对象。<br>这边DEFAULT_BUILDER声明如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> EventBusBuilder DEFAULT_BUILDER = <span class="keyword">new</span> EventBusBuilder();</div></pre></td></tr></table></figure>
<p>存放着一个默认的EventBusBuilder对象;<br>进入EventBusBuilder中看</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.greenrobot.eventbus;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.meta.SubscriberInfoIndex;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.ArrayList;</div><div class="line"><span class="keyword">import</span> java.util.List;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</div><div class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</div><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Creates EventBus instances with custom parameters and also allows to install a custom default EventBus instance.</div><div class="line"> * Create a new builder using &#123;<span class="doctag">@link</span> EventBus#builder()&#125;.</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventBusBuilder</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> ExecutorService DEFAULT_EXECUTOR_SERVICE = Executors.newCachedThreadPool();</div><div class="line"></div><div class="line">    <span class="keyword">boolean</span> logSubscriberExceptions = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">boolean</span> logNoSubscriberMessages = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">boolean</span> sendSubscriberExceptionEvent = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">boolean</span> sendNoSubscriberEvent = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">boolean</span> throwSubscriberException;</div><div class="line">    <span class="keyword">boolean</span> eventInheritance = <span class="keyword">true</span>;</div><div class="line">    <span class="keyword">boolean</span> ignoreGeneratedIndex;</div><div class="line">    <span class="keyword">boolean</span> strictMethodVerification;</div><div class="line">    ExecutorService executorService = DEFAULT_EXECUTOR_SERVICE;</div><div class="line">    List&lt;Class&lt;?&gt;&gt; skipMethodVerificationForClasses;</div><div class="line">    List&lt;SubscriberInfoIndex&gt; subscriberInfoIndexes;</div><div class="line"></div><div class="line">    EventBusBuilder() &#123;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/** Default: true */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">logSubscriberExceptions</span><span class="params">(<span class="keyword">boolean</span> logSubscriberExceptions)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.logSubscriberExceptions = logSubscriberExceptions;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/** Default: true */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">logNoSubscriberMessages</span><span class="params">(<span class="keyword">boolean</span> logNoSubscriberMessages)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.logNoSubscriberMessages = logNoSubscriberMessages;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/** Default: true */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">sendSubscriberExceptionEvent</span><span class="params">(<span class="keyword">boolean</span> sendSubscriberExceptionEvent)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.sendSubscriberExceptionEvent = sendSubscriberExceptionEvent;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/** Default: true */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">sendNoSubscriberEvent</span><span class="params">(<span class="keyword">boolean</span> sendNoSubscriberEvent)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.sendNoSubscriberEvent = sendNoSubscriberEvent;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Fails if an subscriber throws an exception (default: false).</div><div class="line">     * &lt;p/&gt;</div><div class="line">     * Tip: Use this with BuildConfig.DEBUG to let the app crash in DEBUG mode (only). This way, you won't miss</div><div class="line">     * exceptions during development.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">throwSubscriberException</span><span class="params">(<span class="keyword">boolean</span> throwSubscriberException)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.throwSubscriberException = throwSubscriberException;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * By default, EventBus considers the event class hierarchy (subscribers to super classes will be notified).</div><div class="line">     * Switching this feature off will improve posting of events. For simple event classes extending Object directly,</div><div class="line">     * we measured a speed up of 20% for event posting. For more complex event hierarchies, the speed up should be</div><div class="line">     * &gt;20%.</div><div class="line">     * &lt;p/&gt;</div><div class="line">     * However, keep in mind that event posting usually consumes just a small proportion of CPU time inside an app,</div><div class="line">     * unless it is posting at high rates, e.g. hundreds/thousands of events per second.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">eventInheritance</span><span class="params">(<span class="keyword">boolean</span> eventInheritance)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.eventInheritance = eventInheritance;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Provide a custom thread pool to EventBus used for async and background event delivery. This is an advanced</div><div class="line">     * setting to that can break things: ensure the given ExecutorService won't get stuck to avoid undefined behavior.</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">executorService</span><span class="params">(ExecutorService executorService)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.executorService = executorService;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Method name verification is done for methods starting with onEvent to avoid typos; using this method you can</div><div class="line">     * exclude subscriber classes from this check. Also disables checks for method modifiers (public, not static nor</div><div class="line">     * abstract).</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">skipMethodVerificationFor</span><span class="params">(Class&lt;?&gt; clazz)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span> (skipMethodVerificationForClasses == <span class="keyword">null</span>) &#123;</div><div class="line">            skipMethodVerificationForClasses = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        &#125;</div><div class="line">        skipMethodVerificationForClasses.add(clazz);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/** Forces the use of reflection even if there's a generated index (default: false). */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">ignoreGeneratedIndex</span><span class="params">(<span class="keyword">boolean</span> ignoreGeneratedIndex)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.ignoreGeneratedIndex = ignoreGeneratedIndex;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/** Enables strict method verification (default: false). */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">strictMethodVerification</span><span class="params">(<span class="keyword">boolean</span> strictMethodVerification)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.strictMethodVerification = strictMethodVerification;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/** Adds an index generated by EventBus' annotation preprocessor. */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> EventBusBuilder <span class="title">addIndex</span><span class="params">(SubscriberInfoIndex index)</span> </span>&#123;</div><div class="line">        <span class="keyword">if</span>(subscriberInfoIndexes == <span class="keyword">null</span>) &#123;</div><div class="line">            subscriberInfoIndexes = <span class="keyword">new</span> ArrayList&lt;&gt;();</div><div class="line">        &#125;</div><div class="line">        subscriberInfoIndexes.add(index);</div><div class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Installs the default EventBus returned by &#123;<span class="doctag">@link</span> EventBus#getDefault()&#125; using this builders' values. Must be</div><div class="line">     * done only once before the first usage of the default EventBus.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@throws</span> EventBusException if there's already a default EventBus instance in place</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> EventBus <span class="title">installDefaultEventBus</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">synchronized</span> (EventBus.class) &#123;</div><div class="line">            <span class="keyword">if</span> (EventBus.defaultInstance != <span class="keyword">null</span>) &#123;</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Default instance already exists."</span> +</div><div class="line">                        <span class="string">" It may be only set once before it's used the first time to ensure consistent behavior."</span>);</div><div class="line">            &#125;</div><div class="line">            EventBus.defaultInstance = build();</div><div class="line">            <span class="keyword">return</span> EventBus.defaultInstance;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/** Builds an EventBus based on the current configuration. */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> EventBus <span class="title">build</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> EventBus(<span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>里面是一些EventBus的基础配置。打印异常信息，发送未被订阅的消息等。<br>特别需要注意的是 ignoreGeneratedIndex 这个变量是用来确定EventBus用什么方式来获取订阅方法。<br>true代表的是不优先使用索引，用反射的方式，false代表的是优先使用索引。默认是false。<br>这边有个addIndex方法是用来添加订阅方法索引的，这是3.0版本的新特性。<br>在EventBus带参数的构造函数里面初始化了 SubscriberMethodFinder 这个类，三个参数分别为索引列表，<br>是否严格方法定义，是否无视索引。</p>
<pre><code>getDefault方法总结，该方法返回一个单例的EventBus对象，如果对象没被创建就创建一个默认的EventBus对象。
</code></pre><p>接下来从注册方法下手</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Registers the given subscriber to receive events. Subscribers must call &#123;<span class="doctag">@link</span> #unregister(Object)&#125; once they</div><div class="line"> * are no longer interested in receiving events.</div><div class="line"> * &lt;p/&gt;</div><div class="line"> * Subscribers have event handling methods that must be annotated by &#123;<span class="doctag">@link</span> Subscribe&#125;.</div><div class="line"> * The &#123;<span class="doctag">@link</span> Subscribe&#125; annotation also allows configuration like &#123;<span class="doctag">@link</span></div><div class="line"> * ThreadMode&#125; and priority.</div><div class="line"> */</div><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">register</span><span class="params">(Object subscriber)</span> </span>&#123;</div><div class="line">    Class&lt;?&gt; subscriberClass = subscriber.getClass();</div><div class="line">    List&lt;SubscriberMethod&gt; subscriberMethods = subscriberMethodFinder.findSubscriberMethods(subscriberClass);</div><div class="line">    <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;</div><div class="line">        <span class="keyword">for</span> (SubscriberMethod subscriberMethod : subscriberMethods) &#123;</div><div class="line">            subscribe(subscriber, subscriberMethod);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>首先是通过一个findSubscriberMethods方法找到了一个订阅者中的所有订阅方法，返回一个 List<subscribermethod>，然后之后遍历所有的订阅方法，做订阅操作。进入到findSubscriberMethods看看如何实现的。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="function">List&lt;SubscriberMethod&gt; <span class="title">findSubscriberMethods</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> </span>&#123;</div><div class="line">       List&lt;SubscriberMethod&gt; subscriberMethods = METHOD_CACHE.get(subscriberClass);</div><div class="line">       <span class="keyword">if</span> (subscriberMethods != <span class="keyword">null</span>) &#123;</div><div class="line">           <span class="keyword">return</span> subscriberMethods;</div><div class="line">       &#125;</div><div class="line"></div><div class="line">       <span class="keyword">if</span> (ignoreGeneratedIndex) &#123;</div><div class="line">           subscriberMethods = findUsingReflection(subscriberClass);</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           subscriberMethods = findUsingInfo(subscriberClass);</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">if</span> (subscriberMethods.isEmpty()) &#123;</div><div class="line">           <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Subscriber "</span> + subscriberClass</div><div class="line">                   + <span class="string">" and its super classes have no public methods with the @Subscribe annotation"</span>);</div><div class="line">       &#125; <span class="keyword">else</span> &#123;</div><div class="line">           METHOD_CACHE.put(subscriberClass, subscriberMethods);</div><div class="line">           <span class="keyword">return</span> subscriberMethods;</div><div class="line">       &#125;</div><div class="line">   &#125;</div></pre></td></tr></table></figure></subscribermethod></p>
<p>findSubscriberMethods这个方法声明SubscriberMethodFinder这个类中，类中声明了一个ConcurrentHashMap用来做SubscriberMethod的缓存。</p>
<p>回到findSubscriberMethods中，首先是通过类来当key，查找在当前缓存中是否存在这个类的订阅方法列表。有就直接return 缓存中的列表。</p>
<p>没有就进入下一步，这边有两种方式来获取类中的订阅方法通过ignoreGeneratedIndex来确定获取订阅方法的方式为true时会使用反射方法获取订阅者的事件处理函数，为false时会优先使用subscriber Index（订阅方法索引）生成的SubscriberInfo来获取订阅者的事件处理函数（减少反射耗时），默认false。（使用订阅方法索引需自己构建一个EventBus对象，将在后面提及，目前的使用并不能用到索引）</p>
<p>进入findUsingInfo这个方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> List&lt;SubscriberMethod&gt; <span class="title">findUsingInfo</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> </span>&#123;</div><div class="line">       FindState findState = prepareFindState();<span class="comment">//这个方法用来从对象池中获取一个FindState对象，如果对象池都没有可用对象的话新建一个。用来节省创建对象的花销</span></div><div class="line">       findState.initForSubscriber(subscriberClass);</div><div class="line">       <span class="keyword">while</span> (findState.clazz != <span class="keyword">null</span>) &#123;</div><div class="line">           findState.subscriberInfo = getSubscriberInfo(findState);</div><div class="line">           <span class="keyword">if</span> (findState.subscriberInfo != <span class="keyword">null</span>) &#123;</div><div class="line">               SubscriberMethod[] array = findState.subscriberInfo.getSubscriberMethods();</div><div class="line">               <span class="keyword">for</span> (SubscriberMethod subscriberMethod : array) &#123;</div><div class="line">                   <span class="keyword">if</span> (findState.checkAdd(subscriberMethod.method, subscriberMethod.eventType)) &#123;</div><div class="line">                       findState.subscriberMethods.add(subscriberMethod);</div><div class="line">                   &#125;</div><div class="line">               &#125;</div><div class="line">           &#125; <span class="keyword">else</span> &#123;</div><div class="line">               findUsingReflectionInSingleClass(findState);</div><div class="line">           &#125;</div><div class="line">           findState.moveToSuperclass();</div><div class="line">       &#125;</div><div class="line">       <span class="keyword">return</span> getMethodsAndRelease(findState);</div><div class="line">   &#125;</div></pre></td></tr></table></figure>
<ol>
<li>从FindState池——FIND_STATE_POOL中获取一个FindState对象。（SubscriberMethodFinder这个类中声明了一个FIND_STATE_POOL的对象池，这个用来存放空（并非NULL）的FIND_STATE对象，减少创建对象的花销)</li>
<li>该方法会将findState.clazz域中使用了@subscribe标注、方法中只有一个参数、且方法修饰符为public的方法，创建一个SubscriberMethod对象，并添加到findState的List<subscribermethod>集合中。</subscribermethod></li>
<li>将findState.clazz域更新为clazz = clazz.getSuperclass(); 如果该超类名字以java. javax. android.开头则clazz变成null；不再往上寻找父类；</li>
<li>拷贝一份findState的List<subscribermethod>集合并返回，最后回收findState对象,回收的只是释放这个对象内部的变量的资源占用，但这个对象还是存在的，放回对象池中，下次可以再取出来用；</subscribermethod></li>
</ol>
<p>看一下如何用反射获取订阅方法。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> List&lt;SubscriberMethod&gt; <span class="title">findUsingReflection</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> </span>&#123;</div><div class="line">        FindState findState = prepareFindState();</div><div class="line">        findState.initForSubscriber(subscriberClass);</div><div class="line">        <span class="keyword">while</span> (findState.clazz != <span class="keyword">null</span>) &#123;</div><div class="line">            findUsingReflectionInSingleClass(findState);</div><div class="line">            findState.moveToSuperclass();</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">return</span> getMethodsAndRelease(findState);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">findUsingReflectionInSingleClass</span><span class="params">(FindState findState)</span> </span>&#123;</div><div class="line">        Method[] methods;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// This is faster than getMethods, especially when subscribers are fat classes like Activities</span></div><div class="line">            methods = findState.clazz.getDeclaredMethods();</div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable th) &#123;</div><div class="line">            <span class="comment">// Workaround for java.lang.NoClassDefFoundError, see https://github.com/greenrobot/EventBus/issues/149</span></div><div class="line">            methods = findState.clazz.getMethods();</div><div class="line">            findState.skipSuperClasses = <span class="keyword">true</span>;</div><div class="line">        &#125;</div><div class="line">        <span class="keyword">for</span> (Method method : methods) &#123;</div><div class="line">            <span class="keyword">int</span> modifiers = method.getModifiers();</div><div class="line">            <span class="keyword">if</span> ((modifiers &amp; Modifier.PUBLIC) != <span class="number">0</span> &amp;&amp; (modifiers &amp; MODIFIERS_IGNORE) == <span class="number">0</span>) &#123;</div><div class="line">                Class&lt;?&gt;[] parameterTypes = method.getParameterTypes();</div><div class="line">                <span class="keyword">if</span> (parameterTypes.length == <span class="number">1</span>) &#123;</div><div class="line">                    Subscribe subscribeAnnotation = method.getAnnotation(Subscribe.class);</div><div class="line">                    <span class="keyword">if</span> (subscribeAnnotation != <span class="keyword">null</span>) &#123;</div><div class="line">                        Class&lt;?&gt; eventType = parameterTypes[<span class="number">0</span>];</div><div class="line">                        <span class="keyword">if</span> (findState.checkAdd(method, eventType)) &#123;</div><div class="line">                            ThreadMode threadMode = subscribeAnnotation.threadMode();</div><div class="line">                            findState.subscriberMethods.add(<span class="keyword">new</span> SubscriberMethod(method, eventType, threadMode,</div><div class="line">                                    subscribeAnnotation.priority(), subscribeAnnotation.sticky()));</div><div class="line">                        &#125;</div><div class="line">                    &#125;</div><div class="line">                &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) &#123;</div><div class="line">                    String methodName = method.getDeclaringClass().getName() + <span class="string">"."</span> + method.getName();</div><div class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"@Subscribe method "</span> + methodName +</div><div class="line">                            <span class="string">"must have exactly 1 parameter but has "</span> + parameterTypes.length);</div><div class="line">                &#125;</div><div class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (strictMethodVerification &amp;&amp; method.isAnnotationPresent(Subscribe.class)) &#123;</div><div class="line">                String methodName = method.getDeclaringClass().getName() + <span class="string">"."</span> + method.getName();</div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(methodName +</div><div class="line">                        <span class="string">" is a illegal @Subscribe method: must be public, non-static, and non-abstract"</span>);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ol>
<li>获取订阅类声明的所有方法; 然后对获取到的方法全部遍历一遍</li>
<li>获取方法的修饰符：即方法前面的public、private等关键字。</li>
<li>如果该类方法使用了@subscribe标注、方法中只有一个参数、且方法修饰符为public。findState.checkAdd(method, eventType) 如果之前没有存在过则返回true</li>
<li>判断@Subscribe标注中的threadMode对应的值，默认模式ThreadMode.POSTING</li>
<li>创建一个SubscriberMethod对象，该对象很简单就是保存有方法、方法参数类型、线程模式、订阅的优先级、sticky标志位。与Retrofit类似只是这里创建了一个SubscriberMethod对象。并将该对象添加到FindSate的List<subscribermethod>集合中。</subscribermethod></li>
</ol>
<p>回到注册方法，来看一下subscribe方法的实现</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">subscribe</span><span class="params">(Object subscriber, SubscriberMethod subscriberMethod)</span> </span>&#123;  </div><div class="line">        Class&lt;?&gt; eventType = subscriberMethod.eventType; <span class="comment">//note1  </span></div><div class="line">        Subscription newSubscription = <span class="keyword">new</span> Subscription(subscriber, subscriberMethod); <span class="comment">//note2  </span></div><div class="line">  </div><div class="line">        CopyOnWriteArrayList&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType); <span class="comment">//note3  </span></div><div class="line">        <span class="keyword">if</span> (subscriptions == <span class="keyword">null</span>) &#123;  </div><div class="line">            subscriptions = <span class="keyword">new</span> CopyOnWriteArrayList&lt;&gt;();  </div><div class="line">            subscriptionsByEventType.put(eventType, subscriptions);  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            <span class="keyword">if</span> (subscriptions.contains(newSubscription)) &#123;  </div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Subscriber "</span> + subscriber.getClass() + <span class="string">" already registered to event "</span> + eventType);   </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">int</span> size = subscriptions.size(); <span class="comment">//note4  </span></div><div class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= size; i++) &#123;  </div><div class="line">            <span class="keyword">if</span> (i == size || subscriberMethod.priority &gt; subscriptions.get(i).subscriberMethod.priority) &#123;  </div><div class="line">                subscriptions.add(i, newSubscription);  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">  </div><div class="line">        List&lt;Class&lt;?&gt;&gt; subscribedEvents = typesBySubscriber.get(subscriber); <span class="comment">//note5  </span></div><div class="line">        <span class="keyword">if</span> (subscribedEvents == <span class="keyword">null</span>) &#123;  </div><div class="line">            subscribedEvents = <span class="keyword">new</span> ArrayList&lt;&gt;();  </div><div class="line">            typesBySubscriber.put(subscriber, subscribedEvents);  </div><div class="line">        &#125;  </div><div class="line">        subscribedEvents.add(eventType);  </div><div class="line">  </div><div class="line">        <span class="keyword">if</span> (subscriberMethod.sticky) &#123; <span class="comment">//note6  </span></div><div class="line">            <span class="keyword">if</span> (eventInheritance) &#123;  </div><div class="line">                Set&lt;Map.Entry&lt;Class&lt;?&gt;, Object&gt;&gt; entries = stickyEvents.entrySet();  </div><div class="line">                <span class="keyword">for</span> (Map.Entry&lt;Class&lt;?&gt;, Object&gt; entry : entries) &#123;  </div><div class="line">                    Class&lt;?&gt; candidateEventType = entry.getKey();  </div><div class="line">                    <span class="keyword">if</span> (eventType.isAssignableFrom(candidateEventType)) &#123; <span class="comment">//从stickyEvents获取对应的事件交给当前事件订阅者处理  </span></div><div class="line">                        Object stickyEvent = entry.getValue();  </div><div class="line">                        checkPostStickyEventToSubscription(newSubscription, stickyEvent); <span class="comment">//该方法底层还是会执行postToSubscription方法  </span></div><div class="line">                    &#125;  </div><div class="line">                &#125;  </div><div class="line">            &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                Object stickyEvent = stickyEvents.get(eventType);  </div><div class="line">                checkPostStickyEventToSubscription(newSubscription, stickyEvent);  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>获取方法参数类型；注意：使用@Subscribe标注的方法有且仅有一个参数</li>
<li>利用订阅者对象及其事件处理方法构建一个Subscription对象，该对象存储有Object、SubscriberMethod对象</li>
<li>从subscriptionsByEventType集合中获取当前事件对应的Subscription对象集合; 如果得到的集合为空则创建一个这样的集合，并将刚创建的Subscription对象添加进subscriptionsByEventType集合中；如果得到的集合不为空且刚创建的Subscription对象已经存在该集合中则抛出异常，即同一个对象不能注册两次！</li>
<li>将第二步创建的Subscription对象按照优先级存入Subscription对象集合中，该集合中的元素都是按照优先级从高到低存放.</li>
<li>以subscriber对象为键，从typesBySubscriber获取该对象对应的接收事件类型集合，没有则创建一个这样的集合，然后当前事件类型添加到该集合中，最后将整个集合添加进typesBySubscriber集合中；有则直接添加到接收事件类型集合中；</li>
<li>该值默认为false，除非在注册事件方法时使用了如下的标注@Subscribe(sticky = true)；那么就会执行到这里。stickyEvent也是EventBus3.0的一大特点，该类事件一旦发送给EventBus，那么EventBus就会将它存入Map<class<?>, Object&gt; stickyEvents集合中，key事件类型，value事件实例；每个类型事件对应最新的实例。当订阅对象的某个事件处理方法使用了@Subscribe(sticky = true)标注，EventBus一旦对订阅者完成了注册任务之后，立即将stickyEvents集合中的匹配事件发送给该事件处理进行处理！</class<?></li>
</ol>
<p>接下来看post方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">post</span><span class="params">(Object event)</span> </span>&#123;  </div><div class="line">        PostingThreadState postingState = currentPostingThreadState.get(); <span class="comment">//note1  </span></div><div class="line">        List&lt;Object&gt; eventQueue = postingState.eventQueue;   </div><div class="line">        eventQueue.add(event); <span class="comment">//note2  </span></div><div class="line">        <span class="keyword">if</span> (!postingState.isPosting) &#123;   </div><div class="line">            postingState.isMainThread = Looper.getMainLooper() == Looper.myLooper();  </div><div class="line">            postingState.isPosting = <span class="keyword">true</span>;  </div><div class="line">            <span class="keyword">if</span> (postingState.canceled) &#123; <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Internal error. Abort state was not reset"</span>); &#125;  </div><div class="line">            <span class="keyword">try</span> &#123;  </div><div class="line">                <span class="keyword">while</span> (!eventQueue.isEmpty()) &#123;  </div><div class="line">                    postSingleEvent(eventQueue.remove(<span class="number">0</span>), postingState);<span class="comment">//note3  </span></div><div class="line">                &#125;  </div><div class="line">            &#125; <span class="keyword">finally</span> &#123;  </div><div class="line">                postingState.isPosting = <span class="keyword">false</span>;  </div><div class="line">                postingState.isMainThread = <span class="keyword">false</span>;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>获取当前线程对应的一个PostingThreadState()对象；回顾一下我们在EventBus中创建的如下域</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">private</span> <span class="keyword">final</span> ThreadLocal&lt;PostingThreadState&gt; currentPostingThreadState = <span class="keyword">new</span> ThreadLocal&lt;PostingThreadState&gt;() &#123;    </div><div class="line">        <span class="meta">@Override</span>  <span class="function"><span class="keyword">protected</span> PostingThreadState <span class="title">initialValue</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> <span class="keyword">new</span> PostingThreadState(); &#125; <span class="comment">//当前推送线程状态   </span></div><div class="line">&#125;;</div></pre></td></tr></table></figure>
<p>ThreadLocal类型的特点是当调用currentPostingThreadState.get()方法的时候，会返回当前线程所持有的一个 PostingThreadState对象；在不同的线程中执行同样一行代码它们得到的对象是不同的。PostingThreadState也很简单，就是定义了一堆数据，没有任何方法。下面就是它的所有源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">final</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">PostingThreadState</span> </span>&#123;  </div><div class="line">        <span class="keyword">final</span> List&lt;Object&gt; eventQueue = <span class="keyword">new</span> ArrayList&lt;Object&gt;(); <span class="comment">//待派送的事件队列  </span></div><div class="line">        <span class="keyword">boolean</span> isPosting; <span class="comment">//当前PostingThreadState对象是否正在派送事件的标志位  </span></div><div class="line">        <span class="keyword">boolean</span> isMainThread; <span class="comment">//当前PostingThreadState对象是否是工作在UI线程的标志位  </span></div><div class="line">        Subscription subscription; <span class="comment">//事件处理器  </span></div><div class="line">        Object event; <span class="comment">//待处理事件  </span></div><div class="line">        <span class="keyword">boolean</span> canceled; <span class="comment">//是否取消事件派送的标志位  </span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>向PostingThreadState的事件队列中添加一个事件</li>
<li>从PostingThreadState的事件队列——eventQueue中移出一个事件，并调用postSingleEvent方法进行派送</li>
</ol>
<p>postSingleEvent方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postSingleEvent</span><span class="params">(Object event, PostingThreadState postingState)</span> <span class="keyword">throws</span> Error </span>&#123;  </div><div class="line">        Class&lt;?&gt; eventClass = event.getClass();  </div><div class="line">        <span class="keyword">boolean</span> subscriptionFound = <span class="keyword">false</span>;  </div><div class="line">        <span class="keyword">if</span> (eventInheritance) &#123;   </div><div class="line">            List&lt;Class&lt;?&gt;&gt; eventTypes = lookupAllEventTypes(eventClass); <span class="comment">//note2  </span></div><div class="line">            <span class="keyword">int</span> countTypes = eventTypes.size();  </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">0</span>; h &lt; countTypes; h++) &#123; <span class="comment">//note3  </span></div><div class="line">                Class&lt;?&gt; clazz = eventTypes.get(h);  </div><div class="line">                subscriptionFound |= postSingleEventForEventType(event, postingState, clazz);  </div><div class="line">            &#125;  </div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            subscriptionFound = postSingleEventForEventType(event, postingState, eventClass);  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">if</span> (!subscriptionFound) &#123; <span class="comment">//note4  </span></div><div class="line">            <span class="keyword">if</span> (logNoSubscriberMessages) &#123;  </div><div class="line">                Log.d(TAG, <span class="string">"No subscribers registered for event "</span> + eventClass);  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">if</span> (sendNoSubscriberEvent &amp;&amp; eventClass != NoSubscriberEvent.class &amp;&amp;eventClass != SubscriberExceptionEvent.class) &#123;  </div><div class="line">                post(<span class="keyword">new</span> NoSubscriberEvent(<span class="keyword">this</span>, event));  </div><div class="line">            &#125;  </div><div class="line">        &#125;</div></pre></td></tr></table></figure>
<ol>
<li>eventInheritance该标志位默认为true，表示只要 满足订阅事件是该事件的父类或者实现了该事件同样接口或接口父类 中的任何一个条件的订阅者都会来处理该事件。</li>
<li>该方法从名字来看就是获取eventClass的所有父类往上都能追溯到Object、和所有实现的接口、以及接口父类；EventBus进行了优化采用了缓存机制Map<class<?>, List<class<?>&gt;&gt; eventTypesCache。</class<?></class<?></li>
<li>将eventClass所有的关联类都通过postSingleEventForEventType进行推送；下面跟着就会分析该方法</li>
<li>如果该事件没有推送成功，即没有事件处理器来处理这类事件；系统会尝试发送一个post(new NoSubscriberEvent(this, event))事件</li>
</ol>
<p>postSingleEventForEventType方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">boolean</span> <span class="title">postSingleEventForEventType</span><span class="params">(Object event, PostingThreadState postingState, Class&lt;?&gt; eventClass)</span> </span>&#123;  </div><div class="line">        <span class="comment">//第一个是带处理的原始事件，第三个参数是原始事件的关联类  </span></div><div class="line">        CopyOnWriteArrayList&lt;Subscription&gt; subscriptions;  </div><div class="line">        <span class="keyword">synchronized</span> (<span class="keyword">this</span>) &#123;  </div><div class="line">            subscriptions = subscriptionsByEventType.get(eventClass);<span class="comment">//note1  </span></div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">if</span> (subscriptions != <span class="keyword">null</span> &amp;&amp; !subscriptions.isEmpty()) &#123;  </div><div class="line">            <span class="keyword">for</span> (Subscription subscription : subscriptions) &#123;  </div><div class="line">                postingState.event = event;  </div><div class="line">                postingState.subscription = subscription;  </div><div class="line">                <span class="keyword">boolean</span> aborted = <span class="keyword">false</span>;  </div><div class="line">                <span class="keyword">try</span> &#123;  </div><div class="line">                    postToSubscription(subscription, event, postingState.isMainThread); <span class="comment">//note2  </span></div><div class="line">                    aborted = postingState.canceled;  </div><div class="line">                &#125; <span class="keyword">finally</span> &#123;  </div><div class="line">                    postingState.event = <span class="keyword">null</span>;  </div><div class="line">                    postingState.subscription = <span class="keyword">null</span>;  </div><div class="line">                    postingState.canceled = <span class="keyword">false</span>;  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">if</span> (aborted) &#123;  </div><div class="line">                    <span class="keyword">break</span>;  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;  </div><div class="line">        &#125;  </div><div class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>获取原始事件的关联类对应的所有Subscription对象</li>
<li>将上述Subscription对象集合进行遍历，使用postToSubscription方法处理原始事件</li>
</ol>
<p>postToSubscription方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">postToSubscription</span><span class="params">(Subscription subscription, Object event, <span class="keyword">boolean</span> isMainThread)</span> </span>&#123;  </div><div class="line">        <span class="comment">//第一个参数是事件处理器、第二个参数是待处理事件、第三个为当前线程是否是UI线程的标志位  </span></div><div class="line">        <span class="keyword">switch</span> (subscription.subscriberMethod.threadMode) &#123;  </div><div class="line">            <span class="keyword">case</span> POSTING: <span class="comment">//note1  </span></div><div class="line">                invokeSubscriber(subscription, event);  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">case</span> MAIN: <span class="comment">//note2  </span></div><div class="line">                <span class="keyword">if</span> (isMainThread) &#123;  </div><div class="line">                    invokeSubscriber(subscription, event);  </div><div class="line">                &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                    mainThreadPoster.enqueue(subscription, event);  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">case</span> BACKGROUND: <span class="comment">//note3  </span></div><div class="line">                <span class="keyword">if</span> (isMainThread) &#123;  </div><div class="line">                    backgroundPoster.enqueue(subscription, event);  </div><div class="line">                &#125; <span class="keyword">else</span> &#123;  </div><div class="line">                    invokeSubscriber(subscription, event);  </div><div class="line">                &#125;  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">case</span> ASYNC: <span class="comment">//note4  </span></div><div class="line">                asyncPoster.enqueue(subscription, event);  </div><div class="line">                <span class="keyword">break</span>;  </div><div class="line">            <span class="keyword">default</span>:  </div><div class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(<span class="string">"Unknown thread mode: "</span> + subscription.subscriberMethod.threadMode);  </div><div class="line">        &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>POSTING直接在当前线程执行，调用invokeSubscriber方法</li>
<li>MAIN即UI线程执行：如果当前线程就是UI线程则直接调用invokeSubscriber方法，否则将任务交给mainThreadPoster——HandlerPoster(this, Looper.getMainLooper(), 10)对象异步执行，最终会调用invokeSubscriber(PendingPost pendingPost)方法；</li>
<li>BACKGROUND背景线程执行：其实就在非UI线程中执行，如果当前线程是非UI线程则直接调用invokeSubscriber方法，否则将任务交给backgroundPoster——BackgroundPoster(this)对象异步执行，最终会调用invokeSubscriber(PendingPost pendingPost)方法；</li>
<li>ASYNC：将任务交给 asyncPoster—— AsyncPoster(this)对象异步执行，最终会调用invokeSubscriber(PendingPost pendingPost)方法；</li>
<li>就是根据不同的Post模式，选择不同的方式反射执行方法。</li>
</ol>
<p>接下来看取消注册的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">unregister</span><span class="params">(Object subscriber)</span> </span>&#123;  </div><div class="line">        List&lt;Class&lt;?&gt;&gt; subscribedTypes = typesBySubscriber.get(subscriber);<span class="comment">//note1  </span></div><div class="line">        <span class="keyword">if</span> (subscribedTypes != <span class="keyword">null</span>) &#123;  </div><div class="line">            <span class="keyword">for</span> (Class&lt;?&gt; eventType : subscribedTypes) &#123;  </div><div class="line">                unsubscribeByEventType(subscriber, eventType); <span class="comment">//  </span></div><div class="line">            &#125;  </div><div class="line">            typesBySubscriber.remove(subscriber); <span class="comment">//note3  </span></div><div class="line">        &#125; <span class="keyword">else</span> &#123;  </div><div class="line">            Log.w(TAG, <span class="string">"Subscriber to unregister was not registered before: "</span> + subscriber.getClass());  </div><div class="line">        &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ol>
<li>从typesBySubscriber获取该对象接收的事件类型集合；</li>
<li>对得到的接收事件类型集合中的每个事件类型调用unsubscribeByEventType进行处理；跟着我们就分析该方法</li>
<li>该对象从typesBySubscriber集合中移除；</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">unsubscribeByEventType</span><span class="params">(Object subscriber, Class&lt;?&gt; eventType)</span> </span>&#123;  </div><div class="line">        List&lt;Subscription&gt; subscriptions = subscriptionsByEventType.get(eventType); <span class="comment">//note1  </span></div><div class="line">        <span class="keyword">if</span> (subscriptions != <span class="keyword">null</span>) &#123;  </div><div class="line">            <span class="keyword">int</span> size = subscriptions.size();  </div><div class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; size; i++) &#123;  </div><div class="line">                Subscription subscription = subscriptions.get(i);  </div><div class="line">                <span class="keyword">if</span> (subscription.subscriber == subscriber) &#123; <span class="comment">//note2  </span></div><div class="line">                    subscription.active = <span class="keyword">false</span>;  </div><div class="line">                    subscriptions.remove(i);  </div><div class="line">                    i--;  </div><div class="line">                    size--;  </div><div class="line">                &#125;  </div><div class="line">            &#125;  </div><div class="line">        &#125;  </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>1、从subscriptionsByEventType集合中获取该事件类型对应的Subscription集合<br>2、如果集合中的元素——Subscription的subscriber域等于目标subscriber，则将该Subscription从subscriptionsByEventType集合中移除出去；</p>
<pre><code>源码部分就讲解到这里
由于对注解不是很了解，所以在通过索引获取订阅方法的时候我也是一脸蒙逼，因为索引列表是在构造函数中生成的。但是addIndex从来没被调用过。我就很好奇索引列表是怎么来的，后面才明白是另外有方法来添加订阅者索引列表，下面我们来看一下如何使用索引。
</code></pre><h2 id="索引的好处"><a href="#索引的好处" class="headerlink" title="索引的好处"></a>索引的好处</h2><p>EventBus提供了一个扩展包 EventBusAnnotationProcessor 这个方法可以在编译的时候通过注解，自动生成订阅方法索引列表的类。由于是在编译阶段就执行的，这样做可以避免反射获取所需的耗时。缺点可能是会占用一小部分内存。</p>
<h2 id="如何使用索引"><a href="#如何使用索引" class="headerlink" title="如何使用索引"></a>如何使用索引</h2><p>使用索引需要在项目gradle下添加 </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">classpath <span class="string">'com.neenbedankt.gradle.plugins:android-apt:1.8'</span></div></pre></td></tr></table></figure>
<p>如下</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// Top-level build file where you can add configuration options common to all sub-projects/modules.</span></div><div class="line"></div><div class="line">buildscript &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">        mavenCentral()</div><div class="line">    &#125;</div><div class="line">    dependencies &#123;</div><div class="line">        classpath <span class="string">'com.android.tools.build:gradle:2.3.0'</span></div><div class="line"></div><div class="line">        classpath <span class="string">'com.neenbedankt.gradle.plugins:android-apt:1.8'</span></div><div class="line">        <span class="comment">// <span class="doctag">NOTE:</span> Do not place your application dependencies here; they belong</span></div><div class="line">        <span class="comment">// in the individual module build.gradle files</span></div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">allprojects &#123;</div><div class="line">    repositories &#123;</div><div class="line">        jcenter()</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function">task <span class="title">clean</span><span class="params">(type: Delete)</span> </span>&#123;</div><div class="line">    delete rootProject.buildDir</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>然后在app的gradle中添加<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="comment">//apply 需添加</span></div><div class="line">apply plugin: <span class="string">'com.neenbedankt.android-apt'</span></div><div class="line"><span class="comment">//android中需添加</span></div><div class="line">android &#123;</div><div class="line">	apt&#123;</div><div class="line">        arguments&#123;</div><div class="line">	        <span class="comment">//路径加类名，用来确定存放的位置，可以自己定义</span></div><div class="line">            eventBusIndex <span class="string">"org.greenrobot.eventbus.EventBusTestIndex"</span></div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"><span class="comment">//dependencies需添加</span></div><div class="line">dependencies &#123;</div><div class="line">    provided <span class="string">'org.greenrobot:eventbus-annotation-processor:3.0.1'</span></div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>其中eventBusIndex 是路径加类名，用来确定存放的位置，可以自己定义。<br>配置完之后先Rebuild一把<br><img src="http://img.blog.csdn.net/20170330145236125?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="这里写图片描述"><br>可以看到在debug目录下生成了这个EventBusTestIndex这个类。</p>
<p>类中方法如下<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> org.greenrobot.eventbus;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.meta.SimpleSubscriberInfo;</div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.meta.SubscriberMethodInfo;</div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.meta.SubscriberInfo;</div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.meta.SubscriberInfoIndex;</div><div class="line"></div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.ThreadMode;</div><div class="line"></div><div class="line"><span class="keyword">import</span> java.util.HashMap;</div><div class="line"><span class="keyword">import</span> java.util.Map;</div><div class="line"></div><div class="line"><span class="comment">/** This class is generated by EventBus, do not edit. */</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventBusTestIndex</span> <span class="keyword">implements</span> <span class="title">SubscriberInfoIndex</span> </span>&#123;</div><div class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;Class&lt;?&gt;, SubscriberInfo&gt; SUBSCRIBER_INDEX;</div><div class="line"></div><div class="line">    <span class="keyword">static</span> &#123;</div><div class="line">        SUBSCRIBER_INDEX = <span class="keyword">new</span> HashMap&lt;Class&lt;?&gt;, SubscriberInfo&gt;();</div><div class="line"></div><div class="line">        putIndex(<span class="keyword">new</span> SimpleSubscriberInfo(com.cncn.tourenforce.base.BaseFuncActivity.class, <span class="keyword">true</span>,</div><div class="line">                <span class="keyword">new</span> SubscriberMethodInfo[] &#123;</div><div class="line">            <span class="keyword">new</span> SubscriberMethodInfo(<span class="string">"logoutEvent"</span>, com.cncn.tourenforce.bean.event.LogoutEvent.class),</div><div class="line">        &#125;));</div><div class="line"></div><div class="line">        putIndex(<span class="keyword">new</span> SimpleSubscriberInfo(com.cncn.tourenforce.ui.mine.AboutActivity.class, <span class="keyword">true</span>,</div><div class="line">                <span class="keyword">new</span> SubscriberMethodInfo[] &#123;</div><div class="line">            <span class="keyword">new</span> SubscriberMethodInfo(<span class="string">"downLoadSuccess"</span>, com.cncn.tourenforce.bean.event.UpdateVersionEvent.class),</div><div class="line">        &#125;));</div><div class="line"></div><div class="line">        putIndex(<span class="keyword">new</span> SimpleSubscriberInfo(com.cncn.tourenforce.ui.check.CheckReasonEditActivity.class, <span class="keyword">true</span>,</div><div class="line">                <span class="keyword">new</span> SubscriberMethodInfo[] &#123;</div><div class="line">            <span class="keyword">new</span> SubscriberMethodInfo(<span class="string">"checkSuccess"</span>, com.cncn.tourenforce.bean.event.CheckSuccessEvent.class),</div><div class="line">        &#125;));</div><div class="line"></div><div class="line">        putIndex(<span class="keyword">new</span> SimpleSubscriberInfo(com.cncn.tourenforce.ui.check.SignListFragment.class, <span class="keyword">true</span>,</div><div class="line">                <span class="keyword">new</span> SubscriberMethodInfo[] &#123;</div><div class="line">            <span class="keyword">new</span> SubscriberMethodInfo(<span class="string">"resetList"</span>, com.cncn.tourenforce.bean.event.SignSelectResetEvent.class),</div><div class="line">        &#125;));</div><div class="line"></div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">putIndex</span><span class="params">(SubscriberInfo info)</span> </span>&#123;</div><div class="line">        SUBSCRIBER_INDEX.put(info.getSubscriberClass(), info);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> SubscriberInfo <span class="title">getSubscriberInfo</span><span class="params">(Class&lt;?&gt; subscriberClass)</span> </span>&#123;</div><div class="line">        SubscriberInfo info = SUBSCRIBER_INDEX.get(subscriberClass);</div><div class="line">        <span class="keyword">if</span> (info != <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="keyword">return</span> info;</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>就是一个静态的Map对象用来存放所有订阅方法字典。然后提供一个get方法用来获取这个字典中的对象。</p>
<p>然后就是使用了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">EventBus.builder().addIndex(subscriberClass -&gt; <span class="keyword">new</span> EventBusTestIndex().getSubscriberInfo(subscriberClass)).installDefaultEventBus();</div></pre></td></tr></table></figure>
<p>这边再贴一遍installDefaultEventBus这个方法的源码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line">   * Installs the default EventBus returned by &#123;<span class="doctag">@link</span> EventBus#getDefault()&#125; using this builders' values. Must be</div><div class="line">   * done only once before the first usage of the default EventBus.</div><div class="line">   *</div><div class="line">   * <span class="doctag">@throws</span> EventBusException if there's already a default EventBus instance in place</div><div class="line">   */</div><div class="line">  <span class="function"><span class="keyword">public</span> EventBus <span class="title">installDefaultEventBus</span><span class="params">()</span> </span>&#123;</div><div class="line">      <span class="keyword">synchronized</span> (EventBus.class) &#123;</div><div class="line">          <span class="keyword">if</span> (EventBus.defaultInstance != <span class="keyword">null</span>) &#123;</div><div class="line">              <span class="keyword">throw</span> <span class="keyword">new</span> EventBusException(<span class="string">"Default instance already exists."</span> +</div><div class="line">                      <span class="string">" It may be only set once before it's used the first time to ensure consistent behavior."</span>);</div><div class="line">          &#125;</div><div class="line">          EventBus.defaultInstance = build();</div><div class="line">          <span class="keyword">return</span> EventBus.defaultInstance;</div><div class="line">      &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>可以看出这个方法用来自定义一个EventBusBuider对象配置到EventBus中去，并替换掉defaultInstance。<br>注意：这里需要在Default EventBus 对象还没生成的时候执行这句话。如果已经有默认的EventBus对象存在了再installDefaultEventBus会报错的。</p>
<p>所以我们需要在APP启动的时候把这个方法加进去，新建一个App类继承Application</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">import</span> android.app.Application;</div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.EventBus;</div><div class="line"><span class="keyword">import</span> org.greenrobot.eventbus.EventBusTestIndex;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">App</span> <span class="keyword">extends</span> <span class="title">Application</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>.onCreate();</div><div class="line">        EventBus.builder().addIndex(subscriberClass -&gt; <span class="keyword">new</span> EventBusTestIndex().getSubscriberInfo(subscriberClass)).installDefaultEventBus();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>AndroidManifest中别忘了把Application改成当前App<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">application</span></span></div><div class="line">        <span class="attr">android:name</span>=<span class="string">".base.App"</span></div><div class="line">        <span class="attr">android:allowBackup</span>=<span class="string">"true"</span></div><div class="line">        <span class="attr">android:icon</span>=<span class="string">"@mipmap/ic_launcher"</span></div><div class="line">        <span class="attr">android:label</span>=<span class="string">"@string/app_name"</span></div><div class="line">        <span class="attr">android:theme</span>=<span class="string">"@style/CustomAppTheme"</span>&gt;</div><div class="line"><span class="tag">&lt;/<span class="name">application</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>之后的方法获取就都是通过索引获取了。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><pre><code>没有精确去分析所有的源码。这边大概做一下总结，整个流程大概如下。
1. 注册EventBus，EventBus会获取当前类中的订阅方法，包括方法的参数，类型，优先级等信息。在获取的方法中，经常会有缓存。如果在缓存中没有才去调用获取方法。获取订阅方法有两种方式，一种是反射，反射获取全部方法，找到加了@Subscribe注解并有一个参数的方法，另外一种是通过订阅方法索引来得到订阅方法。反射的效率较低，所以一般都是用订阅方法索引来获取，有些情况下找不到这个方法。它还是会走反射的途径。注册过后这个订阅方法就被存起来了。等待接受消息。（这边值得说一下在3.0以前是没有注解方法的那时候都是通过反射来获取和执行方法。而且方法必须以onEvent开头，分别为onEventMainThead,onEventBackground,onEvent,onEventAsync)
3. postEvent，会把这个Event加入消息队列，然后通过Event的类型信息来得到它的订阅方法，然后根据相应的订阅方式反射调用订阅方法。没有选择的Post一般都会在UI线程执行。如果当前post不是UI线程这边会用Handle的机制来让方法运行在UI线程。
4. 解除注册，将该对象从对象缓存列表中移除，获取当前对象的订阅列表，然后将其从订阅列表移除
</code></pre><p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/02/23/MeetMomeryLeak/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/23/MeetMomeryLeak/" itemprop="url">
                  初识内存泄露
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-23T16:02:22+08:00">
                2017-02-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android内存优化/" itemprop="url" rel="index">
                    <span itemprop="name">Android内存优化</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p><strong>什么是内存泄露</strong></p>
<blockquote>
<p>从java的垃圾回收机制说起吧。java比C++好的一点就是有自己的垃圾回收机制。在java虚拟机运行的过程中会把一些没有指向的对象(已知存活的对象节点无法遍历到的对象)回收。</p>
<p>如果一个对象不再被使用，理论上是要被回收的，但是因为它可能被某些存活的对象持有了。导致不能回收。这样的对象会一直占用着内存，直到持有它的对象销毁。而因为强占着内存，很容易导致内存溢出，即OOM。</p>
</blockquote>
<p><strong>为什么会发生内存泄露</strong><br>在Android程序开发中，当一个对象已经不需要再使用了，本该被回收时，而另外一个正在使用的对象持有它的引用从而导致它不能被回收，这就导致本该被回收的对象不能被回收而停留在堆内存中，内存泄漏就产生了。</p>
<p><strong>内存泄漏有什么影响</strong><br>它是造成应用程序OOM的主要原因之一。由于Android系统为每个应用程序分配的内存有限，当一个应用中产生的内存泄漏比较多时，就难免会导致应用所需要的内存超过这个系统分配的内存限额，这就造成了内存溢出而导致应用Crash。</p>
<p><strong>如何避免内存泄露</strong><br>简单地说应该在对象赋值时先看一下持有这个对象的类/变量的声明周期。<br>1.静态变量/对象<br>一些类似于广播啊，EventBus注册，监听事件的注册，因为这些的生命周期都是比Activity长的。所以在activity销毁的时候要取消注册。</p>
<p>今天遇到的一个内存泄露的问题就是因为注册了OrientationEventListener ，在onDestory的时候没有取消监听。当前的context一直都没办法释放掉。打开一次页面5M。一二十次就OOM了。<br>解决方案：在页面销毁的时候记得取消监听。</p>
<p>另外一个内存泄露的问题是webView，webView在activity销毁的时候同样要解除引用，并做销毁。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">   protected void onDestroy() &#123;</div><div class="line">       if (baseWebView != null) &#123;</div><div class="line">           ((ViewGroup) baseWebView.getParent()).removeView(baseWebView);</div><div class="line">           baseWebView.destroy();</div><div class="line">       &#125;</div><div class="line">       super.onDestroy();</div><div class="line">   &#125;</div></pre></td></tr></table></figure></p>
<p>2.非静态内部类（非静态内部类持有当前类的引用）</p>
<p>经常在类里面定义非静态内部类，因为非静态内部类会持有当前类的引用。所以在非静态内部类的工作未结束的时候当前类也不会被回收。<br>例如我们很经常在类里面自定义个Handler 或者Thread。<br>解决方案：用静态内部类来替换。<br>3.图片处理<br>图片处理的过程中不用的图片及时销毁。不然即使没有泄露，因为图片对象一样会OOM的。<br><strong>一、单例造成的内存泄漏</strong><br>如下这个典例：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class AppManager &#123;</div><div class="line">    private static AppManager instance;</div><div class="line">    private Context context;</div><div class="line">    private AppManager(Context context) &#123;</div><div class="line">        this.context = context;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static AppManager getInstance(Context context) &#123;</div><div class="line">        if (instance != null) &#123;</div><div class="line">            instance = new AppManager(context);</div><div class="line">        &#125;</div><div class="line">        return instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这是一个普通的单例模式，当创建这个单例的时候，由于需要传入一个Context，所以这个Context的生命周期的长短至关重要：</p>
<p>1、传入的是Application的Context：这将没有任何问题，因为单例的生命周期和Application的一样长 ;</p>
<p>2、传入的是Activity的Context：当这个Context所对应的Activity退出时，由于该Context和Activity的生命周期一样长(Activity间接继承于Context)，所以当前Activity退出时它的内存并不会被回收，因为单例对象持有该Activity的对象，单例应该修改为下面这种方式：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">public class AppManager &#123;</div><div class="line">    private static AppManager instance;</div><div class="line">    private Context context;</div><div class="line">    private AppManager(Context context) &#123;</div><div class="line">        this.context = context.getApplicationContext();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public static AppManager getInstance(Context context) &#123;</div><div class="line">        if (instance != null) &#123;</div><div class="line">            instance = new AppManager(context);</div><div class="line">        &#125;</div><div class="line">        return instance;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样子持有的是应用的context，就不用担心生命周期比APP还长了。<br>Android的单例模式非常受开发者的喜爱，不过使用的不恰当的话也会造成内存泄漏。因为单例的静态特性使得单例的生命周期和应用的生命周期一样长，这就说明了如果一个对象已经不需要使用了，而单例对象还持有该对象的引用，那么这个对象将不能被正常回收，这就导致了内存泄漏。</p>
<p><strong>二、非静态内部类创建静态实例造成的内存泄漏</strong></p>
<p>有的时候我们可能会在启动频繁的Activity中，为了避免重复创建相同的数据资源，会出现这种写法：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    private static TestResource mResource = null;</div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        if(mManager == null)&#123;</div><div class="line">            mManager = new TestResource();</div><div class="line">        &#125;</div><div class="line">        //...</div><div class="line">    &#125;</div><div class="line">    class TestResource &#123;</div><div class="line">        //...</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这样就在Activity内部创建了一个非静态内部类的单例，每次启动Activity时都会使用该单例的数据，这样虽然避免了资源的重复创建，不过这种写法却会造成内存泄漏，因为非静态内部类默认会持有外部类的引用，而又使用了该非静态内部类创建了一个静态的实例，该实例的生命周期和应用的一样长，这就导致了该静态实例一直会持有该Activity的引用，导致Activity的内存资源不能正常回收。正确的做法为：</p>
<p>将该内部类设为静态内部类或将该内部类抽取出来封装成一个单例，如果需要使用Context，请使用ApplicationContext 。</p>
<p><strong>三、Handler造成的内存泄漏</strong></p>
<p>Handler的使用造成的内存泄漏问题应该说最为常见了，平时在处理网络任务或者封装一些请求回调等api都应该会借助Handler来处理，对于Handler的使用代码编写一不规范即有可能造成内存泄漏，如下示例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line"></div><div class="line">    private Handler mHandler = new Handler() &#123;</div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            //...</div><div class="line">        &#125;</div><div class="line">    &#125;;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        loadData();</div><div class="line">    &#125;</div><div class="line">    private void loadData()&#123;</div><div class="line">        //...request</div><div class="line">        Message message = Message.obtain();</div><div class="line">        mHandler.sendMessage(message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这种创建Handler的方式会造成内存泄漏，由于mHandler是Handler的非静态匿名内部类的实例，所以它持有外部类Activity的引用，我们知道消息队列是在一个Looper线程中不断轮询处理消息，那么当这个Activity退出时消息队列中还有未处理的消息或者正在处理消息，而消息队列中的Message持有mHandler实例的引用，mHandler又持有Activity的引用，所以导致该Activity的内存资源无法及时回收，引发内存泄漏，所以另外一种做法为：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line">public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    private MyHandler mHandler = new MyHandler(this);</div><div class="line">    private TextView mTextView ;</div><div class="line">    private static class MyHandler extends Handler &#123;</div><div class="line">        private WeakReference&lt;Context&gt; reference;</div><div class="line">        public MyHandler(Context context) &#123;</div><div class="line">            reference = new WeakReference&lt;&gt;(context);</div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            MainActivity activity = (MainActivity) reference.get();</div><div class="line">            if(activity != null)&#123;</div><div class="line">                activity.mTextView.setText(&quot;&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">  </div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mTextView = (TextView)findViewById(R.id.textview);</div><div class="line">        loadData();</div><div class="line">    &#125;</div><div class="line">  </div><div class="line">    private void loadData() &#123;</div><div class="line">        //...request</div><div class="line">        Message message = Message.obtain();</div><div class="line">        mHandler.sendMessage(message);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>创建一个静态Handler内部类，然后对Handler持有的对象使用弱引用，这样在回收时也可以回收Handler持有的对象，这样虽然避免了Activity泄漏，不过Looper线程的消息队列中还是可能会有待处理的消息，所以我们在Activity的Destroy时或者Stop时应该移除消息队列中的消息，更准确的做法如下：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div></pre></td><td class="code"><pre><div class="line"> public class MainActivity extends AppCompatActivity &#123;</div><div class="line">    private MyHandler mHandler = new MyHandler(this);</div><div class="line">    private TextView mTextView ;</div><div class="line">    private static class MyHandler extends Handler &#123;</div><div class="line">        private WeakReference&lt;Context&gt; reference;</div><div class="line">        public MyHandler(Context context) &#123;</div><div class="line">            reference = new WeakReference&lt;&gt;(context);</div><div class="line">        &#125;</div><div class="line">        @Override</div><div class="line">        public void handleMessage(Message msg) &#123;</div><div class="line">            MainActivity activity = (MainActivity) reference.get();</div><div class="line">            if(activity != null)&#123;</div><div class="line">                activity.mTextView.setText(&quot;&quot;);</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onCreate(Bundle savedInstanceState) &#123;</div><div class="line">        super.onCreate(savedInstanceState);</div><div class="line">        setContentView(R.layout.activity_main);</div><div class="line">        mTextView = (TextView)findViewById(R.id.textview);</div><div class="line">        loadData();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    private void loadData() &#123;</div><div class="line">        //...request</div><div class="line">        Message message = Message.obtain();</div><div class="line">        mHandler.sendMessage(message);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    @Override</div><div class="line">    protected void onDestroy() &#123;</div><div class="line">        super.onDestroy();</div><div class="line">        mHandler.removeCallbacksAndMessages(null);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用mHandler.removeCallbacksAndMessages(null);是移除消息队列中所有消息和所有的Runnable。当然也可以使用 mHandler.removeCallbacks();或mHandler.removeMessages()；来移除指定的Runnable和Message。<br> <strong>四、线程造成的内存泄漏</strong><br>对于线程造成的内存泄漏，也是平时比较常见的，如下这两个示例可能每个人都这样写过：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">//——————test1 </div><div class="line">       new AsyncTask&lt;Void, Void, Void&gt;() &#123;</div><div class="line">        @Override</div><div class="line">        protected Void doInBackground(Void... params) &#123;</div><div class="line">            SystemClock.sleep(10000);</div><div class="line">            return null;</div><div class="line">        &#125;</div><div class="line">    &#125;.execute();</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">//——————test2 </div><div class="line">new Thread(new Runnable() &#123;             </div><div class="line">    @Override             </div><div class="line">    public void run() &#123;</div><div class="line">    SystemClock.sleep(10000);             </div><div class="line">    &#125;         </div><div class="line">&#125;).start();</div></pre></td></tr></table></figure>
<p>上面的异步任务和Runnable都是一个匿名内部类，因此它们对当前Activity都有一个隐式引用。如果Activity在销毁之前，任务还未完成， 那么将导致Activity的内存资源无法回收，造成内存泄漏。正确的做法还是使用静态内部类的方式，如下： </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">static class MyAsyncTask extends AsyncTask&lt;Void, Void, Void&gt; &#123;</div><div class="line">        private WeakReference&lt;Context&gt; weakReference;</div><div class="line">        public MyAsyncTask(Context context) &#123;</div><div class="line">            weakReference = new WeakReference&lt;&gt;(context);</div><div class="line"></div><div class="line">        &#125;</div><div class="line"></div><div class="line">        @Override</div><div class="line">        protected Void doInBackground(Void... params) &#123;</div><div class="line">            SystemClock.sleep(10000);</div><div class="line">            return null;</div><div class="line">        &#125;</div><div class="line">        @Override</div><div class="line">        protected void onPostExecute(Void aVoid) &#123;</div><div class="line">            super.onPostExecute(aVoid);</div><div class="line">            MainActivity activity = (MainActivity) weakReference.get();</div><div class="line">            if (activity != null) &#123;</div><div class="line">                //...</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    static class MyRunnable implements Runnable&#123;</div><div class="line">        @Override</div><div class="line">        public void run() &#123;</div><div class="line">            SystemClock.sleep(10000);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">//——————</div><div class="line">    new Thread(new MyRunnable()).start();</div><div class="line">    new MyAsyncTask(this).execute();</div></pre></td></tr></table></figure>
<p>这样就避免了Activity的内存资源泄漏，当然在Activity销毁时候也应该取消相应的任务AsyncTask::cancel()，避免任务在后台执行浪费资源。 </p>
<p><strong>五、资源未关闭造成的内存泄漏</strong> </p>
<p>对于使用了BraodcastReceiver，ContentObserver，File，Cursor，Stream，Bitmap等资源的使用，应该在Activity销毁时及时关闭或者注销，否则这些资源将不会被回收，造成内存泄漏。 </p>
<p><strong>如何判断是否内存泄露</strong></p>
<p>在Android Studio的Monitor里面可以看到当前应用CPU,内存和网络还有GPU的使用情况<br><img src="http://img.blog.csdn.net/20170223160821232?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="内存管理"><br>这里只说activity层面上的。<br>观察当前activity内存占用，在启动一个activity之后可以看到内存明显上升。因为activity创建时同时会生成很多对象实例。关闭掉当前activity点击<img src="http://img.blog.csdn.net/20170223161249733?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="GC"><br>可以看到内存又回复到之前差不多的状态。说明activity没有内存泄露的情况。有的话可能也不是什么严重的事情。<br>如果可以看到内存没减少或者内存基本没减少。</p>
<p><img src="http://img.blog.csdn.net/20170223161746001?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="GC2"><br>可以点击内存回收按钮右边的两个小按钮进行分析，现在使用左边的<br><img src="http://img.blog.csdn.net/20170223162018550?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="分析"><br>扩展出Analyzer Task 然后点击运行按钮可以看到重复的String值和泄露的Activity。<br>点击泄露的Activity<img src="http://img.blog.csdn.net/20170223162229172?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="ss"><br>可以看到Reference Tree 里面有当前activity的信息。一般第一条就是内存泄露的原因。<br>然后根据以上经验可以分析哪里出问题了。一看OreentationEventListener就知道是监听这边出问题了。。好吧，没有取消监听。在onDestory中加上。完美解决。</p>
<p>希望大家能有所收获，并能重视内存优化的问题，希望所有的app都没有OOM，没有ANR流畅不卡顿。^_^~~</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/02/19/AnnualSummary 2016/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/02/19/AnnualSummary 2016/" itemprop="url">
                  2016年总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-02-19T15:19:37+08:00">
                2017-02-19
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/阶段性总结/" itemprop="url" rel="index">
                    <span itemprop="name">阶段性总结</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="闲谈"><a href="#闲谈" class="headerlink" title="闲谈"></a>闲谈</h3><hr>
<p>已经毕业快一年了，少了很多刚出来那种激情了，感觉在公司呆久了也开始老油条了。嘻嘻！！<br>开始觉得目前的工作很无趣！<br>经常都是开始一个项目然后框架搭一搭赋值粘贴，一周个把月就是一个项目。<br><img src="http://img.blog.csdn.net/20170219135954610?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="一把梭！！"><br>在这里记录一下在公司这一年的收获吧。<br>首先，刚进公司的时候。虽然之前也有在另一家公司实习过。但是来了这一家公司明显感觉到了两家公司的不一样。可能目前待的公司算是厦门比较大的公司。也可能是因为目前公司搭建整个开发框架的那个小兄弟技术确实牛逼。刚进来就被这家公司的技术框架吸引了。从六月份开始，到现在用这个框架陆陆续续开发了五六个项目。一般都是半个月到一个月 最长的项目应该有两个多月。</p>
<h3 id="框架对比"><a href="#框架对比" class="headerlink" title="框架对比"></a>框架对比</h3><p>在这边上一下两家公司框架对比<br>|    框架名称        |    新公司        |    原公司    |<br>|—————|—————|————-|<br>|    网络请求        |Retrofit+RxJava+OkHttp    |Volley+OkHttp|<br>|    本地数据存储|    SQLlite+SharePreference(封装的较好)|SQLlite+SharePreference|<br>|数据解析|Gson+Retrofit(这边是Retrofit自带的一个Gson类，可以用注解的形式来绑定对象值)|    请求完毕后用Gson做解析，自己封装的库，好像添加了泛型实现，但总的来讲比较复杂        |<br>|    布局工具        |        AutoLayout（zhy的自动布局工具不得不说真的好用）        |    没有使用自动布局工具        |<br>|    Log工具        |        Logger（这个开源的log库感觉还蛮好用的一目了然）        |    DebugUtil    |<br>|    框架模式        |        MVP        |    无（数据绑定跟请求放一起了。这样在页面中存在了很多回调代码，感觉看起来很混乱。而且耦合度高。）    |<br>|    代码支持         |        Lambda        |    无（Lambda纯粹是用来简化代码的，但是不适合阅读）    |<br>|    事件总线        |        EventBus(也是基于handle机制开发的蛮好用的，值得一试。)        |Broadcast|<br>|    列表布局        |        RecycleView（封装）        |    ListView,GridView（封装）        |<br>|其他|支持高版本沉浸式，代码简洁。|不得不说实习的那一家公司各种工具类写的满满的，但是很多工具类其实都没有重用到。因为大家都不知道有那个类。所以在维护的时候就出现很多冗余的代码。|</p>
<p>贴一下使用到的框架。鸿洋的autolayout可以直接compile下来使用具体可以去找找他的github项目 ptr没怎么研究。就一个带ptrheadr的容器。其他的没什么。<br><figure class="highlight gradle"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">   <span class="comment">//控件</span></div><div class="line">   <span class="keyword">compile</span> <span class="keyword">project</span>(<span class="string">':autolayout'</span>)</div><div class="line">   <span class="comment">// Rx</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'io.reactivex:rxjava:1.1.1'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'io.reactivex:rxandroid:1.1.0'</span></div><div class="line">   <span class="comment">// Retrofit网络请求</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:retrofit:2.1.0'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:converter-gson:2.1.0'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.squareup.retrofit2:adapter-rxjava:2.1.0'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.google.code.gson:gson:2.6.1'</span></div><div class="line">   <span class="comment">//ptr</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'in.srain.cube:ultra-ptr:1.0.11'</span></div><div class="line">   <span class="comment">//glide</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.github.bumptech.glide:glide:3.7.0'</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'jp.wasabeef:glide-transformations:2.0.1'</span></div><div class="line">   <span class="comment">//eventpost</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'org.greenrobot:eventbus:3.0.0'</span></div><div class="line">   <span class="comment">//okhttp</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.squareup.okhttp3:logging-interceptor:3.4.1'</span></div><div class="line">   <span class="comment">//log</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.orhanobut:logger:1.15'</span></div><div class="line"><span class="comment">//二维码</span></div><div class="line">   <span class="keyword">compile</span> <span class="string">'com.google.zxing:core:3.3.0'</span></div></pre></td></tr></table></figure></p>
<p>去上一家公司打了三个月的酱油，就写过一个模块的代码。还有一些bug的修改。当然后面问题也都是解决掉了。自己用上一家公司的框架也写过几个小项目。<br>新公司进来，从学习代码规范（上一家公司也有自己的代码规范，不过没有真正学好，因为写的代码不多），然后熟悉框架，差不多一周。之后就开始各种项目。做项目当然开心啦。旁边有同事不懂可以问。平常就各种把框架里面的一个个控件熟悉过来。那段时间刚进来。觉得每天都收获满满。一直加班~（那时候一直在想以我那时候的成长速度，一年后应该就屌炸天了。）不过现在已经是半年多了。事实并没有吊炸天。当然自身的成长还是不少的。这里也讲一下没有吊炸天的原因，因为在一家公司能学到的东西是有限的。</p>
<h3 id="自我反思"><a href="#自我反思" class="headerlink" title="自我反思"></a>自我反思</h3><p>在这家公司我做的项目没有一个项目上线有后续维护的。所有的都是一次做完，下一个项目接踵而至。从一开始做每一个功能都很新奇，到最后写个功能都能闭上眼睛复制粘贴。。我就觉得框架已经差不多了。如果要得到新知识只能自己去学。那个时候开始思考在普通公司工作跟在大公司工作的区别。很多小公司的项目用户其实并不多。只要能做到满足这几个用户的需求就可以了。所以对于性能，甚至效率。还有大部分用户体验的细节上都没有很用心。这个可以去看看腾讯微信的研磨就知道了。人家可是从心理学，行为学的角度来做用户体验的。所以呢？在非大公司的环境下所做的工作永远都是复制粘贴。我不禁想到十几年后我已经不够资格当一个程序员了。但是还是在做这些复制粘贴的工作领着死不能涨的工资。默默流下了悔恨的泪水。</p>
<p>嗯哼，上面的话语其实也讲明了选择一家大公司的重要性。大公司所做的项目都是为用户而来。他们要做的不只是不只是开发一个项目，更有从代码扩展，性能优化，还有单元测试，内存优化。这几个角度来使一个app趋于完美。感觉在那样的环境下生活的程序员才能叫真正的程序员吧。而我们永远走在程序和伪程序，有机会一定要去大公司！！！！！</p>
<p>好了。下一段。</p>
<h3 id="面试与总结"><a href="#面试与总结" class="headerlink" title="面试与总结"></a>面试与总结</h3><p>讲一下上周五去某个上市公司的面试经历</p>
<p>大概是酱的，之前想去一些大一点的公司继续深入学习更多的知识。然后就抽出手来投了几家公司。。当然这些公司招的职位都是高级职位。可能觉得初级职位太low了。作为一个一年开发经验的我。对于这种高级职位，感觉压力山大…投完之后感觉很后悔，为何不先选几个小公司去面几场先增加一下经验。好吧，过了一周，果不其然都被筛掉了。 又过了几天突然其中一家公司打电话过来约我去面试。可以看出我当时的表情= =~卧槽！！卧槽！！！走上人生巅峰的机会。当然那几天工作一直很忙，因为有一个项目进度很赶。所以我就多加了一会班。赶了一下进度，然后请了一天假去面试。。</p>
<p>面试过程大概如下：<br>一面：技术主管面试 二面：总监面试 一面和二面之间因为有一段时间是在等总监。所以顺便跟HR聊了一会。<br>跟主管聊的时候其实聊的还可以（当时感觉），可能他人也蛮不错的。他应该是做图像处理那一块的。所以跟我日常的工作经验还是有差距的。主要就聊了一下Handle，内存优化，OOM，自定义控件，三级缓存等。自己也回答了一些大概，当然一些深入的东西他也没去细究。包括面完我发现我居然忽略掉他的一些问题了。。好吧聊的还算开心。顺便问了他几个笔试题目。。感觉他脑子动的还是蛮快的。在这期间跟HR聊了一会。这里就聊的稍微有点瑕疵了。当然还是聊的蛮开心的。<br>加下来就是总监面了。那时候精神状态特别差。有好几个明明懂的问题。直接就说不懂了。然后各种答不对题。但他也算蛮有耐心的。我很多地方都没有说好，但总监就比较有气场一些。他也没说我讲的对不对，也不指正我的错误。有没答上的点就要求我补充，没说什么点，直接问有什么要补充的吗….真是日了狗。。然后越到后面脑子越乱。。后面问我有什么问题的时候我也没答好，问了一个问题后，直接跟他讲没问题了。。</p>
<p>在这边做一下面试总结。其实面试官的所有题目都是为开发岗位所必须具备的技能提的。包括一些逻辑题目还有java基础题目。当然很多题目他在我做完之后又问了我一次，这个可能就是答的并不符合他的要求。认真讲的话那天有几个点没把握住。<br>1.在面试的场合一定不要紧张。不然会忘掉很多东西。<br>2.如果他们又提问了卷子上的问题。说明有一部分问题还没有回答到点上。这个时候可以对自己所知道的在做进一步扩展。如果实在回答不对，就问一下到底是什么点。<br>3.职业生涯这一块最好对自己这几年的规划，比如说走技术路，以后可能会做架构这一方面的。比如说，先走技术路，之后可能会转管理这一块。<br>3.一般在结尾的时候他们会问你有没有什么问题想知道的。这个是三个面试官都有问我的。这个时候应该做出的回答可以是之前他们问你而你没有答上来的问题。也可以问一下如果进入公司负责的项目。或者公司对这方面技术的人有什么需求，自己有哪一些点没有做好。<br>4.在面试前请做好心理准备，有充足的精力来面对面试。</p>
<p><strong><em>By xiaolong：You have a dream,you got to protect it!</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/01/18/HotFix/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/01/18/HotFix/" itemprop="url">
                  阿里百川HotFix的使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-01-18T16:52:57+08:00">
                2017-01-18
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android第三方/" itemprop="url" rel="index">
                    <span itemprop="name">Android第三方</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="热修复技术前景分析"><a href="#热修复技术前景分析" class="headerlink" title="热修复技术前景分析"></a>热修复技术前景分析</h3><p>近两年来，热修复技术在安卓开发圈儿成为焦点。随之而来的是，相关的解决方案也不断涌现。为此，本文将热修复的几大流派分别做较深入的阐述，以使关注这一技术的开发同学有更深的了解。</p>
<p>在正式切入话题之前，我们先来看看传统的开发流程究竟有哪些痛点。概括之，可以用三个“太”来描述：1.重新发布版本的代价太大；2.用户下载安装的成本太高；3.BUG修复不及时造成用户体验太差。</p>
<p>正因为如此，热修复技术才得以施展，并被广大开发者追捧。那么，热修复开发流程具有怎样的优势？总结起来，也有三点。</p>
<p>第一， 无需重新发版，而且实时高效。</p>
<p>第二， 用户对修复过程无感知，也无需下载新的应用，总之，代价非常小。</p>
<p>第三， 修复的成功率高，可以吧损失降至最低。</p>
<p>哎呀，热修复技术真是棒棒哒。但是热修复技术虽好，可不能“贪杯”，毕竟流派较多，哪款才适合呢？</p>
<h3 id="市面上流行的热修复技术对比"><a href="#市面上流行的热修复技术对比" class="headerlink" title="市面上流行的热修复技术对比"></a>市面上流行的热修复技术对比</h3><p>目前，市面上主流的几个热修复流派有这些，阿里andfix、美团Robust、QQ空间和微信Tinker。那，咱们就一起来看看这些技术方案都有哪些优缺点？</p>
<p>阿里andfix  </p>
<p>hook本地方法. 并没有整体替换class。1. 打开链接库得到操作句柄, 获取native层内部函数, 得到classobject对象. 2. 修复访问权限属性为public 3. 得到新旧方法的指针, 新方法指向目标方法, 实现方法的替换</p>
<p>优点： 1. 不侵入打包, 性能无损耗；2. 即时生效。</p>
<p>缺点： 1. 需要针对dalvik虚拟机和art虚拟机做适配，需要考虑指令集的兼容问题，需要native代码支持，兼容性上会有一定的影响； 2. 不支持新增类方法/字段，以及修改<init>方法，也不支持对资源的替换。</init></p>
<p>美团Robust  </p>
<p>类似Instant Run原理, 每个产品代码的每个函数都在编译打包阶段自动的插入了一段代码。</p>
<p>客户端拿到patch.dex后，用DexClassLoader加载patch.dex. 其中的changeQuickRedirect字段赋值为用patch.dex中的StatePatch.java这个class new出来的对象。这就是打patch的主要过程。</p>
<p>优点： 正常的使用DexClassLoader，兼容性高，未反射注入，实时生效。</p>
<p>缺点： 1. 原来能被ProGuard内联的函数不能被内联了，所以可能导致方法数的增加，原来没超过65536但是后面可能就操作了65536限制，同时apk的体积也会一定程度的增大；2. so和资源的替换暂时不支持；3. 侵入式打包。</p>
<p>QQ空间</p>
<p>类似Multidex, 注入, 插桩. 大致的过程就是：把BUG方法修复以后，放到一个单独的DEX里，插入到dexElements数组的最前面，让虚拟机去加载修复完后的方法。</p>
<p>davilk: 但是有一个问题是，当两个调用关系的类不在同一个DEX时，就会产生异常报错。我们知道，在APK安装时，davilk虚拟机通过dexopt将classes.dex优化成odex文件，然后才会执行。在这个过程中，会进行类的verify操作，如果调用关系的类都在同一个DEX中的话就会被打上CLASS_ISPREVERIFIED的标志，然后才会写入odex文件。所以，为了可以正常的进行打补丁修复，必须避免类被打上CLASS_ISPREVERIFIED标志，具体的做法就是单独放一个类在另外DEX中，让其他类调用。但是虽然阻止了被打上CLASS_ISPREVERIFIED标志, 但是运行时加载类做verify与optimize所以效率低下. 特别是应用刚启动的情况下需要加载大量类的情况下就会花不少时间。</p>
<p>art: Art采用了新的方式，插桩对代码的执行效率并没有什么影响。但是若补丁中的类出现修改类变量或者方法，可能会导致出现内存地址错乱的问题。为了解决这个问题我们需要将修改了变量、方法以及接口的类的父类以及调用这个类的所有类都加入到补丁包中。</p>
<p>优点： 兼容性高</p>
<p>缺点： 1. 不支持实时生效；2. avilk下类加载性能问题；3. art下补丁包包很大；4. 侵入式打包。</p>
<p>微信Tinker</p>
<p>dex merge，微信针对QQ空间超级补丁技术的不足提出了一个提供DEX差量包，整体替换DEX的方案。主要的原理是与QQ空间超级补丁技术基本相同，区别在于不再将patch.dex增加到elements数组中，而是差量的方式给出patch.dex，然后将patch.dex与应用的classes.dex合并，然后整体替换掉旧的DEX，达到修复的目的。</p>
<p>优点： 1. 自研DexDiff算法, 深度利用Dex的格式来减少差异的大小。它的粒度是Dex格式的每一项，可以充分利用原本Dex的信息，而BsDiff的粒度是文件 补丁包足够小。2. 有效防止了qq空间导致的加载效率下降问题。3. 侵入式打包。</p>
<p>缺点： 1. 不支持即时生效；2. 需要给应用开启新的进程才能进行合并，并且很容易因为内存消耗等原因合并失败；3. 合并时占用额外磁盘空间，对于多DEX的应用来说，如果修改了多个DEX文件，就需要下发多个patch.dex与对应的classes.dex进行合并操作时，这种情况会更严重。</p>
<p>阿里百川HotFix</p>
<p>百川HotFix是在阿里AndFix的基础上，增加了补丁管理后台。我们可以在下面的图中看到我们的服务后台功能，可以上传补丁。补丁必须跟版本号绑定，同时提供了补丁控制功能, 比如停止发布/继续发布/灰度/全量发布等功能。 </p>
<p>同时HotFix基于手淘的实践针对andfix做了大量优化，性能上提高了兼容和稳定性，功能上比如支持新增类和基于类方法作为粒度所以有更小的补丁包，开源的andfix补丁包是以类作为粒度。</p>
<p>事实上，阿里百川HotFix也在不断演进之中，最新的2.0版已经突破了很多限制，比如，不支持资源修复，so修复；不支持新增类方法/类字段等。现在这些都不是问题啦，而且它还在依然在不断进化！</p>
<p>相较于最初的1.X版本，阿里百川HotFix  2.0可谓发生了“翻天覆地”的变化。有哪些？请看。</p>
<ul>
<li><p>将1.x版本的所有限制全部取消；</p>
</li>
<li><p>不仅仅只基于AndFix而是自由切换方案；</p>
</li>
<li><p>不管资源/SO文件/类修复都能做到实时生效；</p>
</li>
<li><p>傻瓜式接入, 完全不侵入你的打包过程, 可视化UI界面打补丁。</p>
</li>
</ul>
<p>这么一个好东东究竟啥时候有啊？别急，2017年1月中旬就会上线，到时候就可以“你有我有全都有了！”</p>
<p>另外，阿里百川HotFix还有一些“计划”。</p>
<p>1、更小的补丁包，比如尝试so和资源文件做bsdiff。</p>
<p>2、支持四大组件的代理。</p>
<p>3、更好的性能和稳定兼容性。</p>
<p>你以为这样就完了？No，下面再给大家分享一下阿里百川HotFix的一些具体修复方案。</p>
<p>百川Hotfix2.X 类修复方案</p>
<p>补丁工具检测补丁冷部署or热部署</p>
<ul>
<li>由于热部署andfix修复正在运行的方法有crash的风险, 所以补丁工具提供参数由业务方来决定是否尝试走热部署, 如果用户patch的方法没有被高频调用同时又有实时生效的需求, 那么可以优先选择走热部署方案</li>
</ul>
<p>热部署 -&gt;andfix支持的代码变更</p>
<ul>
<li>此时走优化后的andfix方案</li>
</ul>
<blockquote>
<p>也就是目前hotfix1.0的方案</p>
</blockquote>
<p>冷部署 -&gt;andfix不支持代码变更</p>
<ul>
<li>davilk下hack本地方法native层绕过dvmresolveclass</li>
</ul>
<blockquote>
<p>patch dex追加到PathClassLoad的dexElements中, 同时我们知道插桩的解决方案会影响到运行时性能的原因在于：app内的所有类都预埋引用一个独立dex的空类，导致安装dexopt阶段的preverify失败，运行时将再次verify+optimize. 所以我们选择了hack本地方法native层绕过dvmresolveclass方法的方式。 </p>
</blockquote>
<ul>
<li>art下直接合成dex，采用手淘目前成熟的art动态部署方案 </li>
</ul>
<blockquote>
<p>不同于微信tinker的dex merge方案, dex merge其实很占用应用内存, 所以最终会导致dex merge失败, 实际上art上默认已经支持多dex的合并, 我们只需要把patch dex跟原来apk中的dex合并成完整的新dex, 然后去替换PathClassLoad的dexElements即可.</p>
</blockquote>
<p>阿里百川Hotfix2.X SO文件修复方案</p>
<ul>
<li><p>art下预load原来so, 再load补丁so</p>
</li>
<li><p>davilk下预load补丁so, 再load原来的so </p>
</li>
<li><p>关键:  综合机型支持的abis和补丁包中的abis共同决定补丁so的新libPath</p>
</li>
</ul>
<p>davilk和art下so文件加载的方式不一样, 导致了需要区分art和davilk做不同的处理. 实际上我们还有另外一个so补丁的方案, 这里暂时不对外透露 </p>
<p>更好的性能</p>
<ul>
<li><p>SOPatchManager.load(String libPath) -&gt;代替  System.load(String pathName)</p>
</li>
<li><p>SOPatchManager.loadLibrary(String libName) -&gt;代替  System.loadLibrary(String libName)</p>
</li>
</ul>
<p>我们知道一个so文件如果load两次那么本地内存的使用会变大. 所以我们提供了替代System加载so文件的方法, 我们建议所有的so文件加载都通过这个方法, 那么加载so文件的时候只会尝试去加载指定目录下去的补丁so, 而不会去加载安装apk中的so文件</p>
<p>阿里百川Hotfix2.X 资源文件修复方案</p>
<p>Android资源文件的特点</p>
<ul>
<li><p>资源id编码于resources.arsc文件中，排布紧密。按照排布顺序进行自动编号</p>
</li>
<li><p>res目录保存所有带id的资源文件。布局文件为二进制形式的xml文件，xml以资源id的方式引用其他资源</p>
</li>
<li><p>assets目录存放所有原始文件，不带id</p>
</li>
<li><p>aapt进行资源的构造，包括自动分配资源id与R文件的生成，默认情况下，每次编译不保证和之前包中的id一致</p>
</li>
</ul>
<p>目前市面上普遍采用的三种方式。</p>
<ul>
<li><p>差量合成完整的资源包，运行时完整加载资源。 缺点：合成资源占用时间和内存，容易引起卡顿。</p>
</li>
<li><p>修改aapt，对以后可能新增的资源提前留空，运行时patch包中新增资源id对应留出的位置。 缺点：需改变打包流程，修改代码并编译替换sdk中的aapt。打包侵入太强，且留空占用一定磁盘空间。留空多少是预先定好的，无法改变。</p>
</li>
<li><p>插件化，组件化资源。 缺点：资源需要划分模块，提前规划。杀鸡焉用牛刀？</p>
</li>
</ul>
<p>一个优秀的资源热修复方案应该做到：</p>
<ul>
<li><p>补丁包尽可能地小。加载补丁迅速，性能好，内存和时间消耗极小。</p>
</li>
<li><p>不改变打包流程，保持sdk工具链的完整性。</p>
</li>
<li><p>开发透明，开发者无感知。不需要事先固定资源id。</p>
</li>
<li><p>方便易用，傻瓜式操作。一键完成patch工作。</p>
</li>
</ul>
<p>阿里百川资源热修复</p>
<ul>
<li><p>直接基于新旧两个apk来构造补丁包，不需要改造aapt，对编译过程无要求。</p>
</li>
<li><p>精确比较各个资源id的使用情况，最大程度利用原先基线包资源，补丁包中只包含新增和修改的资源。</p>
</li>
<li><p>运行时无需合成操作，快速应用生效。不影响性能。</p>
</li>
<li><p>不仅仅是简单修复，对于任意程度、乃至天翻地覆的修改都能适用。只是补丁文件会比较大。</p>
</li>
<li><p>使用方便，只需要选取新旧两个apk，一键生成补丁。</p>
</li>
<li><p>兼容Android所有机型，稳定性好。</p>
</li>
<li><p>配合类修复方案, 我们能够做到资源修复的实时生效</p>
</li>
</ul>
<p>需要注意的地方</p>
<ul>
<li><p>如果事先自己做了资源混淆，需要保证新旧包混淆的关系保持一致，否则打补丁时会找不到原来基线包中资源，而将非新增资源视为新增资源，导致补丁包变大。</p>
</li>
<li><p>建议每次打包时设置去除无用的资源。这样即可以减小包大小，同时也保证补丁包中新增资源都是有用的。</p>
</li>
<li><p>AndroidManifest中引用的资源无法改变。有些资源如icon是安装时固定的，目前所有补丁方案都无法进行改变。而另一些资源，如Theme，我们可以提取AndroidManifest中的资源信息，通过代码的方式进行设置。</p>
</li>
</ul>
<p>阿里百川HotFix管理后台服务</p>
<ul>
<li>补丁灰度发布/正式发布  </li>
</ul>
<blockquote>
<p>发布前可以通过本地/扫码两种方式验证之后再发布上线, 本地补丁模式是指补丁可以放到任何一个指定的目录下即可. 扫码模式是扫描二维码生成一个下载url, 然后直接下载这个时候不需要和服务器验证身份.  灰度发布指定具体的用户数然后随机推送</p>
</blockquote>
<ul>
<li>补丁回滚  </li>
</ul>
<blockquote>
<p>回滚到目标补丁版本, 所有该应用版本下的设备都会回滚到目标补丁的版本。</p>
</blockquote>
<ul>
<li>补丁安全</li>
</ul>
<blockquote>
<ol>
<li>平台托管RSA秘钥  2. 补丁加载安全签名校验</li>
</ol>
</blockquote>
<p>我们后续提供的服务</p>
<ul>
<li>补丁自定义平台无关AES秘钥</li>
</ul>
<blockquote>
<p>更安全, 此时打补丁的时候用户可以填入自定义AES秘钥, 然后SDK初始化的时候填入这个秘钥即可. 我们阿里百川平台完全不知道你的秘钥, 所以你们的补丁在我们的后台是绝对安全的. </p>
</blockquote>
<ul>
<li>补丁条件下发 </li>
</ul>
<blockquote>
<ol>
<li><p>分系统版本 比如一个bug只在android5.0上复现, 那么可能只想对android5.0下发补丁</p>
</li>
<li><p>分渠道  比如只想对某个具体的渠道, 豌豆荚/小米不同的渠道进行分发 </p>
</li>
<li><p>自定义TAG 上述几个是默认提供的条件, 当然我们提供了更加自由的方式, 你可以对任何一个补丁打tag, 然后客户端只能请求下载到后台指定tag的补丁.   </p>
</li>
</ol>
</blockquote>
<ul>
<li>实时显示补丁加载成功率等数据</li>
</ul>
<blockquote>
<p>后续可能会上报补丁加载失败详情, 方便排查问题. </p>
</blockquote>
<ul>
<li>一键清除补丁  </li>
</ul>
<blockquote>
<p>使用回滚功能必需要具备一下几个条件：1. 当前的版本已停止发布 2. 该版本之前存在至少一个历史版本 所以如果第一个补丁就下发错误的话, 补丁回滚就无能为力了, 所以我们提供一键清除补丁的功能。</p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20170118163628380?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQvZ3VveGlhb2xvbmdvbmx5/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/SouthEast" alt="热修复技术对比"></p>
<p>对比完这些热修复技术是不是觉得Hotfix是不错的选择。接下来就一起来了解一下hotfix的接入和使用吧。</p>
<p>接入流程大概如下：<br><a href="http://console.baichuan.taobao.com/" target="_blank" rel="external">1. 注册阿里百川开发者帐号（这个用来对阿里百川一些sdk的接入进行管理）</a></p>
<ol>
<li>新建一个项目，并开通阿里百川hotfix的使用权限。<br><a href="http://baichuan.taobao.com/docs/doc.htm?spm=a3c0d.7629140.0.0.Lxy877&amp;treeId=234&amp;articleId=105517&amp;docType=1" target="_blank" rel="external">3. 下载，集成sdk。</a></li>
</ol>
<h3 id="Hotfix-SDK接入"><a href="#Hotfix-SDK接入" class="headerlink" title="Hotfix SDK接入"></a>Hotfix SDK接入</h3><p><a href="http://baichuan.taobao.com/docs/doc.htm?spm=a3c0d.7629140.0.0.ZZm6TK&amp;treeId=234&amp;articleId=105456&amp;docType=1" target="_blank" rel="external">HotFix项目文档地址</a></p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/3/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/lucky.jpg"
               alt="小龙" />
          <p class="site-author-name" itemprop="name">小龙</p>
           
              <p class="site-description motion-element" itemprop="description">程序猿</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">30</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xiaolongonly" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/guoxiaolongonly" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-android"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小龙</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
