<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="MPAndroidChart," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="前言一直在使用MPAndroidChart但对其内部机制却没有做多少了解，自己之前还修改过MPAndroidChart的源码，某次面试被问到，MPAndroidChart是怎样进行绘制的，瞬间一脸懵逼，回答了个大概，但是被看出其实不是很了解。算亡羊补牢吧，今天抽了点时间看了MPAndroidChart 3.0的源码部分。直接进入正题吧。
Chart基类这边顺便讲解一下Chart这个类，它是所有图表">
<meta property="og:type" content="article">
<meta property="og:title" content="MPAndroidChart绘制浅析">
<meta property="og:url" content="http://rngift.com/2017/03/31/MPAndroidChartSource/index.html">
<meta property="og:site_name" content="Xiaolong的个人博客">
<meta property="og:description" content="前言一直在使用MPAndroidChart但对其内部机制却没有做多少了解，自己之前还修改过MPAndroidChart的源码，某次面试被问到，MPAndroidChart是怎样进行绘制的，瞬间一脸懵逼，回答了个大概，但是被看出其实不是很了解。算亡羊补牢吧，今天抽了点时间看了MPAndroidChart 3.0的源码部分。直接进入正题吧。
Chart基类这边顺便讲解一下Chart这个类，它是所有图表">
<meta property="og:updated_time" content="2018-03-14T15:04:05.572Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MPAndroidChart绘制浅析">
<meta name="twitter:description" content="前言一直在使用MPAndroidChart但对其内部机制却没有做多少了解，自己之前还修改过MPAndroidChart的源码，某次面试被问到，MPAndroidChart是怎样进行绘制的，瞬间一脸懵逼，回答了个大概，但是被看出其实不是很了解。算亡羊补牢吧，今天抽了点时间看了MPAndroidChart 3.0的源码部分。直接进入正题吧。
Chart基类这边顺便讲解一下Chart这个类，它是所有图表">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://rngift.com/2017/03/31/MPAndroidChartSource/"/>





  <title> MPAndroidChart绘制浅析 | Xiaolong的个人博客 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Xiaolong的个人博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">每一天都值得被认真对待</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/pastLove" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br />
            
            爱过的人
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://rngift.com/2017/03/31/MPAndroidChartSource/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="小龙">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/lucky.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Xiaolong的个人博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                MPAndroidChart绘制浅析
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-31T14:08:11+08:00">
                2017-03-31
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Android源码解析/" itemprop="url" rel="index">
                    <span itemprop="name">Android源码解析</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>一直在使用MPAndroidChart但对其内部机制却没有做多少了解，自己之前还修改过MPAndroidChart的源码，某次面试被问到，MPAndroidChart是怎样进行绘制的，瞬间一脸懵逼，回答了个大概，但是被看出其实不是很了解。算亡羊补牢吧，今天抽了点时间看了MPAndroidChart 3.0的源码部分。<br>直接进入正题吧。</p>
<h2 id="Chart基类"><a href="#Chart基类" class="headerlink" title="Chart基类"></a>Chart基类</h2><p>这边顺便讲解一下Chart这个类，它是所有图表类的抽象基类，继承自ViewGroup，实现了图表接口ChartInterface（这个接口用来实现图表的大小，边界，和范围的获取。），Chart里面存放了一些公共的配置和一些共有的抽象方法，数据等。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div><div class="line">142</div><div class="line">143</div><div class="line">144</div><div class="line">145</div><div class="line">146</div><div class="line">147</div><div class="line">148</div><div class="line">149</div><div class="line">150</div><div class="line">151</div><div class="line">152</div><div class="line">153</div><div class="line">154</div><div class="line">155</div><div class="line">156</div><div class="line">157</div><div class="line">158</div><div class="line">159</div><div class="line">160</div><div class="line">161</div><div class="line">162</div><div class="line">163</div><div class="line">164</div><div class="line">165</div><div class="line">166</div><div class="line">167</div><div class="line">168</div><div class="line">169</div><div class="line">170</div><div class="line">171</div><div class="line">172</div><div class="line">173</div><div class="line">174</div><div class="line">175</div><div class="line">176</div><div class="line">177</div><div class="line">178</div><div class="line">179</div><div class="line">180</div><div class="line">181</div><div class="line">182</div><div class="line">183</div><div class="line">184</div><div class="line">185</div><div class="line">186</div><div class="line">187</div><div class="line">188</div><div class="line">189</div><div class="line">190</div><div class="line">191</div><div class="line">192</div><div class="line">193</div><div class="line">194</div><div class="line">195</div><div class="line">196</div><div class="line">197</div><div class="line">198</div><div class="line">199</div><div class="line">200</div><div class="line">201</div><div class="line">202</div><div class="line">203</div><div class="line">204</div><div class="line">205</div><div class="line">206</div><div class="line">207</div><div class="line">208</div><div class="line">209</div><div class="line">210</div><div class="line">211</div><div class="line">212</div><div class="line">213</div><div class="line">214</div><div class="line">215</div><div class="line">216</div><div class="line">217</div><div class="line">218</div><div class="line">219</div><div class="line">220</div><div class="line">221</div><div class="line">222</div><div class="line">223</div><div class="line">224</div><div class="line">225</div><div class="line">226</div><div class="line">227</div><div class="line">228</div><div class="line">229</div><div class="line">230</div><div class="line">231</div><div class="line">232</div><div class="line">233</div><div class="line">234</div><div class="line">235</div><div class="line">236</div><div class="line">237</div><div class="line">238</div><div class="line">239</div><div class="line">240</div><div class="line">241</div><div class="line">242</div><div class="line">243</div><div class="line">244</div><div class="line">245</div><div class="line">246</div><div class="line">247</div><div class="line">248</div><div class="line">249</div><div class="line">250</div><div class="line">251</div><div class="line">252</div><div class="line">253</div><div class="line">254</div><div class="line">255</div><div class="line">256</div><div class="line">257</div><div class="line">258</div><div class="line">259</div><div class="line">260</div><div class="line">261</div><div class="line">262</div><div class="line">263</div><div class="line">264</div><div class="line">265</div><div class="line">266</div><div class="line">267</div><div class="line">268</div><div class="line">269</div><div class="line">270</div><div class="line">271</div><div class="line">272</div><div class="line">273</div><div class="line">274</div><div class="line">275</div><div class="line">276</div><div class="line">277</div><div class="line">278</div><div class="line">279</div><div class="line">280</div><div class="line">281</div><div class="line">282</div><div class="line">283</div><div class="line">284</div><div class="line">285</div><div class="line">286</div><div class="line">287</div><div class="line">288</div><div class="line">289</div><div class="line">290</div><div class="line">291</div><div class="line">292</div><div class="line">293</div><div class="line">294</div><div class="line">295</div><div class="line">296</div><div class="line">297</div><div class="line">298</div><div class="line">299</div><div class="line">300</div><div class="line">301</div><div class="line">302</div><div class="line">303</div><div class="line">304</div><div class="line">305</div><div class="line">306</div><div class="line">307</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 这个类是图表类的基类，继承自ViewGroup，它可以让图表像View一样被使用。</div><div class="line"> * <span class="doctag">@author</span> Philipp Jahoda</div><div class="line"> */</div><div class="line"><span class="meta">@SuppressLint</span>(<span class="string">"NewApi"</span>)</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Chart</span>&lt;<span class="title">T</span> <span class="keyword">extends</span> <span class="title">ChartData</span>&lt;? <span class="keyword">extends</span> <span class="title">IDataSet</span>&lt;? <span class="keyword">extends</span> <span class="title">Entry</span>&gt;&gt;&gt; <span class="keyword">extends</span></span></div><div class="line">        <span class="title">ViewGroup</span></div><div class="line">        <span class="keyword">implements</span> <span class="title">ChartInterface</span> &#123;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String LOG_TAG = <span class="string">"MPAndroidChart"</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 声明log是否开启（调试用）</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> mLogEnabled = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 图表数据</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> T mData = <span class="keyword">null</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 触摸区域高亮</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> mHighLightPerTapEnabled = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 触摸事件完成后是否继续滚动（可以试试pieChart的旋转功能）</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mDragDecelerationEnabled = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个就是滚动的减慢速度，算摩擦系数，0就直接停了，1会一直转，所以他回自动变成0.999，</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mDragDecelerationFrictionCoef = <span class="number">0.9f</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 数据格式化</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ValueFormatter mDefaultFormatter;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 图表描述画笔</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mDescPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个画笔是用来画无数据的情况</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mInfoPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 描述描述！！</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> String mDescription = <span class="string">"Description"</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * X轴的label可以看折现图的横轴label</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> XAxis mXAxis;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 手势开关</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">boolean</span> mTouchEnabled = <span class="keyword">true</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Legend是一个图例描述，里面是这个图例，位置等其他配置的信息。</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Legend mLegend;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 数据选中监听</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> OnChartValueSelectedListener mSelectionListener;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 图表点击监听</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ChartTouchListener mChartTouchListener;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 空数据文本</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> String mNoDataText = <span class="string">"No chart data available."</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 手势监听</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> OnChartGestureListener mGestureListener;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 无数据描述</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> String mNoDataTextDescription;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个是图例绘制类</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> LegendRenderer mLegendRenderer;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 数据绘制类基类实现</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> DataRenderer mRenderer;</div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 区域高亮辅助基类。用来计算高亮区域并返回</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ChartHighlighter mHighlighter;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 边界约束管理</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ViewPortHandler mViewPortHandler;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 动画</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ChartAnimator mAnimator;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 边距</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">float</span> mExtraTopOffset = <span class="number">0</span>.f,</div><div class="line">            mExtraRightOffset = <span class="number">0</span>.f,</div><div class="line">            mExtraBottomOffset = <span class="number">0</span>.f,</div><div class="line">            mExtraLeftOffset = <span class="number">0</span>.f;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 默认构造</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Chart</span><span class="params">(Context context)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * constructor for initialization in xml</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Chart</span><span class="params">(Context context, AttributeSet attrs)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * even more awesome constructor</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Chart</span><span class="params">(Context context, AttributeSet attrs, <span class="keyword">int</span> defStyle)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(context, attrs, defStyle);</div><div class="line">        init();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * initialize all paints and stuff</div><div class="line">     * 初始化函数，负责一些对象的初始化</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</div><div class="line">		   ...略</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 设置新数据,在这里有个notify，在数据添加完之后刷新图表</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setData</span><span class="params">(T data)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="comment">// let the chart know there is new data</span></div><div class="line">        notifyDataSetChanged();</div><div class="line"></div><div class="line"> </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 清空所有数据并刷新</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</div><div class="line">        mData = <span class="keyword">null</span>;</div><div class="line">        mIndicesToHighlight = <span class="keyword">null</span>;</div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 上面是直接置空。可能是想回收，这里是清除值后刷新</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearValues</span><span class="params">()</span> </span>&#123;</div><div class="line">        mData.clearValues();</div><div class="line">        invalidate();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 判断data是否为空</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isEmpty</span><span class="params">()</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (mData == <span class="keyword">null</span>)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">        <span class="keyword">else</span> &#123;</div><div class="line"></div><div class="line">            <span class="keyword">if</span> (mData.getYValCount() &lt;= <span class="number">0</span>)</div><div class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">            <span class="keyword">else</span></div><div class="line">                <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">	 * 这个方法可以让图表知道自己掌握的数据，并显示出来。</div><div class="line">	 * 需要重新进行计算</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">notifyDataSetChanged</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 边距计算</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">calculateOffsets</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 最大最小y值计算抽象方法</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">calcMinMax</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 计算单位</div><div class="line">     */</div><div class="line">	<span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">calculateFormatter</span><span class="params">(<span class="keyword">float</span> min, <span class="keyword">float</span> max)</span>      </span>&#123;</div><div class="line">	...略</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 边距计算</div><div class="line">	 */</div><div class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> mOffsetsCalculated = <span class="keyword">false</span>;</div><div class="line"></div><div class="line">    </div><div class="line">    <span class="keyword">protected</span> Paint mDrawPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 主要的绘制方法</div><div class="line">     */</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">onDraw</span><span class="params">(Canvas canvas)</span> </span>&#123;</div><div class="line">        <span class="comment">// super.onDraw(canvas);</span></div><div class="line">	    ...略</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	<span class="comment">/**</span></div><div class="line">     * 描述位置</div><div class="line">     */</div><div class="line">    <span class="keyword">private</span> PointF mDescriptionPosition;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 绘制描述</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawDescription</span><span class="params">(Canvas c)</span> </span>&#123;</div><div class="line"></div><div class="line">      ...略</div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line">	<span class="comment">/**高亮模块 支持点击高亮等各种效果。这边处理绘制还有计算*/</span></div><div class="line">	  ..略</div><div class="line">    <span class="comment">/**下面是MarkView */</span></div><div class="line">		..略</div><div class="line">   </div><div class="line">    <span class="comment">/** 下面是动画处理 */</span></div><div class="line">		..略</div><div class="line"></div><div class="line">    <span class="comment">/** 动画开放方法 */</span></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateXY</span><span class="params">(<span class="keyword">int</span> durationMillisX, <span class="keyword">int</span> durationMillisY, EasingFunction easingX,</span></span></div><div class="line">                          EasingFunction easingY) &#123;</div><div class="line">        mAnimator.animateXY(durationMillisX, durationMillisY, easingX, easingY);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateX</span><span class="params">(<span class="keyword">int</span> durationMillis, EasingFunction easing)</span> </span>&#123;</div><div class="line">        mAnimator.animateX(durationMillis, easing);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateY</span><span class="params">(<span class="keyword">int</span> durationMillis, EasingFunction easing)</span> </span>&#123;</div><div class="line">        mAnimator.animateY(durationMillis, easing);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">	  <span class="comment">/** 动画开放配置 */</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateXY</span><span class="params">(<span class="keyword">int</span> durationMillisX, <span class="keyword">int</span> durationMillisY, Easing.EasingOption easingX,</span></span></div><div class="line">                          Easing.EasingOption easingY) &#123;</div><div class="line">        mAnimator.animateXY(durationMillisX, durationMillisY, easingX, easingY);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateX</span><span class="params">(<span class="keyword">int</span> durationMillis, Easing.EasingOption easing)</span> </span>&#123;</div><div class="line">        mAnimator.animateX(durationMillis, easing);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateY</span><span class="params">(<span class="keyword">int</span> durationMillis, Easing.EasingOption easing)</span> </span>&#123;</div><div class="line">        mAnimator.animateY(durationMillis, easing);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateX</span><span class="params">(<span class="keyword">int</span> durationMillis)</span> </span>&#123;</div><div class="line">        mAnimator.animateX(durationMillis);</div><div class="line">    &#125;</div><div class="line"></div><div class="line"> </div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">animateXY</span><span class="params">(<span class="keyword">int</span> durationMillisX, <span class="keyword">int</span> durationMillisY)</span> </span>&#123;</div><div class="line">        mAnimator.animateXY(durationMillisX, durationMillisY);</div><div class="line">    &#125;</div><div class="line">  <span class="comment">/**在往下就是各种配置了 */</span></div><div class="line">   略略略</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>它是所有图表的基类，里面是一些基础的方法，包括数据，高亮，动画，描述，空数据等公用方法的实现和抽象。保存当前图表信息等…<br>继承结构如下</p>
<ol>
<li>Chart(图表类基类)<ol>
<li>BarLineChartBase（柱状图折线图抽象类）<ol>
<li>BubbleChart（气泡图)</li>
<li>CandleStickChart（烛状图）</li>
<li>CombinedChart（复合图表)</li>
<li>BarChart（柱状图）</li>
<li>LineChart（折线图）</li>
<li>ScatterChart（散点图）</li>
</ol>
</li>
<li>PieRadarChartBase(饼状图雷达图抽象类）<ol>
<li>PieChart（饼状图）</li>
<li>RadarChart（雷达图）</li>
</ol>
</li>
</ol>
</li>
</ol>
<p>根据不同的图表做了不同的实现，比如说BarLineChartBase都有一个共同的属性是XY轴，在onDraw方法中对XY轴做了绘制，BarLineChartBase还支持缩放操作。PieRadarBase是没有XY轴且不支持缩放操作，但支持旋转。所以将这两个图单独抽象了一层。<br>onDraw算是共有的主要方法。因为数据绘制都是在onDraw方法中的canvas上面。</p>
<p>下面来讲解一下MPAndroidChart的绘制过程</p>
<h2 id="MPAndroidChart绘制过程"><a href="#MPAndroidChart绘制过程" class="headerlink" title="MPAndroidChart绘制过程"></a>MPAndroidChart绘制过程</h2><p>所有的绘制都做了抽象在这边基本能重用的方法就做一层抽象。<br>我们来看一下最底层的抽象Renderer类<br>Chart的绘制是经由Renderer类之手，看一下Renderer类的实现。</p>
<h3 id="Render"><a href="#Render" class="headerlink" title="Render"></a>Render</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="comment">/**</span></div><div class="line"> * Abstract baseclass of all Renderers.</div><div class="line"> * </div><div class="line"> * <span class="doctag">@author</span> Philipp Jahoda</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Renderer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个变量用来存放绘制区域还有偏移量等设置</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ViewPortHandler mViewPortHandler;</div><div class="line"></div><div class="line">    <span class="comment">/** </span></div><div class="line">     * X轴需要绘制的最小值</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> mMinX = <span class="number">0</span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">    * X轴需要绘制的最大值</div><div class="line">    */</div><div class="line">    <span class="keyword">protected</span> <span class="keyword">int</span> mMaxX = <span class="number">0</span>;</div><div class="line">	</div><div class="line">	<span class="comment">/**</span></div><div class="line">	 * 这边通过构造传入ViewPortHandler</div><div class="line">	 */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Renderer</span><span class="params">(ViewPortHandler viewPortHandler)</span> </span>&#123;</div><div class="line">        <span class="keyword">this</span>.mViewPortHandler = viewPortHandler;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个方法用来计算当前的值是否在X的最小和最大之间</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">fitsBounds</span><span class="params">(<span class="keyword">float</span> val, <span class="keyword">float</span> min, <span class="keyword">float</span> max)</span> </span>&#123;</div><div class="line"></div><div class="line">        <span class="keyword">if</span> (val &lt; min || val &gt; max)</div><div class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</div><div class="line">        <span class="keyword">else</span></div><div class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个方法用来计算当前可以显示的X的大小，</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">calcXBounds</span><span class="params">(BarLineScatterCandleBubbleDataProvider dataProvider, <span class="keyword">int</span> xAxisModulus)</span> </span>&#123;</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> low = dataProvider.getLowestVisibleXIndex();</div><div class="line">        <span class="keyword">int</span> high = dataProvider.getHighestVisibleXIndex();</div><div class="line">        </div><div class="line">        <span class="keyword">int</span> subLow = (low % xAxisModulus == <span class="number">0</span>) ? xAxisModulus : <span class="number">0</span>;</div><div class="line">        </div><div class="line">        mMinX = Math.max((low / xAxisModulus) * (xAxisModulus) - subLow, <span class="number">0</span>);</div><div class="line">        mMaxX = Math.min((high / xAxisModulus) * (xAxisModulus) + xAxisModulus, (<span class="keyword">int</span>) dataProvider.getXChartMax());</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>这个类里面的方法用来确定当前视图可显示的大小，所有的Render类都继承自它。包括AxisRenderer（轴和轴值绘制），LegendRender（图例绘制）,DataRender（图表图形绘制）。<br>AxisRenderer，和LegendRender的实现都大同小异，DataRender属于图表绘制的抽象，因为图表的样式比较多，它扩展了一些可以供图表使用的方法，接下来主要拿DataRender来讲。</p>
<h3 id="DataRender"><a href="#DataRender" class="headerlink" title="DataRender"></a>DataRender</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div></pre></td><td class="code"><pre><div class="line"><span class="comment">/**</span></div><div class="line"> * 这个类是Renderer的子类，用来提供一些抽象的绘制方法。</div><div class="line"> */</div><div class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">DataRenderer</span> <span class="keyword">extends</span> <span class="title">Renderer</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个对象是用来设置图表动画的</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> ChartAnimator mAnimator;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 初始化图表item绘制的画笔</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mRenderPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 绘制高亮区域</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mHighlightPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个没见用到</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mDrawPaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个用来绘制图表的文本信息</div><div class="line">     */</div><div class="line">    <span class="keyword">protected</span> Paint mValuePaint;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 构造函数传入了动画对象ChartAnimator，控制绘制区域和偏移量的对象ViewPortHandler,里面做的是变量初始化操作</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DataRenderer</span><span class="params">(ChartAnimator animator, ViewPortHandler viewPortHandler)</span> </span>&#123;</div><div class="line">        <span class="keyword">super</span>(viewPortHandler);</div><div class="line">	    略..</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个方法返回了文本绘制的画笔对象</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Paint <span class="title">getPaintValues</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mValuePaint;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 高亮画笔</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Paint <span class="title">getPaintHighlight</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mHighlightPaint;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 绘制画笔</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> Paint <span class="title">getPaintRender</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> mRenderPaint;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * Applies the required styling (provided by the DataSet) to the value-paint</div><div class="line">     * object.</div><div class="line">     *</div><div class="line">     * <span class="doctag">@param</span> set</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">applyValueTextStyle</span><span class="params">(IDataSet set)</span> </span>&#123;</div><div class="line"></div><div class="line">        mValuePaint.setTypeface(set.getValueTypeface());</div><div class="line">        mValuePaint.setTextSize(set.getValueTextSize());</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 初始化Buffers，buffer是用来进行尺寸变换的一个类，他和transformer类配合生成实际的尺寸</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">initBuffers</span><span class="params">()</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 数据绘制抽象类</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drawData</span><span class="params">(Canvas c)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     *数值绘制抽象类</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drawValues</span><span class="params">(Canvas c)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 数值绘制</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawValue</span><span class="params">(Canvas c, ValueFormatter formatter, <span class="keyword">float</span> value, Entry entry, <span class="keyword">int</span> dataSetIndex, <span class="keyword">float</span> x, <span class="keyword">float</span> y, <span class="keyword">int</span> color)</span> </span>&#123;</div><div class="line">        mValuePaint.setColor(color);</div><div class="line">        c.drawText(formatter.getFormattedValue(value, entry, dataSetIndex, mViewPortHandler), x, y, mValuePaint);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 这个是为LineChart 或者PieChart等设计的附加绘制。因为lineChart需要为每个点进行绘制，PieChart可能需要绘制中间圆形等。</div><div class="line">     * <span class="doctag">@param</span> c</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drawExtras</span><span class="params">(Canvas c)</span></span>;</div><div class="line"></div><div class="line">    <span class="comment">/**</span></div><div class="line">     * 绘制高亮数据</div><div class="line">     */</div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">drawHighlighted</span><span class="params">(Canvas c, Highlight[] indices)</span></span>;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>DataRender里面的方法大致如下</p>
<ol>
<li>图表的绘制抽象方法 (drawData)</li>
<li>数值绘制的抽象方法 (drawValues)</li>
<li>数值绘制方法（drawValue）</li>
<li>图表高亮抽象方法（drawHighlighted）</li>
<li>动画对象和画笔对象的初始化(构造函数)</li>
</ol>
<p>看一下BarChartRender的实现</p>
<h3 id="BarChartRender"><a href="#BarChartRender" class="headerlink" title="BarChartRender"></a>BarChartRender</h3><pre><code class="java">
<span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BarChartRenderer</span> <span class="keyword">extends</span> <span class="title">DataRenderer</span> </span>{
    <span class="comment">/**
     * BarDataProvider这个类中存放了所有的barData，还有一些类似于阴影，数值位置，高亮箭头等。
     */</span>
    <span class="keyword">protected</span> BarDataProvider mChart;

    <span class="comment">/** the rect object that is used for drawing the bars
     *  这个是用来设置每条bar的大小。主要是用做高亮绘制
     */</span>
    <span class="keyword">protected</span> RectF mBarRect = <span class="keyword">new</span> RectF();
    <span class="comment">/**
     * 声明buffer的数组
     */</span>
    <span class="keyword">protected</span> BarBuffer[] mBarBuffers;
    <span class="comment">/**
     * 阴影画笔
     */</span>
    <span class="keyword">protected</span> Paint mShadowPaint;
    <span class="comment">/**
     * 边框画笔
     */</span>
    <span class="keyword">protected</span> Paint mBarBorderPaint;

    <span class="comment">/**
     * 构造函数传入了BarDataProvider,动画类，显示位置控制类，初始化了绘制所需的画笔
     */</span>
    <span class="function"><span class="keyword">public</span> <span class="title">BarChartRenderer</span><span class="params">(BarDataProvider chart, ChartAnimator animator,
            ViewPortHandler viewPortHandler)</span> </span>{
        <span class="keyword">super</span>(animator, viewPortHandler);
        <span class="keyword">this</span>.mChart = chart;

        mHighlightPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);
        mHighlightPaint.setStyle(Paint.Style.FILL);
        mHighlightPaint.setColor(Color.rgb(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>));
        <span class="comment">// set alpha after color</span>
        mHighlightPaint.setAlpha(<span class="number">120</span>);

        mShadowPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);
        mShadowPaint.setStyle(Paint.Style.FILL);

        mBarBorderPaint = <span class="keyword">new</span> Paint(Paint.ANTI_ALIAS_FLAG);
        mBarBorderPaint.setStyle(Paint.Style.STROKE);
    }

    <span class="comment">/**
     * 初始化Buffer
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initBuffers</span><span class="params">()</span> </span>{

        BarData barData = mChart.getBarData();
        mBarBuffers = <span class="keyword">new</span> BarBuffer[barData.getDataSetCount()];

        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; mBarBuffers.length; i++) {
            IBarDataSet set = barData.getDataSetByIndex(i);
            mBarBuffers[i] = <span class="keyword">new</span> BarBuffer(set.getEntryCount() * <span class="number">4</span> * (set.isStacked() ? set.getStackSize() : <span class="number">1</span>),
                    barData.getGroupSpace(),
                    barData.getDataSetCount(), set.isStacked());
        }
    }

    <span class="comment">/**
     * 绘制图表
     * <span class="doctag">@param</span> c
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawData</span><span class="params">(Canvas c)</span> </span>{

        BarData barData = mChart.getBarData();

        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; barData.getDataSetCount(); i++) {

            IBarDataSet set = barData.getDataSetByIndex(i);

            <span class="keyword">if</span> (set.isVisible() &amp;&amp; set.getEntryCount() &gt; <span class="number">0</span>) {
                drawDataSet(c, set, i);
            }
        }
    }

    <span class="comment">/**
     * 根据每个dataset绘制图表
     */</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">drawDataSet</span><span class="params">(Canvas c, IBarDataSet dataSet, <span class="keyword">int</span> index)</span> </span>{
       ...略
    }

    <span class="comment">/**
     * 准备高亮的区域
     */</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">prepareBarHighlight</span><span class="params">(<span class="keyword">float</span> x, <span class="keyword">float</span> y1, <span class="keyword">float</span> y2, <span class="keyword">float</span> barspaceHalf,
            Transformer trans)</span> </span>{

        <span class="keyword">float</span> barWidth = <span class="number">0.5f</span>;

        <span class="keyword">float</span> left = x - barWidth + barspaceHalf;
        <span class="keyword">float</span> right = x + barWidth - barspaceHalf;
        <span class="keyword">float</span> top = y1;
        <span class="keyword">float</span> bottom = y2;

        mBarRect.set(left, top, right, bottom);

        trans.rectValueToPixel(mBarRect, mAnimator.getPhaseY());
    }

    <span class="comment">/**
     * 绘制数值  一系列的计算
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawValues</span><span class="params">(Canvas c)</span> </span>{
         略...     }

    <span class="comment">/**
     * 绘制高亮  一系列的计算
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawHighlighted</span><span class="params">(Canvas c, Highlight[] indices)</span> </span>{
            略...
    }

    <span class="keyword">public</span> <span class="keyword">float</span>[] getTransformedValues(Transformer trans, IBarDataSet data,
            <span class="keyword">int</span> dataSetIndex) {
        <span class="keyword">return</span> trans.generateTransformedValuesBarChart(data, dataSetIndex,
                mChart.getBarData(),
                mAnimator.getPhaseY());
    }

    <span class="comment">/**
     * 检查是否为可显示的值
     * <span class="doctag">@return</span>
     */</span>
    <span class="function"><span class="keyword">protected</span> <span class="keyword">boolean</span> <span class="title">passesCheck</span><span class="params">()</span> </span>{
        <span class="keyword">return</span> mChart.getBarData().getYValCount() &lt; mChart.getMaxVisibleCount()
                * mViewPortHandler.getScaleX();
    }

    <span class="comment">/**
     * 绘制其他
     * <span class="doctag">@param</span> c
     */</span>
    <span class="meta">@Override</span>
    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">drawExtras</span><span class="params">(Canvas c)</span> </span>{ }
}
</code></pre>
<p>可以看到里面就是图表项和文本绘制的具体实现了，主要方法是drawvalues方法，大致就是一些通过一些方法计算每条bar的值，然后进行绘制。</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>在这边简单讲解一下设计的方法。因为所有的Chart都继承了ViewGroup，实现了View的onMeasure,onDraw,onLayout，onSizeChanged方法，所以它是可以像自定义控件一样来使用。<br>View的绘制都再Render中实现，不同图表实现了不同的Render，继承结构大概如下：</p>
<ol>
<li>Render基类<ol>
<li>AxisRender（轴绘制）</li>
<li>DataRender（图表绘制抽象类）<ol>
<li>CombinedChartRender（复合图表绘制，这个类是3.0版本添加的，可以展示折线图，柱状图，散点图等混合）</li>
<li>BubbleChartRenderer(气泡图绘制)</li>
<li>BarChartRender(柱状图绘制)</li>
<li>LineScatterCandleRadarRenderer（折线图，散点图，烛状图，雷达图抽象类）<ol>
<li>LineRadarRenderer（折线图，雷达图抽象）<ol>
<li>LineChartRender(折线图绘制类)</li>
<li>RadarChartRender(雷达图绘制类)</li>
</ol>
</li>
<li>ScatterChartRender(散点图绘制) </li>
<li>CandleStickChartRenderer（烛状图绘制）</li>
</ol>
</li>
</ol>
</li>
<li>LegendRender（图例绘制）</li>
</ol>
</li>
</ol>
<p>在不同的图表构造中初始化不同的将mRender对象初始化成不同的图表的Render对象，这里传入的参数有</p>
<ol>
<li>不同图表的DataProvider（DataProvider是一个接口，实现了获取Y轴方向（左或右），和获取数据的方法）。</li>
<li>ChartAnimator这是一个动画类，执行动画效果</li>
<li>ViewPortHandler 图表信息类，包括边距，大小，转换等级（缩放）<br>之后这些Render类就根据自己的实现在canvas上面绘制东西了。</li>
</ol>
<h2 id="其他补充"><a href="#其他补充" class="headerlink" title="其他补充"></a>其他补充</h2><p>由于很好奇它的点击事件是怎么实现的，这边也看了一下它的点击事件。<br>每个图表写了自己的TouchListener<br>在构造中需要传入的参数有</p>
<ol>
<li>图表大小的矩阵（用来计算缩放等级，还有当前点击事件位置）</li>
<li>图表对象</li>
</ol>
<p>之后根据Touch事件判断相应的手势或者点击，触摸事件作出反应（点击，手势缩放，移动等）。调用View的postInvalidate 方法通知刷新。</p>
<p><strong><em>By Xiaolong,每一天都值得被认真对待！</em></strong></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/MPAndroidChart/" rel="tag"># MPAndroidChart</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2017/03/25/EventBusSource/" rel="next" title="EventBus的使用和源码解析">
                <i class="fa fa-chevron-left"></i> EventBus的使用和源码解析
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/05/07/WorkSummary 2017-05-07/" rel="prev" title="工作总结（二）">
                工作总结（二） <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/lucky.jpg"
               alt="小龙" />
          <p class="site-author-name" itemprop="name">小龙</p>
           
              <p class="site-description motion-element" itemprop="description">程序猿</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">36</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">16</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-tags">
              <a href="/tags/index.html">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/xiaolongonly" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://blog.csdn.net/guoxiaolongonly" target="_blank" title="CSDN">
                  
                    <i class="fa fa-fw fa-android"></i>
                  
                  CSDN
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#前言"><span class="nav-number">1.</span> <span class="nav-text">前言</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Chart基类"><span class="nav-number">2.</span> <span class="nav-text">Chart基类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MPAndroidChart绘制过程"><span class="nav-number">3.</span> <span class="nav-text">MPAndroidChart绘制过程</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Render"><span class="nav-number">3.1.</span> <span class="nav-text">Render</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#DataRender"><span class="nav-number">3.2.</span> <span class="nav-text">DataRender</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#BarChartRender"><span class="nav-number">3.3.</span> <span class="nav-text">BarChartRender</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#总结"><span class="nav-number">4.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#其他补充"><span class="nav-number">5.</span> <span class="nav-text">其他补充</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">小龙</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

</body>
</html>
